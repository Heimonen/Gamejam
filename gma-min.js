/*
 RequireJS 0.15.0+ Copyright (c) 2010, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details
*/
var require,define;
(function(){function f(E){return W.call(E)==="[object Function]"}function v(E,G,Q){var O=A.plugins.defined[E];if(O)O[Q.name].apply(null,Q.args);else{O=A.plugins.waiting[E]||(A.plugins.waiting[E]=[]);O.push(Q);X(["require/"+E],G.contextName)}}function h(E,G){ya.apply(X,E);G.loaded[E[0]]=true}function e(E,G,Q){var O,Z,da;for(O=0;da=G[O];O++){da=typeof da==="string"?{name:da}:da;Z=da.location;if(Q&&(!Z||Z.indexOf("/")!==0&&Z.indexOf(":")===-1))da.location=Q+"/"+(da.location||da.name);da.location=da.location||
da.name;da.lib=da.lib||"lib";da.main=da.main||"main";E[da.name]=da}}function g(E){var G=true,Q=E.config.priorityWait,O,Z;if(Q){for(Z=0;O=Q[Z];Z++)if(!E.loaded[O]){G=false;break}G&&delete E.config.priorityWait}return G}function l(E){var G,Q=A.paused;if(E.scriptCount<=0){for(E.scriptCount=0;Ba.length;){G=Ba.shift();G[0]===null?X.onError(new Error("Mismatched anonymous require.def modules")):h(G,E)}if(!(E.config.priorityWait&&!g(E))){if(Q.length){A.paused=[];for(E=0;G=Q[E];E++)X.checkDeps.apply(X,G)}J?
setTimeout(function(){X.checkLoaded(A.ctxName)},30):X.checkLoaded(A.ctxName)}}}function o(E,G){var Q=A.plugins.callbacks[E]=[];A.plugins[E]=function(){for(var O=0,Z;Z=Q[O];O++)if(Z.apply(null,arguments)===true&&G)return true;return false}}function r(E,G){if(!E.jQuery)if((G=G||(typeof jQuery!=="undefined"?jQuery:null))&&"readyWait"in G){E.jQuery=G;if(!E.defined.jquery&&!E.jQueryDef)E.defined.jquery=G;if(E.scriptCount){G.readyWait+=1;E.jQueryIncremented=true}}}function s(E){return function(G){E.exports=
G}}function w(E,G,Q){return function(){var O=[].concat(na.call(arguments,0));O.push(G,Q);return(E?require[E]:require).apply(null,O)}}function D(E,G){var Q=E.contextName,O=w(null,Q,G);X.mixin(O,{modify:w("modify",Q,G),def:w("def",Q,G),get:w("get",Q,G),nameToUrl:w("nameToUrl",Q,G),toUrl:w("toUrl",Q,G),ready:X.ready,context:E,config:E.config,isBrowser:A.isBrowser});return O}var L={},A,K,Y=[],aa,q,P,fa,S,F,ja={},xa,za=/(\/\*([\s\S]*?)\*\/|\/\/(.*)$)/mg,Ca=/require\(["']([\w\!\-_\.\/]+)["']\)/g,ya,B=!!(typeof window!==
"undefined"&&navigator&&document),J=!B&&typeof importScripts!=="undefined",R=B&&navigator.platform==="PLAYSTATION 3"?/^complete$/:/^(complete|loaded)$/,W=Object.prototype.toString,ia=Array.prototype,na=ia.slice,ta,X,Ja,Ba=[],Oa=false,Ka;if(typeof require!=="undefined")if(f(require))return;else ja=require;X=require=function(E,G,Q,O,Z){var da;if(typeof E==="string"&&!f(G))return require.get(E,G,Q,O);if(!require.isArray(E)){da=E;if(require.isArray(G)){E=G;G=Q;Q=O;O=Z}else E=[]}ya(null,E,G,da,Q,O);(E=
A.contexts[Q||da&&da.context||A.ctxName])&&E.scriptCount===0&&l(E)};X.onError=function(E){throw E;};define=X.def=function(E,G,Q,O){var Z,da,ga=Ka;if(typeof E!=="string"){O=Q;Q=G;G=E;E=null}if(!X.isArray(G)){O=Q;Q=G;G=[]}if(!E&&!G.length&&X.isFunction(Q)){Q.toString().replace(za,"").replace(Ca,function(ha,sa){G.push(sa)});G=["require","exports","module"].concat(G)}if(!E&&Oa){Z=document.getElementsByTagName("script");for(E=Z.length-1;E>-1&&(da=Z[E]);E--)if(da.readyState==="interactive"){ga=da;break}ga||
X.onError(new Error("ERROR: No matching script interactive for "+Q));E=ga.getAttribute("data-requiremodule")}if(typeof E==="string")A.contexts[A.ctxName].jQueryDef=E==="jquery";Ba.push([E,G,Q,null,O])};ya=function(E,G,Q,O,Z,da){var ga,ha,sa,ua,pa;Z=Z?Z:O&&O.context?O.context:A.ctxName;ga=A.contexts[Z];if(E){ha=E.indexOf("!");if(ha!==-1){sa=E.substring(0,ha);E=E.substring(ha+1,E.length)}else sa=ga.defPlugin[E];ha=ga.waiting[E];if(ga&&(ga.defined[E]||ha&&ha!==ia[E]))return}if(Z!==A.ctxName){ha=A.contexts[A.ctxName]&&
A.contexts[A.ctxName].loaded;ua=true;if(ha)for(pa in ha)if(!(pa in L))if(!ha[pa]){ua=false;break}if(ua)A.ctxName=Z}if(!ga){ga={contextName:Z,config:{waitSeconds:7,baseUrl:A.baseUrl||"./",paths:{},packages:{}},waiting:[],specified:{require:true,exports:true,module:true},loaded:{},scriptCount:0,urlFetched:{},defPlugin:{},defined:{},modifiers:{}};A.plugins.newContext&&A.plugins.newContext(ga);ga=A.contexts[Z]=ga}if(O){if(O.baseUrl)if(O.baseUrl.charAt(O.baseUrl.length-1)!=="/")O.baseUrl+="/";ua=ga.config.paths;
ha=ga.config.packages;X.mixin(ga.config,O,true);if(O.paths){for(pa in O.paths)pa in L||(ua[pa]=O.paths[pa]);ga.config.paths=ua}if((ua=O.packagePaths)||O.packages){if(ua)for(pa in ua)pa in L||e(ha,ua[pa],pa);O.packages&&e(ha,O.packages);ga.config.packages=ha}if(O.priority){X(O.priority);ga.config.priorityWait=O.priority}if(O.deps||O.callback)X(O.deps||[],O.callback);O.ready&&X.ready(O.ready);if(!G)return}if(G){pa=G;G=[];for(O=0;O<pa.length;O++)G[O]=X.splitPrefix(pa[O],E||da,ga)}da=ga.waiting.push({name:E,
deps:G,callback:Q});if(E){ga.waiting[E]=da-1;ga.specified[E]=true;if(da=ga.modifiers[E]){X(da,Z);if(da=da.__deferMods)for(O=0;O<da.length;O++){pa=da[O];ha=pa[pa.length-1];if(ha===undefined)pa[pa.length-1]=Z;else typeof ha==="string"&&da.push(Z);require.def.apply(require,pa)}}}if(E&&Q&&!X.isFunction(Q))ga.defined[E]=Q;sa&&v(sa,ga,{name:"require",args:[E,G,Q,ga]});A.paused.push([sa,E,G,ga]);if(E){ga.loaded[E]=true;ga.jQueryDef=E==="jquery"}};X.mixin=function(E,G,Q){for(var O in G)if(!(O in L)&&(!(O in
E)||Q))E[O]=G[O];return X};X.version="0.15.0+";A=X.s={ctxName:"_",contexts:{},paused:[],plugins:{defined:{},callbacks:{},waiting:{}},skipAsync:{},isBrowser:B,isPageLoaded:!B,readyCalls:[],doc:B?document:null};X.isBrowser=A.isBrowser;if(B){A.head=document.getElementsByTagName("head")[0];if(Ja=document.getElementsByTagName("base")[0])A.head=Ja.parentNode}X.plugin=function(E){var G,Q,O,Z=E.prefix,da=A.plugins.callbacks,ga=A.plugins.waiting[Z],ha;G=A.plugins.defined;O=A.contexts;if(G[Z])return X;G[Z]=
E;ha=["newContext","isWaiting","orderDeps"];for(G=0;Q=ha[G];G++){A.plugins[Q]||o(Q,Q==="isWaiting");da[Q].push(E[Q])}if(E.newContext)for(Q in O)if(!(Q in L)){G=O[Q];E.newContext(G)}if(ga){for(G=0;O=ga[G];G++)E[O.name]&&E[O.name].apply(null,O.args);delete A.plugins.waiting[Z]}return X};X.completeLoad=function(E,G){for(var Q;Ba.length;){Q=Ba.shift();if(Q[0]===null){Q[0]=E;break}else if(Q[0]===E)break;else h(Q,G)}Q&&h(Q,G);G.loaded[E]=true;r(G);G.scriptCount-=1;l(G)};X.pause=X.resume=function(){};X.checkDeps=
function(E,G,Q,O){if(E)v(E,O,{name:"checkDeps",args:[G,Q,O]});else for(E=0;G=Q[E];E++)if(!O.specified[G.fullName]){O.specified[G.fullName]=true;O.startTime=(new Date).getTime();G.prefix?v(G.prefix,O,{name:"load",args:[G.name,O.contextName]}):X.load(G.name,O.contextName)}};X.modify=function(E,G,Q,O,Z){var da,ga,ha=(typeof E==="string"?Z:G)||A.ctxName,sa=A.contexts[ha],ua=sa.modifiers;if(typeof E==="string"){ga=ua[E]||(ua[E]=[]);if(!ga[G]){ga.push(G);ga[G]=true}sa.specified[E]?X.def(G,Q,O,Z):(ga.__deferMods||
(ga.__deferMods=[])).push([G,Q,O,Z])}else for(da in E)if(!(da in L)){G=E[da];ga=ua[da]||(sa.modifiers[da]=[]);if(!ga[G]){ga.push(G);ga[G]=true;sa.specified[da]&&X([G],ha)}}};X.isArray=function(E){return W.call(E)==="[object Array]"};X.isFunction=f;X.get=function(E,G,Q){if(E==="require"||E==="exports"||E==="module")X.onError(new Error("Explicit require of "+E+" is not allowed."));G=G||A.ctxName;var O;O=A.contexts[G];Q=X.splitPrefix(E,Q,O);O=O.defined[Q.name];O===undefined&&X.onError(new Error("require: module name '"+
E+"' has not been loaded yet for context: "+G));return O};X.load=function(E,G){var Q=A.contexts[G],O=Q.urlFetched,Z=Q.loaded;A.isDone=false;Z[E]||(Z[E]=false);if(G!==A.ctxName)Y.push(arguments);else{Z=X.nameToUrl(E,null,G);if(!O[Z]){Q.scriptCount+=1;X.attach(Z,G,E);O[Z]=true;if(Q.jQuery&&!Q.jQueryIncremented){Q.jQuery.readyWait+=1;Q.jQueryIncremented=true}}}};X.jsExtRegExp=/^\/|:|\?|\.js$/;X.normalizeName=function(E,G,Q){if(E.charAt(0)===".")if(G){if(Q.config.packages[G])G=[G];else{G=G.split("/");
G=G.slice(0,G.length-1)}E=G.concat(E.split("/"));for(K=0;G=E[K];K++)if(G==="."){E.splice(K,1);K-=1}else if(G==="..")if(K===1)break;else if(K>1){E.splice(K-1,2);K-=2}E=E.join("/")}return E};X.splitPrefix=function(E,G,Q){var O=E.indexOf("!"),Z=null;if(O!==-1){Z=E.substring(0,O);E=E.substring(O+1,E.length)}E=X.normalizeName(E,G,Q);return{prefix:Z,name:E,fullName:Z?Z+"!"+E:E}};X.nameToUrl=function(E,G,Q,O){var Z,da,ga,ha;ha=A.contexts[Q];Q=ha.config;E=X.normalizeName(E,O,ha);if(X.jsExtRegExp.test(E))E=
E+(G?G:"");else{Z=Q.paths;da=Q.packages;O=E.split("/");for(ha=O.length;ha>0;ha--){ga=O.slice(0,ha).join("/");if(Z[ga]){O.splice(0,ha,Z[ga]);break}else if(ga=da[ga]){Z=ga.location+"/"+ga.lib;if(E===ga.name)Z+="/"+ga.main;O.splice(0,ha,Z);break}}E=O.join("/")+(G||".js");E=(E.charAt(0)==="/"||E.match(/^\w+:/)?"":Q.baseUrl)+E}return Q.urlArgs?E+((E.indexOf("?")===-1?"?":"&")+Q.urlArgs):E};X.blockCheckLoaded=true;X.checkLoaded=function(E){var G=A.contexts[E||A.ctxName],Q=G.config.waitSeconds*1E3,O=Q&&
G.startTime+Q<(new Date).getTime(),Z,da=G.defined,ga=G.modifiers,ha="",sa=false,ua=false,pa,Aa=A.plugins.isWaiting,Ga=A.plugins.orderDeps;if(!G.isCheckLoaded){if(G.config.priorityWait)if(g(G))l(G);else return;G.isCheckLoaded=X.blockCheckLoaded;Q=G.waiting;Z=G.loaded;for(pa in Z)if(!(pa in L)){sa=true;if(!Z[pa])if(O)ha+=pa+" ";else{ua=true;break}}if(!sa&&!Q.length&&(!Aa||!Aa(G)))G.isCheckLoaded=false;else{if(O&&ha){Z=new Error("require.js load timeout for modules: "+ha);Z.requireType="timeout";Z.requireModules=
ha;X.onError(Z)}if(ua){G.isCheckLoaded=false;if(B||J)setTimeout(function(){X.checkLoaded(E)},50)}else{G.waiting=[];G.loaded={};Ga&&Ga(G);for(pa in ga)pa in L||da[pa]&&X.execModifiers(pa,{},Q,G);for(Z=0;da=Q[Z];Z++)X.exec(da,{},Q,G);G.isCheckLoaded=false;if(G.waiting.length||Aa&&Aa(G))X.checkLoaded(E);else if(Y.length){Z=G.loaded;G=true;for(pa in Z)if(!(pa in L))if(!Z[pa]){G=false;break}if(G){A.ctxName=Y[0][1];pa=Y;Y=[];for(Z=0;G=pa[Z];Z++)X.load.apply(X,G)}}else{A.ctxName="_";A.isDone=true;X.callReady&&
X.callReady()}}}}};X.exec=function(E,G,Q,O){if(E){var Z=E.name,da=E.callback;da=E.deps;var ga,ha,sa=O.defined,ua,pa=[],Aa,Ga=false;if(Z){if(G[Z]||Z in sa)return sa[Z];G[Z]=true}if(da)for(ga=0;ha=da[ga];ga++){ha=ha.name;if(ha==="require")ha=D(O,Z);else if(ha==="exports"){ha=sa[Z]={};Ga=true}else if(ha==="module"){Aa=ha={id:Z,uri:Z?X.nameToUrl(Z,null,O.contextName):undefined};Aa.setExports=s(Aa)}else ha=ha in sa?sa[ha]:G[ha]?undefined:X.exec(Q[Q[ha]],G,Q,O);pa.push(ha)}if((da=E.callback)&&X.isFunction(da)){ua=
X.execCb(Z,da,pa);if(Z)if(Ga&&ua===undefined&&(!Aa||!("exports"in Aa)))ua=sa[Z];else if(Aa&&"exports"in Aa)ua=sa[Z]=Aa.exports;else{Z in sa&&!Ga&&X.onError(new Error(Z+" has already been defined"));sa[Z]=ua}}X.execModifiers(Z,G,Q,O);return ua}};X.execCb=function(E,G,Q){return G.apply(null,Q)};X.execModifiers=function(E,G,Q,O){var Z=O.modifiers,da=Z[E],ga,ha;if(da){for(ha=0;ha<da.length;ha++){ga=da[ha];ga in Q&&X.exec(Q[Q[ga]],G,Q,O)}delete Z[E]}};X.onScriptLoad=function(E){var G=E.currentTarget||
E.srcElement,Q;if(E.type==="load"||R.test(G.readyState)){Q=G.getAttribute("data-requirecontext");E=G.getAttribute("data-requiremodule");Q=A.contexts[Q];X.completeLoad(E,Q);G.removeEventListener?G.removeEventListener("load",X.onScriptLoad,false):G.detachEvent("onreadystatechange",X.onScriptLoad)}};X.attach=function(E,G,Q,O,Z){var da;if(B){O=O||X.onScriptLoad;da=document.createElement("script");da.type=Z||"text/javascript";da.charset="utf-8";da.async=!A.skipAsync[E];da.setAttribute("data-requirecontext",
G);da.setAttribute("data-requiremodule",Q);if(da.addEventListener)da.addEventListener("load",O,false);else{Oa=true;da.attachEvent("onreadystatechange",O)}da.src=E;Ka=da;Ja?A.head.insertBefore(da,Ja):A.head.appendChild(da);Ka=null;return da}else if(J){O=A.contexts[G];G=O.loaded;G[Q]=false;importScripts(E);X.completeLoad(Q,O)}return null};A.baseUrl=ja.baseUrl;if(B&&(!A.baseUrl||!A.head)){aa=document.getElementsByTagName("script");P=ja.baseUrlMatch?ja.baseUrlMatch:/(allplugins-)?require\.js(\W|$)/i;
for(K=aa.length-1;K>-1&&(q=aa[K]);K--){if(!A.head)A.head=q.parentNode;if(!F&&(F=q.getAttribute("data-main"))){ja.deps=ja.deps?ja.deps.concat(F):[F];if(!ja.baseUrl&&(fa=q.src)){fa=fa.split("/");fa.pop();A.baseUrl=ja.baseUrl=fa.length?fa.join("/"):"./"}}if(!A.baseUrl&&(fa=q.src))if(S=fa.match(P)){A.baseUrl=fa.substring(0,S.index);break}}}X.pageLoaded=function(){if(!A.isPageLoaded){A.isPageLoaded=true;ta&&clearInterval(ta);if(xa)document.readyState="complete";X.callReady()}};X.callReady=function(){var E=
A.readyCalls,G,Q,O;if(A.isPageLoaded&&A.isDone){if(E.length){A.readyCalls=[];for(G=0;Q=E[G];G++)Q()}E=A.contexts;for(O in E)if(!(O in L)){G=E[O];if(G.jQueryIncremented){G.jQuery.readyWait-=1;G.jQueryIncremented=false}}}};X.ready=function(E){A.isPageLoaded&&A.isDone?E():A.readyCalls.push(E);return X};if(B){if(document.addEventListener){document.addEventListener("DOMContentLoaded",X.pageLoaded,false);window.addEventListener("load",X.pageLoaded,false);if(!document.readyState){xa=true;document.readyState=
"loading"}}else if(window.attachEvent){window.attachEvent("onload",X.pageLoaded);if(self===self.top)ta=setInterval(function(){try{if(document.body){document.documentElement.doScroll("left");X.pageLoaded()}}catch(E){}},30)}document.readyState==="complete"&&X.pageLoaded()}X(ja);typeof setTimeout!=="undefined"&&setTimeout(function(){var E=A.contexts[ja.context||"_"];r(E);l(E)},0)})();
require.def("gma/constants",[],function(){return function(f){f=f||{};f.JUMPING="gma_j";f.FALLING="gma_f";f.STILL="gma_s";f.LEFT="gma_l";f.RIGHT="gma_r";f.TOP="gma_t";f.BOTTOM="gma_b";f.GRAVITY=-0.5;return f}()});
require.def("gma/base",["gma/constants","gma/convenience"],function(f){var v={};window.gma=v;v.constants=f;v.logger=console;v.insertScript=function(h){$("head").append("<script type='text/javascript'>"+h+"<\/script>")};v.test=function(h,e){h=JSpec.load(h);if(e)h=h.replace("require(",'require.def("'+e+'", ');v.insertScript(JSpec.preprocess(h))};v.instructions=function(h,e,g,l,o){if(l===undefined)l=true;l&&h.displayMessage(e);if(g){var r=function(){var s=false;return function(w,D){if(w.type==="keydown"){if(D)s=
true;if(s){if(o===undefined||manager.levelIndex===o)manager.hud.displayMessage(e);s=false}else{manager.hud.hideMessage();s=true}}}}();gma.keyHandler.register(g,r)}return r};return v});
require.def("gma/convenience",[],function(){if(typeof Object.create!=="function")Object.create=function(f){var v=function(){};v.prototype=f;return new v};Function.prototype.method=function(f,v){this.prototype[f]=v;return this};Function.method("bind",function(f){var v=Array.prototype.slice,h=v.apply(arguments,[1]),e=this;return function(){return e.apply(f,h.concat(v.apply(arguments,[0])))}});Function.method("curry",function(){var f=this,v=Array.prototype.slice,h=v.apply(arguments);return function(){return f.apply(null,
h.concat(v.apply(arguments)))}});Object.method("superior",function(f){var v=this,h=v[f];return function(){return h.apply(v,arguments)}});RegExp.method("test",function(f){return this.exec(f)!==null});Number.method("integer",function(){return Math[this<0?"ceil":"floor"](this)});String.method("charAt",function(f){return this.slice(f,f+1)});String.method("trim",function(){return this.replace(/^\s+|\s+$/g,"")});String.method("entityify",function(){var f={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"};
return function(){return this.replace(/[<>&"]/g,function(v){return f[v]})}}());String.method("deentityify",function(){var f={quot:'"',lt:"<",gt:">"};return function(){return this.replace(/&([^&;]+);/g,function(v,h){h=f[h];return typeof h==="string"?h:v})}}());Array.method("pop",function(){return this.splice(this.length-1,1)[0]});Array.method("push",function(){this.splice.apply(this,[this.length,0].concat(Array.prototype.slice.apply(arguments)));return this.length});Array.method("shift",function(){return this.splice(0,
1)[0]});Array.method("unshift",function(){this.splice.apply(this,[0,0].concat(Array.prototype.slice.apply(arguments)));return this.length});Array.method("splice",function(f,v){var h,e,g,l=0;h=Math.max;g=Math.min;var o=this.length,r=[],s=h(arguments.length-2,0);f=f||0;if(f<0)f+=o;f=h(g(f,o),0);v=h(g(typeof v==="number"?v:o,o-f),0);h=s-v;for(g=o+h;l<v;){e=this[f+l];if(e!==undefined)r[l]=e;l+=1}e=o-f-v;if(h<0){for(l=f+s;e;){this[l]=this[l-h];l+=1;e-=1}this.length=g}else if(h>0)for(l=1;e;){this[g-l]=
this[o-l];l+=1;e-=1}for(l=0;l<s;l+=1)this[f+l]=arguments[l+2];return r})});
require.def("gma/events",["gma/base"],function(f){f.keyHandler=function(v){v=v||{};var h={};v.keyCheck=function(e){var g=e.which||e.keyCode;h[g]&&_.each(h[g],function(l){l(e)})};$(document).keydown(v.keyCheck);$(document).keyup(v.keyCheck);v.register=function(e,g){if(_.isString(e)&&e.length>1||!_.isString(e)&&!_.isNumber(e))throw new Error("Can only register keycodes or characters");if(_.isString(e))e=e.charCodeAt(0);h[e]||(h[e]=[]);h[e].push(g)};v.numEvents=function(e){if(e){if(h[e])return h[e].length;
return 0}else return _.flatten(h).length};v.reset=function(){h={}};return v}()});require.def("gma/entities/base",["gma/base"],function(f){f.entities=f.entities||{}});
require.def("gma/entities/platform",["gma/base","gma/entities/base","gma/entities/shapes","gma/utils/collisions"],function(f){f.platform=function(v){var h=f.shapes.rectangle(v||{x:0,y:0,width:1,height:1});if(!h)throw new Error("Can't create rectangle for platform");h.tags.platform=true;var e=h.collided;h.collided=function(){e.apply(this,arguments);h.tags.deathtouch&&h.collided__deathtouch.apply(this,arguments)};return h};f.deathPlatform=function(v){v=f.platform(v);v.tags.deathtouch=true;return v}});
require.def("gma/manager",["gma/base","gma/entities/platform","gma/utils/hud","gma/utils/render","gma/utils/parser"],function(f){f.manager=function(v){var h=v||{};h.width=h.width||800;h.height=h.height||600;h.containerID=h.containerID||"gamma";h.container=h.container||$("#"+h.containerID);h.container.css({width:h.width,height:h.height});h.canvas=h.canvas||function(){var r=h.container.find("canvas");if(r.length===0){h.container.html('<canvas id="theCanvas" height="'+h.height+'" width="'+h.width+'"></canvas>');
r=h.container.find("canvas")}return r[0]}();h.sceneHelper=h.sceneHelper||f.sceneHelper();h.resources=h.resources||[];h.levelParser=h.levelParser||f.levelParser();h.levels=h.levels||[];h.levelIndex=h.levelIndex||0;h.hud=h.hud||f.hud({canvasContainer:h.container});if(h.showLoading!==false)h.showLoading=true;h.showLoading&&h.hud.displayMessage("Loading...",500);var e,g=0,l=0,o=0;h.getFPS=h.getFPS||function(){return l};h.background=h.background||function(){return h.sceneHelper&&h.sceneHelper.background?
h.sceneHelper.background:[]};h.entities=h.entities||function(){return h.currentLevel?h.character&&h.character.alive?_.flatten([h.currentLevel.entities,h.character]):h.currentLevel.entities:[]};h.determineObject=h.determineObject||function(r,s){if(_.isString(r))if(f[r])r=f[r](s);else throw new Error("No such object as gma."+r);else s&&_.each(s,function(w,D){r[D]=w});return r};h.prepareEntity=h.prepareEntity||function(r,s,w){w&&_.each(w,function(D,L){r[L]=D});r.helper=f.renderHelper({template:s||f.unitCube});
r.helper.template.sceneHelper=h.sceneHelper;r.helper.attachTo(r);return r};h.addCustomDefinitions=h.addCustomDefinitions||function(r){h.levelParser.process(h,r)};h.storeLevels=h.storeLevels||function(r,s){if(s)h.levels=[];_.isArray(r)||(r=[r]);h.levels=_.flatten([h.levels,r])};h.loadLevel=h.loadLevel||function(r,s){if(!h.levelParser)throw new Error("The manager must be given a level parser object before it can load a level");if(!_.isArray(h.levels)||h.levels.length===0)throw new Error("You must call storeLevels on the manager first before you can load any level");
if(r>h.levels.length-1)throw new Error("No level at index "+r+", manager only has "+h.levels.length+" levels");h.clearLevel();s||(s="main");r=h.levelIndex=r||0;r=h.levels[r]=h.levelParser.process(h,h.levels[r]);var w=h.sceneHelper;if(h.character){h.character.setBottomLeft(r.spawn[s]);s=h.character.template||"cube";var D=false;if(_.isString(s)){s=h.levelParser.templates[h.character.template];D=true}if(D||!h.character.helper){_.isArray(s)||(s=[s]);s=h.determineObject.apply(this,s);h.prepareEntity(h.character,
s);h.character.template=s}}r.camera=w.addExtra("camera","camera",r.camera);_.each(r.light,function(L,A){r.light[A]=w.addExtra(A,"light",L)});_.each(r.background,function(L){w.addExtra(L.id,"background",L)});_.each(r.following,function(L,A){if(L[0]==="character")L[0]=h.character;L[0]&&w.attach.curry(A).apply(this,L)});for(h.currentLevel=r;r.removed.length>0;){s=r.removed.pop();s.alive=true;r.entities.push(s)}_.each(h.entities(),function(L){w.add(L.helper)});_.each(h.background(),function(L){w.add(L)});
w.setupScene(h)};h.clearLevel=h.clearLevel||function(){if(h.currentLevel){_.each(h.currentLevel.following,function(r,s){h.sceneHelper.detach(s)});h.sceneHelper.removeBackground(h.currentLevel.bkgIds);h.currentLevel.levelExtras&&h.sceneHelper.removeExtras(h.currentLevel.levelExtras);_.each(h.entities(),function(r){r.helper&&r.helper.remove()});h.sceneHelper.clear()}};h.init=h.init||function(r,s){h.sceneHelper.init(h,h.resources,function(){if(!h.currentLevel||r)h.loadLevel(r,s);e=new Date;window.manager=
h;setTimeout(h.twitch.curry(h),25)})};h.twitch=h.twitch||function(r){if(r.currentLevel){if(e===undefined)e=new Date;var s=new Date,w=(s-e)/1E3;g+=w;o++;r.animate(w);r.removeDead(r.currentLevel.entities,r.currentLevel.removed);r.checkCharacter();e=s;r.sceneHelper.render(r);if(g>1){l=o/g;o=g=0}r.hud.refresh();s=new Date-e;setTimeout(r.twitch.curry(r),s>30?0:30-s)}};h.animate=h.animate||function(r){_.each(h.entities(),function(s){s.animate!==undefined&&s.animate(r,h)})};h.removeDead=h.removeDead||function(r,
s){index=0;for(var w;index<r.length;){w=r[index];if(w.alive!==true){w.helper.remove();r.splice(index,1);w.tags.reincarnate&&s.push(w)}else index+=1}};h.checkCharacter=h.checkCharacter||function(){h.character&&h.character.alive!==true&&h.character.helper.remove()};h.respawn=h.respawn||function(r){if(h.character&&h.currentLevel){h.character.alive=true;h.character.setBottomLeft(h.currentLevel.spawn[r||"main"]);h.sceneHelper.add(h.character.helper)}};return h}});
require.def("gma/entities/shapes",["gma/base","gma/entities/base"],function(f){f.shapes=function(v){var h=v||{};h.rectangle=h.rectangle||function(e){if(e.centre===undefined&&e.x!==undefined&&e.y!==undefined)e.centre=[e.x,e.y];if(e.points===null)e.points=undefined;if(e.points!==undefined){e.top=undefined;e.left=undefined;e.right=undefined;e.bottom=undefined;if(e.points.length>=2){_.each(e.points,function(l){var o=l[0];l=l[1];if(e.left===undefined||e.left>o){if(e.left!==undefined&&(e.right===undefined||
e.right<e.left))e.right=e.left;e.left=o}else if(e.right===undefined||e.right<o)e.right=o;if(e.top===undefined||e.top<l){if(e.top!==undefined&&(e.bottom===undefined||e.top<e.bottom))e.bottom=e.top;e.top=l}else if(e.bottom===undefined||e.bottom>l)e.bottom=l});if(e.left===e.right||e.top===e.bottom){e.top=undefined;e.left=undefined;e.right=undefined;e.bottom=undefined}else{e.width=e.right-e.left;e.height=e.top-e.bottom}}else e.points=undefined}if(e.points===undefined)if(e.width!==undefined&&e.height!==
undefined){if(e.top!==undefined&&e.bottom!==undefined)if(e.top-e.bottom!==e.height){e.top=undefined;e.bottom=undefined}if(e.left!==undefined&&e.right!==undefined)if(e.right-e.left!==e.width){e.right=undefined;e.left=undefined}if(e.width>0&&e.height>0)if(e.centre){e.top=e.centre[1]+e.height/2;e.bottom=e.centre[1]-e.height/2;e.left=e.centre[0]-e.width/2;e.right=e.centre[0]+e.width/2}else{if(e.top!==undefined)e.bottom=e.top-e.height;else if(e.bottom!==undefined)e.top=e.bottom+e.height;else if(e.y!==
undefined){e.bottom=e.y-e.height/2;e.top=e.y+e.height/2}if(e.left!==undefined)e.right=e.left+e.width;else if(e.right!==undefined)e.left=e.right-e.width;else if(e.x!==undefined){e.left=e.x-e.width/2;e.right=e.x+e.width/2}}}else if(e.width!==undefined&&e.width>0){if(e.left!==undefined&&e.right!==undefined){if(e.right-e.left!==e.width){e.right=undefined;e.left=undefined}}else if(e.top!==undefined&&e.bottom!==undefined)if(e.left!==undefined)e.right=e.left+e.width;else if(e.right!==undefined)e.left=e.right-
e.width;else if(e.x!==undefined){e.left=e.x-e.width/2;e.right=e.x+e.width/2}e.height=e.top-e.bottom}else if(e.height!==undefined&&e.height>0){if(e.top!==undefined&&e.bottom!==undefined){if(e.top-e.bottom!==e.height){e.top=undefined;e.bottom=undefined}}else if(e.right!==undefined&&e.left!==undefined)if(e.top!==undefined)e.bottom=e.top-e.height;else if(e.bottom!==undefined)e.top=e.bottom+e.height;else if(e.y!==undefined){e.top=e.y+e.height/2;e.bottom=e.y-e.height/2}e.width=e.right-e.left}else{e.width=
e.right-e.left;e.height=e.top-e.bottom}if(e.top!==undefined&&e.left!==undefined&&e.right!==undefined&&e.bottom!==undefined){e.alive=e.alive||true;e.z=e.z||0;e.depth=e.depth||1;if(e.solid===undefined)e.solid=true;var g={};_.isArray(e.tags)&&_.each(e.tags,function(l){g[l]=true});e.tags=g;e.tags.shape=true;if(e.x===undefined||e.y===undefined){e.x=e.left+e.width/2;e.y=e.bottom+e.height/2}e.xOffset=e.xOffset||0;e.yOffset=e.yOffset||0;e.setPointsAndEdges=e.setPointsAndEdges||function(){e.points=[[e.left,
e.bottom],[e.right,e.bottom],[e.right,e.top],[e.left,e.top]];e.edges={};e.edges[f.constants.BOTTOM]=[e.points[0],e.points[1]];e.edges[f.constants.RIGHT]=[e.points[1],e.points[2]];e.edges[f.constants.TOP]=[e.points[2],e.points[3]];e.edges[f.constants.LEFT]=[e.points[3],e.points[0]]};e.setCentre=e.setCentre||function(l){e.centre=l;e.x=l[0];e.left=e.x-e.width/2;e.right=e.x+e.width/2;e.y=l[1];e.top=e.y+e.height/2;e.bottom=e.y-e.height/2;e.setPointsAndEdges()};e.setBottomLeft=e.setBottomLeft||function(l){e.left=
l[0];e.bottom=l[1];e.right=e.left+e.width;e.top=e.bottom+e.height;e.x=e.left+e.width/2;e.y=e.bottom+e.height/2;e.setPointsAndEdges()};e.xOf=function(l){return l===f.constants.LEFT?e.left:l===f.constants.RIGHT?e.right:null};e.yOf=function(l){return l===f.constants.TOP?e.top:l===f.constants.BOTTOM?e.bottom:null};e.toString=function(){return"y:"+e.y+" x:"+e.x+" t:"+e.top+" b:"+e.bottom+" l:"+e.left+" r:"+e.right+" w:"+e.width+" h:"+e.height};e.collided=h.collided||function(){};e.collided__deathtouch=
h.collided__deathtouch||function(l,o){o.tags.character&&o.kill()};e.setPointsAndEdges();return e}};return h}()});require.def("gma/utils/base",["gma/base"],function(f){f.utils=f.utils||{}});
require.def("gma/utils/collisions",["gma/base","gma/utils/base"],function(f){f.collisions=function(v){var h=v||{};h.factories={findBlockers:function(e,g){var l=_.max([e.top,e.top+g[1]]),o=_.min([e.left,e.left+g[0]]),r=_.max([e.right,e.right+g[0]]),s=_.min([e.bottom,e.bottom+g[1]]);return function(w){return w!==e&&!_.any([w.top<=s,w.left>=r,w.right<=o,w.bottom>=l])}},findGround:function(e){var g=e.bottom,l=e.left,o=e.right;return function(r){if(r.solid===false)return false;var s=g-r.top,w=r.left>l&&
r.left<o,D=r.right>l&&r.right<o,L=r.left<=l&&r.right>=o;if(s=s>=0&&s<0.1&&_.any([w,D,L])){e.collided(f.constants.BOTTOM,r,f.constants.TOP,null);r.collided(f.constants.TOP,e,f.constants.BOTTOM,null)}return s}},findCollisions:function(e,g){var l=[],o=[];if(g[0]>0){l.push(f.constants.LEFT);o.push(f.constants.RIGHT)}else if(g[0]<0){l.push(f.constants.RIGHT);o.push(f.constants.LEFT)}if(g[1]>0){l.push(f.constants.BOTTOM);o.push(f.constants.TOP)}else if(g[1]<0){l.push(f.constants.TOP);o.push(f.constants.BOTTOM)}var r=
0;if(g[1]!==0)r=g[1]/g[0];var s,w,D,L,A,K,Y,aa,q,P,fa,S,F,ja,xa,za,Ca,ya,B;return function(J){A=g[0];K=g[1];if(l.length===1){if(l[0]===f.constants.RIGHT||l[0]===f.constants.LEFT){q=J.xOf(l[0]);P=e.xOf(o[0]);A=_.min([q-P,g[0]],Math.abs)}else{fa=J.yOf(l[0]);S=e.yOf(o[0]);K=_.min([fa-S,g[1]],Math.abs)}L=l[0];D=o[0]}else{q=J.xOf(l[0]);fa=J.yOf(l[1]);P=e.xOf(o[0]);S=e.yOf(o[1]);F=q-P;ja=fa-S;B=ya=false;if(F===0||l[0]===f.constants.RIGHT&&F<0||l[0]===f.constants.LEFT&&F>0)B=true;if(ja===0||l[1]===f.constants.BOTTOM&&
ja>0||l[1]===f.constants.TOP&&ja<0)ya=true;ja=Math.abs(ja);F=Math.abs(F);if(o[0]===f.constants.RIGHT)if(o[1]!==f.constants.TOP)ja=-ja;if(o[0]===f.constants.LEFT)if(o[1]===f.constants.TOP)F=-F;else{F=-F;ja=-ja}za=Math.abs(ja/r);xa=Math.abs(r*F);if(B&&ya){if(xa<Math.abs(ja))B=false;if(za<Math.abs(F))ya=false}w=true;if(B&&ya){aa=ja;Y=F;L=l[1];D=o[1];w=false}else if(B){Y=F;aa=K;L=l[0];D=o[0];s=Math.abs(J.yOf(o[1])-e.yOf(l[1]));w=xa>=s}else if(ya){aa=ja;Y=A;L=l[1];D=o[1];s=Math.abs(J.xOf(o[0])-e.xOf(l[0]));
w=za>=s}if(w===false){A=Y;K=aa}}if(A!==g[0]||K!==g[1]){e.collided(D,J,L,null);J.collided(L,e,D,g)}return Ca=J.solid===true?[A,K]:g}}};h.detectCollisions=h.detectCollisions||function(e,g,l){var o=h.factories.findBlockers(e,g);e=h.factories.findCollisions(e,g);l=_.filter(l,o);o=_.map(l,e);if(o.length>0){l=_.min(_.map(o,function(r){return r[0]}),Math.abs);g=_.min(_.map(o,function(r){return r[1]}),Math.abs)}else{l=g[0];g=g[1]}return[l,g]};return h}()});
require.def("gma/utils/hud",["gma/base","gma/utils/base"],function(f){f.hud=function(v){var h=v||{},e=[];h.setup=h.setup||function(g){if(!h.canvasContainer)throw new Error("HUD needs a canvas container");h.reset();g&&_.each(g,function(l,o){var r=o.split("_");h[o]=h.createSection.apply(this,r);r=h[o];r.functions=[];h.fillSection(r,l);e.push(o)})};h.createSection=h.createSection||function(g,l){var o=$(h.canvasContainer).find("#"+g+"_hud");if(o.length===0){o=$('<div id="'+g+'_hud"></div>');o.appendTo($(h.canvasContainer))}g=
o.find("."+l).first();if(g.length===0){g=$('<dl class="'+l+'"></dl>');g.appendTo(o)}return g};h.fillSection=h.fillSection||function(g,l){_.each(l,function(o,r){var s="hud_"+r.toLowerCase(),w=g.find("dt#"+s);w.length===0&&g.append('<dt id="'+s+'"></dt>');w=g.find("dt#"+s);w.find("span").length===0&&w.append("<span>"+r+"</span");if(_.isFunction(o)){r=$("<dd>"+o()+"</dd>");if(!_.isArray(g.functions))g.functions=[];g.functions.push([r,o])}else r=$("<dd>"+o+"</dd>");r.appendTo(g)})};h.reset=h.reset||function(){$(h.canvasContainer).find("div[id$='_hud']").remove();
_.each(e,function(g){h[g]=undefined});e=[]};h.refresh=h.refresh||function(){_.each(e,function(g){_.each(h[g].functions,function(l){l[0].text(l[1]())})})};h.hide=h.hide||function(g){if(g!==undefined)if(g.indexOf("_")===-1){$(h.canvasContainer).find("#"+g+"_hud").first().hide();$(h.canvasContainer).find("#"+g+"_hud").find("dl").hide()}else{h[g].hide();g=h[g].parent();_.all(g.children(),function(l){return $(l).css("display")==="none"})&&g.hide()}else{$(h.canvasContainer).find("div[id$='_hud']").hide();
$(h.canvasContainer).find("div[id$='_hud'] dl").hide()}};h.show=h.show||function(g){if(g!==undefined)if(g.indexOf("_")===-1){$(h.canvasContainer).find("#"+g+"_hud").first().show();$(h.canvasContainer).find("#"+g+"_hud").find("dl").show()}else{h[g].show();h[g].parent().show()}else{$(h.canvasContainer).find("div[id$='_hud']").show();$(h.canvasContainer).find("div[id$='_hud'] dl").show()}};h.displayMessage=h.displayMessage||function(g,l,o){var r=$(h.canvasContainer).find("div#message");if(r.length===
0){r=$("<div id='message'></div>");$(h.canvasContainer).append(r)}else r=r.first();r.html(g);r.show();if(_.isNumber(l))setTimeout(function(){h.hideMessage();_.isFunction(o)&&o()},l);else _.isFunction(o)&&o()};h.hideMessage=h.hideMessage||function(){var g=$(h.canvasContainer).find("div#message");g.length!==0&&g.first().hide()};return h}});
require.def("gma/utils/render",["gma/base","gma/utils/base"],function(f){var v=function(h,e,g){var l;_.each(e,function(o,r){if(!g||!_.any(_.map(g,function(s){return s===r}))){l=h["set"+r[0].toUpperCase()+r.substr(1)];_.isFunction(l)&&l.apply(h,[o])}})};f.sceneHelper=function(h){var e=h||{};e.bkgIds=e.bkgIds||{};e.background=e.background||[];e.extras=e.extras||{};e.attached=e.attached||{};e.scene=e.scene||function(){e.scene=new GLGE.Scene;e.scene.setAmbientColor("#999");e.scene.setBackgroundColor("#999");
return e.scene}();e.grp=new GLGE.Group;e.init=e.init||function(g,l,o){e.doc=e.doc||new GLGE.Document;e.doc.onLoad=function(){o()};l&&l.length>0?_.each(l,function(r){e.doc.loadDocument(r)}):e.doc.onLoad()};e.setupScene=e.setupScene||function(g){if(!e.extras.camera)e.extras.camera=new GLGE.Camera;e.scene.camera=e.extras.camera;_.each(e.extras,function(l){e.grp.addObject(l)});e.scene.addChild(e.grp);e.renderer&&e.makeRenderer(g)};e.makeRenderer=e.makeRenderer||function(g){e.renderer=e.renderer||new GLGE.Renderer(g.canvas);
e.renderer.setScene(e.scene)};e.clear=e.clear||function(){e.scene.removeChild(e.grp)};e.add=e.add||function(g){g.addTo(e.grp)};e.countContained=e.countContained||function(){return e.grp.children.length};e.render=e.render||function(g){e.renderer||e.makeRenderer(g);e.setRenderedLocations(g);e.renderer.render()};e.setRenderedLocations=e.setRenderedLocations||function(g){_.each(g.entities(),function(l){l.helper&&l.helper.setLocation()});_.each(e.attached,function(l,o){var r=l[0],s=l[1],w=l[2];l=l[3];
var D=e.extras[o];D||(D=e.bkgIds[o].getRenderedObj());if(D){D.setLocX(r.x+s);D.setLocY(r.y+w);l&&D.setLocZ(r.z+l)}})};e.addExtra=e.addExtra||function(g,l,o){var r=o||{},s=false;if(l==="background"){if(o){e.background.push(o);if(o.id)e.bkgIds[o.id]=o}return o}if(l==="light")if(r.className!="Light"){r=new GLGE.Light;s=true}if(l==="camera")if(r.className!="Camera"){r=new GLGE.Camera;s=true}o&&s&&v(r,o);r.setId(g);return e.extras[g]=r};e.removeExtras=e.removeExtras||function(g){g&&_.each(g,function(l){var o=
e.extras[l];if(o){e.grp.removeChild(o);e.extras[l]=undefined;delete e.extras[l]}})};e.removeBackground=e.removeBackground||function(g){g&&_.each(g,function(l){var o=e.bkgIds[l];if(o){o.remove&&o.remove();e.bkgIds[l]=undefined;delete e.bkgIds[l]}});if(e.background){temp=[];_.each(e.background,function(l){if(l.id&&e.bkgIds[l.id])temp.push(l);else l.remove&&l.remove()});e.background=temp}};e.attach=e.attach||function(g,l,o,r,s){e.attached[g]=[l,o||0,r||0,s]};e.detach=e.detach||function(g){e.attached[g]&&
delete e.attached[g]};return e};f.renderHelper=function(h){var e=h||{},g;e.attachTo=e.attachTo||function(l){e.entity=l;e._instance=undefined};e.addTo=e.addTo||function(l){e.parent=l;var o=e.getRenderedObj();o.setScale(e.entity.width,e.entity.height,e.entity.depth);o.notifyOfScale&&o.notifyOfScale(e.entity.width,e.entity.height,e.entity.depth);o.setLoc(e.entity.x,e.entity.y,e.entity.z);l.addObject(o)};e.setLocation=e.setLocation||function(){var l=e.getRenderedObj();l.setLocX(e.entity.x);l.setLocY(e.entity.y);
e.entity.getRotation&&l.setRotY(e.entity.getRotation())};e.getRenderedObj=e.getRenderedObj||function(){if(!e._instance)e._instance=e.template.getInstance();return e._instance};e.remove=e.remove||function(){if(e.parent){e.parent.removeChild(e.getRenderedObj());e.parent=undefined}};e.toggleBounding=e.toggleBounding||function(){var l=e.getRenderedObj(),o=e.parent;e.remove();e._instance=g||f.unitCube.getInstance();g=l;e.addTo(o)};return e};f.baseTemplate=function(h){var e=h||{};e.xRot=e.xRot||0;e.yRot=
e.yRot||0;e.zRot=e.zRot||0;e.xScale=e.xScale||1;e.yScale=e.yScale||1;e.zScale=e.zScale||1;e.xOffset=e.xOffset||0;e.yOffset=e.yOffset||0;e.zOffset=e.zOffset||0;e.defineInstance=e.defineInstance||function(){return new GLGE.Object};e.getInstance=e.getInstance||function(){var g=e.defineInstance(),l=new GLGE.Group;g.setLoc(e.xOffset,e.yOffset,e.zOffset);g.setScale(e.xScale,e.yScale,e.zScale);g.setRot(e.xRot,e.yRot,e.zRot);l.addChild(g);l.notifyOfScale=g.notifyOfScale||function(){};return l};return e};
f.colladaTemplate=function(h){var e=f.baseTemplate(h||{});e.defineInstance=function(){var g=new GLGE.Collada;e.collada.document&&g.setDocument(e.collada.document,g.getAbsolutePath(window.location.toString(),null));e.collada&&v(g,e.collada,["document"]);return g};return e};f.glgeIDTemplate=function(h){var e=f.baseTemplate(h||{});e.defineInstance=function(){return e.sceneHelper.doc.getElement(e.id)};return e};f.meshTemplate=function(h){var e=f.baseTemplate(h||{});e.defineInstance=function(){var g=new GLGE.Object,
l;if(e.mesh){l=new GLGE.Mesh;v(l,e.mesh);g.setMesh(l)}if(e.material){l=new GLGE.Material;v(l,e.material);g.setMaterial(l)}else if(e.texture){var o=new GLGE.MaterialLayer,r=new GLGE.Texture;r.setSrc(e.texture.src);o.setMapinput(GLGE.UV1);o.setMapto(GLGE.M_COLOR);o.setTexture(r);g.notifyOfScale=function(s,w){o.setDScaleX(e.texture.repeatX*s);o.setDScaleY(e.texture.repeatY*w)};l=new GLGE.Material;g.setMaterial(l);l.addTexture(r);l.addMaterialLayer(o)}return g};return e};f.unitCubeInfo={mesh:{positions:[0.5,
0.5,-0.5,0.5,-0.5,-0.5,-0.5,-0.5,-0.5,-0.5,0.5,-0.5,0.5,0.5,0.5,-0.5,0.5,0.5,-0.5,-0.5,0.5,0.5,-0.5,0.5,0.5,0.5,-0.5,0.5,0.5,0.5,0.5,-0.5,0.5,0.5,-0.5,-0.5,0.5,-0.5,-0.5,0.5,-0.5,0.5,-0.5,-0.5,0.5,-0.5,-0.5,-0.5,-0.5,-0.5,-0.5,-0.5,-0.5,0.5,-0.5,0.5,0.5,-0.5,0.5,-0.5,0.5,0.5,0.5,0.5,0.5,-0.5,-0.5,0.5,-0.5,-0.5,0.5,0.5],normals:[0,0,-0.5,0,0,-0.5,0,0,-0.5,0,0,-0.5,0,0,0.5,0,0,0.5,0,0,0.5,0,0,0.5,0.5,0,0,0.5,0,0,0.5,0,0,0.5,0,0,0,-0.5,0,0,-0.5,0,0,-0.5,0,0,-0.5,0,-0.5,0,0,-0.5,0,0,-0.5,0,0,-0.5,0,0,
0,0.5,0,0,0.5,0,0,0.5,0,0,0.5,0],UV:[0,0,0.5,0,0.5,0.5,0,0.5,0,0,0.5,0,0.5,0.5,0,0.5,0,0,0.5,0,0.5,0.5,0,0.5,0,0,0.5,0,0.5,0.5,0,0.5,0,0,0.5,0,0.5,0.5,0,0.5,0,0,0.5,0,0.5,0.5,0,0.5],faces:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]},material:{color:"#009"}};f.unitCube=f.meshTemplate(f.unitCubeInfo)});
require.def("gma/utils/background",["gma/base","gma/utils/render","gma/entities/shapes"],function(f){f.backgroundMaker=function(v){var h=v||{};h.z=h.z||0;h.process=h.process||function(e,g){if(g){if(_.isString(g.config)){func=h["process_"+g.config];if(_.isFunction(func))return func(e,g,g.config)}else if(_.isFunction(g.config))return g.config(e,g);return h.process_other(e,g,g.config)}};h.sanitise=h.sanitise||function(e,g){g=g||{x:0,y:0,width:1,height:1};g=_.extend(g,e,e.entity);e.entity=f.shapes.rectangle(g)};
h.process_other=h.process_other||function(e,g){h.sanitise(g);e=(g.template||f.unitCube).getInstance();g._instance=e;return f.renderHelper(g)};h.process_skybox=h.process_skybox||function(e,g){if(!g.mesh)g.mesh=f.unitCubeInfo.mesh;if(!g.texture&&!g.material)g.material=f.unitCubeInfo.material;g.texture&&g.material&&delete g.material;h.sanitise(g,{width:50,height:50,depth:1,x:0,y:0,z:-50});e=f.meshTemplate(g).getInstance();g._instance=e;return f.renderHelper(g)};return h}});
require.def("gma/utils/parser",["gma/base","gma/utils/base","gma/utils/background"],function(f){f.utils.expandReplicateWith=function(v){var h=v;if(v.replicateWith!==undefined){v=v.replicateWith;delete h.replicateWith;v=_.map(v,function(e){var g={};_.each(h,function(l,o){g[o]=l});_.each(e,function(l,o){g[o]=l});return g});if(v.length===1)v=v[0]}h=v;if(_.isArray(v)){v=[];_.each(h,function(e){var g=e.replicateWith!==undefined,l=f.utils.expandReplicateWith(e);g?_.each(l,function(o){v.push(o)}):v.push(e)})}else if(!_.isString(v)&&
!_.isFunction(v)&&!_.isNumber(v)&&!_.isDate(v)&&!_.isBoolean(v))_.any(v,function(e){return _.isFunction(e)})||_.each(v,function(e,g){v[g]=f.utils.expandReplicateWith(e)});return v};f.levelParser=function(v){var h=v||{};h.templates=h.templates||{cube:f.unitCube,redcube:["meshTemplate",{mesh:f.unitCubeInfo.mesh,material:{color:"#900"}}]};h.types=h.types||{"default":["platform",{template:"cube"}]};h.process=h.process||function(e,g){if(g.processed===true)return g;var l=h.validate_other,o=h.process_other;
g=h.preProcess(e,g);_.each(g,function(r,s){var w=h["validate_"+s]||l;if(!w(e,s,r,g)){r=undefined;if(w=h["default_"+s])r=w();else delete g[s]}if(r){w=h["process_"+s]||o;w(e,s,r,g)}});g.processed=true;return g};h.preProcess=h.preProcess||function(e,g){g=f.utils.expandReplicateWith(g);g.spawn=g.spawn||h.default_spawn();if(!g.spawn.main)g.spawn.main=[0,0];g.light=g.light||h.default_light();g.camera=g.camera||h.default_camera();g.entities=g.entities||h.default_entities();g.bkgIds=g.bkgIds||[];g.removed=
g.removed||[];g.following=g.following||{};g.background=g.background||[];g.levelExtras=g.levelExtras||["camera"];return g};h.processPosition=h.processPosition||function(e){var g=e.locX||0,l=e.locY||0,o=e.locZ||0;if(e.position){var r=e.position,s=r.length;if(s>0)g=r[0];if(s>1)l=r[1];if(s>2)o=r[2];e.locX=g;e.locY=l;e.locZ=o;delete e.position}};h.processAttached=h.processAttached||function(e,g,l){if(g.attached){if(e)l.following[e]=g.attached;delete g.attached}};h.determineTemplate=h.determineTemplate||
function(e,g){g=g||"cube";if(_.isString(g)){var l=g;g=h.templates[g];if(!g)throw new Error("No such template as "+l);}_.isArray(g)||(g=[g]);return e.determineObject.apply(this,g)};h.validate_other=h.validate_other||function(){return true};h.process_other=h.process_other||function(){};h.default_spawn=h.default_spawn||function(){return{}};h.validate_spawn=h.validate_spawn||function(e,g,l){var o=true;if(_.isArray(l)||_.isNumber(l)||_.isString(l)||_.isBoolean(l)){o=false;throw new Error("Spawn must be an object of {id : [x, y]}, not "+
l);}_.each(l,function(r,s){if(_.isArray(r)){if(r.length>2){o=false;throw new Error("Spawn location "+s+" should be [x, y], not "+r);}}else{o=false;throw new Error("Each spawn location must be an array of [x, y], not "+r);}});return o};h.process_spawn=h.process_spawn||function(e,g,l){_.each(l,function(o){o.length===0&&o.push(0);o.length===1&&o.push(0)})};h.default_camera=h.default_camera||function(){return{position:[0,0,50],attached:["character"]}};h.validate_camera=h.validate_camera||function(e,g,
l){if(_.isArray(l)||_.isNumber(l)||_.isString(l)||_.isBoolean(l))throw new Error("Camera must be an object, not "+l);return true};h.process_camera=h.process_camera||function(e,g,l,o){h.processPosition(l);h.processAttached(g,l,o)};h.default_light=h.default_light||function(){return{}};h.validate_light=h.validate_light||function(e,g,l){if(_.isArray(l)||_.isString(l)||_.isBoolean(l)||_.isNumber(l))throw new Error("Light must be an object, not "+l);return true};h.process_light=h.process_light||function(e,
g,l,o){_.each(l,function(r,s){o.levelExtras.push(s);h.processPosition(r);h.processAttached(s,r,o)})};h.default_entities=h.default_entities||function(){return[]};h.validate_entities=h.validate_entities||function(e,g,l){if(!_.isArray(l))throw new Error("Entities must be a list, not "+l);return true};h.process_entities=h.process_entities||function(e,g,l){_.each(l,function(o,r){if(o.type===undefined)o.type="default";var s=o.template;if(!_.any(o,function(A,K){return _.isFunction(A)&&K!=="getRotation"})){var w=
h.types[o.type];if(!w)throw new Error("No such type as "+o.type);delete o.type;var D=w[0],L={};w[1]&&_.each(w[1],function(A,K){L[K]=A});o&&_.each(o,function(A,K){L[K]=A});s=s||L.template;delete L.template;o=e.determineObject(D,L)}s=h.determineTemplate(e,s);o=e.prepareEntity(o,s);l[r]=o})};h.validate_background=h.validate_background||function(e,g,l){if(!_.isArray(l))throw new Error("Background must be a list, not "+l);return true};h.process_background=h.process_background||function(e,g,l,o){if(h.backgroundMaker===
undefined)h.backgroundMaker=f.backgroundMaker({z:o.backgroundZ||-20});g=_.map(l,function(r){if(r!==null&&r!==undefined)r.template=h.determineTemplate(e,r.template);return h.backgroundMaker.process(e,r)});o.background=[];_.each(g,function(r){if(r!==null&&r!==undefined){h.processAttached(r.id,r,o);r.id&&o.bkgIds.push(r.id);o.background.push(r)}})};h.validate_types=h.validate_types||function(e,g,l){var o=true;_.each(l,function(r){if(!_.isArray(r)){o=false;throw new Error("Types must be arrays of [type, opts] Where type is a string name of the type, or the type itself");
}});return o};h.process_types=h.process_types||function(e,g,l){_.each(l,function(o,r){h.types[r]=o})};h.validate_templates=h.validate_templates||function(e,g,l){var o=true;_.each(l,function(r){if(!_.isArray(r)&&!_.any(r,function(s,w){return _.isFunction(r[w])})){o=false;throw new Error("Templates must be arrays of [template, opts] Where template is a string name of the template, or the template itself");}});return o};h.process_templates=h.process_templates||function(e,g,l){_.each(l,function(o,r){h.templates[r]=
o})};h.validate_bkgIds=h.validate_bkgIds||function(){return true};h.process_bkgIds=h.process_bkgIds||function(){};h.validate_levelExtras=h.validate_levelExtras||function(){return true};h.process_levelExtras=h.process_levelExtras||function(){};h.validate_following=h.validate_following||function(){return true};h.process_following=h.process_following||function(){};h.validate_removed=h.validate_removed||function(){return true};h.process_removed=h.process_removed||function(){};return h}});
require.def("gma/entities/collectable",["gma/base","gma/entities/base","gma/entities/shapes","gma/utils/collisions"],function(f){f.collectable=function(v){var h=f.shapes.rectangle(v||{x:0,y:0,width:1,height:1});if(!h)throw new Error("Can't create rectangle for platform");h.tags.collectable=true;h.pickup=h.pickup||function(){h.alive=false};return h};f.scoreCollectable=function(v){v=f.collectable(v);v.tags.scoreCollectable=true;return v}});
require.def("gma/entities/moveable",["gma/base","gma/entities/base","gma/entities/shapes","gma/utils/collisions"],function(f){f.moveable=function(v){var h=f.shapes.rectangle(v||{x:0,y:0,width:1,height:1});if(!h)throw new Error("Can't create rectangle for moveable");h.tags.moveable=true;h.yState=h.yState||f.constants.FALLING;h.xState=h.xState||f.constants.STILL;h.lastXState=h.lastXState||h.xState;h.velocity=h.velocity||0;h.jumpVelocity=h.jumpVelocity||4;h.getMovement=h.getMovement||function(g){var l=
0,o=0,r=0;if(h.yState===f.constants.JUMPING||h.yState===f.constants.FALLING){r=h.velocity+f.constants.GRAVITY*g;o=(r+h.velocity)/2*g;h.velocity=r;if(h.velocity<=0)h.yState=f.constants.FALLING}if(h.xState===f.constants.RIGHT)l+=g;if(h.xState===f.constants.LEFT)l-=g;return[l,o]};h.animate=h.animate||function(g,l){if(g<0.05)g=0.05;var o=h.getMovement(10*g,l);g=o[0];o=o[1];var r=[0,0];if(h.xState!==f.constants.STILL||h.yState!==f.constants.STILL)r=f.collisions.detectCollisions(h,[g,o],l.entities());if(r[1]===
0&&h.yState===f.constants.JUMPING){h.yState=f.constants.FALLING;h.velocity=0}h.updatePositions(r);h.findGround(l)};h.findGround=h.findGround||function(g){var l=f.collisions.factories.findGround(h);if(h.yState!==f.constants.JUMPING)if(_.filter(g.entities(),l).length>0){h.yState=f.constants.STILL;h.velocity=0}else h.yState=f.constants.FALLING};h.updatePositions=h.updatePositions||function(g){var l=g[0];g=g[1];if(_.isNumber(l)&&!isNaN(l)&&_.isNumber(g)&&!isNaN(g)){h.x+=l;h.left+=l;h.right+=l;h.y+=g;
h.top+=g;h.bottom+=g;h.centre=[h.x,h.y];h.setPointsAndEdges()}};var e=0;h.getRotation=h.getRotation||function(){var g=h.xState;if(g===f.constants.STILL)g=h.lastXState;if(g===f.constants.LEFT){if(e<0.1)e+=0.5;if(e>0.1)e=0}else{if(e>-3.15)e-=0.5;if(e<-3.15)e=-3.14}return-e};h.kill=h.kill||function(){h.xState=f.constants.STILL;h.alive=false};return h}});
require.def("gma/entities/door",["gma/base","gma/entities/base","gma/entities/moveable","gma/utils/collisions"],function(f){f.door=function(v){var h=f.shapes.rectangle(v||{x:0,y:0,width:1,height:1});if(!h)throw new Error("Can't create rectangle for door");h.tags.door=true;var e=h.collided;h.collided=function(){e.apply(this,arguments);h.tags.door&&h.collided__door.apply(this,arguments)};h.collided__door=h.collided__door||function(g,l){l.tags.character&&window.manager.loadLevel(h.level,h.spawnId)};
return h}});
require.def("gma/entities/enemy",["gma/base","gma/entities/base","gma/entities/moveable","gma/utils/collisions"],function(f){f.enemy=function(v){var h=f.moveable(v||{x:0,y:0,width:1,height:1});h.tags.enemy=true;if(h.tags.platformer)h.findGround=function(){};var e=h.getMovement;h.getMovement=function(l,o){h.determineState(l,o);return e(l,o)};h.determineState=h.determineState||function(){h.tags.jumping&&h.behaviour__jumping.apply(this,arguments);h.tags.patrolling&&h.behaviour__patrolling.apply(this,arguments);
h.tags.platformer&&h.behaviour__platformer.apply(this,arguments)};var g=h.collided;h.collided=function(){g.apply(this,arguments);h.tags.rebound&&h.collided__rebound.apply(this,arguments);h.tags.weakhead&&h.collided__weakhead.apply(this,arguments);h.alive&&h.tags.deathtouch&&h.collided__deathtouch.apply(this,arguments)};h.behaviour__jumping=function(){if(h.yState===f.constants.STILL){h.yState=f.constants.JUMPING;h.velocity=h.jumpVelocity}};h.behaviour__platformer=function(l,o){l=f.collisions.factories.findGround(h);
if(h.yState!==f.constants.JUMPING){o=_.filter(o.entities(),l);if(o.length>0){if(h.yState===f.constants.FALLING)h.yState=f.constants.STILL;o=o[0];if(h.x<=o.left)h.xState=f.constants.RIGHT;if(h.x>=o.right)h.xState=f.constants.LEFT;if(h.xState===f.constants.STILL)h.xState=h.x<o.x?f.constants.RIGHT:f.constants.LEFT}else h.yState=f.constants.FALLING}};h.behaviour__patrolling=function(){if(h.limitLeft&&h.x<=h.limitLeft)h.xState=f.constants.RIGHT;if(h.limitRight&&h.x>=h.limitRight)h.xState=f.constants.LEFT;
if(h.xState===f.constants.STILL)h.xState=f.constants.LEFT};h.collided__rebound=function(l){if(l===f.constants.LEFT)h.xState=f.constants.RIGHT;else if(l===f.constants.RIGHT)h.xState=f.constants.LEFT};h.collided__weakhead=function(l,o){l===f.constants.TOP&&o.tags.character&&h.kill()};return h};f.platformEnemy=function(v){v=f.enemy(v);v.tags.rebound=true;v.tags.deathtouch=true;v.tags.weakhead=true;v.tags.platformer=true;v.findGround=function(){};return v};f.jumpingEnemy=function(v){v=f.enemy(v);v.tags.deathtouch=
true;v.tags.weakhead=true;v.tags.jumping=true;return v};f.patrolEnemy=function(v){v=f.enemy(v);v.tags.rebound=true;v.tags.deathtouch=true;v.tags.weakhead=true;v.tags.patrolling=true;return v}});
require.def("gma/entities/character",["gma/base","gma/entities/moveable","gma/utils/collisions"],function(f){f.character=function(v){var h=f.moveable(v||{x:0,y:0,width:1,height:1});if(!h)throw new Error("Can't create rectangle for character");h.tags.character=true;h.score=h.score||0;h.jump=h.jump||function(){if(h.alive)if(h.yState===f.constants.STILL){h.yState=f.constants.JUMPING;h.velocity=h.jumpVelocity}};h.move=h.move||function(g,l){if(h.alive)if(l.type==="keyup"){if(h.xState===g){h.lastXState=
h.xState;h.xState=f.constants.STILL}}else if(g)if(g===f.constants.LEFT||g===f.constants.RIGHT)h.xState=g;else throw new Error("You can only call move() with constants.LEFT or constants.RIGHT");else throw new Error("You need to supply a direction to move()");};var e=h.collided;h.collided=function(g,l){e.apply(this,arguments);l.tags.collectable&&h.collided__pickupCollectable.apply(this,arguments)};h.collided__pickupCollectable=h.collided__pickupCollectable||function(g,l){l.pickup();if(l.tags.scoreCollectable)h.score+=
1};return h}});
require.def("gma/support/base64",[],function(){(function(){function f(g){var l,o,r,s,w,D;r=g.length;o=0;for(l="";o<r;){s=g.charCodeAt(o++)&255;if(o==r){l+=h.charAt(s>>2);l+=h.charAt((s&3)<<4);l+="==";break}w=g.charCodeAt(o++);if(o==r){l+=h.charAt(s>>2);l+=h.charAt((s&3)<<4|(w&240)>>4);l+=h.charAt((w&15)<<2);l+="=";break}D=g.charCodeAt(o++);l+=h.charAt(s>>2);l+=h.charAt((s&3)<<4|(w&240)>>4);l+=h.charAt((w&15)<<2|(D&192)>>6);l+=h.charAt(D&63)}return l}function v(g){var l,o,r,s,w;s=g.length;r=0;for(w=
"";r<s;){do l=e[g.charCodeAt(r++)&255];while(r<s&&l===-1);if(l===-1)break;do o=e[g.charCodeAt(r++)&255];while(r<s&&o==-1);if(o==-1)break;w+=String.fromCharCode(l<<2|(o&48)>>4);do{l=g.charCodeAt(r++)&255;if(l==61)return w;l=e[l]}while(r<s&&l==-1);if(l==-1)break;w+=String.fromCharCode((o&15)<<4|(l&60)>>2);do{o=g.charCodeAt(r++)&255;if(o==61)return w;o=e[o]}while(r<s&&o==-1);if(o==-1)break;w+=String.fromCharCode((l&3)<<6|o)}return w}var h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",
e=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);if(!window.btoa)window.btoa=f;if(!window.atob)window.atob=v})()});
require.def("gma/support/canvas2image",["gma/support/base64"],function(){Canvas2Image=function(){var f=false,v=document.createElement("canvas");if(v.getContext("2d"))f=true;if(!f)return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}};var h=!!v.getContext("2d").getImageData,e=!!v.toDataURL,g=!!window.btoa,l=function(A){var K=parseInt(A.width,10),Y=parseInt(A.height,10);return A.getContext("2d").getImageData(0,0,K,Y)},o=function(A){var K="";if(typeof A=="string")K=A;else for(var Y=
0;Y<A.length;Y++)K+=String.fromCharCode(A[Y]);return window.btoa(K)},r=function(A){var K=[],Y=A.width,aa=A.height;K.push(66);K.push(77);var q=Y*aa*3+54;K.push(q%256);q=Math.floor(q/256);K.push(q%256);q=Math.floor(q/256);K.push(q%256);q=Math.floor(q/256);K.push(q%256);K.push(0);K.push(0);K.push(0);K.push(0);K.push(54);K.push(0);K.push(0);K.push(0);q=[];q.push(40);q.push(0);q.push(0);q.push(0);var P=Y;q.push(P%256);P=Math.floor(P/256);q.push(P%256);P=Math.floor(P/256);q.push(P%256);P=Math.floor(P/256);
q.push(P%256);P=aa;q.push(P%256);P=Math.floor(P/256);q.push(P%256);P=Math.floor(P/256);q.push(P%256);P=Math.floor(P/256);q.push(P%256);q.push(1);q.push(0);q.push(24);q.push(0);q.push(0);q.push(0);q.push(0);q.push(0);P=Y*aa*3;q.push(P%256);P=Math.floor(P/256);q.push(P%256);P=Math.floor(P/256);q.push(P%256);P=Math.floor(P/256);q.push(P%256);for(P=0;P<16;P++)q.push(0);P=(4-Y*3%4)%4;A=A.data;var fa="";aa=aa;do{for(var S=Y*(aa-1)*4,F="",ja=0;ja<Y;ja++){var xa=4*ja;F+=String.fromCharCode(A[S+xa+2]);F+=
String.fromCharCode(A[S+xa+1]);F+=String.fromCharCode(A[S+xa])}for(S=0;S<P;S++)F+=String.fromCharCode(0);fa+=F}while(--aa);return o(K.concat(q))+o(fa)},s=function(A){document.location.href=A},w=function(A,K){return"data:"+K+";base64,"+A},D=function(A){var K=document.createElement("img");K.src=A;return K},L=function(A,K,Y){if(K&&Y){var aa=document.createElement("canvas");aa.width=K;aa.height=Y;aa.style.width=K+"px";aa.style.height=Y+"px";aa.getContext("2d").drawImage(A,0,0,A.width,A.height,0,0,K,Y);
return aa}return A};return{saveAsPNG:function(A,K,Y,aa){if(!e)return false;A=L(A,Y,aa).toDataURL("image/png");if(K)return D(A);else s(A.replace("image/png","image/octet-stream"));return true},saveAsJPEG:function(A,K,Y,aa){if(!e)return false;A=L(A,Y,aa).toDataURL("image/jpeg");if(A.indexOf("image/jpeg")!=5)return false;if(K)return D(A);else s(A.replace("image/jpeg","image/octet-stream"));return true},saveAsBMP:function(A,K,Y,aa){if(!(h&&g))return false;A=L(A,Y,aa);A=l(A);A=r(A);if(K)return D(w(A,"image/bmp"));
else s(w(A,"image/octet-stream"));return true}}}()});require.def("gma/utils/image",["gma/base","gma/utils/base","gma/support/canvas2image"],function(f){f.makeImage=function(v,h,e){return Canvas2Image.saveAsPNG(v.canvas,true,h,e)};f.checkImage=function(v,h){eval("var result = "+$.ajax({url:"/check/image",async:false,data:{checkAgainst:h,png:v.src}}).responseText);return result}});define("compiled/gma",function(){});define("compiled/libs",function(){});
(function(f,v){function h(){if(!q.isReady){try{S.documentElement.doScroll("left")}catch(m){setTimeout(h,1);return}q.ready()}}function e(m,p){p.src?q.ajax({url:p.src,async:false,dataType:"script"}):q.globalEval(p.text||p.textContent||p.innerHTML||"");p.parentNode&&p.parentNode.removeChild(p)}function g(m,p,u,y,x,H){var I=m.length;if(typeof p==="object"){for(var V in p)g(m,V,p[V],y,x,u);return m}if(u!==v){y=!H&&y&&q.isFunction(u);for(V=0;V<I;V++)x(m[V],p,y?u.call(m[V],V,x(m[V],p)):u,H);return m}return I?
x(m[0],p):v}function l(){return(new Date).getTime()}function o(){return false}function r(){return true}function s(m,p,u){u[0].type=m;return q.event.handle.apply(p,u)}function w(m){var p,u=[],y=[],x=arguments,H,I,V,M,U,ea;I=q.data(this,"events");if(!(m.liveFired===this||!I||!I.live||m.button&&m.type==="click")){m.liveFired=this;var la=I.live.slice(0);for(M=0;M<la.length;M++){I=la[M];I.origType.replace(sa,"")===m.type?y.push(I.selector):la.splice(M--,1)}H=q(m.target).closest(y,m.currentTarget);U=0;
for(ea=H.length;U<ea;U++)for(M=0;M<la.length;M++){I=la[M];if(H[U].selector===I.selector){V=H[U].elem;y=null;if(I.preType==="mouseenter"||I.preType==="mouseleave")y=q(m.relatedTarget).closest(I.selector)[0];if(!y||y!==V)u.push({elem:V,handleObj:I})}}U=0;for(ea=u.length;U<ea;U++){H=u[U];m.currentTarget=H.elem;m.data=H.handleObj.data;m.handleObj=H.handleObj;if(H.handleObj.origHandler.apply(H.elem,x)===false){p=false;break}}return p}}function D(m,p){return"live."+(m&&m!=="*"?m+".":"")+p.replace(/\./g,
"`").replace(/ /g,"&")}function L(m){return!m||!m.parentNode||m.parentNode.nodeType===11}function A(m,p){var u=0;p.each(function(){if(this.nodeName===(m[u]&&m[u].nodeName)){var y=q.data(m[u++]),x=q.data(this,y);if(y=y&&y.events){delete x.handle;x.events={};for(var H in y)for(var I in y[H])q.event.add(this,H,y[H][I],y[H][I].data)}}})}function K(m,p,u){var y,x,H;p=p&&p[0]?p[0].ownerDocument||p[0]:S;if(m.length===1&&typeof m[0]==="string"&&m[0].length<512&&p===S&&!ab.test(m[0])&&(q.support.checkClone||
!bb.test(m[0]))){x=true;if(H=q.fragments[m[0]])if(H!==1)y=H}if(!y){y=p.createDocumentFragment();q.clean(m,p,y,u)}if(x)q.fragments[m[0]]=H?y:1;return{fragment:y,cacheable:x}}function Y(m,p){var u={};q.each(cb.concat.apply([],cb.slice(0,p)),function(){u[this]=m});return u}function aa(m){return"scrollTo"in m&&m.document?m:m.nodeType===9?m.defaultView||m.parentWindow:false}var q=function(m,p){return new q.fn.init(m,p)},P=f.jQuery,fa=f.$,S=f.document,F,ja=/^[^<]*(<[\w\W]+>)[^>]*$|^#([\w-]+)$/,xa=/^.[^:#\[\.,]*$/,
za=/\S/,Ca=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,ya=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,B=navigator.userAgent,J=false,R=[],W,ia=Object.prototype.toString,na=Object.prototype.hasOwnProperty,ta=Array.prototype.push,X=Array.prototype.slice,Ja=Array.prototype.indexOf;q.fn=q.prototype={init:function(m,p){var u,y;if(!m)return this;if(m.nodeType){this.context=this[0]=m;this.length=1;return this}if(m==="body"&&!p){this.context=S;this[0]=S.body;this.selector="body";this.length=1;return this}if(typeof m==="string")if((u=
ja.exec(m))&&(u[1]||!p))if(u[1]){y=p?p.ownerDocument||p:S;if(m=ya.exec(m))if(q.isPlainObject(p)){m=[S.createElement(m[1])];q.fn.attr.call(m,p,true)}else m=[y.createElement(m[1])];else{m=K([u[1]],[y]);m=(m.cacheable?m.fragment.cloneNode(true):m.fragment).childNodes}return q.merge(this,m)}else{if(p=S.getElementById(u[2])){if(p.id!==u[2])return F.find(m);this.length=1;this[0]=p}this.context=S;this.selector=m;return this}else if(!p&&/^\w+$/.test(m)){this.selector=m;this.context=S;m=S.getElementsByTagName(m);
return q.merge(this,m)}else return!p||p.jquery?(p||F).find(m):q(p).find(m);else if(q.isFunction(m))return F.ready(m);if(m.selector!==v){this.selector=m.selector;this.context=m.context}return q.makeArray(m,this)},selector:"",jquery:"1.4.2",length:0,size:function(){return this.length},toArray:function(){return X.call(this,0)},get:function(m){return m==null?this.toArray():m<0?this.slice(m)[0]:this[m]},pushStack:function(m,p,u){var y=q();q.isArray(m)?ta.apply(y,m):q.merge(y,m);y.prevObject=this;y.context=
this.context;if(p==="find")y.selector=this.selector+(this.selector?" ":"")+u;else if(p)y.selector=this.selector+"."+p+"("+u+")";return y},each:function(m,p){return q.each(this,m,p)},ready:function(m){q.bindReady();if(q.isReady)m.call(S,q);else R&&R.push(m);return this},eq:function(m){return m===-1?this.slice(m):this.slice(m,+m+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(X.apply(this,arguments),"slice",X.call(arguments).join(","))},
map:function(m){return this.pushStack(q.map(this,function(p,u){return m.call(p,u,p)}))},end:function(){return this.prevObject||q(null)},push:ta,sort:[].sort,splice:[].splice};q.fn.init.prototype=q.fn;q.extend=q.fn.extend=function(){var m=arguments[0]||{},p=1,u=arguments.length,y=false,x,H,I,V;if(typeof m==="boolean"){y=m;m=arguments[1]||{};p=2}if(typeof m!=="object"&&!q.isFunction(m))m={};if(u===p){m=this;--p}for(;p<u;p++)if((x=arguments[p])!=null)for(H in x){I=m[H];V=x[H];if(m!==V)if(y&&V&&(q.isPlainObject(V)||
q.isArray(V))){I=I&&(q.isPlainObject(I)||q.isArray(I))?I:q.isArray(V)?[]:{};m[H]=q.extend(y,I,V)}else if(V!==v)m[H]=V}return m};q.extend({noConflict:function(m){f.$=fa;if(m)f.jQuery=P;return q},isReady:false,ready:function(){if(!q.isReady){if(!S.body)return setTimeout(q.ready,13);q.isReady=true;if(R){for(var m,p=0;m=R[p++];)m.call(S,q);R=null}q.fn.triggerHandler&&q(S).triggerHandler("ready")}},bindReady:function(){if(!J){J=true;if(S.readyState==="complete")return q.ready();if(S.addEventListener){S.addEventListener("DOMContentLoaded",
W,false);f.addEventListener("load",q.ready,false)}else if(S.attachEvent){S.attachEvent("onreadystatechange",W);f.attachEvent("onload",q.ready);var m=false;try{m=f.frameElement==null}catch(p){}S.documentElement.doScroll&&m&&h()}}},isFunction:function(m){return ia.call(m)==="[object Function]"},isArray:function(m){return ia.call(m)==="[object Array]"},isPlainObject:function(m){if(!m||ia.call(m)!=="[object Object]"||m.nodeType||m.setInterval)return false;if(m.constructor&&!na.call(m,"constructor")&&
!na.call(m.constructor.prototype,"isPrototypeOf"))return false;var p;for(p in m);return p===v||na.call(m,p)},isEmptyObject:function(m){for(var p in m)return false;return true},error:function(m){throw m;},parseJSON:function(m){if(typeof m!=="string"||!m)return null;m=q.trim(m);if(/^[\],:{}\s]*$/.test(m.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return f.JSON&&f.JSON.parse?f.JSON.parse(m):
(new Function("return "+m))();else q.error("Invalid JSON: "+m)},noop:function(){},globalEval:function(m){if(m&&za.test(m)){var p=S.getElementsByTagName("head")[0]||S.documentElement,u=S.createElement("script");u.type="text/javascript";if(q.support.scriptEval)u.appendChild(S.createTextNode(m));else u.text=m;p.insertBefore(u,p.firstChild);p.removeChild(u)}},nodeName:function(m,p){return m.nodeName&&m.nodeName.toUpperCase()===p.toUpperCase()},each:function(m,p,u){var y,x=0,H=m.length,I=H===v||q.isFunction(m);
if(u)if(I)for(y in m){if(p.apply(m[y],u)===false)break}else for(;x<H;){if(p.apply(m[x++],u)===false)break}else if(I)for(y in m){if(p.call(m[y],y,m[y])===false)break}else for(u=m[0];x<H&&p.call(u,x,u)!==false;u=m[++x]);return m},trim:function(m){return(m||"").replace(Ca,"")},makeArray:function(m,p){p=p||[];if(m!=null)m.length==null||typeof m==="string"||q.isFunction(m)||typeof m!=="function"&&m.setInterval?ta.call(p,m):q.merge(p,m);return p},inArray:function(m,p){if(p.indexOf)return p.indexOf(m);for(var u=
0,y=p.length;u<y;u++)if(p[u]===m)return u;return-1},merge:function(m,p){var u=m.length,y=0;if(typeof p.length==="number")for(var x=p.length;y<x;y++)m[u++]=p[y];else for(;p[y]!==v;)m[u++]=p[y++];m.length=u;return m},grep:function(m,p,u){for(var y=[],x=0,H=m.length;x<H;x++)!u!==!p(m[x],x)&&y.push(m[x]);return y},map:function(m,p,u){for(var y=[],x,H=0,I=m.length;H<I;H++){x=p(m[H],H,u);if(x!=null)y[y.length]=x}return y.concat.apply([],y)},guid:1,proxy:function(m,p,u){if(arguments.length===2)if(typeof p===
"string"){u=m;m=u[p];p=v}else if(p&&!q.isFunction(p)){u=p;p=v}if(!p&&m)p=function(){return m.apply(u||this,arguments)};if(m)p.guid=m.guid=m.guid||p.guid||q.guid++;return p},uaMatch:function(m){m=m.toLowerCase();m=/(webkit)[ \/]([\w.]+)/.exec(m)||/(opera)(?:.*version)?[ \/]([\w.]+)/.exec(m)||/(msie) ([\w.]+)/.exec(m)||!/compatible/.test(m)&&/(mozilla)(?:.*? rv:([\w.]+))?/.exec(m)||[];return{browser:m[1]||"",version:m[2]||"0"}},browser:{}});B=q.uaMatch(B);if(B.browser){q.browser[B.browser]=true;q.browser.version=
B.version}if(q.browser.webkit)q.browser.safari=true;if(Ja)q.inArray=function(m,p){return Ja.call(p,m)};F=q(S);if(S.addEventListener)W=function(){S.removeEventListener("DOMContentLoaded",W,false);q.ready()};else if(S.attachEvent)W=function(){if(S.readyState==="complete"){S.detachEvent("onreadystatechange",W);q.ready()}};(function(){q.support={};var m=S.documentElement,p=S.createElement("script"),u=S.createElement("div"),y="script"+l();u.style.display="none";u.innerHTML="   <link/><table></table><a href='/a' style='color:red;float:left;opacity:.55;'>a</a><input type='checkbox'/>";
var x=u.getElementsByTagName("*"),H=u.getElementsByTagName("a")[0];if(!(!x||!x.length||!H)){q.support={leadingWhitespace:u.firstChild.nodeType===3,tbody:!u.getElementsByTagName("tbody").length,htmlSerialize:!!u.getElementsByTagName("link").length,style:/red/.test(H.getAttribute("style")),hrefNormalized:H.getAttribute("href")==="/a",opacity:/^0.55$/.test(H.style.opacity),cssFloat:!!H.style.cssFloat,checkOn:u.getElementsByTagName("input")[0].value==="on",optSelected:S.createElement("select").appendChild(S.createElement("option")).selected,
parentNode:u.removeChild(u.appendChild(S.createElement("div"))).parentNode===null,deleteExpando:true,checkClone:false,scriptEval:false,noCloneEvent:true,boxModel:null};p.type="text/javascript";try{p.appendChild(S.createTextNode("window."+y+"=1;"))}catch(I){}m.insertBefore(p,m.firstChild);if(f[y]){q.support.scriptEval=true;delete f[y]}try{delete p.test}catch(V){q.support.deleteExpando=false}m.removeChild(p);if(u.attachEvent&&u.fireEvent){u.attachEvent("onclick",function M(){q.support.noCloneEvent=
false;u.detachEvent("onclick",M)});u.cloneNode(true).fireEvent("onclick")}u=S.createElement("div");u.innerHTML="<input type='radio' name='radiotest' checked='checked'/>";m=S.createDocumentFragment();m.appendChild(u.firstChild);q.support.checkClone=m.cloneNode(true).cloneNode(true).lastChild.checked;q(function(){var M=S.createElement("div");M.style.width=M.style.paddingLeft="1px";S.body.appendChild(M);q.boxModel=q.support.boxModel=M.offsetWidth===2;S.body.removeChild(M).style.display="none"});m=function(M){var U=
S.createElement("div");M="on"+M;var ea=M in U;if(!ea){U.setAttribute(M,"return;");ea=typeof U[M]==="function"}return ea};q.support.submitBubbles=m("submit");q.support.changeBubbles=m("change");m=p=u=x=H=null}})();q.props={"for":"htmlFor","class":"className",readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",colspan:"colSpan",tabindex:"tabIndex",usemap:"useMap",frameborder:"frameBorder"};var Ba="jQuery"+l(),Oa=0,Ka={};q.extend({cache:{},expando:Ba,noData:{embed:true,
object:true,applet:true},data:function(m,p,u){if(!(m.nodeName&&q.noData[m.nodeName.toLowerCase()])){m=m==f?Ka:m;var y=m[Ba],x=q.cache;if(!y&&typeof p==="string"&&u===v)return null;y||(y=++Oa);if(typeof p==="object"){m[Ba]=y;x[y]=q.extend(true,{},p)}else if(!x[y]){m[Ba]=y;x[y]={}}m=x[y];if(u!==v)m[p]=u;return typeof p==="string"?m[p]:m}},removeData:function(m,p){if(!(m.nodeName&&q.noData[m.nodeName.toLowerCase()])){m=m==f?Ka:m;var u=m[Ba],y=q.cache,x=y[u];if(p){if(x){delete x[p];q.isEmptyObject(x)&&
q.removeData(m)}}else{if(q.support.deleteExpando)delete m[q.expando];else m.removeAttribute&&m.removeAttribute(q.expando);delete y[u]}}}});q.fn.extend({data:function(m,p){if(typeof m==="undefined"&&this.length)return q.data(this[0]);else if(typeof m==="object")return this.each(function(){q.data(this,m)});var u=m.split(".");u[1]=u[1]?"."+u[1]:"";if(p===v){var y=this.triggerHandler("getData"+u[1]+"!",[u[0]]);if(y===v&&this.length)y=q.data(this[0],m);return y===v&&u[1]?this.data(u[0]):y}else return this.trigger("setData"+
u[1]+"!",[u[0],p]).each(function(){q.data(this,m,p)})},removeData:function(m){return this.each(function(){q.removeData(this,m)})}});q.extend({queue:function(m,p,u){if(m){p=(p||"fx")+"queue";var y=q.data(m,p);if(!u)return y||[];if(!y||q.isArray(u))y=q.data(m,p,q.makeArray(u));else y.push(u);return y}},dequeue:function(m,p){p=p||"fx";var u=q.queue(m,p),y=u.shift();if(y==="inprogress")y=u.shift();if(y){p==="fx"&&u.unshift("inprogress");y.call(m,function(){q.dequeue(m,p)})}}});q.fn.extend({queue:function(m,
p){if(typeof m!=="string"){p=m;m="fx"}if(p===v)return q.queue(this[0],m);return this.each(function(){var u=q.queue(this,m,p);m==="fx"&&u[0]!=="inprogress"&&q.dequeue(this,m)})},dequeue:function(m){return this.each(function(){q.dequeue(this,m)})},delay:function(m,p){m=q.fx?q.fx.speeds[m]||m:m;p=p||"fx";return this.queue(p,function(){var u=this;setTimeout(function(){q.dequeue(u,p)},m)})},clearQueue:function(m){return this.queue(m||"fx",[])}});var E=/[\n\t]/g,G=/\s+/,Q=/\r/g,O=/href|src|style/,Z=/(button|input)/i,
da=/(button|input|object|select|textarea)/i,ga=/^(a|area)$/i,ha=/radio|checkbox/;q.fn.extend({attr:function(m,p){return g(this,m,p,true,q.attr)},removeAttr:function(m){return this.each(function(){q.attr(this,m,"");this.nodeType===1&&this.removeAttribute(m)})},addClass:function(m){if(q.isFunction(m))return this.each(function(U){var ea=q(this);ea.addClass(m.call(this,U,ea.attr("class")))});if(m&&typeof m==="string")for(var p=(m||"").split(G),u=0,y=this.length;u<y;u++){var x=this[u];if(x.nodeType===
1)if(x.className){for(var H=" "+x.className+" ",I=x.className,V=0,M=p.length;V<M;V++)if(H.indexOf(" "+p[V]+" ")<0)I+=" "+p[V];x.className=q.trim(I)}else x.className=m}return this},removeClass:function(m){if(q.isFunction(m))return this.each(function(M){var U=q(this);U.removeClass(m.call(this,M,U.attr("class")))});if(m&&typeof m==="string"||m===v)for(var p=(m||"").split(G),u=0,y=this.length;u<y;u++){var x=this[u];if(x.nodeType===1&&x.className)if(m){for(var H=(" "+x.className+" ").replace(E," "),I=
0,V=p.length;I<V;I++)H=H.replace(" "+p[I]+" "," ");x.className=q.trim(H)}else x.className=""}return this},toggleClass:function(m,p){var u=typeof m,y=typeof p==="boolean";if(q.isFunction(m))return this.each(function(x){var H=q(this);H.toggleClass(m.call(this,x,H.attr("class"),p),p)});return this.each(function(){if(u==="string")for(var x,H=0,I=q(this),V=p,M=m.split(G);x=M[H++];){V=y?V:!I.hasClass(x);I[V?"addClass":"removeClass"](x)}else if(u==="undefined"||u==="boolean"){this.className&&q.data(this,
"__className__",this.className);this.className=this.className||m===false?"":q.data(this,"__className__")||""}})},hasClass:function(m){m=" "+m+" ";for(var p=0,u=this.length;p<u;p++)if((" "+this[p].className+" ").replace(E," ").indexOf(m)>-1)return true;return false},val:function(m){if(m===v){var p=this[0];if(p){if(q.nodeName(p,"option"))return(p.attributes.value||{}).specified?p.value:p.text;if(q.nodeName(p,"select")){var u=p.selectedIndex,y=[],x=p.options;p=p.type==="select-one";if(u<0)return null;
var H=p?u:0;for(u=p?u+1:x.length;H<u;H++){var I=x[H];if(I.selected){m=q(I).val();if(p)return m;y.push(m)}}return y}if(ha.test(p.type)&&!q.support.checkOn)return p.getAttribute("value")===null?"on":p.value;return(p.value||"").replace(Q,"")}return v}var V=q.isFunction(m);return this.each(function(M){var U=q(this),ea=m;if(this.nodeType===1){if(V)ea=m.call(this,M,U.val());if(typeof ea==="number")ea+="";if(q.isArray(ea)&&ha.test(this.type))this.checked=q.inArray(U.val(),ea)>=0;else if(q.nodeName(this,
"select")){var la=q.makeArray(ea);q("option",this).each(function(){this.selected=q.inArray(q(this).val(),la)>=0});if(!la.length)this.selectedIndex=-1}else this.value=ea}})}});q.extend({attrFn:{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true},attr:function(m,p,u,y){if(!m||m.nodeType===3||m.nodeType===8)return v;if(y&&p in q.attrFn)return q(m)[p](u);y=m.nodeType!==1||!q.isXMLDoc(m);var x=u!==v;p=y&&q.props[p]||p;if(m.nodeType===1){var H=O.test(p);if(p in m&&y&&!H){if(x){p===
"type"&&Z.test(m.nodeName)&&m.parentNode&&q.error("type property can't be changed");m[p]=u}if(q.nodeName(m,"form")&&m.getAttributeNode(p))return m.getAttributeNode(p).nodeValue;if(p==="tabIndex")return(p=m.getAttributeNode("tabIndex"))&&p.specified?p.value:da.test(m.nodeName)||ga.test(m.nodeName)&&m.href?0:v;return m[p]}if(!q.support.style&&y&&p==="style"){if(x)m.style.cssText=""+u;return m.style.cssText}x&&m.setAttribute(p,""+u);m=!q.support.hrefNormalized&&y&&H?m.getAttribute(p,2):m.getAttribute(p);
return m===null?v:m}return q.style(m,p,u)}});var sa=/\.(.*)$/,ua=function(m){return m.replace(/[^\w\s\.\|`]/g,function(p){return"\\"+p})};q.event={add:function(m,p,u,y){if(!(m.nodeType===3||m.nodeType===8)){if(m.setInterval&&m!==f&&!m.frameElement)m=f;var x,H;if(u.handler){x=u;u=x.handler}if(!u.guid)u.guid=q.guid++;if(H=q.data(m)){var I=H.events=H.events||{},V=H.handle;if(!V)H.handle=V=function(){return typeof q!=="undefined"&&!q.event.triggered?q.event.handle.apply(V.elem,arguments):v};V.elem=m;
p=p.split(" ");for(var M,U=0,ea;M=p[U++];){H=x?q.extend({},x):{handler:u,data:y};if(M.indexOf(".")>-1){ea=M.split(".");M=ea.shift();H.namespace=ea.slice(0).sort().join(".")}else{ea=[];H.namespace=""}H.type=M;H.guid=u.guid;var la=I[M],ra=q.event.special[M]||{};if(!la){la=I[M]=[];if(!ra.setup||ra.setup.call(m,y,ea,V)===false)if(m.addEventListener)m.addEventListener(M,V,false);else m.attachEvent&&m.attachEvent("on"+M,V)}if(ra.add){ra.add.call(m,H);if(!H.handler.guid)H.handler.guid=u.guid}la.push(H);
q.event.global[M]=true}m=null}}},global:{},remove:function(m,p,u,y){if(!(m.nodeType===3||m.nodeType===8)){var x,H=0,I,V,M,U,ea,la,ra=q.data(m),wa=ra&&ra.events;if(ra&&wa){if(p&&p.type){u=p.handler;p=p.type}if(!p||typeof p==="string"&&p.charAt(0)==="."){p=p||"";for(x in wa)q.event.remove(m,x+p)}else{for(p=p.split(" ");x=p[H++];){U=x;I=x.indexOf(".")<0;V=[];if(!I){V=x.split(".");x=V.shift();M=new RegExp("(^|\\.)"+q.map(V.slice(0).sort(),ua).join("\\.(?:.*\\.)?")+"(\\.|$)")}if(ea=wa[x])if(u){U=q.event.special[x]||
{};for(va=y||0;va<ea.length;va++){la=ea[va];if(u.guid===la.guid){if(I||M.test(la.namespace)){y==null&&ea.splice(va--,1);U.remove&&U.remove.call(m,la)}if(y!=null)break}}if(ea.length===0||y!=null&&ea.length===1){if(!U.teardown||U.teardown.call(m,V)===false)pa(m,x,ra.handle);delete wa[x]}}else for(var va=0;va<ea.length;va++){la=ea[va];if(I||M.test(la.namespace)){q.event.remove(m,U,la.handler,va);ea.splice(va--,1)}}}if(q.isEmptyObject(wa)){if(p=ra.handle)p.elem=null;delete ra.events;delete ra.handle;
q.isEmptyObject(ra)&&q.removeData(m)}}}}},trigger:function(m,p,u,y){var x=m.type||m;if(!y){m=typeof m==="object"?m[Ba]?m:q.extend(q.Event(x),m):q.Event(x);if(x.indexOf("!")>=0){m.type=x=x.slice(0,-1);m.exclusive=true}if(!u){m.stopPropagation();q.event.global[x]&&q.each(q.cache,function(){this.events&&this.events[x]&&q.event.trigger(m,p,this.handle.elem)})}if(!u||u.nodeType===3||u.nodeType===8)return v;m.result=v;m.target=u;p=q.makeArray(p);p.unshift(m)}m.currentTarget=u;(y=q.data(u,"handle"))&&y.apply(u,
p);y=u.parentNode||u.ownerDocument;try{if(!(u&&u.nodeName&&q.noData[u.nodeName.toLowerCase()]))if(u["on"+x]&&u["on"+x].apply(u,p)===false)m.result=false}catch(H){}if(!m.isPropagationStopped()&&y)q.event.trigger(m,p,y,true);else if(!m.isDefaultPrevented()){y=m.target;var I,V=q.nodeName(y,"a")&&x==="click",M=q.event.special[x]||{};if((!M._default||M._default.call(u,m)===false)&&!V&&!(y&&y.nodeName&&q.noData[y.nodeName.toLowerCase()])){try{if(y[x]){if(I=y["on"+x])y["on"+x]=null;q.event.triggered=true;
y[x]()}}catch(U){}if(I)y["on"+x]=I;q.event.triggered=false}}},handle:function(m){var p,u,y,x;m=arguments[0]=q.event.fix(m||f.event);m.currentTarget=this;p=m.type.indexOf(".")<0&&!m.exclusive;if(!p){u=m.type.split(".");m.type=u.shift();y=new RegExp("(^|\\.)"+u.slice(0).sort().join("\\.(?:.*\\.)?")+"(\\.|$)")}x=q.data(this,"events");u=x[m.type];if(x&&u){u=u.slice(0);x=0;for(var H=u.length;x<H;x++){var I=u[x];if(p||y.test(I.namespace)){m.handler=I.handler;m.data=I.data;m.handleObj=I;I=I.handler.apply(this,
arguments);if(I!==v){m.result=I;if(I===false){m.preventDefault();m.stopPropagation()}}if(m.isImmediatePropagationStopped())break}}}return m.result},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),
fix:function(m){if(m[Ba])return m;var p=m;m=q.Event(p);for(var u=this.props.length,y;u;){y=this.props[--u];m[y]=p[y]}if(!m.target)m.target=m.srcElement||S;if(m.target.nodeType===3)m.target=m.target.parentNode;if(!m.relatedTarget&&m.fromElement)m.relatedTarget=m.fromElement===m.target?m.toElement:m.fromElement;if(m.pageX==null&&m.clientX!=null){p=S.documentElement;u=S.body;m.pageX=m.clientX+(p&&p.scrollLeft||u&&u.scrollLeft||0)-(p&&p.clientLeft||u&&u.clientLeft||0);m.pageY=m.clientY+(p&&p.scrollTop||
u&&u.scrollTop||0)-(p&&p.clientTop||u&&u.clientTop||0)}if(!m.which&&(m.charCode||m.charCode===0?m.charCode:m.keyCode))m.which=m.charCode||m.keyCode;if(!m.metaKey&&m.ctrlKey)m.metaKey=m.ctrlKey;if(!m.which&&m.button!==v)m.which=m.button&1?1:m.button&2?3:m.button&4?2:0;return m},guid:1E8,proxy:q.proxy,special:{ready:{setup:q.bindReady,teardown:q.noop},live:{add:function(m){q.event.add(this,m.origType,q.extend({},m,{handler:w}))},remove:function(m){var p=true,u=m.origType.replace(sa,"");q.each(q.data(this,
"events").live||[],function(){if(u===this.origType.replace(sa,""))return p=false});p&&q.event.remove(this,m.origType,w)}},beforeunload:{setup:function(m,p,u){if(this.setInterval)this.onbeforeunload=u;return false},teardown:function(m,p){if(this.onbeforeunload===p)this.onbeforeunload=null}}}};var pa=S.removeEventListener?function(m,p,u){m.removeEventListener(p,u,false)}:function(m,p,u){m.detachEvent("on"+p,u)};q.Event=function(m){if(!this.preventDefault)return new q.Event(m);if(m&&m.type){this.originalEvent=
m;this.type=m.type}else this.type=m;this.timeStamp=l();this[Ba]=true};q.Event.prototype={preventDefault:function(){this.isDefaultPrevented=r;var m=this.originalEvent;if(m){m.preventDefault&&m.preventDefault();m.returnValue=false}},stopPropagation:function(){this.isPropagationStopped=r;var m=this.originalEvent;if(m){m.stopPropagation&&m.stopPropagation();m.cancelBubble=true}},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=r;this.stopPropagation()},isDefaultPrevented:o,isPropagationStopped:o,
isImmediatePropagationStopped:o};var Aa=function(m){var p=m.relatedTarget;try{for(;p&&p!==this;)p=p.parentNode;if(p!==this){m.type=m.data;q.event.handle.apply(this,arguments)}}catch(u){}},Ga=function(m){m.type=m.data;q.event.handle.apply(this,arguments)};q.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(m,p){q.event.special[m]={setup:function(u){q.event.add(this,p,u&&u.selector?Ga:Aa,m)},teardown:function(u){q.event.remove(this,p,u&&u.selector?Ga:Aa)}}});if(!q.support.submitBubbles)q.event.special.submit=
{setup:function(){if(this.nodeName.toLowerCase()!=="form"){q.event.add(this,"click.specialSubmit",function(m){var p=m.target,u=p.type;if((u==="submit"||u==="image")&&q(p).closest("form").length)return s("submit",this,arguments)});q.event.add(this,"keypress.specialSubmit",function(m){var p=m.target,u=p.type;if((u==="text"||u==="password")&&q(p).closest("form").length&&m.keyCode===13)return s("submit",this,arguments)})}else return false},teardown:function(){q.event.remove(this,".specialSubmit")}};if(!q.support.changeBubbles){var Sa=
/textarea|input|select/i,Ta,db=function(m){var p=m.type,u=m.value;if(p==="radio"||p==="checkbox")u=m.checked;else if(p==="select-multiple")u=m.selectedIndex>-1?q.map(m.options,function(y){return y.selected}).join("-"):"";else if(m.nodeName.toLowerCase()==="select")u=m.selectedIndex;return u},Ua=function(m,p){var u=m.target,y,x;if(!(!Sa.test(u.nodeName)||u.readOnly)){y=q.data(u,"_change_data");x=db(u);if(m.type!=="focusout"||u.type!=="radio")q.data(u,"_change_data",x);if(!(y===v||x===y))if(y!=null||
x){m.type="change";return q.event.trigger(m,p,u)}}};q.event.special.change={filters:{focusout:Ua,click:function(m){var p=m.target,u=p.type;if(u==="radio"||u==="checkbox"||p.nodeName.toLowerCase()==="select")return Ua.call(this,m)},keydown:function(m){var p=m.target,u=p.type;if(m.keyCode===13&&p.nodeName.toLowerCase()!=="textarea"||m.keyCode===32&&(u==="checkbox"||u==="radio")||u==="select-multiple")return Ua.call(this,m)},beforeactivate:function(m){m=m.target;q.data(m,"_change_data",db(m))}},setup:function(){if(this.type===
"file")return false;for(var m in Ta)q.event.add(this,m+".specialChange",Ta[m]);return Sa.test(this.nodeName)},teardown:function(){q.event.remove(this,".specialChange");return Sa.test(this.nodeName)}};Ta=q.event.special.change.filters}S.addEventListener&&q.each({focus:"focusin",blur:"focusout"},function(m,p){function u(y){y=q.event.fix(y);y.type=p;return q.event.handle.call(this,y)}q.event.special[p]={setup:function(){this.addEventListener(m,u,true)},teardown:function(){this.removeEventListener(m,
u,true)}}});q.each(["bind","one"],function(m,p){q.fn[p]=function(u,y,x){if(typeof u==="object"){for(var H in u)this[p](H,y,u[H],x);return this}if(q.isFunction(y)){x=y;y=v}var I=p==="one"?q.proxy(x,function(M){q(this).unbind(M,I);return x.apply(this,arguments)}):x;if(u==="unload"&&p!=="one")this.one(u,y,x);else{H=0;for(var V=this.length;H<V;H++)q.event.add(this[H],u,I,y)}return this}});q.fn.extend({unbind:function(m,p){if(typeof m==="object"&&!m.preventDefault)for(var u in m)this.unbind(u,m[u]);else{u=
0;for(var y=this.length;u<y;u++)q.event.remove(this[u],m,p)}return this},delegate:function(m,p,u,y){return this.live(p,u,y,m)},undelegate:function(m,p,u){return arguments.length===0?this.unbind("live"):this.die(p,null,u,m)},trigger:function(m,p){return this.each(function(){q.event.trigger(m,p,this)})},triggerHandler:function(m,p){if(this[0]){m=q.Event(m);m.preventDefault();m.stopPropagation();q.event.trigger(m,p,this[0]);return m.result}},toggle:function(m){for(var p=arguments,u=1;u<p.length;)q.proxy(m,
p[u++]);return this.click(q.proxy(m,function(y){var x=(q.data(this,"lastToggle"+m.guid)||0)%u;q.data(this,"lastToggle"+m.guid,x+1);y.preventDefault();return p[x].apply(this,arguments)||false}))},hover:function(m,p){return this.mouseenter(m).mouseleave(p||m)}});var eb={focus:"focusin",blur:"focusout",mouseenter:"mouseover",mouseleave:"mouseout"};q.each(["live","die"],function(m,p){q.fn[p]=function(u,y,x,H){var I,V=0,M,U,ea=H||this.selector,la=H?this:q(this.context);if(q.isFunction(y)){x=y;y=v}for(u=
(u||"").split(" ");(I=u[V++])!=null;){H=sa.exec(I);M="";if(H){M=H[0];I=I.replace(sa,"")}if(I==="hover")u.push("mouseenter"+M,"mouseleave"+M);else{U=I;if(I==="focus"||I==="blur"){u.push(eb[I]+M);I+=M}else I=(eb[I]||I)+M;p==="live"?la.each(function(){q.event.add(this,D(I,ea),{data:y,selector:ea,handler:x,origType:I,origHandler:x,preType:U})}):la.unbind(D(I,ea),x)}}return this}});q.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error".split(" "),
function(m,p){q.fn[p]=function(u){return u?this.bind(p,u):this.trigger(p)};if(q.attrFn)q.attrFn[p]=true});f.attachEvent&&!f.addEventListener&&f.attachEvent("onunload",function(){for(var m in q.cache)if(q.cache[m].handle)try{q.event.remove(q.cache[m].handle.elem)}catch(p){}});(function(){function m(z){for(var C="",N,T=0;z[T];T++){N=z[T];if(N.nodeType===3||N.nodeType===4)C+=N.nodeValue;else if(N.nodeType!==8)C+=m(N.childNodes)}return C}function p(z,C,N,T,ca,ba){ca=0;for(var ma=T.length;ca<ma;ca++){var ka=
T[ca];if(ka){ka=ka[z];for(var qa=false;ka;){if(ka.sizcache===N){qa=T[ka.sizset];break}if(ka.nodeType===1&&!ba){ka.sizcache=N;ka.sizset=ca}if(ka.nodeName.toLowerCase()===C){qa=ka;break}ka=ka[z]}T[ca]=qa}}}function u(z,C,N,T,ca,ba){ca=0;for(var ma=T.length;ca<ma;ca++){var ka=T[ca];if(ka){ka=ka[z];for(var qa=false;ka;){if(ka.sizcache===N){qa=T[ka.sizset];break}if(ka.nodeType===1){if(!ba){ka.sizcache=N;ka.sizset=ca}if(typeof C!=="string"){if(ka===C){qa=true;break}}else if(M.filter(C,[ka]).length>0){qa=
ka;break}}ka=ka[z]}T[ca]=qa}}}var y=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,x=0,H=Object.prototype.toString,I=false,V=true;[0,0].sort(function(){V=false;return 0});var M=function(z,C,N,T){N=N||[];var ca=C=C||S;if(C.nodeType!==1&&C.nodeType!==9)return[];if(!z||typeof z!=="string")return N;for(var ba=[],ma,ka,qa,Na,Ha=true,La=oa(C),Ia=z;(y.exec(""),ma=y.exec(Ia))!==null;){Ia=ma[3];ba.push(ma[1]);if(ma[2]){Na=
ma[3];break}}if(ba.length>1&&ea.exec(z))if(ba.length===2&&U.relative[ba[0]])ka=Va(ba[0]+ba[1],C);else for(ka=U.relative[ba[0]]?[C]:M(ba.shift(),C);ba.length;){z=ba.shift();if(U.relative[z])z+=ba.shift();ka=Va(z,ka)}else{if(!T&&ba.length>1&&C.nodeType===9&&!La&&U.match.ID.test(ba[0])&&!U.match.ID.test(ba[ba.length-1])){ma=M.find(ba.shift(),C,La);C=ma.expr?M.filter(ma.expr,ma.set)[0]:ma.set[0]}if(C){ma=T?{expr:ba.pop(),set:ra(T)}:M.find(ba.pop(),ba.length===1&&(ba[0]==="~"||ba[0]==="+")&&C.parentNode?
C.parentNode:C,La);ka=ma.expr?M.filter(ma.expr,ma.set):ma.set;if(ba.length>0)qa=ra(ka);else Ha=false;for(;ba.length;){var Da=ba.pop();ma=Da;if(U.relative[Da])ma=ba.pop();else Da="";if(ma==null)ma=C;U.relative[Da](qa,ma,La)}}else qa=[]}qa||(qa=ka);qa||M.error(Da||z);if(H.call(qa)==="[object Array]")if(Ha)if(C&&C.nodeType===1)for(z=0;qa[z]!=null;z++){if(qa[z]&&(qa[z]===true||qa[z].nodeType===1&&Ea(C,qa[z])))N.push(ka[z])}else for(z=0;qa[z]!=null;z++)qa[z]&&qa[z].nodeType===1&&N.push(ka[z]);else N.push.apply(N,
qa);else ra(qa,N);if(Na){M(Na,ca,N,T);M.uniqueSort(N)}return N};M.uniqueSort=function(z){if(va){I=V;z.sort(va);if(I)for(var C=1;C<z.length;C++)z[C]===z[C-1]&&z.splice(C--,1)}return z};M.matches=function(z,C){return M(z,null,null,C)};M.find=function(z,C,N){var T,ca;if(!z)return[];for(var ba=0,ma=U.order.length;ba<ma;ba++){var ka=U.order[ba];if(ca=U.leftMatch[ka].exec(z)){var qa=ca[1];ca.splice(1,1);if(qa.substr(qa.length-1)!=="\\"){ca[1]=(ca[1]||"").replace(/\\/g,"");T=U.find[ka](ca,C,N);if(T!=null){z=
z.replace(U.match[ka],"");break}}}}T||(T=C.getElementsByTagName("*"));return{set:T,expr:z}};M.filter=function(z,C,N,T){for(var ca=z,ba=[],ma=C,ka,qa,Na=C&&C[0]&&oa(C[0]);z&&C.length;){for(var Ha in U.filter)if((ka=U.leftMatch[Ha].exec(z))!=null&&ka[2]){var La=U.filter[Ha],Ia,Da;Da=ka[1];qa=false;ka.splice(1,1);if(Da.substr(Da.length-1)!=="\\"){if(ma===ba)ba=[];if(U.preFilter[Ha])if(ka=U.preFilter[Ha](ka,ma,N,ba,T,Na)){if(ka===true)continue}else qa=Ia=true;if(ka)for(var Pa=0;(Da=ma[Pa])!=null;Pa++)if(Da){Ia=
La(Da,ka,Pa,ma);var fb=T^!!Ia;if(N&&Ia!=null)if(fb)qa=true;else ma[Pa]=false;else if(fb){ba.push(Da);qa=true}}if(Ia!==v){N||(ma=ba);z=z.replace(U.match[Ha],"");if(!qa)return[];break}}}if(z===ca)if(qa==null)M.error(z);else break;ca=z}return ma};M.error=function(z){throw"Syntax error, unrecognized expression: "+z;};var U=M.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,
TAG:/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(z){return z.getAttribute("href")}},relative:{"+":function(z,C){var N=typeof C==="string",T=N&&!/\W/.test(C);N=N&&!T;if(T)C=C.toLowerCase();T=0;for(var ca=z.length,
ba;T<ca;T++)if(ba=z[T]){for(;(ba=ba.previousSibling)&&ba.nodeType!==1;);z[T]=N||ba&&ba.nodeName.toLowerCase()===C?ba||false:ba===C}N&&M.filter(C,z,true)},">":function(z,C){var N=typeof C==="string";if(N&&!/\W/.test(C)){C=C.toLowerCase();for(var T=0,ca=z.length;T<ca;T++){var ba=z[T];if(ba){N=ba.parentNode;z[T]=N.nodeName.toLowerCase()===C?N:false}}}else{T=0;for(ca=z.length;T<ca;T++)if(ba=z[T])z[T]=N?ba.parentNode:ba.parentNode===C;N&&M.filter(C,z,true)}},"":function(z,C,N){var T=x++,ca=u;if(typeof C===
"string"&&!/\W/.test(C)){var ba=C=C.toLowerCase();ca=p}ca("parentNode",C,T,z,ba,N)},"~":function(z,C,N){var T=x++,ca=u;if(typeof C==="string"&&!/\W/.test(C)){var ba=C=C.toLowerCase();ca=p}ca("previousSibling",C,T,z,ba,N)}},find:{ID:function(z,C,N){if(typeof C.getElementById!=="undefined"&&!N)return(z=C.getElementById(z[1]))?[z]:[]},NAME:function(z,C){if(typeof C.getElementsByName!=="undefined"){var N=[];C=C.getElementsByName(z[1]);for(var T=0,ca=C.length;T<ca;T++)C[T].getAttribute("name")===z[1]&&
N.push(C[T]);return N.length===0?null:N}},TAG:function(z,C){return C.getElementsByTagName(z[1])}},preFilter:{CLASS:function(z,C,N,T,ca,ba){z=" "+z[1].replace(/\\/g,"")+" ";if(ba)return z;ba=0;for(var ma;(ma=C[ba])!=null;ba++)if(ma)if(ca^(ma.className&&(" "+ma.className+" ").replace(/[\t\n]/g," ").indexOf(z)>=0))N||T.push(ma);else if(N)C[ba]=false;return false},ID:function(z){return z[1].replace(/\\/g,"")},TAG:function(z){return z[1].toLowerCase()},CHILD:function(z){if(z[1]==="nth"){var C=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(z[2]===
"even"&&"2n"||z[2]==="odd"&&"2n+1"||!/\D/.test(z[2])&&"0n+"+z[2]||z[2]);z[2]=C[1]+(C[2]||1)-0;z[3]=C[3]-0}z[0]=x++;return z},ATTR:function(z,C,N,T,ca,ba){C=z[1].replace(/\\/g,"");if(!ba&&U.attrMap[C])z[1]=U.attrMap[C];if(z[2]==="~=")z[4]=" "+z[4]+" ";return z},PSEUDO:function(z,C,N,T,ca){if(z[1]==="not")if((y.exec(z[3])||"").length>1||/^\w/.test(z[3]))z[3]=M(z[3],null,null,C);else{z=M.filter(z[3],C,N,true^ca);N||T.push.apply(T,z);return false}else if(U.match.POS.test(z[0])||U.match.CHILD.test(z[0]))return true;
return z},POS:function(z){z.unshift(true);return z}},filters:{enabled:function(z){return z.disabled===false&&z.type!=="hidden"},disabled:function(z){return z.disabled===true},checked:function(z){return z.checked===true},selected:function(z){return z.selected===true},parent:function(z){return!!z.firstChild},empty:function(z){return!z.firstChild},has:function(z,C,N){return!!M(N[3],z).length},header:function(z){return/h\d/i.test(z.nodeName)},text:function(z){return"text"===z.type},radio:function(z){return"radio"===
z.type},checkbox:function(z){return"checkbox"===z.type},file:function(z){return"file"===z.type},password:function(z){return"password"===z.type},submit:function(z){return"submit"===z.type},image:function(z){return"image"===z.type},reset:function(z){return"reset"===z.type},button:function(z){return"button"===z.type||z.nodeName.toLowerCase()==="button"},input:function(z){return/input|select|textarea|button/i.test(z.nodeName)}},setFilters:{first:function(z,C){return C===0},last:function(z,C,N,T){return C===
T.length-1},even:function(z,C){return C%2===0},odd:function(z,C){return C%2===1},lt:function(z,C,N){return C<N[3]-0},gt:function(z,C,N){return C>N[3]-0},nth:function(z,C,N){return N[3]-0===C},eq:function(z,C,N){return N[3]-0===C}},filter:{PSEUDO:function(z,C,N,T){var ca=C[1],ba=U.filters[ca];if(ba)return ba(z,N,C,T);else if(ca==="contains")return(z.textContent||z.innerText||m([z])||"").indexOf(C[3])>=0;else if(ca==="not"){C=C[3];N=0;for(T=C.length;N<T;N++)if(C[N]===z)return false;return true}else M.error("Syntax error, unrecognized expression: "+
ca)},CHILD:function(z,C){var N=C[1],T=z;switch(N){case "only":case "first":for(;T=T.previousSibling;)if(T.nodeType===1)return false;if(N==="first")return true;T=z;case "last":for(;T=T.nextSibling;)if(T.nodeType===1)return false;return true;case "nth":N=C[2];var ca=C[3];if(N===1&&ca===0)return true;C=C[0];var ba=z.parentNode;if(ba&&(ba.sizcache!==C||!z.nodeIndex)){var ma=0;for(T=ba.firstChild;T;T=T.nextSibling)if(T.nodeType===1)T.nodeIndex=++ma;ba.sizcache=C}z=z.nodeIndex-ca;return N===0?z===0:z%N===
0&&z/N>=0}},ID:function(z,C){return z.nodeType===1&&z.getAttribute("id")===C},TAG:function(z,C){return C==="*"&&z.nodeType===1||z.nodeName.toLowerCase()===C},CLASS:function(z,C){return(" "+(z.className||z.getAttribute("class"))+" ").indexOf(C)>-1},ATTR:function(z,C){var N=C[1];z=U.attrHandle[N]?U.attrHandle[N](z):z[N]!=null?z[N]:z.getAttribute(N);N=z+"";var T=C[2];C=C[4];return z==null?T==="!=":T==="="?N===C:T==="*="?N.indexOf(C)>=0:T==="~="?(" "+N+" ").indexOf(C)>=0:!C?N&&z!==false:T==="!="?N!==
C:T==="^="?N.indexOf(C)===0:T==="$="?N.substr(N.length-C.length)===C:T==="|="?N===C||N.substr(0,C.length+1)===C+"-":false},POS:function(z,C,N,T){var ca=U.setFilters[C[2]];if(ca)return ca(z,N,C,T)}}},ea=U.match.POS;for(var la in U.match){U.match[la]=new RegExp(U.match[la].source+/(?![^\[]*\])(?![^\(]*\))/.source);U.leftMatch[la]=new RegExp(/(^(?:.|\r|\n)*?)/.source+U.match[la].source.replace(/\\(\d+)/g,function(z,C){return"\\"+(C-0+1)}))}var ra=function(z,C){z=Array.prototype.slice.call(z,0);if(C){C.push.apply(C,
z);return C}return z};try{Array.prototype.slice.call(S.documentElement.childNodes,0)}catch(wa){ra=function(z,C){C=C||[];if(H.call(z)==="[object Array]")Array.prototype.push.apply(C,z);else if(typeof z.length==="number")for(var N=0,T=z.length;N<T;N++)C.push(z[N]);else for(N=0;z[N];N++)C.push(z[N]);return C}}var va;if(S.documentElement.compareDocumentPosition)va=function(z,C){if(!z.compareDocumentPosition||!C.compareDocumentPosition){if(z==C)I=true;return z.compareDocumentPosition?-1:1}z=z.compareDocumentPosition(C)&
4?-1:z===C?0:1;if(z===0)I=true;return z};else if("sourceIndex"in S.documentElement)va=function(z,C){if(!z.sourceIndex||!C.sourceIndex){if(z==C)I=true;return z.sourceIndex?-1:1}z=z.sourceIndex-C.sourceIndex;if(z===0)I=true;return z};else if(S.createRange)va=function(z,C){if(!z.ownerDocument||!C.ownerDocument){if(z==C)I=true;return z.ownerDocument?-1:1}var N=z.ownerDocument.createRange(),T=C.ownerDocument.createRange();N.setStart(z,0);N.setEnd(z,0);T.setStart(C,0);T.setEnd(C,0);z=N.compareBoundaryPoints(Range.START_TO_END,
T);if(z===0)I=true;return z};(function(){var z=S.createElement("div"),C="script"+(new Date).getTime();z.innerHTML="<a name='"+C+"'/>";var N=S.documentElement;N.insertBefore(z,N.firstChild);if(S.getElementById(C)){U.find.ID=function(T,ca,ba){if(typeof ca.getElementById!=="undefined"&&!ba)return(ca=ca.getElementById(T[1]))?ca.id===T[1]||typeof ca.getAttributeNode!=="undefined"&&ca.getAttributeNode("id").nodeValue===T[1]?[ca]:v:[]};U.filter.ID=function(T,ca){var ba=typeof T.getAttributeNode!=="undefined"&&
T.getAttributeNode("id");return T.nodeType===1&&ba&&ba.nodeValue===ca}}N.removeChild(z);N=z=null})();(function(){var z=S.createElement("div");z.appendChild(S.createComment(""));if(z.getElementsByTagName("*").length>0)U.find.TAG=function(C,N){N=N.getElementsByTagName(C[1]);if(C[1]==="*"){C=[];for(var T=0;N[T];T++)N[T].nodeType===1&&C.push(N[T]);N=C}return N};z.innerHTML="<a href='#'></a>";if(z.firstChild&&typeof z.firstChild.getAttribute!=="undefined"&&z.firstChild.getAttribute("href")!=="#")U.attrHandle.href=
function(C){return C.getAttribute("href",2)};z=null})();S.querySelectorAll&&function(){var z=M,C=S.createElement("div");C.innerHTML="<p class='TEST'></p>";if(!(C.querySelectorAll&&C.querySelectorAll(".TEST").length===0)){M=function(T,ca,ba,ma){ca=ca||S;if(!ma&&ca.nodeType===9&&!oa(ca))try{return ra(ca.querySelectorAll(T),ba)}catch(ka){}return z(T,ca,ba,ma)};for(var N in z)M[N]=z[N];C=null}}();(function(){var z=S.createElement("div");z.innerHTML="<div class='test e'></div><div class='test'></div>";
if(!(!z.getElementsByClassName||z.getElementsByClassName("e").length===0)){z.lastChild.className="e";if(z.getElementsByClassName("e").length!==1){U.order.splice(1,0,"CLASS");U.find.CLASS=function(C,N,T){if(typeof N.getElementsByClassName!=="undefined"&&!T)return N.getElementsByClassName(C[1])};z=null}}})();var Ea=S.compareDocumentPosition?function(z,C){return!!(z.compareDocumentPosition(C)&16)}:function(z,C){return z!==C&&(z.contains?z.contains(C):true)},oa=function(z){return(z=(z?z.ownerDocument||
z:0).documentElement)?z.nodeName!=="HTML":false},Va=function(z,C){var N=[],T="",ca;for(C=C.nodeType?[C]:C;ca=U.match.PSEUDO.exec(z);){T+=ca[0];z=z.replace(U.match.PSEUDO,"")}z=U.relative[z]?z+"*":z;ca=0;for(var ba=C.length;ca<ba;ca++)M(z,C[ca],N);return M.filter(T,N)};q.find=M;q.expr=M.selectors;q.expr[":"]=q.expr.filters;q.unique=M.uniqueSort;q.text=m;q.isXMLDoc=oa;q.contains=Ea})();var ob=/Until$/,pb=/^(?:parents|prevUntil|prevAll)/,qb=/,/;X=Array.prototype.slice;var gb=function(m,p,u){if(q.isFunction(p))return q.grep(m,
function(x,H){return!!p.call(x,H,x)===u});else if(p.nodeType)return q.grep(m,function(x){return x===p===u});else if(typeof p==="string"){var y=q.grep(m,function(x){return x.nodeType===1});if(xa.test(p))return q.filter(p,y,!u);else p=q.filter(p,y)}return q.grep(m,function(x){return q.inArray(x,p)>=0===u})};q.fn.extend({find:function(m){for(var p=this.pushStack("","find",m),u=0,y=0,x=this.length;y<x;y++){u=p.length;q.find(m,this[y],p);if(y>0)for(var H=u;H<p.length;H++)for(var I=0;I<u;I++)if(p[I]===
p[H]){p.splice(H--,1);break}}return p},has:function(m){var p=q(m);return this.filter(function(){for(var u=0,y=p.length;u<y;u++)if(q.contains(this,p[u]))return true})},not:function(m){return this.pushStack(gb(this,m,false),"not",m)},filter:function(m){return this.pushStack(gb(this,m,true),"filter",m)},is:function(m){return!!m&&q.filter(m,this).length>0},closest:function(m,p){if(q.isArray(m)){var u=[],y=this[0],x,H={},I;if(y&&m.length){x=0;for(var V=m.length;x<V;x++){I=m[x];H[I]||(H[I]=q.expr.match.POS.test(I)?
q(I,p||this.context):I)}for(;y&&y.ownerDocument&&y!==p;){for(I in H){x=H[I];if(x.jquery?x.index(y)>-1:q(y).is(x)){u.push({selector:I,elem:y});delete H[I]}}y=y.parentNode}}return u}var M=q.expr.match.POS.test(m)?q(m,p||this.context):null;return this.map(function(U,ea){for(;ea&&ea.ownerDocument&&ea!==p;){if(M?M.index(ea)>-1:q(ea).is(m))return ea;ea=ea.parentNode}return null})},index:function(m){if(!m||typeof m==="string")return q.inArray(this[0],m?q(m):this.parent().children());return q.inArray(m.jquery?
m[0]:m,this)},add:function(m,p){m=typeof m==="string"?q(m,p||this.context):q.makeArray(m);p=q.merge(this.get(),m);return this.pushStack(L(m[0])||L(p[0])?p:q.unique(p))},andSelf:function(){return this.add(this.prevObject)}});q.each({parent:function(m){return(m=m.parentNode)&&m.nodeType!==11?m:null},parents:function(m){return q.dir(m,"parentNode")},parentsUntil:function(m,p,u){return q.dir(m,"parentNode",u)},next:function(m){return q.nth(m,2,"nextSibling")},prev:function(m){return q.nth(m,2,"previousSibling")},
nextAll:function(m){return q.dir(m,"nextSibling")},prevAll:function(m){return q.dir(m,"previousSibling")},nextUntil:function(m,p,u){return q.dir(m,"nextSibling",u)},prevUntil:function(m,p,u){return q.dir(m,"previousSibling",u)},siblings:function(m){return q.sibling(m.parentNode.firstChild,m)},children:function(m){return q.sibling(m.firstChild)},contents:function(m){return q.nodeName(m,"iframe")?m.contentDocument||m.contentWindow.document:q.makeArray(m.childNodes)}},function(m,p){q.fn[m]=function(u,
y){var x=q.map(this,p,u);ob.test(m)||(y=u);if(y&&typeof y==="string")x=q.filter(y,x);x=this.length>1?q.unique(x):x;if((this.length>1||qb.test(y))&&pb.test(m))x=x.reverse();return this.pushStack(x,m,X.call(arguments).join(","))}});q.extend({filter:function(m,p,u){if(u)m=":not("+m+")";return q.find.matches(m,p)},dir:function(m,p,u){var y=[];for(m=m[p];m&&m.nodeType!==9&&(u===v||m.nodeType!==1||!q(m).is(u));){m.nodeType===1&&y.push(m);m=m[p]}return y},nth:function(m,p,u){p=p||1;for(var y=0;m;m=m[u])if(m.nodeType===
1&&++y===p)break;return m},sibling:function(m,p){for(var u=[];m;m=m.nextSibling)m.nodeType===1&&m!==p&&u.push(m);return u}});var hb=/ jQuery\d+="(?:\d+|null)"/g,Qa=/^\s+/,ib=/(<([\w:]+)[^>]*?)\/>/g,rb=/^(?:area|br|col|embed|hr|img|input|link|meta|param)$/i,jb=/<([\w:]+)/,sb=/<tbody/i,tb=/<|&#?\w+;/,ab=/<script|<object|<embed|<option|<style/i,bb=/checked\s*(?:[^=]|=\s*.checked.)/i,kb=function(m,p,u){return rb.test(u)?m:p+"></"+u+">"},Fa={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,
"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};Fa.optgroup=Fa.option;Fa.tbody=Fa.tfoot=Fa.colgroup=Fa.caption=Fa.thead;Fa.th=Fa.td;if(!q.support.htmlSerialize)Fa._default=[1,"div<div>","</div>"];q.fn.extend({text:function(m){if(q.isFunction(m))return this.each(function(p){var u=q(this);
u.text(m.call(this,p,u.text()))});if(typeof m!=="object"&&m!==v)return this.empty().append((this[0]&&this[0].ownerDocument||S).createTextNode(m));return q.text(this)},wrapAll:function(m){if(q.isFunction(m))return this.each(function(u){q(this).wrapAll(m.call(this,u))});if(this[0]){var p=q(m,this[0].ownerDocument).eq(0).clone(true);this[0].parentNode&&p.insertBefore(this[0]);p.map(function(){for(var u=this;u.firstChild&&u.firstChild.nodeType===1;)u=u.firstChild;return u}).append(this)}return this},
wrapInner:function(m){if(q.isFunction(m))return this.each(function(p){q(this).wrapInner(m.call(this,p))});return this.each(function(){var p=q(this),u=p.contents();u.length?u.wrapAll(m):p.append(m)})},wrap:function(m){return this.each(function(){q(this).wrapAll(m)})},unwrap:function(){return this.parent().each(function(){q.nodeName(this,"body")||q(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,true,function(m){this.nodeType===1&&this.appendChild(m)})},
prepend:function(){return this.domManip(arguments,true,function(m){this.nodeType===1&&this.insertBefore(m,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,false,function(p){this.parentNode.insertBefore(p,this)});else if(arguments.length){var m=q(arguments[0]);m.push.apply(m,this.toArray());return this.pushStack(m,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,false,function(p){this.parentNode.insertBefore(p,
this.nextSibling)});else if(arguments.length){var m=this.pushStack(this,"after",arguments);m.push.apply(m,q(arguments[0]).toArray());return m}},remove:function(m,p){for(var u=0,y;(y=this[u])!=null;u++)if(!m||q.filter(m,[y]).length){if(!p&&y.nodeType===1){q.cleanData(y.getElementsByTagName("*"));q.cleanData([y])}y.parentNode&&y.parentNode.removeChild(y)}return this},empty:function(){for(var m=0,p;(p=this[m])!=null;m++)for(p.nodeType===1&&q.cleanData(p.getElementsByTagName("*"));p.firstChild;)p.removeChild(p.firstChild);
return this},clone:function(m){var p=this.map(function(){if(!q.support.noCloneEvent&&!q.isXMLDoc(this)){var u=this.outerHTML,y=this.ownerDocument;if(!u){u=y.createElement("div");u.appendChild(this.cloneNode(true));u=u.innerHTML}return q.clean([u.replace(hb,"").replace(/=([^="'>\s]+\/)>/g,'="$1">').replace(Qa,"")],y)[0]}else return this.cloneNode(true)});if(m===true){A(this,p);A(this.find("*"),p.find("*"))}return p},html:function(m){if(m===v)return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(hb,
""):null;else if(typeof m==="string"&&!ab.test(m)&&(q.support.leadingWhitespace||!Qa.test(m))&&!Fa[(jb.exec(m)||["",""])[1].toLowerCase()]){m=m.replace(ib,kb);try{for(var p=0,u=this.length;p<u;p++)if(this[p].nodeType===1){q.cleanData(this[p].getElementsByTagName("*"));this[p].innerHTML=m}}catch(y){this.empty().append(m)}}else q.isFunction(m)?this.each(function(x){var H=q(this),I=H.html();H.empty().append(function(){return m.call(this,x,I)})}):this.empty().append(m);return this},replaceWith:function(m){if(this[0]&&
this[0].parentNode){if(q.isFunction(m))return this.each(function(p){var u=q(this),y=u.html();u.replaceWith(m.call(this,p,y))});if(typeof m!=="string")m=q(m).detach();return this.each(function(){var p=this.nextSibling,u=this.parentNode;q(this).remove();p?q(p).before(m):q(u).append(m)})}else return this.pushStack(q(q.isFunction(m)?m():m),"replaceWith",m)},detach:function(m){return this.remove(m,true)},domManip:function(m,p,u){function y(la){return q.nodeName(la,"table")?la.getElementsByTagName("tbody")[0]||
la.appendChild(la.ownerDocument.createElement("tbody")):la}var x,H,I=m[0],V=[],M;if(!q.support.checkClone&&arguments.length===3&&typeof I==="string"&&bb.test(I))return this.each(function(){q(this).domManip(m,p,u,true)});if(q.isFunction(I))return this.each(function(la){var ra=q(this);m[0]=I.call(this,la,p?ra.html():v);ra.domManip(m,p,u)});if(this[0]){x=I&&I.parentNode;x=q.support.parentNode&&x&&x.nodeType===11&&x.childNodes.length===this.length?{fragment:x}:K(m,this,V);M=x.fragment;if(H=M.childNodes.length===
1?(M=M.firstChild):M.firstChild){p=p&&q.nodeName(H,"tr");for(var U=0,ea=this.length;U<ea;U++)u.call(p?y(this[U],H):this[U],U>0||x.cacheable||this.length>1?M.cloneNode(true):M)}V.length&&q.each(V,e)}return this}});q.fragments={};q.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(m,p){q.fn[m]=function(u){var y=[];u=q(u);var x=this.length===1&&this[0].parentNode;if(x&&x.nodeType===11&&x.childNodes.length===1&&u.length===1){u[p](this[0]);
return this}else{x=0;for(var H=u.length;x<H;x++){var I=(x>0?this.clone(true):this).get();q.fn[p].apply(q(u[x]),I);y=y.concat(I)}return this.pushStack(y,m,u.selector)}}});q.extend({clean:function(m,p,u,y){p=p||S;if(typeof p.createElement==="undefined")p=p.ownerDocument||p[0]&&p[0].ownerDocument||S;for(var x=[],H=0,I;(I=m[H])!=null;H++){if(typeof I==="number")I+="";if(I){if(typeof I==="string"&&!tb.test(I))I=p.createTextNode(I);else if(typeof I==="string"){I=I.replace(ib,kb);var V=(jb.exec(I)||["",
""])[1].toLowerCase(),M=Fa[V]||Fa._default,U=M[0],ea=p.createElement("div");for(ea.innerHTML=M[1]+I+M[2];U--;)ea=ea.lastChild;if(!q.support.tbody){U=sb.test(I);V=V==="table"&&!U?ea.firstChild&&ea.firstChild.childNodes:M[1]==="<table>"&&!U?ea.childNodes:[];for(M=V.length-1;M>=0;--M)q.nodeName(V[M],"tbody")&&!V[M].childNodes.length&&V[M].parentNode.removeChild(V[M])}!q.support.leadingWhitespace&&Qa.test(I)&&ea.insertBefore(p.createTextNode(Qa.exec(I)[0]),ea.firstChild);I=ea.childNodes}if(I.nodeType)x.push(I);
else x=q.merge(x,I)}}if(u)for(H=0;x[H];H++)if(y&&q.nodeName(x[H],"script")&&(!x[H].type||x[H].type.toLowerCase()==="text/javascript"))y.push(x[H].parentNode?x[H].parentNode.removeChild(x[H]):x[H]);else{x[H].nodeType===1&&x.splice.apply(x,[H+1,0].concat(q.makeArray(x[H].getElementsByTagName("script"))));u.appendChild(x[H])}return x},cleanData:function(m){for(var p,u,y=q.cache,x=q.event.special,H=q.support.deleteExpando,I=0,V;(V=m[I])!=null;I++)if(u=V[q.expando]){p=y[u];if(p.events)for(var M in p.events)x[M]?
q.event.remove(V,M):pa(V,M,p.handle);if(H)delete V[q.expando];else V.removeAttribute&&V.removeAttribute(q.expando);delete y[u]}}});var ub=/z-?index|font-?weight|opacity|zoom|line-?height/i,lb=/alpha\([^)]*\)/,mb=/opacity=([^)]*)/,Wa=/float/i,Xa=/-([a-z])/ig,vb=/([A-Z])/g,wb=/^-?\d+(?:px)?$/i,xb=/^-?\d/,yb={position:"absolute",visibility:"hidden",display:"block"},zb=["Left","Right"],Ab=["Top","Bottom"],Bb=S.defaultView&&S.defaultView.getComputedStyle,nb=q.support.cssFloat?"cssFloat":"styleFloat",Ya=
function(m,p){return p.toUpperCase()};q.fn.css=function(m,p){return g(this,m,p,true,function(u,y,x){if(x===v)return q.curCSS(u,y);if(typeof x==="number"&&!ub.test(y))x+="px";q.style(u,y,x)})};q.extend({style:function(m,p,u){if(!m||m.nodeType===3||m.nodeType===8)return v;if((p==="width"||p==="height")&&parseFloat(u)<0)u=v;var y=m.style||m,x=u!==v;if(!q.support.opacity&&p==="opacity"){if(x){y.zoom=1;p=parseInt(u,10)+""==="NaN"?"":"alpha(opacity="+u*100+")";m=y.filter||q.curCSS(m,"filter")||"";y.filter=
lb.test(m)?m.replace(lb,p):p}return y.filter&&y.filter.indexOf("opacity=")>=0?parseFloat(mb.exec(y.filter)[1])/100+"":""}if(Wa.test(p))p=nb;p=p.replace(Xa,Ya);if(x)y[p]=u;return y[p]},css:function(m,p,u,y){if(p==="width"||p==="height"){var x,H=p==="width"?zb:Ab;u=function(){x=p==="width"?m.offsetWidth:m.offsetHeight;y!=="border"&&q.each(H,function(){y||(x-=parseFloat(q.curCSS(m,"padding"+this,true))||0);if(y==="margin")x+=parseFloat(q.curCSS(m,"margin"+this,true))||0;else x-=parseFloat(q.curCSS(m,
"border"+this+"Width",true))||0})};m.offsetWidth!==0?u():q.swap(m,yb,u);return Math.max(0,Math.round(x))}return q.curCSS(m,p,u)},curCSS:function(m,p,u){var y,x=m.style;if(!q.support.opacity&&p==="opacity"&&m.currentStyle){y=mb.test(m.currentStyle.filter||"")?parseFloat(RegExp.$1)/100+"":"";return y===""?"1":y}if(Wa.test(p))p=nb;if(!u&&x&&x[p])y=x[p];else if(Bb){if(Wa.test(p))p="float";p=p.replace(vb,"-$1").toLowerCase();x=m.ownerDocument.defaultView;if(!x)return null;if(m=x.getComputedStyle(m,null))y=
m.getPropertyValue(p);if(p==="opacity"&&y==="")y="1"}else if(m.currentStyle){u=p.replace(Xa,Ya);y=m.currentStyle[p]||m.currentStyle[u];if(!wb.test(y)&&xb.test(y)){p=x.left;var H=m.runtimeStyle.left;m.runtimeStyle.left=m.currentStyle.left;x.left=u==="fontSize"?"1em":y||0;y=x.pixelLeft+"px";x.left=p;m.runtimeStyle.left=H}}return y},swap:function(m,p,u){var y={};for(var x in p){y[x]=m.style[x];m.style[x]=p[x]}u.call(m);for(x in p)m.style[x]=y[x]}});if(q.expr&&q.expr.filters){q.expr.filters.hidden=function(m){var p=
m.offsetWidth,u=m.offsetHeight,y=m.nodeName.toLowerCase()==="tr";return p===0&&u===0&&!y?true:p>0&&u>0&&!y?false:q.curCSS(m,"display")==="none"};q.expr.filters.visible=function(m){return!q.expr.filters.hidden(m)}}var Cb=l(),Db=/<script(.|\s)*?\/script>/gi,Eb=/select|textarea/i,Fb=/color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week/i,Ma=/=\?(&|$)/,Za=/\?/,Gb=/(\?|&)_=.*?(&|$)/,Hb=/^(\w+:)?\/\/([^\/?#]+)/,Ib=/%20/g,Jb=q.fn.load;q.fn.extend({load:function(m,p,
u){if(typeof m!=="string")return Jb.call(this,m);else if(!this.length)return this;var y=m.indexOf(" ");if(y>=0){var x=m.slice(y,m.length);m=m.slice(0,y)}y="GET";if(p)if(q.isFunction(p)){u=p;p=null}else if(typeof p==="object"){p=q.param(p,q.ajaxSettings.traditional);y="POST"}var H=this;q.ajax({url:m,type:y,dataType:"html",data:p,complete:function(I,V){if(V==="success"||V==="notmodified")H.html(x?q("<div />").append(I.responseText.replace(Db,"")).find(x):I.responseText);u&&H.each(u,[I.responseText,
V,I])}});return this},serialize:function(){return q.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?q.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||Eb.test(this.nodeName)||Fb.test(this.type))}).map(function(m,p){m=q(this).val();return m==null?null:q.isArray(m)?q.map(m,function(u){return{name:p.name,value:u}}):{name:p.name,value:m}}).get()}});q.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),
function(m,p){q.fn[p]=function(u){return this.bind(p,u)}});q.extend({get:function(m,p,u,y){if(q.isFunction(p)){y=y||u;u=p;p=null}return q.ajax({type:"GET",url:m,data:p,success:u,dataType:y})},getScript:function(m,p){return q.get(m,null,p,"script")},getJSON:function(m,p,u){return q.get(m,p,u,"json")},post:function(m,p,u,y){if(q.isFunction(p)){y=y||u;u=p;p={}}return q.ajax({type:"POST",url:m,data:p,success:u,dataType:y})},ajaxSetup:function(m){q.extend(q.ajaxSettings,m)},ajaxSettings:{url:location.href,
global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,xhr:f.XMLHttpRequest&&(f.location.protocol!=="file:"||!f.ActiveXObject)?function(){return new f.XMLHttpRequest}:function(){try{return new f.ActiveXObject("Microsoft.XMLHTTP")}catch(m){}},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},lastModified:{},etag:{},ajax:function(m){function p(){x.success&&
x.success.call(M,V,I,oa);x.global&&y("ajaxSuccess",[oa,x])}function u(){x.complete&&x.complete.call(M,oa,I);x.global&&y("ajaxComplete",[oa,x]);x.global&&!--q.active&&q.event.trigger("ajaxStop")}function y(ca,ba){(x.context?q(x.context):q.event).trigger(ca,ba)}var x=q.extend(true,{},q.ajaxSettings,m),H,I,V,M=m&&m.context||x,U=x.type.toUpperCase();if(x.data&&x.processData&&typeof x.data!=="string")x.data=q.param(x.data,x.traditional);if(x.dataType==="jsonp"){if(U==="GET")Ma.test(x.url)||(x.url+=(Za.test(x.url)?
"&":"?")+(x.jsonp||"callback")+"=?");else if(!x.data||!Ma.test(x.data))x.data=(x.data?x.data+"&":"")+(x.jsonp||"callback")+"=?";x.dataType="json"}if(x.dataType==="json"&&(x.data&&Ma.test(x.data)||Ma.test(x.url))){H=x.jsonpCallback||"jsonp"+Cb++;if(x.data)x.data=(x.data+"").replace(Ma,"="+H+"$1");x.url=x.url.replace(Ma,"="+H+"$1");x.dataType="script";f[H]=f[H]||function(ca){V=ca;p();u();f[H]=v;try{delete f[H]}catch(ba){}ra&&ra.removeChild(wa)}}if(x.dataType==="script"&&x.cache===null)x.cache=false;
if(x.cache===false&&U==="GET"){var ea=l(),la=x.url.replace(Gb,"$1_="+ea+"$2");x.url=la+(la===x.url?(Za.test(x.url)?"&":"?")+"_="+ea:"")}if(x.data&&U==="GET")x.url+=(Za.test(x.url)?"&":"?")+x.data;x.global&&!q.active++&&q.event.trigger("ajaxStart");ea=(ea=Hb.exec(x.url))&&(ea[1]&&ea[1]!==location.protocol||ea[2]!==location.host);if(x.dataType==="script"&&U==="GET"&&ea){var ra=S.getElementsByTagName("head")[0]||S.documentElement,wa=S.createElement("script");wa.src=x.url;if(x.scriptCharset)wa.charset=
x.scriptCharset;if(!H){var va=false;wa.onload=wa.onreadystatechange=function(){if(!va&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){va=true;p();u();wa.onload=wa.onreadystatechange=null;ra&&wa.parentNode&&ra.removeChild(wa)}}}ra.insertBefore(wa,ra.firstChild);return v}var Ea=false,oa=x.xhr();if(oa){x.username?oa.open(U,x.url,x.async,x.username,x.password):oa.open(U,x.url,x.async);try{if(x.data||m&&m.contentType)oa.setRequestHeader("Content-Type",x.contentType);if(x.ifModified){q.lastModified[x.url]&&
oa.setRequestHeader("If-Modified-Since",q.lastModified[x.url]);q.etag[x.url]&&oa.setRequestHeader("If-None-Match",q.etag[x.url])}ea||oa.setRequestHeader("X-Requested-With","XMLHttpRequest");oa.setRequestHeader("Accept",x.dataType&&x.accepts[x.dataType]?x.accepts[x.dataType]+", */*":x.accepts._default)}catch(Va){}if(x.beforeSend&&x.beforeSend.call(M,oa,x)===false){x.global&&!--q.active&&q.event.trigger("ajaxStop");oa.abort();return false}x.global&&y("ajaxSend",[oa,x]);var z=oa.onreadystatechange=function(ca){if(!oa||
oa.readyState===0||ca==="abort"){Ea||u();Ea=true;if(oa)oa.onreadystatechange=q.noop}else if(!Ea&&oa&&(oa.readyState===4||ca==="timeout")){Ea=true;oa.onreadystatechange=q.noop;I=ca==="timeout"?"timeout":!q.httpSuccess(oa)?"error":x.ifModified&&q.httpNotModified(oa,x.url)?"notmodified":"success";var ba;if(I==="success")try{V=q.httpData(oa,x.dataType,x)}catch(ma){I="parsererror";ba=ma}if(I==="success"||I==="notmodified")H||p();else q.handleError(x,oa,I,ba);u();ca==="timeout"&&oa.abort();if(x.async)oa=
null}};try{var C=oa.abort;oa.abort=function(){oa&&C.call(oa);z("abort")}}catch(N){}x.async&&x.timeout>0&&setTimeout(function(){oa&&!Ea&&z("timeout")},x.timeout);try{oa.send(U==="POST"||U==="PUT"||U==="DELETE"?x.data:null)}catch(T){q.handleError(x,oa,null,T);u()}x.async||z();return oa}},handleError:function(m,p,u,y){if(m.error)m.error.call(m.context||m,p,u,y);if(m.global)(m.context?q(m.context):q.event).trigger("ajaxError",[p,m,y])},active:0,httpSuccess:function(m){try{return!m.status&&location.protocol===
"file:"||m.status>=200&&m.status<300||m.status===304||m.status===1223||m.status===0}catch(p){}return false},httpNotModified:function(m,p){var u=m.getResponseHeader("Last-Modified"),y=m.getResponseHeader("Etag");if(u)q.lastModified[p]=u;if(y)q.etag[p]=y;return m.status===304||m.status===0},httpData:function(m,p,u){var y=m.getResponseHeader("content-type")||"",x=p==="xml"||!p&&y.indexOf("xml")>=0;m=x?m.responseXML:m.responseText;x&&m.documentElement.nodeName==="parsererror"&&q.error("parsererror");
if(u&&u.dataFilter)m=u.dataFilter(m,p);if(typeof m==="string")if(p==="json"||!p&&y.indexOf("json")>=0)m=q.parseJSON(m);else if(p==="script"||!p&&y.indexOf("javascript")>=0)q.globalEval(m);return m},param:function(m,p){function u(I,V){if(q.isArray(V))q.each(V,function(M,U){p||/\[\]$/.test(I)?y(I,U):u(I+"["+(typeof U==="object"||q.isArray(U)?M:"")+"]",U)});else!p&&V!=null&&typeof V==="object"?q.each(V,function(M,U){u(I+"["+M+"]",U)}):y(I,V)}function y(I,V){V=q.isFunction(V)?V():V;x[x.length]=encodeURIComponent(I)+
"="+encodeURIComponent(V)}var x=[];if(p===v)p=q.ajaxSettings.traditional;if(q.isArray(m)||m.jquery)q.each(m,function(){y(this.name,this.value)});else for(var H in m)u(H,m[H]);return x.join("&").replace(Ib,"+")}});var $a={},Kb=/toggle|show|hide/,Lb=/^([+-]=)?([\d+-.]+)(.*)$/,Ra,cb=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];q.fn.extend({show:function(m,p){if(m||m===0)return this.animate(Y("show",
3),m,p);else{m=0;for(p=this.length;m<p;m++){var u=q.data(this[m],"olddisplay");this[m].style.display=u||"";if(q.css(this[m],"display")==="none"){u=this[m].nodeName;var y;if($a[u])y=$a[u];else{var x=q("<"+u+" />").appendTo("body");y=x.css("display");if(y==="none")y="block";x.remove();$a[u]=y}q.data(this[m],"olddisplay",y)}}m=0;for(p=this.length;m<p;m++)this[m].style.display=q.data(this[m],"olddisplay")||"";return this}},hide:function(m,p){if(m||m===0)return this.animate(Y("hide",3),m,p);else{m=0;for(p=
this.length;m<p;m++){var u=q.data(this[m],"olddisplay");!u&&u!=="none"&&q.data(this[m],"olddisplay",q.css(this[m],"display"))}m=0;for(p=this.length;m<p;m++)this[m].style.display="none";return this}},_toggle:q.fn.toggle,toggle:function(m,p){var u=typeof m==="boolean";if(q.isFunction(m)&&q.isFunction(p))this._toggle.apply(this,arguments);else m==null||u?this.each(function(){var y=u?m:q(this).is(":hidden");q(this)[y?"show":"hide"]()}):this.animate(Y("toggle",3),m,p);return this},fadeTo:function(m,p,
u){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:p},m,u)},animate:function(m,p,u,y){var x=q.speed(p,u,y);if(q.isEmptyObject(m))return this.each(x.complete);return this[x.queue===false?"each":"queue"](function(){var H=q.extend({},x),I,V=this.nodeType===1&&q(this).is(":hidden"),M=this;for(I in m){var U=I.replace(Xa,Ya);if(I!==U){m[U]=m[I];delete m[I];I=U}if(m[I]==="hide"&&V||m[I]==="show"&&!V)return H.complete.call(this);if((I==="height"||I==="width")&&this.style){H.display=
q.css(this,"display");H.overflow=this.style.overflow}if(q.isArray(m[I])){(H.specialEasing=H.specialEasing||{})[I]=m[I][1];m[I]=m[I][0]}}if(H.overflow!=null)this.style.overflow="hidden";H.curAnim=q.extend({},m);q.each(m,function(ea,la){var ra=new q.fx(M,H,ea);if(Kb.test(la))ra[la==="toggle"?V?"show":"hide":la](m);else{var wa=Lb.exec(la),va=ra.cur(true)||0;if(wa){la=parseFloat(wa[2]);var Ea=wa[3]||"px";if(Ea!=="px"){M.style[ea]=(la||1)+Ea;va=(la||1)/ra.cur(true)*va;M.style[ea]=va+Ea}if(wa[1])la=(wa[1]===
"-="?-1:1)*la+va;ra.custom(va,la,Ea)}else ra.custom(va,la,"")}});return true})},stop:function(m,p){var u=q.timers;m&&this.queue([]);this.each(function(){for(var y=u.length-1;y>=0;y--)if(u[y].elem===this){p&&u[y](true);u.splice(y,1)}});p||this.dequeue();return this}});q.each({slideDown:Y("show",1),slideUp:Y("hide",1),slideToggle:Y("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"}},function(m,p){q.fn[m]=function(u,y){return this.animate(p,u,y)}});q.extend({speed:function(m,p,u){var y=m&&
typeof m==="object"?m:{complete:u||!u&&p||q.isFunction(m)&&m,duration:m,easing:u&&p||p&&!q.isFunction(p)&&p};y.duration=q.fx.off?0:typeof y.duration==="number"?y.duration:q.fx.speeds[y.duration]||q.fx.speeds._default;y.old=y.complete;y.complete=function(){y.queue!==false&&q(this).dequeue();q.isFunction(y.old)&&y.old.call(this)};return y},easing:{linear:function(m,p,u,y){return u+y*m},swing:function(m,p,u,y){return(-Math.cos(m*Math.PI)/2+0.5)*y+u}},timers:[],fx:function(m,p,u){this.options=p;this.elem=
m;this.prop=u;if(!p.orig)p.orig={}}});q.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this);(q.fx.step[this.prop]||q.fx.step._default)(this);if((this.prop==="height"||this.prop==="width")&&this.elem.style)this.elem.style.display="block"},cur:function(m){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null))return this.elem[this.prop];return(m=parseFloat(q.css(this.elem,this.prop,m)))&&m>-10000?m:parseFloat(q.curCSS(this.elem,
this.prop))||0},custom:function(m,p,u){function y(H){return x.step(H)}this.startTime=l();this.start=m;this.end=p;this.unit=u||this.unit||"px";this.now=this.start;this.pos=this.state=0;var x=this;y.elem=this.elem;if(y()&&q.timers.push(y)&&!Ra)Ra=setInterval(q.fx.tick,13)},show:function(){this.options.orig[this.prop]=q.style(this.elem,this.prop);this.options.show=true;this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur());q(this.elem).show()},hide:function(){this.options.orig[this.prop]=
q.style(this.elem,this.prop);this.options.hide=true;this.custom(this.cur(),0)},step:function(m){var p=l(),u=true;if(m||p>=this.options.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();this.options.curAnim[this.prop]=true;for(var y in this.options.curAnim)if(this.options.curAnim[y]!==true)u=false;if(u){if(this.options.display!=null){this.elem.style.overflow=this.options.overflow;m=q.data(this.elem,"olddisplay");this.elem.style.display=m?m:this.options.display;if(q.css(this.elem,
"display")==="none")this.elem.style.display="block"}this.options.hide&&q(this.elem).hide();if(this.options.hide||this.options.show)for(var x in this.options.curAnim)q.style(this.elem,x,this.options.orig[x]);this.options.complete.call(this.elem)}return false}else{x=p-this.startTime;this.state=x/this.options.duration;m=this.options.easing||(q.easing.swing?"swing":"linear");this.pos=q.easing[this.options.specialEasing&&this.options.specialEasing[this.prop]||m](this.state,x,0,1,this.options.duration);
this.now=this.start+(this.end-this.start)*this.pos;this.update()}return true}};q.extend(q.fx,{tick:function(){for(var m=q.timers,p=0;p<m.length;p++)m[p]()||m.splice(p--,1);m.length||q.fx.stop()},stop:function(){clearInterval(Ra);Ra=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(m){q.style(m.elem,"opacity",m.now)},_default:function(m){if(m.elem.style&&m.elem.style[m.prop]!=null)m.elem.style[m.prop]=(m.prop==="width"||m.prop==="height"?Math.max(0,m.now):m.now)+m.unit;else m.elem[m.prop]=
m.now}}});if(q.expr&&q.expr.filters)q.expr.filters.animated=function(m){return q.grep(q.timers,function(p){return m===p.elem}).length};q.fn.offset="getBoundingClientRect"in S.documentElement?function(m){var p=this[0];if(m)return this.each(function(x){q.offset.setOffset(this,m,x)});if(!p||!p.ownerDocument)return null;if(p===p.ownerDocument.body)return q.offset.bodyOffset(p);var u=p.getBoundingClientRect(),y=p.ownerDocument;p=y.body;y=y.documentElement;return{top:u.top+(self.pageYOffset||q.support.boxModel&&
y.scrollTop||p.scrollTop)-(y.clientTop||p.clientTop||0),left:u.left+(self.pageXOffset||q.support.boxModel&&y.scrollLeft||p.scrollLeft)-(y.clientLeft||p.clientLeft||0)}}:function(m){var p=this[0];if(m)return this.each(function(ea){q.offset.setOffset(this,m,ea)});if(!p||!p.ownerDocument)return null;if(p===p.ownerDocument.body)return q.offset.bodyOffset(p);q.offset.initialize();var u=p.offsetParent,y=p,x=p.ownerDocument,H,I=x.documentElement,V=x.body;y=(x=x.defaultView)?x.getComputedStyle(p,null):p.currentStyle;
for(var M=p.offsetTop,U=p.offsetLeft;(p=p.parentNode)&&p!==V&&p!==I;){if(q.offset.supportsFixedPosition&&y.position==="fixed")break;H=x?x.getComputedStyle(p,null):p.currentStyle;M-=p.scrollTop;U-=p.scrollLeft;if(p===u){M+=p.offsetTop;U+=p.offsetLeft;if(q.offset.doesNotAddBorder&&!(q.offset.doesAddBorderForTableAndCells&&/^t(able|d|h)$/i.test(p.nodeName))){M+=parseFloat(H.borderTopWidth)||0;U+=parseFloat(H.borderLeftWidth)||0}y=u;u=p.offsetParent}if(q.offset.subtractsBorderForOverflowNotVisible&&H.overflow!==
"visible"){M+=parseFloat(H.borderTopWidth)||0;U+=parseFloat(H.borderLeftWidth)||0}y=H}if(y.position==="relative"||y.position==="static"){M+=V.offsetTop;U+=V.offsetLeft}if(q.offset.supportsFixedPosition&&y.position==="fixed"){M+=Math.max(I.scrollTop,V.scrollTop);U+=Math.max(I.scrollLeft,V.scrollLeft)}return{top:M,left:U}};q.offset={initialize:function(){var m=S.body,p=S.createElement("div"),u,y,x,H=parseFloat(q.curCSS(m,"marginTop",true))||0;q.extend(p.style,{position:"absolute",top:0,left:0,margin:0,
border:0,width:"1px",height:"1px",visibility:"hidden"});p.innerHTML="<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>";m.insertBefore(p,m.firstChild);u=p.firstChild;y=u.firstChild;x=u.nextSibling.firstChild.firstChild;this.doesNotAddBorder=y.offsetTop!==5;this.doesAddBorderForTableAndCells=
x.offsetTop===5;y.style.position="fixed";y.style.top="20px";this.supportsFixedPosition=y.offsetTop===20||y.offsetTop===15;y.style.position=y.style.top="";u.style.overflow="hidden";u.style.position="relative";this.subtractsBorderForOverflowNotVisible=y.offsetTop===-5;this.doesNotIncludeMarginInBodyOffset=m.offsetTop!==H;m.removeChild(p);q.offset.initialize=q.noop},bodyOffset:function(m){var p=m.offsetTop,u=m.offsetLeft;q.offset.initialize();if(q.offset.doesNotIncludeMarginInBodyOffset){p+=parseFloat(q.curCSS(m,
"marginTop",true))||0;u+=parseFloat(q.curCSS(m,"marginLeft",true))||0}return{top:p,left:u}},setOffset:function(m,p,u){if(/static/.test(q.curCSS(m,"position")))m.style.position="relative";var y=q(m),x=y.offset(),H=parseInt(q.curCSS(m,"top",true),10)||0,I=parseInt(q.curCSS(m,"left",true),10)||0;if(q.isFunction(p))p=p.call(m,u,x);u={top:p.top-x.top+H,left:p.left-x.left+I};"using"in p?p.using.call(m,u):y.css(u)}};q.fn.extend({position:function(){if(!this[0])return null;var m=this[0],p=this.offsetParent(),
u=this.offset(),y=/^body|html$/i.test(p[0].nodeName)?{top:0,left:0}:p.offset();u.top-=parseFloat(q.curCSS(m,"marginTop",true))||0;u.left-=parseFloat(q.curCSS(m,"marginLeft",true))||0;y.top+=parseFloat(q.curCSS(p[0],"borderTopWidth",true))||0;y.left+=parseFloat(q.curCSS(p[0],"borderLeftWidth",true))||0;return{top:u.top-y.top,left:u.left-y.left}},offsetParent:function(){return this.map(function(){for(var m=this.offsetParent||S.body;m&&!/^body|html$/i.test(m.nodeName)&&q.css(m,"position")==="static";)m=
m.offsetParent;return m})}});q.each(["Left","Top"],function(m,p){var u="scroll"+p;q.fn[u]=function(y){var x=this[0],H;if(!x)return null;if(y!==v)return this.each(function(){if(H=aa(this))H.scrollTo(!m?y:q(H).scrollLeft(),m?y:q(H).scrollTop());else this[u]=y});else return(H=aa(x))?"pageXOffset"in H?H[m?"pageYOffset":"pageXOffset"]:q.support.boxModel&&H.document.documentElement[u]||H.document.body[u]:x[u]}});q.each(["Height","Width"],function(m,p){var u=p.toLowerCase();q.fn["inner"+p]=function(){return this[0]?
q.css(this[0],u,false,"padding"):null};q.fn["outer"+p]=function(y){return this[0]?q.css(this[0],u,false,y?"margin":"border"):null};q.fn[u]=function(y){var x=this[0];if(!x)return y==null?null:this;if(q.isFunction(y))return this.each(function(H){var I=q(this);I[u](y.call(this,H,I[u]()))});return"scrollTo"in x&&x.document?x.document.compatMode==="CSS1Compat"&&x.document.documentElement["client"+p]||x.document.body["client"+p]:x.nodeType===9?Math.max(x.documentElement["client"+p],x.body["scroll"+p],x.documentElement["scroll"+
p],x.body["offset"+p],x.documentElement["offset"+p]):y===v?q.css(x,u):this.css(u,typeof y==="string"?y:y+"px")}});f.jQuery=f.$=q})(window);define("lib/jquery-1.4.2",function(){});
(function(){var f=this,v=f._,h=typeof StopIteration!=="undefined"?StopIteration:"__break__",e=function(B){return B.replace(/([.*+?^${}()|[\]\/\\])/g,"\\$1")},g=Array.prototype,l=Object.prototype,o=g.slice,r=g.unshift,s=l.toString,w=l.hasOwnProperty,D=g.forEach,L=g.map,A=g.reduce,K=g.reduceRight,Y=g.filter,aa=g.every,q=g.some,P=g.indexOf,fa=g.lastIndexOf;l=Array.isArray;var S=Object.keys,F=function(B){return new za(B)};if(typeof exports!=="undefined")exports._=F;f._=F;F.VERSION="1.0.2";var ja=F.forEach=
function(B,J,R){try{if(D&&B.forEach===D)B.forEach(J,R);else if(F.isNumber(B.length))for(var W=0,ia=B.length;W<ia;W++)J.call(R,B[W],W,B);else for(W in B)w.call(B,W)&&J.call(R,B[W],W,B)}catch(na){if(na!=h)throw na;}return B};F.map=function(B,J,R){if(L&&B.map===L)return B.map(J,R);var W=[];ja(B,function(ia,na,ta){W.push(J.call(R,ia,na,ta))});return W};F.reduce=function(B,J,R,W){if(A&&B.reduce===A)return B.reduce(F.bind(R,W),J);ja(B,function(ia,na,ta){J=R.call(W,J,ia,na,ta)});return J};F.reduceRight=
function(B,J,R,W){if(K&&B.reduceRight===K)return B.reduceRight(F.bind(R,W),J);B=F.clone(F.toArray(B)).reverse();return F.reduce(B,J,R,W)};F.detect=function(B,J,R){var W;ja(B,function(ia,na,ta){if(J.call(R,ia,na,ta)){W=ia;F.breakLoop()}});return W};F.filter=function(B,J,R){if(Y&&B.filter===Y)return B.filter(J,R);var W=[];ja(B,function(ia,na,ta){J.call(R,ia,na,ta)&&W.push(ia)});return W};F.reject=function(B,J,R){var W=[];ja(B,function(ia,na,ta){!J.call(R,ia,na,ta)&&W.push(ia)});return W};F.every=function(B,
J,R){J=J||F.identity;if(aa&&B.every===aa)return B.every(J,R);var W=true;ja(B,function(ia,na,ta){(W=W&&J.call(R,ia,na,ta))||F.breakLoop()});return W};F.some=function(B,J,R){J=J||F.identity;if(q&&B.some===q)return B.some(J,R);var W=false;ja(B,function(ia,na,ta){if(W=J.call(R,ia,na,ta))F.breakLoop()});return W};F.include=function(B,J){if(P&&B.indexOf===P)return B.indexOf(J)!=-1;var R=false;ja(B,function(W){if(R=W===J)F.breakLoop()});return R};F.invoke=function(B,J){var R=F.rest(arguments,2);return F.map(B,
function(W){return(J?W[J]:W).apply(W,R)})};F.pluck=function(B,J){return F.map(B,function(R){return R[J]})};F.max=function(B,J,R){if(!J&&F.isArray(B))return Math.max.apply(Math,B);var W={computed:-Infinity};ja(B,function(ia,na,ta){na=J?J.call(R,ia,na,ta):ia;na>=W.computed&&(W={value:ia,computed:na})});return W.value};F.min=function(B,J,R){if(!J&&F.isArray(B))return Math.min.apply(Math,B);var W={computed:Infinity};ja(B,function(ia,na,ta){na=J?J.call(R,ia,na,ta):ia;na<W.computed&&(W={value:ia,computed:na})});
return W.value};F.sortBy=function(B,J,R){return F.pluck(F.map(B,function(W,ia,na){return{value:W,criteria:J.call(R,W,ia,na)}}).sort(function(W,ia){W=W.criteria;ia=ia.criteria;return W<ia?-1:W>ia?1:0}),"value")};F.sortedIndex=function(B,J,R){R=R||F.identity;for(var W=0,ia=B.length;W<ia;){var na=W+ia>>1;R(B[na])<R(J)?(W=na+1):(ia=na)}return W};F.toArray=function(B){if(!B)return[];if(B.toArray)return B.toArray();if(F.isArray(B))return B;if(F.isArguments(B))return o.call(B);return F.values(B)};F.size=
function(B){return F.toArray(B).length};F.first=function(B,J,R){return J&&!R?o.call(B,0,J):B[0]};F.rest=function(B,J,R){return o.call(B,F.isUndefined(J)||R?1:J)};F.last=function(B){return B[B.length-1]};F.compact=function(B){return F.filter(B,function(J){return!!J})};F.flatten=function(B){return F.reduce(B,[],function(J,R){if(F.isArray(R))return J.concat(F.flatten(R));J.push(R);return J})};F.without=function(B){var J=F.rest(arguments);return F.filter(B,function(R){return!F.include(J,R)})};F.uniq=
function(B,J){return F.reduce(B,[],function(R,W,ia){if(0==ia||(J===true?F.last(R)!=W:!F.include(R,W)))R.push(W);return R})};F.intersect=function(B){var J=F.rest(arguments);return F.filter(F.uniq(B),function(R){return F.every(J,function(W){return F.indexOf(W,R)>=0})})};F.zip=function(){for(var B=F.toArray(arguments),J=F.max(F.pluck(B,"length")),R=new Array(J),W=0;W<J;W++)R[W]=F.pluck(B,String(W));return R};F.indexOf=function(B,J){if(P&&B.indexOf===P)return B.indexOf(J);for(var R=0,W=B.length;R<W;R++)if(B[R]===
J)return R;return-1};F.lastIndexOf=function(B,J){if(fa&&B.lastIndexOf===fa)return B.lastIndexOf(J);for(var R=B.length;R--;)if(B[R]===J)return R;return-1};F.range=function(B,J,R){var W=F.toArray(arguments),ia=W.length<=1;B=ia?0:W[0];J=ia?W[0]:W[1];R=W[2]||1;W=Math.ceil((J-B)/R);if(W<=0)return[];W=new Array(W);ia=B;for(var na=0;;ia+=R){if((R>0?ia-J:J-ia)>=0)return W;W[na++]=ia}};F.bind=function(B,J){var R=F.rest(arguments,2);return function(){return B.apply(J||{},R.concat(F.toArray(arguments)))}};F.bindAll=
function(B){var J=F.rest(arguments);if(J.length==0)J=F.functions(B);ja(J,function(R){B[R]=F.bind(B[R],B)});return B};F.delay=function(B,J){var R=F.rest(arguments,2);return setTimeout(function(){return B.apply(B,R)},J)};F.defer=function(B){return F.delay.apply(F,[B,1].concat(F.rest(arguments)))};F.wrap=function(B,J){return function(){var R=[B].concat(F.toArray(arguments));return J.apply(J,R)}};F.compose=function(){var B=F.toArray(arguments);return function(){for(var J=F.toArray(arguments),R=B.length-
1;R>=0;R--)J=[B[R].apply(this,J)];return J[0]}};F.keys=S||function(B){if(F.isArray(B))return F.range(0,B.length);var J=[];for(var R in B)w.call(B,R)&&J.push(R);return J};F.values=function(B){return F.map(B,F.identity)};F.functions=function(B){return F.filter(F.keys(B),function(J){return F.isFunction(B[J])}).sort()};F.extend=function(B){ja(F.rest(arguments),function(J){for(var R in J)B[R]=J[R]});return B};F.clone=function(B){if(F.isArray(B))return B.slice(0);return F.extend({},B)};F.tap=function(B,
J){J(B);return B};F.isEqual=function(B,J){if(B===J)return true;var R=typeof B;if(R!=typeof J)return false;if(B==J)return true;if(!B&&J||B&&!J)return false;if(B.isEqual)return B.isEqual(J);if(F.isDate(B)&&F.isDate(J))return B.getTime()===J.getTime();if(F.isNaN(B)&&F.isNaN(J))return true;if(F.isRegExp(B)&&F.isRegExp(J))return B.source===J.source&&B.global===J.global&&B.ignoreCase===J.ignoreCase&&B.multiline===J.multiline;if(R!=="object")return false;if(B.length&&B.length!==J.length)return false;R=F.keys(B);
var W=F.keys(J);if(R.length!=W.length)return false;for(var ia in B)if(!(ia in J)||!F.isEqual(B[ia],J[ia]))return false;return true};F.isEmpty=function(B){if(F.isArray(B))return B.length===0;for(var J in B)if(w.call(B,J))return false;return true};F.isElement=function(B){return!!(B&&B.nodeType==1)};F.isArray=l||function(B){return!!(B&&B.concat&&B.unshift&&!B.callee)};F.isArguments=function(B){return B&&B.callee};F.isFunction=function(B){return!!(B&&B.constructor&&B.call&&B.apply)};F.isString=function(B){return!!(B===
""||B&&B.charCodeAt&&B.substr)};F.isNumber=function(B){return B===+B||s.call(B)==="[object Number]"};F.isBoolean=function(B){return B===true||B===false};F.isDate=function(B){return!!(B&&B.getTimezoneOffset&&B.setUTCFullYear)};F.isRegExp=function(B){return!!(B&&B.test&&B.exec&&(B.ignoreCase||B.ignoreCase===false))};F.isNaN=function(B){return F.isNumber(B)&&isNaN(B)};F.isNull=function(B){return B===null};F.isUndefined=function(B){return typeof B=="undefined"};F.noConflict=function(){f._=v;return this};
F.identity=function(B){return B};F.times=function(B,J,R){for(var W=0;W<B;W++)J.call(R,W)};F.breakLoop=function(){throw h;};F.mixin=function(B){ja(F.functions(B),function(J){ya(J,F[J]=B[J])})};var xa=0;F.uniqueId=function(B){var J=xa++;return B?B+J:J};F.templateSettings={start:"<%",end:"%>",interpolate:/<%=(.+?)%>/g};F.template=function(B,J){var R=F.templateSettings,W=new RegExp("'(?=[^"+R.end.substr(0,1)+"]*"+e(R.end)+")","g");B=new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+
B.replace(/[\r\t\n]/g," ").replace(W,"\t").split("'").join("\\'").split("\t").join("'").replace(R.interpolate,"',$1,'").split(R.start).join("');").split(R.end).join("p.push('")+"');}return p.join('');");return J?B(J):B};F.each=F.forEach;F.foldl=F.inject=F.reduce;F.foldr=F.reduceRight;F.select=F.filter;F.all=F.every;F.any=F.some;F.head=F.first;F.tail=F.rest;F.methods=F.functions;var za=function(B){this._wrapped=B},Ca=function(B,J){return J?F(B).chain():B},ya=function(B,J){za.prototype[B]=function(){var R=
F.toArray(arguments);r.call(R,this._wrapped);return Ca(J.apply(F,R),this._chain)}};F.mixin(F);ja(["pop","push","reverse","shift","sort","splice","unshift"],function(B){var J=g[B];za.prototype[B]=function(){J.apply(this._wrapped,arguments);return Ca(this._wrapped,this._chain)}});ja(["concat","join","slice"],function(B){var J=g[B];za.prototype[B]=function(){return Ca(J.apply(this._wrapped,arguments),this._chain)}});za.prototype.chain=function(){this._chain=true;return this};za.prototype.value=function(){return this._wrapped}})();
define("lib/underscore",function(){});window.GLGE||(window.GLGE={});
(function(f){function v(){var h=f.Vec([1,2,3,4]),e=f.Vec4(f.getVec4(h,3),f.get1basedVec4(h,3),f.getVec4(h,1),f.getVec4(h,0));h=f.identMatrix();e=f.mulMat4Vec4(h,e);if(f.getVec4(e,0)!=4||f.getVec4(e,1)!=3||f.getVec4(e,2)!=2||f.getVec4(e,3)!=1)throw"Unit Test 1 failed MatVecMul "+e;e=f.Mat4([3,4,5,0,0.5,0.75,0,0,0.75,0.5,0,0,0.25,0.25,1,1]);var g=f.Mat4([2,1,8,2,1,4,3,2,1,0.5,6.5,2,8,3,1,0.25]),l=f.mulMat4(e,g),o=f.Mat4([15,21.5,68.5,24,1.75,3.5,6.25,2.5,2,2.75,7.5,2.5,9.75,4.75,10.25,3.25]);for(g=
0;g<4;++g)for(var r=0;r<4;++r){var s=f.getMat4(l,g,r)-f.getMat4(o,g,r);if(!(s<1.0E-6&&s>-1.0E-6))throw"Unit Test 1 failed Multiplication "+f.getMat4(l,g,r)+" != "+f.getMat4(o,g,r);}g=f.inverseMat4(e);l=f.mulMat4(e,g);f.mulMat4(g,e);for(g=0;g<4;++g)for(r=0;r<4;++r){s=f.getMat4(l,g,r)-f.getMat4(h,g,r);if(!(s<1.0E-4&&s>-1.0E-4))throw"Unit Test 1 failed Inverse "+f.getMat4(l,g,r)+" != "+f.getMat4(h,g,r);}}f.Vec=function(h){return h.slice(0)};f.Vec3=function(h,e,g){return[h,e,g]};f.Vec4=function(h,e,g,
l){return[h,e,g,l]};f.get1basedVec4=function(h,e){return h[e-1]};f.get1basedVec3=function(h,e){return h[e-1]};f.getVec4=function(h,e){return h[e]};f.getVec3=function(h,e){return h[e]};f.addVec4=function(h,e){return[h[0]+e[0],h[1]+e[1],h[2]+e[2],h[3]+e[3]]};f.addVec3=function(h,e){return[h[0]+e[0],h[1]+e[1],h[2]+e[2]]};f.subVec4=function(h,e){return[h[0]-e[0],h[1]-e[1],h[2]-e[2],h[3]-e[3]]};f.subVec3=function(h,e){return[h[0]-e[0],h[1]-e[1],h[2]-e[2]]};f.dotVec3=function(h,e){return h[0]*e[0]+h[1]*
e[1]+h[2]*e[2]};f.dotVec4=function(h,e){return h[0]*e[0]+h[1]*e[1]+h[2]*e[2]+h[3]*e[3]};f.scaleVec4=function(h,e){return[h[0]*e,h[1]*e,h[2]*e,h[3]*e]};f.scaleVec3=function(h,e){return[h[0]*e,h[1]*e,h[2]*e]};f.crossVec3=function(h,e){return[h[1]*e[2]-h[2]*e[1],h[2]*e[0]-h[0]*e[2],h[0]*e[1]-h[1]*e[0]]};f.toUnitVec3=function(h){var e=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],g=1;if(e>0)g=Math.pow(e,0.5);return[h[0]/g,h[1]/g,h[2]/g]};f.toUnitVec4=function(h){var e=h[0]*h[0]+h[1]*h[1]+h[2]*h[2]+h[3]*h[3],g=1;if(e>
0)g=Math.pow(e,0.5);return[h[0]/g,h[1]/g,h[2]/g,h[3]/g]};f.lengthVec3=function(h){return Math.pow(h[0]*h[0]+h[1]*h[1]+h[2]*h[2],0.5)};f.distanceVec3=function(h,e){return f.lengthVec3(f.subVec3(h,e))};f.lengthVec4=function(h){return Math.pow(h[0]*h[0]+h[1]*h[1]+h[2]*h[2]+h[3]*h[3],0.5)};f.distanceVec4=function(h,e){return f.lengthVec4(f.subVec4(h,e))};f.angleVec3=function(h,e){h=f.toUnitVec3(h);e=f.toUnitVec3(e);d=f.dotVec3(h,e);if(d<-1)d=-1;if(d>1)d=1;return Math.acos(d)};f.angleVec4=function(h,e){h=
f.toUnitVec4(h);e=f.toUnitVec4(e);d=f.dotVec4(h,e);if(d<-1)d=-1;if(d>1)d=1;return Math.acos(d)};GLGE_math_use_webgl_float=false;f.Mat3=GLGE_math_use_webgl_float?function(h){if(h.length==9)return new Float32Array(h);else if(h.length==16)return new Float32Array([h[0],h[1],h[2],h[4],h[5],h[6],h[8],h[9],h[10]]);else throw"invalid matrix length";}:function(h){if(h.length==9)h=h.slice(0);else if(h.length==16)h=[h[0],h[1],h[2],h[4],h[5],h[6],h[8],h[9],h[10]];else throw"invalid matrix length";h.get=function(e){return this[e]};
return h};f.Mat=GLGE_math_use_webgl_float?function(h){return new Float32Array(h)}:function(h){h=h.slice(0);h.get=function(e){return this[e]};return h};f.Mat4=function(h){if(h.length==9)h=[h[0],h[1],h[2],0,h[3],h[4],h[5],0,h[6],h[7],h[8],0,0,0,0,1];else if(h.length==16)h=h.slice(0);else throw"invalid matrix length";h.get=function(e){return this[e]};return h};f.determinantMat4=function(h){return h[12]*h[9]*h[6]*h[3]-h[8]*h[13]*h[6]*h[3]-h[12]*h[5]*h[10]*h[3]+h[4]*h[13]*h[10]*h[3]+h[8]*h[5]*h[14]*h[3]-
h[4]*h[9]*h[14]*h[3]-h[12]*h[9]*h[2]*h[7]+h[8]*h[13]*h[2]*h[7]+h[12]*h[1]*h[10]*h[7]-h[0]*h[13]*h[10]*h[7]-h[8]*h[1]*h[14]*h[7]+h[0]*h[9]*h[14]*h[7]+h[12]*h[5]*h[2]*h[11]-h[4]*h[13]*h[2]*h[11]-h[12]*h[1]*h[6]*h[11]+h[0]*h[13]*h[6]*h[11]+h[4]*h[1]*h[14]*h[11]-h[0]*h[5]*h[14]*h[11]-h[8]*h[5]*h[2]*h[15]+h[4]*h[9]*h[2]*h[15]+h[8]*h[1]*h[6]*h[15]-h[0]*h[9]*h[6]*h[15]-h[4]*h[1]*h[10]*h[15]+h[0]*h[5]*h[10]*h[15]};f.inverseMat4=function(h){var e=h[0],g=h[1],l=h[2],o=h[3],r=h[4],s=h[5],w=h[6],D=h[7],L=h[8],
A=h[9],K=h[10],Y=h[11],aa=h[12],q=h[13],P=h[14];h=h[15];var fa=aa*A*w*o-L*q*w*o-aa*s*K*o+r*q*K*o+L*s*P*o-r*A*P*o-aa*A*l*D+L*q*l*D+aa*g*K*D-e*q*K*D-L*g*P*D+e*A*P*D+aa*s*l*Y-r*q*l*Y-aa*g*w*Y+e*q*w*Y+r*g*P*Y-e*s*P*Y-L*s*l*h+r*A*l*h+L*g*w*h-e*A*w*h-r*g*K*h+e*s*K*h;return[(A*P*D-q*K*D+q*w*Y-s*P*Y-A*w*h+s*K*h)/fa,(q*K*o-A*P*o-q*l*Y+g*P*Y+A*l*h-g*K*h)/fa,(s*P*o-q*w*o+q*l*D-g*P*D-s*l*h+g*w*h)/fa,(A*w*o-s*K*o-A*l*D+g*K*D+s*l*Y-g*w*Y)/fa,(aa*K*D-L*P*D-aa*w*Y+r*P*Y+L*w*h-r*K*h)/fa,(L*P*o-aa*K*o+aa*l*Y-e*P*Y-
L*l*h+e*K*h)/fa,(aa*w*o-r*P*o-aa*l*D+e*P*D+r*l*h-e*w*h)/fa,(r*K*o-L*w*o+L*l*D-e*K*D-r*l*Y+e*w*Y)/fa,(L*q*D-aa*A*D+aa*s*Y-r*q*Y-L*s*h+r*A*h)/fa,(aa*A*o-L*q*o-aa*g*Y+e*q*Y+L*g*h-e*A*h)/fa,(r*q*o-aa*s*o+aa*g*D-e*q*D-r*g*h+e*s*h)/fa,(L*s*o-r*A*o-L*g*D+e*A*D+r*g*Y-e*s*Y)/fa,(aa*A*w-L*q*w-aa*s*K+r*q*K+L*s*P-r*A*P)/fa,(L*q*l-aa*A*l+aa*g*K-e*q*K-L*g*P+e*A*P)/fa,(aa*s*l-r*q*l-aa*g*w+e*q*w+r*g*P-e*s*P)/fa,(r*A*l-L*s*l+L*g*w-e*A*w-r*g*K+e*s*K)/fa]};f.mulMat4Vec4=function(h,e){return f.Vec4(h[0]*e[0]+h[1]*e[1]+
h[2]*e[2]+h[3]*e[3],h[4]*e[0]+h[5]*e[1]+h[6]*e[2]+h[7]*e[3],h[8]*e[0]+h[9]*e[1]+h[10]*e[2]+h[11]*e[3],h[12]*e[0]+h[13]*e[1]+h[14]*e[2]+h[15]*e[3])};f.scaleMat4=function(h,e){return f.Mat([h[0]*e,h[1]*e,h[2]*e,h[3]*e,h[4]*e,h[5]*e,h[6]*e,h[7]*e,h[8]*e,h[9]*e,h[10]*e,h[11]*e,h[12]*e,h[13]*e,h[14]*e,h[15]*e])};f.scaleInPlaceMat4=function(h,e){h.set(0,h[0]*e);h.set(1,h[1]*e);h.set(2,h[2]*e);h.set(3,h[3]*e);h.set(4,h[4]*e);h.set(5,h[5]*e);h.set(6,h[6]*e);h.set(7,h[7]*e);h.set(8,h[8]*e);h.set(9,h[9]*e);
h.set(10,h[10]*e);h.set(11,h[11]*e);h.set(12,h[12]*e);h.set(13,h[13]*e);h.set(14,h[14]*e);h.set(15,h[15]*e);return h};f.addInPlaceMat4=function(h,e){h.set(0,h[0]+e[0]);h.set(1,h[1]+e[1]);h.set(2,h[2]+e[2]);h.set(3,h[3]+e[3]);h.set(4,h[4]+e[4]);h.set(5,h[5]+e[5]);h.set(6,h[6]+e[6]);h.set(7,h[7]+e[7]);h.set(8,h[8]+e[8]);h.set(9,h[9]+e[9]);h.set(10,h[10]+e[10]);h.set(11,h[11]+e[11]);h.set(12,h[12]+e[12]);h.set(13,h[13]+e[13]);h.set(14,h[14]+e[14]);h.set(15,h[15]+e[15]);return h};f.addMat4=function(h,
e){return f.Mat([h[0]+e[0],h[1]+e[1],h[2]+e[2],h[3]+e[3],h[4]+e[4],h[5]+e[5],h[6]+e[6],h[7]+e[7],h[8]+e[8],h[9]+e[9],h[10]+e[10],h[11]+e[11],h[12]+e[12],h[13]+e[13],h[14]+e[14],h[15]+e[15]])};f.subInPlaceMat4=function(h,e){h.set(0,h[0]-e[0]);h.set(1,h[1]-e[1]);h.set(2,h[2]-e[2]);h.set(3,h[3]-e[3]);h.set(4,h[4]-e[4]);h.set(5,h[5]-e[5]);h.set(6,h[6]-e[6]);h.set(7,h[7]-e[7]);h.set(8,h[8]-e[8]);h.set(9,h[9]-e[9]);h.set(10,h[10]-e[10]);h.set(11,h[11]-e[11]);h.set(12,h[12]-e[12]);h.set(13,h[13]-e[13]);
h.set(14,h[14]-e[14]);h.set(15,h[15]-e[15]);return h};f.subMat4=function(h,e){return f.Mat([h[0]-e[0],h[1]-e[1],h[2]-e[2],h[3]-e[3],h[4]-e[4],h[5]-e[5],h[6]-e[6],h[7]-e[7],h[8]-e[8],h[9]-e[9],h[10]-e[10],h[11]-e[11],h[12]-e[12],h[13]-e[13],h[14]-e[14],h[15]-e[15]])};f.mulMat4=function(h,e){var g=e[0],l=e[1],o=e[2],r=e[3],s=e[4],w=e[5],D=e[6],L=e[7],A=e[8],K=e[9],Y=e[10],aa=e[11],q=e[12],P=e[13],fa=e[14];e=e[15];var S=h[0],F=h[1],ja=h[2],xa=h[3],za=h[4],Ca=h[5],ya=h[6],B=h[7],J=h[8],R=h[9],W=h[10],
ia=h[11],na=h[12],ta=h[13],X=h[14];h=h[15];return[S*g+F*s+ja*A+xa*q,S*l+F*w+ja*K+xa*P,S*o+F*D+ja*Y+xa*fa,S*r+F*L+ja*aa+xa*e,za*g+Ca*s+ya*A+B*q,za*l+Ca*w+ya*K+B*P,za*o+Ca*D+ya*Y+B*fa,za*r+Ca*L+ya*aa+B*e,J*g+R*s+W*A+ia*q,J*l+R*w+W*K+ia*P,J*o+R*D+W*Y+ia*fa,J*r+R*L+W*aa+ia*e,na*g+ta*s+X*A+h*q,na*l+ta*w+X*K+h*P,na*o+ta*D+X*Y+h*fa,na*r+ta*L+X*aa+h*e]};f.transposeInPlaceMat4=function(h){var e=h[1];h.set(1,h[4]);h.set(4,e);e=h[8];h.set(8,h[2]);h.set(2,e);e=h[3];h.set(3,h[12]);h.set(12,e);e=h[9];h.set(9,h[6]);
h.set(6,e);e=h[13];h.set(13,h[7]);h.set(7,e);e=h[14];h.set(14,h[11]);h.set(11,e)};f.transposeMat4=function(h){return f.Mat4([h[0],h[4],h[8],h[12],h[1],h[5],h[9],h[13],h[2],h[6],h[10],h[14],h[3],h[7],h[11],h[15]])};f.mat4gl=function(h,e){e[0]=h[0];e[1]=h[1];e[2]=h[2];e[3]=h[3];e[4]=h[4];e[5]=h[5];e[6]=h[6];e[7]=h[7];e[8]=h[8];e[9]=h[9];e[10]=h[10];e[11]=h[11];e[12]=h[12];e[13]=h[13];e[14]=h[14];e[15]=h[15]};f.set1basedMat4=function(h,e,g,l){h[(e-1)*4+(g-1)]=l;h.glData!==undefined&&delete h.glData};
f.setMat4=function(h,e,g,l){h[e*4+g]=l;h.glData!==undefined&&delete h.glData};f.get1basedMat4=function(h,e,g){return h.get((e-1)*4+(g-1))};f.getMat4=function(h,e,g){return h[e*4+g]};f.glDataMat4=function(h){h.glArray=new Float32Array(h);return h.glArray};f.identMatrix=function(){return f.Mat([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};f.translateMatrix=function(h){var e,g,l;if(arguments.length==3){e=arguments[0];g=arguments[1];l=arguments[2]}else if(h.data){e=h.data[0];g=h.data[1];l=h.data[2]}else if(h instanceof
Array){e=h[0];g=h[1];l=h[2]}return f.Mat([1,0,0,e,0,1,0,g,0,0,1,l,0,0,0,1])};f.scaleMatrix=function(h){var e,g,l;if(arguments.length==3){e=arguments[0];g=arguments[1];l=arguments[2]}else if(h.data){e=h.data[0];g=h.data[1];l=h.data[2]}else if(h instanceof Array){e=h[0];g=h[1];l=h[2]}return f.Mat([e,0,0,0,0,g,0,0,0,0,l,0,0,0,0,1])};f.ROT_XYZ=1;f.ROT_XZY=2;f.ROT_YXZ=3;f.ROT_YZX=4;f.ROT_ZXY=5;f.ROT_ZYX=6;f.rotateMatrix=function(h,e){var g,l,o;if(arguments.length>2){g=arguments[0];l=arguments[1];o=arguments[2];
e=arguments[3]}else if(h.data){g=h.data[0];l=h.data[1];o=h.data[2]}else if(h instanceof Array){g=h[0];l=h[1];o=h[2]}if(!e)e=f.ROT_XYZ;var r=Math.cos(g),s=Math.sin(g);g=Math.cos(l);var w=Math.sin(l);l=Math.cos(o);o=Math.sin(o);r=f.Mat([1,0,0,0,0,r,-s,0,0,s,r,0,0,0,0,1]);g=f.Mat([g,0,w,0,0,1,0,0,-w,0,g,0,0,0,0,1]);l=f.Mat([l,-o,0,0,o,l,0,0,0,0,1,0,0,0,0,1]);switch(e){case f.ROT_XYZ:return f.mulMat4(r,f.mulMat4(g,l));case f.ROT_XZY:return f.mulMat4(r,f.mulMat4(l,g));case f.ROT_YXZ:return f.mulMat4(g,
f.mulMat4(r,l));case f.ROT_YZX:return f.mulMat4(g,f.mulMat4(l,r));case f.ROT_ZXY:return f.mulMat4(l,f.mulMat4(r,g));case f.ROT_ZYX:return f.mulMat4(l,f.mulMat4(g,r))}};f.angleAxis=function(h,e){var g,l,o,r,s,w,D,L;e=[e[0],e[1],e[2],0];w=e[0];s=e[1];var A=e[2];e=Math.cos(h);var K=1-e;g=Math.sin(h);h=w*g;D=s*g;L=A*g;g=w*w;l=s*s;o=A*A;r=w*s;s=s*A;w=A*w;return f.Mat([K*g+e,K*r-L,K*w+D,0,K*r+L,K*l+e,K*s-h,0,K*w-D,K*s+h,K*o+e,0,0,0,0,1])};f.quatRotation=function(h,e,g,l){return f.Mat([1-2*e*e-2*g*g,2*h*
e-2*g*l,2*h*g+2*e*l,0,2*h*e+2*g*l,1-2*h*h-2*g*g,2*e*g-2*h*l,0,2*h*g-2*e*l,2*e*g+2*h*l,1-2*h*h-2*e*e,0,0,0,0,1])};f.makeOrtho=function(h,e,g,l,o,r){return f.Mat([2/(e-h),0,0,-(e+h)/(e-h),0,2/(l-g),0,-(l+g)/(l-g),0,0,-2/(r-o),-(r+o)/(r-o),0,0,0,1])};f.makeFrustum=function(h,e,g,l,o,r){return f.Mat([2*o/(e-h),0,(e+h)/(e-h),0,0,2*o/(l-g),(l+g)/(l-g),0,0,0,-(r+o)/(r-o),-2*r*o/(r-o),0,0,-1,0])};f.makePerspective=function(h,e,g,l){h=g*Math.tan(h*0.00872664625972);var o=-h;return f.makeFrustum(o*e,h*e,o,
h,g,l)};f.matrix2Scale=function(h){var e=h[0],g=h[1],l=h[2],o=h[4],r=h[5],s=h[6],w=h[8],D=h[9];h=h[10];e=Math.sqrt(e*e+g*g+l*l);o=Math.sqrt(o*o+r*r+s*s);w=Math.sqrt(w*w+D*D+h*h);return[e,o,w]};f.rotationMatrix2Quat=function(h){var e=h[0]+h[5]+h[10]+1,g,l,o;if(e>0){g=0.5/Math.sqrt(e);o=0.25/g;e=(h[9]-h[6])*g;l=(h[2]-h[8])*g;h=(h[4]-h[1])*g}else if(h[0]>h[5]&&h[0]>h[10]){g=Math.sqrt(1+h[0]-h[5]-h[10])*2;o=(h[9]-h[6])/g;e=0.25/g;l=(h[1]+h[4])/g;h=(h[2]+h[8])/g}else if(h[5]>h[10]){g=Math.sqrt(1+h[5]-
h[0]-h[10])*2;o=(h[2]-h[8])/g;e=(h[1]+h[4])/g;l=0.25/g;h=(h[6]+h[9])/g}else{g=Math.sqrt(1+h[10]-h[0]-h[5])*2;o=(h[4]-h[1])/g;e=(h[2]+h[8])/g;l=(h[6]+h[9])/g;h=0.25/g}g=Math.sqrt(e*e+l*l+h*h+o*o);return[e/g,l/g,h/g,o/g]};f.rayToPlane=function(h,e){e=f.toUnitVec3(e);return[e[0],e[1],e[2],f.dotVec3(h,e)]};f.rayIntersectPlane=function(h,e,g){var l=[g[0],g[1],g[2]];g=g[3];var o=f.dotVec3(l,e);if(o<=0)return false;l=-(f.dotVec3(l,h)+g)/o;if(l<=0)return false;return f.addVec3(h,f.scaleVec3(e,l))};f.screenToDirection=
function(h,e,g,l,o){xcoord=-(2*h/g-1)/o[0];ycoord=(2*e/l-1)/o[5];zcoord=1;return f.toUnitVec3([xcoord,ycoord,zcoord])};f.BoundingVolume=function(h,e,g,l,o,r){this.dims=e=[e-h,l-g,r-o];this.center=[e[0]/2+h,e[1]/2+g,e[2]/2+o]};f.BoundingVolume.prototype.getCenter=function(h){return f.mulMat4Vec4(h,this.center)};f.BoundingVolume.prototype.getBoxPoint=function(h,e){return f.mulMat4Vec4(h,[this.dims[0]/2*e[0]+this.center[0],this.dims[1]/2*e[1]+this.center[1],this.dims[2]/2*e[2]+this.center[2]])};f.BoundingVolume.prototype.getSphereRadius=
function(){return Math.pow((this.dims[0]*this.dims[0]+this.dims[1]*this.dims[1]+this.dims[2]*this.dims[2])/4,0.5)};f.BoundingVolume.prototype.addBoundingVolume=function(h){var e=Math.min(this.center[0]-this.dims[0]/2,h.center[0]-h.dims[0]/2),g=Math.max(this.center[0]+this.dims[0]/2,h.center[0]+h.dims[0]/2),l=Math.min(this.center[1]-this.dims[1]/2,h.center[1]-h.dims[1]/2),o=Math.max(this.center[1]+this.dims[1]/2,h.center[1]+h.dims[1]/2),r=Math.min(this.center[2]-this.dims[2]/2,h.center[2]-h.dims[2]/
2);h=Math.max(this.center[2]+this.dims[2]/2,h.center[2]+h.dims[2]/2);this.dims=g=[g-e,o-l,h-r];this.center=[g[0]/2+e,g[1]/2+l,g[2]/2+r]};f.BoundingVolume.prototype.applyMatrixScale=function(h){var e=f.lengthVec3([h[0],h[4],h[8]]),g=f.lengthVec3([h[1],h[5],h[9]]),l=f.lengthVec3([h[2],h[6],h[10]]);h=(this.center[0]-this.dims[0]/2)*e;var o=(this.center[1]-this.dims[1]/2)*g,r=(this.center[2]-this.dims[2]/2)*l;this.dims=e=[(this.center[0]+this.dims[0]/2)*e-h,(this.center[1]+this.dims[1]/2)*g-o,(this.center[2]+
this.dims[2]/2)*l-r];this.center=[e[0]/2+h,e[1]/2+o,e[2]/2+r]};f.BoundingVolume.prototype.clone=function(){return new f.BoundingVolume(this.center[0]-this.dims[0]/2,this.center[0]+this.dims[0]/2,this.center[1]-this.dims[1]/2,this.center[1]+this.dims[1]/2,this.center[2]-this.dims[2]/2,this.center[2]+this.dims[2]/2)};f.BoundingVolume.prototype.toString=function(){return[this.center[0]-this.dims[0]/2,this.center[0]+this.dims[0]/2,this.center[1]-this.dims[1]/2,this.center[1]+this.dims[1]/2,this.center[2]-
this.dims[2]/2,this.center[2]+this.dims[2]/2].toString()};v();f.Vec3=f.Vec3;f.Vec4=f.Vec4;f.get1basedVec4=f.get1basedVec4;f.get1basedVec3=f.get1basedVec3;f.getVec4=f.getVec4;f.getVec3=f.getVec3;f.addVec4=f.addVec4;f.addVec3=f.addVec3;f.subVec4=f.subVec4;f.subVec3=f.subVec3;f.dotVec3=f.dotVec3;f.dotVec4=f.dotVec4;f.scaleVec4=f.scaleVec4;f.scaleVec3=f.scaleVec3;f.crossVec3=f.crossVec3;f.toUnitVec3=f.toUnitVec3;f.toUnitVec4=f.toUnitVec4;f.lengthVec3=f.lengthVec3;f.distanceVec3=f.distanceVec3;f.lengthVec4=
f.lengthVec4;f.distanceVec4=f.distanceVec4;f.angleVec3=f.angleVec3;f.angleVec4=f.angleVec4;f.Mat3=f.Mat3;f.Mat=f.Mat;f.Mat4=f.Mat4;f.determinantMat4=f.determinantMat4;f.inverseMat4=f.inverseMat4;f.mulMat4Vec4=f.mulMat4Vec4;f.scaleMat4=f.scaleMat4;f.scaleInPlaceMat4=f.scaleInPlaceMat4;f.addInPlaceMat4=f.addInPlaceMat4;f.addMat4=f.addMat4;f.subInPlaceMat4=f.subInPlaceMat4;f.subMat4=f.subMat4;f.mulMat4=f.mulMat4;f.transposeInPlaceMat4=f.transposeInPlaceMat4;f.transposeMat4=f.transposeMat4;f.set1basedMat4=
f.set1basedMat4;f.setMat4=f.setMat4;f.get1basedMat4=f.get1basedMat4;f.getMat4=f.getMat4;f.glDataMat4=f.glDataMat4;f.identMatrix=f.identMatrix;f.translateMatrix=f.translateMatrix;f.scaleMatrix=f.scaleMatrix;f.ROT_XYZ=f.ROT_XYZ;f.ROT_XZY=f.ROT_XZY;f.ROT_YXZ=f.ROT_YXZ;f.ROT_YZX=f.ROT_YZX;f.ROT_ZXY=f.ROT_ZXY;f.ROT_ZYX=f.ROT_ZYX;f.rotateMatrix=f.rotateMatrix;f.angleAxis=f.angleAxis;f.quatRotation=f.quatRotation;f.makeOrtho=f.makeOrtho;f.makeFrustum=f.makeFrustum;f.makePerspective=f.makePerspective;f.matrix2Scale=
f.matrix2Scale;f.rotationMatrix2Quat=f.rotationMatrix2Quat;f.mat4gl=f.mat4gl})(window.GLGE);define("glge/glge_math",function(){});window.GLGE||(window.GLGE={});
(function(f){function v(){if(f.Message){f.Message=f.Message;f.Message.parseMessage=f.Message.parseMessage}if(f.Document){f.Document=f.Document;f.Document.prototype.getElementById=f.Document.prototype.getElementById;f.Document.prototype.getElement=f.Document.prototype.getElement;f.Document.prototype.load=f.Document.prototype.load;f.Document.prototype.loadDocument=f.Document.prototype.loadDocument;f.Document.prototype.onLoad=f.Document.prototype.onLoad;f.Document.prototype.addLoadListener=f.Document.prototype.addLoadListener;
f.Document.prototype.removeLoadListener=f.Document.prototype.removeLoadListener}if(f.Placeable){f.Placeable=f.Placeable;f.Placeable.prototype.getRoot=f.Placeable.prototype.getRoot;f.Placeable.prototype.getRef=f.Placeable.prototype.getRef;f.Placeable.prototype.setId=f.Placeable.prototype.setId;f.Placeable.prototype.getId=f.Placeable.prototype.getId;f.Placeable.prototype.getLookat=f.Placeable.prototype.getLookat;f.Placeable.prototype.setLookat=f.Placeable.prototype.setLookat;f.Placeable.prototype.Lookat=
f.Placeable.prototype.Lookat;f.Placeable.prototype.getRotOrder=f.Placeable.prototype.getRotOrder;f.Placeable.prototype.setRotOrder=f.Placeable.prototype.setRotOrder;f.Placeable.prototype.getRotMatrix=f.Placeable.prototype.getRotMatrix;f.Placeable.prototype.setRotMatrix=f.Placeable.prototype.setRotMatrix;f.Placeable.prototype.setLocX=f.Placeable.prototype.setLocX;f.Placeable.prototype.setLocY=f.Placeable.prototype.setLocY;f.Placeable.prototype.setLocZ=f.Placeable.prototype.setLocZ;f.Placeable.prototype.setLoc=
f.Placeable.prototype.setLoc;f.Placeable.prototype.setDLocX=f.Placeable.prototype.setDLocX;f.Placeable.prototype.setDLocY=f.Placeable.prototype.setDLocY;f.Placeable.prototype.setDLocZ=f.Placeable.prototype.setDLocZ;f.Placeable.prototype.setDLoc=f.Placeable.prototype.setDLoc;f.Placeable.prototype.setQuatX=f.Placeable.prototype.setQuatX;f.Placeable.prototype.setQuatY=f.Placeable.prototype.setQuatY;f.Placeable.prototype.setQuatZ=f.Placeable.prototype.setQuatZ;f.Placeable.prototype.setQuatW=f.Placeable.prototype.setQuatW;
f.Placeable.prototype.setQuat=f.Placeable.prototype.setQuat;f.Placeable.prototype.setRotX=f.Placeable.prototype.setRotX;f.Placeable.prototype.setRotY=f.Placeable.prototype.setRotY;f.Placeable.prototype.setRotZ=f.Placeable.prototype.setRotZ;f.Placeable.prototype.setRot=f.Placeable.prototype.setRot;f.Placeable.prototype.setDRotX=f.Placeable.prototype.setDRotX;f.Placeable.prototype.setDRotY=f.Placeable.prototype.setDRotY;f.Placeable.prototype.setDRotZ=f.Placeable.prototype.setDRotZ;f.Placeable.prototype.setDRot=
f.Placeable.prototype.setDRot;f.Placeable.prototype.setScaleX=f.Placeable.prototype.setScaleX;f.Placeable.prototype.setScaleY=f.Placeable.prototype.setScaleY;f.Placeable.prototype.setScaleZ=f.Placeable.prototype.setScaleZ;f.Placeable.prototype.setScale=f.Placeable.prototype.setScale;f.Placeable.prototype.setDScaleX=f.Placeable.prototype.setDScaleX;f.Placeable.prototype.setDScaleY=f.Placeable.prototype.setDScaleY;f.Placeable.prototype.setDScaleZ=f.Placeable.prototype.setDScaleZ;f.Placeable.prototype.setDScale=
f.Placeable.prototype.setDScale;f.Placeable.prototype.getLocX=f.Placeable.prototype.getLocX;f.Placeable.prototype.getLocY=f.Placeable.prototype.getLocY;f.Placeable.prototype.getLocZ=f.Placeable.prototype.getLocZ;f.Placeable.prototype.getDLocX=f.Placeable.prototype.getDLocX;f.Placeable.prototype.getDLocY=f.Placeable.prototype.getDLocY;f.Placeable.prototype.getDLocZ=f.Placeable.prototype.getDLocZ;f.Placeable.prototype.getQuatX=f.Placeable.prototype.getQuatX;f.Placeable.prototype.getQuatY=f.Placeable.prototype.getQuatY;
f.Placeable.prototype.getQuatZ=f.Placeable.prototype.getQuatZ;f.Placeable.prototype.getQuatW=f.Placeable.prototype.getQuatW;f.Placeable.prototype.getRotX=f.Placeable.prototype.getRotX;f.Placeable.prototype.getRotY=f.Placeable.prototype.getRotY;f.Placeable.prototype.getRotZ=f.Placeable.prototype.getRotZ;f.Placeable.prototype.getDRotX=f.Placeable.prototype.getDRotX;f.Placeable.prototype.getDRotY=f.Placeable.prototype.getDRotY;f.Placeable.prototype.getDRotZ=f.Placeable.prototype.getDRotZ;f.Placeable.prototype.getScaleX=
f.Placeable.prototype.getScaleX;f.Placeable.prototype.getScaleY=f.Placeable.prototype.getScaleY;f.Placeable.prototype.getScaleZ=f.Placeable.prototype.getScaleZ;f.Placeable.prototype.getDScaleX=f.Placeable.prototype.getDScaleX;f.Placeable.prototype.getDScaleY=f.Placeable.prototype.getDScaleY;f.Placeable.prototype.getDScaleZ=f.Placeable.prototype.getDScaleZ;f.Placeable.prototype.getPosition=f.Placeable.prototype.getPosition;f.Placeable.prototype.getRotation=f.Placeable.prototype.getRotation;f.Placeable.prototype.getScale=
f.Placeable.prototype.getScale;f.Placeable.prototype.getModelMatrix=f.Placeable.prototype.getModelMatrix}if(f.Animatable){f.Animatable=f.Animatable;f.Animatable.prototype.animationStart=f.Animatable.prototype.animationStart;f.Animatable.prototype.animate=f.Animatable.prototype.animate;f.Animatable.prototype.setAnimation=f.Animatable.prototype.setAnimation;f.Animatable.prototype.getAnimation=f.Animatable.prototype.getAnimation;f.Animatable.prototype.setFrameRate=f.Animatable.prototype.setFrameRate;
f.Animatable.prototype.getFrameRate=f.Animatable.prototype.getFrameRate;f.Animatable.prototype.setLoop=f.Animatable.prototype.setLoop;f.Animatable.prototype.getLoop=f.Animatable.prototype.getLoop;f.Animatable.prototype.isLooping=f.Animatable.prototype.isLooping;f.Animatable.prototype.setPaused=f.Animatable.prototype.setPaused;f.Animatable.prototype.getPaused=f.Animatable.prototype.getPaused;f.Animatable.prototype.togglePaused=f.Animatable.prototype.togglePaused}if(f.BezTriple){f.BezTriple=f.BezTriple;
f.BezTriple.prototype.className=f.BezTriple.prototype.className;f.BezTriple.prototype.setX1=f.BezTriple.prototype.setX1;f.BezTriple.prototype.setY1=f.BezTriple.prototype.setY1;f.BezTriple.prototype.setX2=f.BezTriple.prototype.setX2;f.BezTriple.prototype.setY2=f.BezTriple.prototype.setY2;f.BezTriple.prototype.setX3=f.BezTriple.prototype.setX3;f.BezTriple.prototype.setY4=f.BezTriple.prototype.setY4}if(f.LinearPoint){f.LinearPoint=f.LinearPoint;f.LinearPoint.prototype.className=f.LinearPoint.prototype.className;
f.LinearPoint.prototype.setX=f.LinearPoint.prototype.setX;f.LinearPoint.prototype.setY=f.LinearPoint.prototype.setY}if(f.StepPoint)f.StepPoint=f.StepPoint;if(f.AnimationCurve){f.AnimationCurve=f.AnimationCurve;f.AnimationCurve.prototype.className=f.AnimationCurve.prototype.className;f.AnimationCurve.prototype.addPoint=f.AnimationCurve.prototype.addPoint;f.AnimationCurve.prototype.getValue=f.AnimationCurve.prototype.getValue}if(f.AnimationVector){f.AnimationVector=f.AnimationVector;f.AnimationVector.prototype.addCurve=
f.AnimationVector.prototype.addCurve;f.AnimationVector.prototype.removeCurve=f.AnimationVector.prototype.removeCurve;f.AnimationVector.prototype.setFrames=f.AnimationVector.prototype.setFrames;f.AnimationVector.prototype.getFrames=f.AnimationVector.prototype.getFrames}if(f.augment)f.augment=f.augment;f.G_NODE=f.G_NODE;f.G_ROOT=f.G_ROOT;if(f.Group){f.Group=f.Group;f.Group.prototype.children=f.Group.prototype.children;f.Group.prototype.className=f.Group.prototype.className;f.Group.prototype.type=f.Group.prototype.type;
f.Group.prototype.getObjects=f.Group.prototype.getObjects;f.Group.prototype.getLights=f.Group.prototype.getLights;f.Group.prototype.addChild=f.Group.prototype.addChild;f.Group.prototype.addObject=f.Group.prototype.addObject;f.Group.prototype.addGroup=f.Group.prototype.addGroup;f.Group.prototype.addText=f.Group.prototype.addText;f.Group.prototype.addSkeleton=f.Group.prototype.addSkeleton;f.Group.prototype.addLight=f.Group.prototype.addLight;f.Group.prototype.addCamera=f.Group.prototype.addCamera;f.Group.prototype.removeChild=
f.Group.prototype.removeChild;f.Group.prototype.getChildren=f.Group.prototype.getChildren}if(f.Text){f.Text=f.Text;f.Text.prototype.className=f.Text.prototype.className;f.Text.prototype.getPickType=f.Text.prototype.getPickType;f.Text.prototype.setPickType=f.Text.prototype.setPickType;f.Text.prototype.getFont=f.Text.prototype.getFont;f.Text.prototype.setFont=f.Text.prototype.setFont;f.Text.prototype.getSize=f.Text.prototype.getSize;f.Text.prototype.setSize=f.Text.prototype.setSize;f.Text.prototype.getText=
f.Text.prototype.getText;f.Text.prototype.setText=f.Text.prototype.setText;f.Text.prototype.setColor=f.Text.prototype.setColor;f.Text.prototype.setColorR=f.Text.prototype.setColorR;f.Text.prototype.setColorG=f.Text.prototype.setColorG;f.Text.prototype.setColorB=f.Text.prototype.setColorB;f.Text.prototype.getColor=f.Text.prototype.getColor;f.Text.prototype.setZtransparent=f.Text.prototype.setZtransparent;f.Text.prototype.isZtransparent=f.Text.prototype.isZtransparent}if(f.MultiMaterial){f.MultiMaterial=
f.MultiMaterial;f.MultiMaterial.prototype.className=f.MultiMaterial.prototype.className;f.MultiMaterial.prototype.setMesh=f.MultiMaterial.prototype.setMesh;f.MultiMaterial.prototype.getMesh=f.MultiMaterial.prototype.getMesh;f.MultiMaterial.prototype.setMaterial=f.MultiMaterial.prototype.setMaterial;f.MultiMaterial.prototype.getMaterial=f.MultiMaterial.prototype.getMaterial}if(f.Object instanceof Object){f.Object=f.Object;f.Object.prototype.className=f.Object.prototype.className;f.Object.prototype.setZtransparent=
f.Object.prototype.setZtransparent;f.Object.prototype.isZtransparent=f.Object.prototype.isZtransparent;f.Object.prototype.setSkeleton=f.Object.prototype.setSkeleton;f.Object.prototype.getSkeleton=f.Object.prototype.getSkeleton;f.Object.prototype.setMaterial=f.Object.prototype.setMaterial;f.Object.prototype.getMaterial=f.Object.prototype.getMaterial;f.Object.prototype.setMesh=f.Object.prototype.setMesh;f.Object.prototype.getMesh=f.Object.prototype.getMesh;f.Object.prototype.addMultiMaterial=f.Object.prototype.addMultiMaterial;
f.Object.prototype.getMultiMaterials=f.Object.prototype.getMultiMaterials}if(f.Mesh){f.Mesh=f.Mesh;f.Mesh.prototype.className=f.Mesh.prototype.className;f.Mesh.prototype.setJoints=f.Mesh.prototype.setJoints;f.Mesh.prototype.setInvBindMatrix=f.Mesh.prototype.setInvBindMatrix;f.Mesh.prototype.setVertexJoints=f.Mesh.prototype.setVertexJoints;f.Mesh.prototype.setVertexWeights=f.Mesh.prototype.setVertexWeights;f.Mesh.prototype.setUV=f.Mesh.prototype.setUV;f.Mesh.prototype.setUV2=f.Mesh.prototype.setUV2;
f.Mesh.prototype.setPositions=f.Mesh.prototype.setPositions;f.Mesh.prototype.setNormals=f.Mesh.prototype.setNormals;f.Mesh.prototype.setBuffer=f.Mesh.prototype.setBuffer;f.Mesh.prototype.setFaces=f.Mesh.prototype.setFaces;f.Mesh.prototype.addObject=f.Mesh.prototype.addObject;f.Mesh.prototype.removeObject=f.Mesh.prototype.removeObject}f.L_POINT=f.L_POINT;f.L_DIR=f.L_DIR;f.L_SPOT=f.L_SPOT;if(f.Light){f.Light=f.Light;f.Light.prototype.className=f.Light.prototype.className;f.Light.prototype.getPMatrix=
f.Light.prototype.getPMatrix;f.Light.prototype.setCastShadows=f.Light.prototype.setCastShadows;f.Light.prototype.getCastShadows=f.Light.prototype.getCastShadows;f.Light.prototype.setShadowBias=f.Light.prototype.setShadowBias;f.Light.prototype.getShadowBias=f.Light.prototype.getShadowBias;f.Light.prototype.setBufferWidth=f.Light.prototype.setBufferWidth;f.Light.prototype.getBufferHeight=f.Light.prototype.getBufferHeight;f.Light.prototype.setBufferHeight=f.Light.prototype.setBufferHeight;f.Light.prototype.getBufferWidth=
f.Light.prototype.getBufferWidth;f.Light.prototype.setSpotCosCutOff=f.Light.prototype.setSpotCosCutOff;f.Light.prototype.getSpotCosCutOff=f.Light.prototype.getSpotCosCutOff;f.Light.prototype.setSpotExponent=f.Light.prototype.setSpotExponent;f.Light.prototype.getSpotExponent=f.Light.prototype.getSpotExponent;f.Light.prototype.getAttenuation=f.Light.prototype.getAttenuation;f.Light.prototype.setAttenuation=f.Light.prototype.setAttenuation;f.Light.prototype.setAttenuationConstant=f.Light.prototype.setAttenuationConstant;
f.Light.prototype.setAttenuationLinear=f.Light.prototype.setAttenuationLinear;f.Light.prototype.setAttenuationQuadratic=f.Light.prototype.setAttenuationQuadratic;f.Light.prototype.setColor=f.Light.prototype.setColor;f.Light.prototype.setColorR=f.Light.prototype.setColorR;f.Light.prototype.setColorG=f.Light.prototype.setColorG;f.Light.prototype.setColorB=f.Light.prototype.setColorB;f.Light.prototype.getColor=f.Light.prototype.getColor;f.Light.prototype.getType=f.Light.prototype.getType;f.Light.prototype.setType=
f.Light.prototype.setType}f.C_PERSPECTIVE=f.C_PERSPECTIVE;f.C_ORTHO=f.C_ORTHO;if(f.Camera){f.Camera=f.Camera;f.Camera.prototype.className=f.Camera.prototype.className;f.Camera.prototype.getOrthoScale=f.Camera.prototype.getOrthoScale;f.Camera.prototype.setOrthoScale=f.Camera.prototype.setOrthoScale;f.Camera.prototype.getFar=f.Camera.prototype.getFar;f.Camera.prototype.setFar=f.Camera.prototype.setFar;f.Camera.prototype.getNear=f.Camera.prototype.getNear;f.Camera.prototype.setNear=f.Camera.prototype.setNear;
f.Camera.prototype.getType=f.Camera.prototype.getType;f.Camera.prototype.setType=f.Camera.prototype.setType;f.Camera.prototype.getFovY=f.Camera.prototype.getFovY;f.Camera.prototype.setFovY=f.Camera.prototype.setFovY;f.Camera.prototype.getAspect=f.Camera.prototype.getAspect;f.Camera.prototype.setAspect=f.Camera.prototype.setAspect;f.Camera.prototype.getProjectionMatrix=f.Camera.prototype.getProjectionMatrix;f.Camera.prototype.setProjectionMatrix=f.Camera.prototype.setProjectionMatrix;f.Camera.prototype.getViewMatrix=
f.Camera.prototype.getViewMatrix}f.FOG_NONE=f.FOG_NONE;f.FOG_LINEAR=f.FOG_LINEAR;f.FOG_QUADRATIC=f.FOG_QUADRATIC;if(f.Scene){f.Scene=f.Scene;f.Scene.prototype.className=f.Scene.prototype.className;f.Scene.prototype.getFogType=f.Scene.prototype.getFogType;f.Scene.prototype.setFogType=f.Scene.prototype.setFogType;f.Scene.prototype.getFogFar=f.Scene.prototype.getFogFar;f.Scene.prototype.setFogFar=f.Scene.prototype.setFogFar;f.Scene.prototype.getFogNear=f.Scene.prototype.getFogNear;f.Scene.prototype.setFogNear=
f.Scene.prototype.setFogNear;f.Scene.prototype.getFogColor=f.Scene.prototype.getFogColor;f.Scene.prototype.setFogColor=f.Scene.prototype.setFogColor;f.Scene.prototype.getBackgroundColor=f.Scene.prototype.getBackgroundColor;f.Scene.prototype.setBackgroundColor=f.Scene.prototype.setBackgroundColor;f.Scene.prototype.getAmbientColor=f.Scene.prototype.getAmbientColor;f.Scene.prototype.setAmbientColor=f.Scene.prototype.setAmbientColor;f.Scene.prototype.setAmbientColorR=f.Scene.prototype.setAmbientColorR;
f.Scene.prototype.setAmbientColorG=f.Scene.prototype.setAmbientColorG;f.Scene.prototype.setAmbientColorB=f.Scene.prototype.setAmbientColorB;f.Scene.prototype.setCamera=f.Scene.prototype.setCamera;f.Scene.prototype.getCamera=f.Scene.prototype.getCamera;f.Scene.prototype.render=f.Scene.prototype.render;f.Scene.prototype.ray=f.Scene.prototype.ray;f.Scene.prototype.pick=f.Scene.prototype.pick}if(f.Renderer){f.Renderer=f.Renderer;f.Renderer.prototype.getScene=f.Renderer.prototype.getScene;f.Renderer.prototype.setScene=
f.Renderer.prototype.setScene;f.Renderer.prototype.render=f.Renderer.prototype.render}if(f.Texture){f.Texture=f.Texture;f.Texture.prototype.className=f.Texture.prototype.className;f.Texture.prototype.getSrc=f.Texture.prototype.getSrc;f.Texture.prototype.setSrc=f.Texture.prototype.setSrc}if(f.MaterialLayer){f.MaterialLayer=f.MaterialLayer;f.MaterialLayer.prototype.className=f.MaterialLayer.prototype.className;f.MaterialLayer.prototype.getMatrix=f.MaterialLayer.prototype.getMatrix;f.MaterialLayer.prototype.setTexture=
f.MaterialLayer.prototype.setTexture;f.MaterialLayer.prototype.getTexture=f.MaterialLayer.prototype.getTexture;f.MaterialLayer.prototype.setMapto=f.MaterialLayer.prototype.setMapto;f.MaterialLayer.prototype.getMapto=f.MaterialLayer.prototype.getMapto;f.MaterialLayer.prototype.setMapinput=f.MaterialLayer.prototype.setMapinput;f.MaterialLayer.prototype.getMapinput=f.MaterialLayer.prototype.getMapinput;f.MaterialLayer.prototype.getOffset=f.MaterialLayer.prototype.getOffset;f.MaterialLayer.prototype.getRotation=
f.MaterialLayer.prototype.getRotation;f.MaterialLayer.prototype.getScale=f.MaterialLayer.prototype.getScale;f.MaterialLayer.prototype.setOffsetX=f.MaterialLayer.prototype.setOffsetX;f.MaterialLayer.prototype.getOffsetX=f.MaterialLayer.prototype.getOffsetX;f.MaterialLayer.prototype.setOffsetY=f.MaterialLayer.prototype.setOffsetY;f.MaterialLayer.prototype.getOffsetY=f.MaterialLayer.prototype.getOffsetY;f.MaterialLayer.prototype.setOffsetZ=f.MaterialLayer.prototype.setOffsetZ;f.MaterialLayer.prototype.getOffsetZ=
f.MaterialLayer.prototype.getOffsetZ;f.MaterialLayer.prototype.setDOffsetX=f.MaterialLayer.prototype.setDOffsetX;f.MaterialLayer.prototype.getDOffsetX=f.MaterialLayer.prototype.getDOffsetX;f.MaterialLayer.prototype.setDOffsetY=f.MaterialLayer.prototype.setDOffsetY;f.MaterialLayer.prototype.getDOffsetY=f.MaterialLayer.prototype.getDOffsetY;f.MaterialLayer.prototype.setDOffsetZ=f.MaterialLayer.prototype.setDOffsetZ;f.MaterialLayer.prototype.getDOffsetZ=f.MaterialLayer.prototype.getDOffsetZ;f.MaterialLayer.prototype.setScaleX=
f.MaterialLayer.prototype.setScaleX;f.MaterialLayer.prototype.getScaleX=f.MaterialLayer.prototype.getScaleX;f.MaterialLayer.prototype.setScaleY=f.MaterialLayer.prototype.setScaleY;f.MaterialLayer.prototype.getScaleY=f.MaterialLayer.prototype.getScaleY;f.MaterialLayer.prototype.setScaleZ=f.MaterialLayer.prototype.setScaleZ;f.MaterialLayer.prototype.getScaleZ=f.MaterialLayer.prototype.getScaleZ;f.MaterialLayer.prototype.setDScaleX=f.MaterialLayer.prototype.setDScaleX;f.MaterialLayer.prototype.getDScaleX=
f.MaterialLayer.prototype.getDScaleX;f.MaterialLayer.prototype.setDScaleY=f.MaterialLayer.prototype.setDScaleY;f.MaterialLayer.prototype.getDScaleY=f.MaterialLayer.prototype.getDScaleY;f.MaterialLayer.prototype.setDScaleZ=f.MaterialLayer.prototype.setDScaleZ;f.MaterialLayer.prototype.getDScaleZ=f.MaterialLayer.prototype.getDScaleZ;f.MaterialLayer.prototype.setRotX=f.MaterialLayer.prototype.setRotX;f.MaterialLayer.prototype.getRotX=f.MaterialLayer.prototype.getRotX;f.MaterialLayer.prototype.setRotY=
f.MaterialLayer.prototype.setRotY;f.MaterialLayer.prototype.getRotY=f.MaterialLayer.prototype.getRotY;f.MaterialLayer.prototype.setRotZ=f.MaterialLayer.prototype.setRotZ;f.MaterialLayer.prototype.getRotZ=f.MaterialLayer.prototype.getRotZ;f.MaterialLayer.prototype.setDRotX=f.MaterialLayer.prototype.setDRotX;f.MaterialLayer.prototype.getDRotX=f.MaterialLayer.prototype.getDRotX;f.MaterialLayer.prototype.setDRotY=f.MaterialLayer.prototype.setDRotY;f.MaterialLayer.prototype.getDRotY=f.MaterialLayer.prototype.getDRotY;
f.MaterialLayer.prototype.setDRotZ=f.MaterialLayer.prototype.setDRotZ;f.MaterialLayer.prototype.getDRotZ=f.MaterialLayer.prototype.getDRotZ;f.MaterialLayer.prototype.setBlendMode=f.MaterialLayer.prototype.setBlendMode;f.MaterialLayer.prototype.getBlendMode=f.MaterialLayer.prototype.getBlendMode}f.M_COLOR=f.M_COLOR;f.M_NOR=f.M_NOR;f.M_ALPHA=f.M_ALPHA;f.M_SPECCOLOR=f.M_SPECCOLOR;f.M_SPECULAR=f.M_SPECULAR;f.M_SHINE=f.M_SHINE;f.M_REFLECT=f.M_REFLECT;f.M_EMIT=f.M_EMIT;f.M_ALPHA=f.M_ALPHA;f.M_MSKR=f.M_MSKR;
f.M_MSKG=f.M_MSKG;f.M_MSKB=f.M_MSKB;f.M_MSKA=f.M_MSKA;f.M_HEIGHT=f.M_HEIGHT;f.UV1=f.UV1;f.UV2=f.UV2;f.MAP_NORM=f.MAP_NORM;f.MAP_OBJ=f.MAP_OBJ;f.BL_MIX=f.BL_MIX;f.BL_MUL=f.BL_MUL;if(f.Material){f.Material=f.Material;f.Material.prototype.className=f.Material.prototype.className;f.Material.prototype.setShadow=f.Material.prototype.setShadow;f.Material.prototype.getShadow=f.Material.prototype.getShadow;f.Material.prototype.setColor=f.Material.prototype.setColor;f.Material.prototype.setColorR=f.Material.prototype.setColorR;
f.Material.prototype.setColorG=f.Material.prototype.setColorG;f.Material.prototype.setColorB=f.Material.prototype.setColorB;f.Material.prototype.getColor=f.Material.prototype.getColor;f.Material.prototype.setSpecularColor=f.Material.prototype.setSpecularColor;f.Material.prototype.getSpecularColor=f.Material.prototype.getSpecularColor;f.Material.prototype.setAlpha=f.Material.prototype.setAlpha;f.Material.prototype.getAlpha=f.Material.prototype.getAlpha;f.Material.prototype.setSpecular=f.Material.prototype.setSpecular;
f.Material.prototype.getSpecular=f.Material.prototype.getSpecular;f.Material.prototype.setShininess=f.Material.prototype.setShininess;f.Material.prototype.getShininess=f.Material.prototype.getShininess;f.Material.prototype.setEmit=f.Material.prototype.setEmit;f.Material.prototype.getEmit=f.Material.prototype.getEmit;f.Material.prototype.setReflectivity=f.Material.prototype.setReflectivity;f.Material.prototype.getReflectivity=f.Material.prototype.getReflectivity;f.Material.prototype.addMaterialLayer=
f.Material.prototype.addMaterialLayer;f.Material.prototype.getLayers=f.Material.prototype.getLayers;f.Material.prototype.addTexture=f.Material.prototype.addTexture}}f.augment=function(e,g){for(proto in e.prototype)g.prototype[proto]=e.prototype[proto]};f.makeGlobal=function(){for(var e in f)window[e]=f[e]};f.New=function(e){return f[e].prototype.className!=""?new f[e]:false};f.TRUE=1;f.FALSE=0;f.DRAW_TRIS=1;f.DRAW_LINES=2;f.DRAW_LINELOOPS=3;f.DRAW_LINESTRIPS=4;f.DRAW_POINTS=5;f.RENDER_DEFAULT=0;f.RENDER_SHADOW=
1;f.RENDER_PICK=2;f.RENDER_NORMAL=3;f.RENDER_NULL=4;f.TEXT_BOXPICK=1;f.TEXT_TEXTPICK=1;f.P_EULER=1;f.P_QUAT=2;f.P_MATRIX=3;f.NONE=0;f.XAXIS=1;f.YAXIS=2;f.ZAXIS=3;f.POS_XAXIS=1;f.NEG_XAXIS=2;f.POS_YAXIS=3;f.NEG_YAXIS=4;f.POS_ZAXIS=5;f.NEG_ZAXIS=6;f.LINEAR_BLEND=function(e){return e};f.QUAD_BLEND=function(e){return e*e};f.SPECIAL_BLEND=function(e){e*=2-e;return e*e};f.error=function(e){alert(e)};f.Assets={};f.Assets.assets={};f.Assets.createUUID=function(){var e=["0","1","2","3","4","5","6","7","8",
"9","A","B","C","D","E","F"],g=["8","9","A","B"];uuid="";for(var l=0;l<38;l++)switch(l){case 8:uuid+="-";break;case 13:uuid+="-";break;case 18:uuid+="-";break;case 14:uuid+="4";break;case 19:uuid+=g[Math.round(Math.random()*3)];break;default:uuid+=e[Math.round(Math.random()*15)];break}return uuid};f.Assets.registerAsset=function(e,g){g||(g=f.Assets.createUUID());e.uid=g;f.Assets.assets[g]=e};f.Assets.unregisterAsset=function(e){delete f.Assets.assets[e]};f.Assets.get=function(e){return(e=f.Assets.assets[e])?
e:false};f.fastHash=function(e){var g=0,l=0,o=0,r=0,s=0,w=0,D=0,L=0,A=0,K=0,Y=0,aa=0,q=0,P=e.length;for(e+="000000";q<P;){D=e.charCodeAt(q++);L=e.charCodeAt(q++);A=e.charCodeAt(q++);K=e.charCodeAt(q++);Y=e.charCodeAt(q++);aa=e.charCodeAt(q++);g=(s+D+L)%255;l=(w+L+A)%255;o=(g+A+K)%255;r=(l+K+Y)%255;s=(o+Y+aa)%255;w=(r+aa+D)%255}return[String.fromCharCode(g),String.fromCharCode(l),String.fromCharCode(o),String.fromCharCode(r),String.fromCharCode(s),String.fromCharCode(w)].join("")};f.getGLShader=function(e,
g,l){var o=f.fastHash(l);if(!e.shaderCache)e.shaderCache={};if(!e.shaderCache[o]){g=e.createShader(g);e.shaderSource(g,l);e.compileShader(g);if(!e.getShaderParameter(g,e.COMPILE_STATUS)){alert(e.getShaderInfoLog(g));return}e.shaderCache[o]=g}return e.shaderCache[o]};f.getGLProgram=function(e,g,l){if(!e.programCache)e.programCache=[];for(var o=e.programCache,r=0;r<o.length;r++)if(o[r].fShader==l&&o[r].vShader==g)return o[r].program;var s=e.createProgram();e.attachShader(s,g);e.attachShader(s,l);e.linkProgram(s);
o.push({vShader:g,fShader:l,program:s});if(!s.uniformDetails){s.uniformDetails={};g=e.getProgramParameter(s,e.ACTIVE_UNIFORMS);for(r=0;r<g;++r){l=e.getActiveUniform(s,r);s.uniformDetails[l.name]={loc:f.getUniformLocation(e,s,l.name),info:l}}}return s};f.getUniformLocation=function(e,g,l){if(!g.uniformCache)g.uniformCache={};if(!g.uniformChecked)g.uniformChecked={};if(!g.uniformChecked[l]){g.uniformCache[l]=e.getUniformLocation(g,l);g.uniformChecked[l]=true}return g.uniformCache[l]};f.getAttribLocation=
function(e,g,l){if(!g.attribCache)g.attribCache={};g.attribCache[l]||(g.attribCache[l]=e.getAttribLocation(g,l));return g.attribCache[l]};f.QuickNotation=function(){};f.QuickNotation.prototype._=function(){for(var e,g=0;g<arguments.length;g++){e=arguments[g];if(typeof e=="object")if(e.className&&this["add"+e.className])this["add"+e.className](e);else for(var l in e)this["set"+l]&&this["set"+l](e[l])}return this};f.Message={};f.Message.parseMessage=function(e){switch(e.command){case "create":var g=
new f[e.type](e.uid);this.setAttributes(g,e.attributes);e.children&&f.Message.addChildren(g,e.children);return g;case "update":g=f.Assets.get(e.uid);this.setAttributes(g,e.attributes);e.add&&f.Message.addChildren(g,e.add);e.remove&&f.Message.removeChildren(g,e.remove);return g}return null};f.Message.setAttributes=function(e,g){if(g)for(var l in g)if(e["set"+l]){if(g[l].command)g[l]=f.Message.parseMessage(g[l]);e["set"+l](g[l])}return this};f.Message.addChildren=function(e,g){g instanceof Array||(g=
[g]);for(var l=0;l<g.length;l++){var o=g[l].command?f.Message.parseMessage(g[l]):f.Assets.get(g[l]);e["add"+o.className](o)}};f.Message.removeChildren=function(e,g){g instanceof Array||(g=[g]);for(var l=0;l<g.length;l++){var o=f.Assets.get(g[l]);e["add"+o.className](o)}};f.Message.toLoad=[];f.Message.messageLoader=function(e,g,l){f.Message.toLoad.push([e,g,l]);f.Message.toLoad.length==1&&f.Message.loadMessages()};f.Message.loadMessages=function(){var e=f.Message.toLoad.pop(),g=new XMLHttpRequest;
g.onreadystatechange=function(){if(this.readyState==4)this.status==200||this.status==0?e[1](this.responseText):f.error("Error loading Document: "+e[0]+" status "+this.status)};g.open("GET",e[0],true);g.send("");f.Message.toLoad.length>0&&f.Message.loadMessages()};f.colorParse=function(e){var g,l,o,r,s={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",
burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",
deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",
lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",
mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",
royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};if(s[e])e="#"+s[e];if(e.substr&&e.substr(0,1)==
"#"){e=e.substr(1);if(e.length==8){g=parseInt("0x"+e.substr(0,2))/255;l=parseInt("0x"+e.substr(2,2))/255;o=parseInt("0x"+e.substr(4,2))/255;r=parseInt("0x"+e.substr(6,2))/255}else if(e.length==4){g=parseInt("0x"+e.substr(0,1))/15;l=parseInt("0x"+e.substr(1,1))/15;o=parseInt("0x"+e.substr(2,1))/15;r=parseInt("0x"+e.substr(3,1))/15}else if(e.length==6){g=parseInt("0x"+e.substr(0,2))/255;l=parseInt("0x"+e.substr(2,2))/255;o=parseInt("0x"+e.substr(4,2))/255;r=1}else if(e.length==3){g=parseInt("0x"+e.substr(0,
1))/15;l=parseInt("0x"+e.substr(1,1))/15;o=parseInt("0x"+e.substr(2,1))/15;r=1}}else if(e.substr&&e.substr(0,4)=="rgb("){e=e.substr(4).split(",");g=parseInt(e[0])/255;l=parseInt(e[1])/255;o=parseInt(e[2])/255;r=1}else if(e.substr&&e.substr(0,5)=="rgba("){e=e.substr(4).split(",");g=parseInt(e[0])/255;l=parseInt(e[1])/255;o=parseInt(e[2])/255;r=parseInt(e[3])/255}else r=o=l=g=0;return{r:g,g:l,b:o,a:r}};f.JSONLoader=function(){};f.JSONLoader.prototype.downloadPriority=0;f.JSONLoader.prototype.setJSONSrc=
function(e){var g=this;f.Message.messageLoader(e,function(l){g.setJSONString(l)},this.downloadPriority)};f.JSONLoader.prototype.setJSONString=function(e){e=JSON.parse(e);if(e.type==this.className){e.uid=this.uid;e.command="update";f.Message.parseMessage(e)}};f.JSONLoader.prototype.setDownloadPriority=function(e){this.downloadPriority=e};f.JSONLoader.prototype.getDownloadPriority=function(){return this.downloadPriority};f.Events=function(){};f.Events.prototype.fireEvent=function(e,g){if(this.events&&
this.events[e]){e=this.events[e];for(var l=0;l<e.length;l++)e[l].call(this,g)}};f.Events.prototype.addEventListener=function(e,g){if(!this.events)this.events={};this.events[e]||(this.events[e]=[]);this.events[e].push(g)};f.Events.prototype.removeEventListener=function(e,g){g=this.events[e].indexOf(g);g!=-1&&this.events[e].splice(g,1)};f.Document=function(){this.listeners=[];this.documents=[]};f.Document.prototype.listeners=null;f.Document.prototype.documents=null;f.Document.prototype.rootURL=null;
f.Document.prototype.loadCount=0;f.Document.prototype.getElementById=function(e){for(var g=this.getElementsByTagName("*"),l=0;l<g.length;l++)if(g[l].getAttribute("id")==e)return g[l];return null};f.Document.prototype.getAbsolutePath=function(e,g){if(e.substr(0,7)=="http://"||e.substr(0,7)=="file://"||e.substr(0,7)=="https://")return e;else{if(!g)g=window.location.href;var l=g.split("/");g=l[2];for(var o=l[0],r=[],s=3;s<l.length-1;s++)r.push(l[s]);if(e.substr(0,1)=="/")r=[];e=e.split("/");for(s=0;s<
e.length;s++)if(e[s]=="..")r.pop();else e[s]!=""&&r.push(e[s]);return o+"//"+g+"/"+r.join("/")}};f.Document.prototype.load=function(e){this.documents=[];this.rootURL=e;this.loadDocument(e,null)};f.Document.prototype.loadDocument=function(e,g){this.loadCount++;e=this.getAbsolutePath(e,g);if(g=new XMLHttpRequest){g.docurl=e;g.docObj=this;g.overrideMimeType("text/xml");g.onreadystatechange=function(){if(this.readyState==4)if(this.status==200||this.status==0){this.responseXML.getElementById=this.docObj.getElementById;
this.docObj.loaded(this.docurl,this.responseXML)}else f.error("Error loading Document: "+this.docurl+" status "+this.status)};g.open("GET",e,true);g.send("")}};f.Document.prototype.loaded=function(e,g){this.loadCount--;this.documents[e]={xml:g};g=g.getElementsByTagName("import");for(var l=0;l<g.length;l++)if(!this.documents[this.getAbsolutePath(g[l].getAttribute("url"),e)]){this.documents[this.getAbsolutePath(g[l].getAttribute("url"),e)]={};this.loadDocument(g[l].getAttribute("url"),e)}this.loadCount==
0&&this.finishedLoading()};f.Document.prototype.finishedLoading=function(){for(var e=0;e<this.listeners.length;e++)this.listeners[e](this.listeners.rootURL);this.onLoad()};f.Document.prototype.onLoad=function(){};f.Document.prototype.classString=function(e){if(!e)return false;e=e.split("_");for(var g="",l=0;l<e.length;l++)g=g+e[l][0].toUpperCase()+e[l].substr(1);return g};f.Document.prototype.setProperties=function(e){for(var g,l,o=0;o<e.attributes.length;o++){l=false;g="set"+this.classString(e.attributes[o].nodeName);
if(e.attributes[o].value[0]=="#")l=this.getElement(e.attributes[o].value.substr(1),true);l||(l=typeof f[e.attributes[o].value]!="undefined"?f[e.attributes[o].value]:e.attributes[o].value);e.object[g]&&e.object[g](l);if(e.attributes[o].nodeName=="uid"){f.Assets.unregisterAsset(e.object.uid);e.object.uid=e.attributes[o].value;f.Assets.registerAsset(e.object,e.attributes[o].value)}}};f.Document.prototype.addChildren=function(e){for(var g,l=e.firstChild;l;){g="add"+this.classString(l.tagName);e.object[g]&&
e.object[g](this.getElement(l));l=l.nextSibling}};f.Document.prototype.getElement=function(e,g){var l,o;if(typeof e=="string")for(o in this.documents)if(this.documents[o].xml)if(l=this.documents[o].xml.getElementById(e)){e=l;break}if(typeof e=="string"){g||f.error("Element "+e+" not found in document");return false}else return this["get"+this.classString(e.tagName)]?this["get"+this.classString(e.tagName)](e):this.getDefault(e)};f.Document.prototype.getDefault=function(e){if(!e.object)if(f[this.classString(e.tagName)]){e.object=
new (f[this.classString(e.tagName)]);this.setProperties(e);this.addChildren(e)}else f.error("XML Parse Error: GLGE Object not found");return e.object};f.Document.prototype.getTexture=function(e){if(!e.object){var g=this.getAbsolutePath(this.rootURL,null);e.object=new (f[this.classString(e.tagName)]);e.object.setSrc(this.getAbsolutePath(e.getAttribute("src"),g));e.removeAttribute("src");this.setProperties(e)}return e.object};f.Document.prototype.getTextureVideo=f.Document.prototype.getTexture;f.Document.prototype.parseArray=
function(e){e=e.firstChild;for(var g="",l=[],o,r;e;){o=(g+e.nodeValue).split(",");e=e.nextSibling;o[0]==""&&o.unshift();if(e)g=o.pop();for(r=0;r<o.length;r++)l.push(o[r])}return l};f.Document.prototype.getMesh=function(e){if(!e.object){e.object=new f.Mesh;this.setProperties(e);for(var g=e.firstChild;g;){switch(g.tagName){case "positions":e.object.setPositions(this.parseArray(g));break;case "normals":e.object.setNormals(this.parseArray(g));break;case "uv1":e.object.setUV(this.parseArray(g));break;
case "uv2":e.object.setUV2(this.parseArray(g));break;case "faces":e.object.setFaces(this.parseArray(g));break;case "joint_names":for(var l=this.parseArray(g),o=[],r=0;r<l.length;r++)l[r].substr(0,1)=="#"?o.push(this.getElement(l[r].substr(1))):o.push(l[r]);e.object.setJoints(o);break;case "bind_matrix":l=this.parseArray(g);o=[];for(r=0;r<l.length;r++)o.push(f.Mat4(l[r].split(" ")));e.object.setInvBindMatrix(o);break;case "joints":e.object.setVertexJoints(this.parseArray(g),g.getAttribute("count"));
break;case "weights":e.object.setVertexWeights(this.parseArray(g),g.getAttribute("count"));break}g=g.nextSibling}}return e.object};f.Document.prototype.addLoadListener=function(e){this.listeners.append(e)};f.Document.prototype.removeLoadListener=function(e){for(var g=0;g<this.listeners.length;g++)this.listeners[g]===e&&this.listeners.splice(g,1)};f.Document.prototype.parseScript=function(e){this.rootURL=window.location.toString();var g=document.getElementById(e);if(!g)return null;var l="";for(g=g.firstChild;g;){if(g.nodeType==
3)l+=g.textContent;g=g.nextSibling}l=(new DOMParser).parseFromString(l,"text/xml");l.getElementById=this.getElementById;this.documents["#"+e]={xml:l};e=l.getElementsByTagName("import");for(l=0;l<e.length;l++)if(!this.documents[this.getAbsolutePath(e[l].getAttribute("url"),url)]){this.documents[this.getAbsolutePath(e[l].getAttribute("url"),url)]={};this.loadDocument(e[l].getAttribute("url"))}this.loadCount==0&&this.finishedLoading()};f.Placeable=function(){};f.Placeable.prototype.locX=0;f.Placeable.prototype.locY=
0;f.Placeable.prototype.locZ=0;f.Placeable.prototype.dLocX=0;f.Placeable.prototype.dLocY=0;f.Placeable.prototype.dLocZ=0;f.Placeable.prototype.quatX=0;f.Placeable.prototype.quatY=0;f.Placeable.prototype.quatZ=0;f.Placeable.prototype.quatW=0;f.Placeable.prototype.rotX=0;f.Placeable.prototype.rotY=0;f.Placeable.prototype.rotZ=0;f.Placeable.prototype.dRotX=0;f.Placeable.prototype.dRotY=0;f.Placeable.prototype.dRotZ=0;f.Placeable.prototype.scaleX=1;f.Placeable.prototype.scaleY=1;f.Placeable.prototype.scaleZ=
1;f.Placeable.prototype.dScaleX=0;f.Placeable.prototype.dScaleY=0;f.Placeable.prototype.dScaleZ=0;f.Placeable.prototype.matrix=null;f.Placeable.prototype.rotOrder=f.ROT_XYZ;f.Placeable.prototype.lookAt=null;f.Placeable.prototype.mode=f.P_EULER;f.Placeable.prototype.getRoot=function(){if(this.type==f.G_ROOT)return this;else if(this.parent){var e=this.parent.getRoot();return e?e:this}else return this};f.Placeable.prototype.getRef=function(){return this.id?this.id:this.parent?this.parent.getRef():null};
f.Placeable.prototype.setId=function(e){this.id=e;return this};f.Placeable.prototype.getId=function(){return this.id};f.Placeable.prototype.getLookat=function(){return this.lookAt};f.Placeable.prototype.setLookat=function(e){this.lookAt=e;return this};f.Placeable.prototype.Lookat=function(e){var g=this.getPosition();e=e.getPosition?e.getPosition():{x:e[0],y:e[1],z:e[2]};g=f.toUnitVec3([g.x-e.x,g.y-e.y,g.z-e.z]);e=f.toUnitVec3(f.crossVec3([0,0,1],g));var l=f.toUnitVec3(f.crossVec3(g,e));this.setRotMatrix(f.Mat4([e[0],
l[0],g[0],0,e[1],l[1],g[1],0,e[2],l[2],g[2],0,0,0,0,1]))};f.Placeable.prototype.getRotOrder=function(){return this.rotOrder};f.Placeable.prototype.setRotOrder=function(e){this.rotOrder=e;this.rotmatrix=this.matrix=null;return this};f.Placeable.prototype.getRotMatrix=function(){if(!this.rotmatrix){var e=this.getRotation();if(this.mode==f.P_EULER)this.rotmatrix=f.rotateMatrix(e.x,e.y,e.z,this.rotOrder);if(this.mode==f.P_QUAT)this.rotmatrix=f.quatRotation(e.x,e.y,e.z,e.w)}return this.rotmatrix};f.Placeable.prototype.setRotMatrix=
function(e){this.mode=f.P_MATRIX;this.rotmatrix=e;this.updateMatrix();return this};f.Placeable.prototype.setLocX=function(e){this.locX=e;this.updateMatrix();return this};f.Placeable.prototype.setLocY=function(e){this.locY=e;this.updateMatrix();return this};f.Placeable.prototype.setLocZ=function(e){this.locZ=e;this.updateMatrix();return this};f.Placeable.prototype.setLoc=function(e,g,l){this.locX=e;this.locY=g;this.locZ=l;this.updateMatrix();return this};f.Placeable.prototype.setDLocX=function(e){this.dLocX=
e;this.updateMatrix();return this};f.Placeable.prototype.setDLocY=function(e){this.dLocY=e;this.updateMatrix();return this};f.Placeable.prototype.setDLocZ=function(e){this.dLocZ=e;this.updateMatrix();return this};f.Placeable.prototype.setDLoc=function(e,g,l){this.dLocX=e;this.dLocY=g;this.dLocZ=l;this.updateMatrix();return this};f.Placeable.prototype.setQuatX=function(e){this.mode=f.P_QUAT;this.quatX=parseFloat(e);this.updateMatrix();this.rotmatrix=null;return this};f.Placeable.prototype.setQuatY=
function(e){this.mode=f.P_QUAT;this.quatY=parseFloat(e);this.updateMatrix();this.rotmatrix=null;return this};f.Placeable.prototype.setQuatZ=function(e){this.mode=f.P_QUAT;this.quatZ=parseFloat(e);this.updateMatrix();this.rotmatrix=null;return this};f.Placeable.prototype.setQuatW=function(e){this.mode=f.P_QUAT;this.quatW=parseFloat(e);this.updateMatrix();this.rotmatrix=null;return this};f.Placeable.prototype.setQuat=function(e,g,l,o){this.mode=f.P_QUAT;this.quatX=e;this.quatY=g;this.quatZ=l;this.quatW=
o;this.updateMatrix();this.rotmatrix=null;return this};f.Placeable.prototype.setRotX=function(e){this.mode=f.P_EULER;this.rotX=e;this.updateMatrix();this.rotmatrix=null;return this};f.Placeable.prototype.setRotY=function(e){this.mode=f.P_EULER;this.rotY=e;this.updateMatrix();this.rotmatrix=null;return this};f.Placeable.prototype.setRotZ=function(e){this.mode=f.P_EULER;this.rotZ=e;this.updateMatrix();this.rotmatrix=null;return this};f.Placeable.prototype.setRot=function(e,g,l){this.mode=f.P_EULER;
this.rotX=e;this.rotY=g;this.rotZ=l;this.updateMatrix();this.rotmatrix=null;return this};f.Placeable.prototype.setDRotX=function(e){this.mode=f.P_EULER;this.dRotX=e;this.updateMatrix();this.rotmatrix=null;return this};f.Placeable.prototype.setDRotY=function(e){this.mode=f.P_EULER;this.dRotY=e;this.updateMatrix();this.rotmatrix=null;return this};f.Placeable.prototype.setDRotZ=function(e){this.mode=f.P_EULER;this.dRotZ=e;this.updateMatrix();this.rotmatrix=null;return this};f.Placeable.prototype.setDRot=
function(e,g,l){this.mode=f.P_EULER;this.dRotX=e;this.dRotY=g;this.dRotZ=l;this.updateMatrix();this.rotmatrix=null;return this};f.Placeable.prototype.setScaleX=function(e){this.scaleX=e;this.updateMatrix();return this};f.Placeable.prototype.setScaleY=function(e){this.scaleY=e;this.updateMatrix();return this};f.Placeable.prototype.setScaleZ=function(e){this.scaleZ=e;this.updateMatrix();return this};f.Placeable.prototype.setScale=function(e,g,l){if(!g)l=g=e;this.scaleX=e;this.scaleY=g;this.scaleZ=l;
this.updateMatrix();return this};f.Placeable.prototype.setDScaleX=function(e){this.dScaleX=e;this.updateMatrix();return this};f.Placeable.prototype.setDScaleY=function(e){this.dScaleY=e;this.updateMatrix();return this};f.Placeable.prototype.setDScaleZ=function(e){this.dScaleZ=e;this.updateMatrix();return this};f.Placeable.prototype.setDScale=function(e,g,l){this.dScaleX=e;this.dScaleY=g;this.dScaleZ=l;this.updateMatrix();return this};f.Placeable.prototype.getLocX=function(){return this.locX};f.Placeable.prototype.getLocY=
function(){return this.locY};f.Placeable.prototype.getLocZ=function(){return this.locZ};f.Placeable.prototype.getDLocX=function(){return this.dLocX};f.Placeable.prototype.getDLocY=function(){return this.dLocY};f.Placeable.prototype.getDLocZ=function(){return this.dLocZ};f.Placeable.prototype.getQuatX=function(){return this.quatX};f.Placeable.prototype.getQuatY=function(){return this.quatY};f.Placeable.prototype.getQuatZ=function(){return this.quatZ};f.Placeable.prototype.getQuatW=function(){return this.quatW};
f.Placeable.prototype.getRotX=function(){return this.rotX};f.Placeable.prototype.getRotY=function(){return this.rotY};f.Placeable.prototype.getRotZ=function(){return this.rotZ};f.Placeable.prototype.getDRotX=function(){return this.dRotX};f.Placeable.prototype.getDRotY=function(){return this.dRotY};f.Placeable.prototype.getDRotZ=function(){return this.dRotZ};f.Placeable.prototype.getScaleX=function(){return this.scaleX};f.Placeable.prototype.getScaleY=function(){return this.scaleY};f.Placeable.prototype.getScaleZ=
function(){return this.scaleZ};f.Placeable.prototype.getDScaleX=function(){return this.dScaleX};f.Placeable.prototype.getDScaleY=function(){return this.dScaleY};f.Placeable.prototype.getDScaleZ=function(){return this.dScaleZ};f.Placeable.prototype.getPosition=function(){var e={};e.x=parseFloat(this.locX)+parseFloat(this.dLocX);e.y=parseFloat(this.locY)+parseFloat(this.dLocY);e.z=parseFloat(this.locZ)+parseFloat(this.dLocZ);return e};f.Placeable.prototype.getRotation=function(){var e={};if(this.mode==
f.P_EULER){e.x=parseFloat(this.rotX)+parseFloat(this.dRotX);e.y=parseFloat(this.rotY)+parseFloat(this.dRotY);e.z=parseFloat(this.rotZ)+parseFloat(this.dRotZ)}if(this.mode==f.P_QUAT){e.x=parseFloat(this.quatX);e.y=parseFloat(this.quatY);e.z=parseFloat(this.quatZ);e.w=parseFloat(this.quatW)}return e};f.Placeable.prototype.getScale=function(){var e={};e.x=parseFloat(this.scaleX)+parseFloat(this.dScaleX);e.y=parseFloat(this.scaleY)+parseFloat(this.dScaleY);e.z=parseFloat(this.scaleZ)+parseFloat(this.dScaleZ);
return e};f.Placeable.prototype.updateMatrix=function(){this.matrix=null;if(this.children)for(var e=0;e<this.children.length;e++)this.children[e].updateMatrix()};f.Placeable.prototype.getModelMatrix=function(){if(!this.matrix){this.transinvmatrix=this.transmatrix=this.invmatrix=null;var e=this.getPosition(),g=this.getScale();e=f.mulMat4(f.translateMatrix(e.x,e.y,e.z),f.mulMat4(this.getRotMatrix(),f.scaleMatrix(g.x,g.y,g.z)));if(this.parent)e=f.mulMat4(this.parent.getModelMatrix(),e);this.matrix=e}return this.matrix};
f.Placeable.prototype.getInverseModelMatrix=function(){this.matrix||this.getModelMatrix();if(!this.invmatrix)this.invmatrix=f.transposeMat4(this.matrix);return this.invmatrix};f.Placeable.prototype.getTransposeModelMatrix=function(){this.matrix||this.getModelMatrix();if(!this.transmatrix)this.transmatrix=f.transposeMat4(this.matrix);return this.transmatrix};f.Placeable.prototype.getTransposeInverseModelMatrix=function(){this.matrix||this.getModelMatrix();if(!this.transinvmatrix)this.invtransmatrix=
f.transposeMat4(this.getInverseModelMatrix());return this.transinvmatrix};f.Animatable=function(){};f.augment(f.Events,f.Animatable);f.Animatable.prototype.animationStart=null;f.Animatable.prototype.animation=null;f.Animatable.prototype.blendStart=0;f.Animatable.prototype.blendTime=0;f.Animatable.prototype.lastFrame=null;f.Animatable.prototype.frameRate=25;f.Animatable.prototype.loop=f.TRUE;f.Animatable.prototype.paused=f.FALSE;f.Animatable.prototype.pausedTime=null;f.Animatable.prototype.blendFunction=
f.LINEAR_BLEND;f.Animatable.prototype.blendTo=function(e,g,l){if(!l)l=f.LINEAR_BLEND;var o=new f.AnimationVector,r,s;for(prop in e){r=new f.AnimationCurve;r.setChannel(prop);s=new f.LinearPoint;s.setX(1);s.setY(e[prop]);r.addPoint(s);o.addAnimationCurve(r)}this.setBlendFunction(l);this.setAnimation(o,g);return this};f.Animatable.prototype.setBlendFunction=function(e){this.blendFunction=e;return this};f.Animatable.prototype.getBlendFunction=function(){return this.blendFunction};f.Animatable.prototype.setName=
function(e){this.name=e;return this};f.Animatable.prototype.getName=function(){return this.name};f.Animatable.prototype.getFrameNumber=function(e){e||(e=parseInt((new Date).getTime()));if(this.animation.frames>1)if(this.loop)e=(parseFloat(e)-parseFloat(this.animationStart))/1E3*this.frameRate%(this.animation.frames-1)+1;else{e=(parseFloat(e)-parseFloat(this.animationStart))/1E3*this.frameRate+1;if(e>=this.animation.frames)e=this.animation.frames}else e=1;return Math.round(e)};f.Animatable.prototype.getInitialValues=
function(e,g){var l={};if(this.animation){this.lastFrame=null;this.animate(g,true)}for(var o in e.curves)if(this["get"+o])l[o]=this["get"+o]();return l};f.Animatable.prototype.animate=function(e,g){if(!this.paused&&this.animation){e||(e=parseInt((new Date).getTime()));var l=this.getFrameNumber(e);if(!this.animation.animationCache)this.animation.animationCache={};if(l!=this.lastFrame||this.blendTime!=0){this.lastFrame=l;if(this.blendTime==0)if(!this.animation.animationCache[l]||g){this.animation.animationCache[l]=
[];for(property in this.animation.curves)if(this["set"+property]){var o=this.animation.curves[property].getValue(parseFloat(l));switch(property){case "QuatX":case "QuatY":case "QuatZ":case "QuatW":case "RotX":case "RotY":case "RotZ":var r=true;break;default:this.animation.animationCache[l].push({property:property,value:o});break}this["set"+property](o)}if(r){o=this.getRotMatrix();this.animation.animationCache[l].push({property:"RotMatrix",value:o})}}else{o=this.animation.animationCache[l];for(r=0;r<
o.length;r++)this["set"+o[r].property]&&this["set"+o[r].property](o[r].value)}else{o=e-this.animationStart;if(o<this.blendTime){r=o/this.blendTime;r=this.blendFunction(r);for(property in this.animation.curves)if(this["set"+property]){o=this.animation.curves[property].getValue(parseFloat(l));o=o*r+this.blendInitValues[property]*(1-r);this["set"+property](o)}}else this.blendTime=0}}}if(this.children)for(r=0;r<this.children.length;r++)this.children[r].animate&&this.children[r].animate(e,g);if(this.animation&&
!this.animFinished&&this.blendTime==0&&this.animation.frames==l&&!g){this.animFinished=true;this.fireEvent("animFinished",{})}};f.Animatable.prototype.setAnimation=function(e,g,l){if(l==null)l=parseInt((new Date).getTime());g||(g=0);if(g>0){this.blendInitValues=this.getInitialValues(e,l);this.blendTime=g}this.animationStart=l;this.lastFrame=null;this.animation=e;this.animFinished=false;return this};f.Animatable.prototype.getAnimation=function(){return this.animation};f.Animatable.prototype.setFrameRate=
function(e){this.frameRate=e;return this};f.Animatable.prototype.getFrameRate=function(){return this.frameRate};f.Animatable.prototype.setLoop=function(e){this.loop=e;return this};f.Animatable.prototype.getLoop=function(){return this.loop};f.Animatable.prototype.isLooping=f.Animatable.prototype.getLoop;f.Animatable.prototype.setPaused=function(e){if(e)this.pauseTime=parseInt((new Date).getTime());else this.animationStart+=parseInt((new Date).getTime())-this.pauseTime;this.paused=e;return this};f.Animatable.prototype.getPaused=
function(){return this.paused};f.Animatable.prototype.togglePaused=function(){this.setPaused(!this.getPaused());return this.paused};v();f.BezTriple=function(e){f.Assets.registerAsset(this,e)};f.augment(f.QuickNotation,f.BezTriple);f.augment(f.JSONLoader,f.BezTriple);f.BezTriple.prototype.className="BezTriple";f.BezTriple.prototype.setX1=function(e){this.x1=parseFloat(e);return this};f.BezTriple.prototype.setY1=function(e){this.y1=parseFloat(e);return this};f.BezTriple.prototype.setX2=function(e){this.x=
parseFloat(e);return this};f.BezTriple.prototype.setY2=function(e){this.y=parseFloat(e);return this};f.BezTriple.prototype.setX3=function(e){this.x3=parseFloat(e);return this};f.BezTriple.prototype.setY3=function(e){this.y3=parseFloat(e);return this};f.LinearPoint=function(e){f.Assets.registerAsset(this,e)};f.augment(f.QuickNotation,f.LinearPoint);f.augment(f.JSONLoader,f.LinearPoint);f.LinearPoint.prototype.className="LinearPoint";f.LinearPoint.prototype.setX=function(e){this.x=parseFloat(e);return this};
f.LinearPoint.prototype.setY=function(e){this.y=parseFloat(e);return this};f.StepPoint=function(e,g){this.x=parseFloat(e);this.y=g};f.AnimationCurve=function(e){f.Assets.registerAsset(this,e);this.keyFrames=[];this.solutions={}};f.augment(f.QuickNotation,f.AnimationCurve);f.augment(f.JSONLoader,f.AnimationCurve);f.AnimationCurve.prototype.className="AnimationCurve";f.AnimationCurve.prototype.keyFrames=null;f.AnimationCurve.prototype.addPoint=function(e){this.keyFrames.push(e);return this.keyFrames.length-
1};f.AnimationCurve.prototype.addStepPoint=f.AnimationCurve.prototype.addPoint;f.AnimationCurve.prototype.addLinearPoint=f.AnimationCurve.prototype.addPoint;f.AnimationCurve.prototype.addBezTriple=f.AnimationCurve.prototype.addPoint;f.AnimationCurve.prototype.coord=function(e,g){return{x:e,y:g}};f.AnimationCurve.prototype.setChannel=function(e){this.channel=e};f.AnimationCurve.prototype.getValue=function(e){var g,l,o,r;if(e<this.keyFrames[0].x)return this.keyFrames[0].y;for(var s=0;s<this.keyFrames.length;s++){if(this.keyFrames[s].x==
e)return this.keyFrames[s].y;if(this.keyFrames[s].x<=e&&(g==undefined||this.keyFrames[s].x>this.keyFrames[g].x)){o=g;g=s}else if(this.keyFrames[s].x<=e&&(o==undefined||this.keyFrames[s].x>this.keyFrames[o].x))o=s;if(this.keyFrames[s].x>e&&(l==undefined||this.keyFrames[s].x<=this.keyFrames[l].x)){r=l;l=s}else if(this.keyFrames[s].x>e&&(r==undefined||this.keyFrames[s].x<=this.keyFrames[r].x))r=s}if(g==undefined){g=l;l=r}if(l==undefined){l=g;g=o}if(this.keyFrames[g]instanceof f.BezTriple&&this.keyFrames[l]instanceof
f.BezTriple){o=this.coord(this.keyFrames[g].x,this.keyFrames[g].y);r=this.coord(this.keyFrames[g].x3,this.keyFrames[g].y3);g=this.coord(this.keyFrames[l].x1,this.keyFrames[l].y1);l=this.coord(this.keyFrames[l].x,this.keyFrames[l].y);return this.atX(e,o,r,g,l).y}if(this.keyFrames[g]instanceof f.LinearPoint&&this.keyFrames[l]instanceof f.BezTriple){o=this.coord(this.keyFrames[g].x,this.keyFrames[g].y);r=this.coord(this.keyFrames[l].x1,this.keyFrames[l].y1);g=this.coord(this.keyFrames[l].x1,this.keyFrames[l].y1);
l=this.coord(this.keyFrames[l].x,this.keyFrames[l].y);return this.atX(e,o,r,g,l).y}if(this.keyFrames[g]instanceof f.BezTriple&&this.keyFrames[l]instanceof f.LinearPoint){o=this.coord(this.keyFrames[g].x,this.keyFrames[g].y);r=this.coord(this.keyFrames[g].x3,this.keyFrames[g].y3);g=this.coord(this.keyFrames[g].x3,this.keyFrames[g].y3);l=this.coord(this.keyFrames[l].x,this.keyFrames[l].y);return this.atX(e,o,r,g,l).y}if(this.keyFrames[g]instanceof f.LinearPoint&&this.keyFrames[l]instanceof f.LinearPoint)return(e-
this.keyFrames[g].x)*(this.keyFrames[l].y-this.keyFrames[g].y)/(this.keyFrames[l].x-this.keyFrames[g].x)+this.keyFrames[g].y;if(this.keyFrames[g]instanceof f.StepPoint)return this.keyFrames[g].y;if(!this.keyFrames.preStartKey)this.keyFrames.preStartKey=this.keyFrames[0].y;return this.keyFrames.preStartKey};f.AnimationCurve.prototype.B1=function(e){return e*e*e};f.AnimationCurve.prototype.B2=function(e){return 3*e*e*(1-e)};f.AnimationCurve.prototype.B3=function(e){return 3*e*(1-e)*(1-e)};f.AnimationCurve.prototype.B4=
function(e){return(1-e)*(1-e)*(1-e)};f.AnimationCurve.prototype.getBezier=function(e,g,l,o,r){var s={};s.x=g.x*this.B1(e)+l.x*this.B2(e)+o.x*this.B3(e)+r.x*this.B4(e);s.y=g.y*this.B1(e)+l.y*this.B2(e)+o.y*this.B3(e)+r.y*this.B4(e);return s};f.AnimationCurve.prototype.Quad3Solve=function(e,g,l,o){ref=e+"-"+g+"--"+l+"-"+o;if(this.solutions[ref])return this.solutions[ref];else{g/=e;l/=e;o/=e;e=(3*l-g*g)/9;l=-(27*o)+g*(9*l-2*g*g);l/=54;g=g/3;discrim=e*e*e+l*l;result=[];if(discrim>0){e=l+Math.sqrt(discrim);
e=e<0?-Math.pow(-e,1/3):Math.pow(e,1/3);l=l-Math.sqrt(discrim);l=l<0?-Math.pow(-l,1/3):Math.pow(l,1/3);result[0]=-g+e+l;g+=(e+l)/2;result[1]=result[2]=-g}else if(discrim==0){e=l<0?-Math.pow(-l,1/3):Math.pow(l,1/3);result[1]=-g+2*e;result[1]=result[2]=-(e+g)}else{e=-e;l=Math.acos(l/Math.sqrt(1));e=2*Math.sqrt(e);result[0]=-g+e*Math.cos(l/3);result[1]=-g+e*Math.cos((l+2*Math.PI)/3);result[2]=-g+e*Math.cos((l+4*Math.PI)/3)}e=false;if(result[0]>=0&&result[0]<=1)e=result[0];if(!e&&result[1]>=0&&result[1]<=
1)e=result[1];if(!e&&result[2]>=0&&result[2]<=1)e=result[2];return this.solutions[ref]=e}};f.AnimationCurve.prototype.atX=function(e,g,l,o,r){a=g.x-l.x*3+o.x*3-r.x;b=l.x*3-o.x*6+r.x*3;c=o.x*3-r.x*3;d=r.x-e;return this.getBezier(this.Quad3Solve(a,b,c,d),g,l,o,r)};f.AnimationVector=function(e){f.Assets.registerAsset(this,e);this.curves=[]};f.augment(f.QuickNotation,f.AnimationVector);f.augment(f.JSONLoader,f.AnimationVector);f.AnimationVector.prototype.curves=[];f.AnimationVector.prototype.frames=250;
f.AnimationVector.prototype.addAnimationCurve=function(e){this.curves[e.channel]=e;return this};f.AnimationVector.prototype.removeAnimationCurve=function(e){delete this.curves[e]};f.AnimationVector.prototype.setFrames=function(e){this.frames=e;return this};f.AnimationVector.prototype.getFrames=function(){return this.frames};f.G_NODE=1;f.G_ROOT=2;f.Group=function(e){f.Assets.registerAsset(this,e);this.children=[]};f.augment(f.Placeable,f.Group);f.augment(f.Animatable,f.Group);f.augment(f.QuickNotation,
f.Group);f.augment(f.JSONLoader,f.Group);f.Group.prototype.children=null;f.Group.prototype.className="Group";f.Group.prototype.type=f.G_NODE;f.Group.prototype.setAction=function(e,g,l){e.start(g,l,this.getNames());return this};f.Group.prototype.getNames=function(e){e||(e={});var g=this.getName();if(g!="")e[g]=this;for(g=0;g<this.children.length;g++)this.children[g].getNames&&this.children[g].getNames(e);return e};f.Group.prototype.getBoundingVolume=function(){this.boundingVolume=new f.BoundingVolume(0,
0,0,0,0,0);for(var e=0;e<this.children.length;e++)if(this.children[e].getBoundingVolume)this.boundingVolume.addBoundingVolume(this.children[e].getBoundingVolume());else if(this.children[e].getLocX){var g=parseFloat(this.children[e].getLocX()),l=parseFloat(this.children[e].getLocY()),o=parseFloat(this.children[e].getLocZ());this.boundingVolume.addBoundingVolume(new f.BoundingVolume(g,g,l,l,o,o))}this.boundingVolume.applyMatrixScale(this.getModelMatrix());return this.boundingVolume};f.Group.prototype.getObjects=
function(e){e||(e=[]);for(var g=0;g<this.children.length;g++)if(this.children[g].className=="Object"||this.children[g].className=="Text"||this.children[g].toRender)this.children[g].renderFirst?e.unshift(this.children[g]):e.push(this.children[g]);else this.children[g].getObjects&&this.children[g].getObjects(e);return e};f.Group.prototype.getLights=function(e){e||(e=[]);for(var g=0;g<this.children.length;g++)if(this.children[g].className=="Light")e.push(this.children[g]);else this.children[g].getLights&&
this.children[g].getLights(e);return e};f.Group.prototype.addChild=function(e){e.parent&&e.parent.removeChild(e);e.matrix=null;e.parent=this;this.children.push(e);return this};f.Group.prototype.addObject=f.Group.prototype.addChild;f.Group.prototype.addObjectInstance=f.Group.prototype.addChild;f.Group.prototype.addGroup=f.Group.prototype.addChild;f.Group.prototype.addText=f.Group.prototype.addChild;f.Group.prototype.addSkeleton=f.Group.prototype.addChild;f.Group.prototype.addLight=f.Group.prototype.addChild;
f.Group.prototype.addCamera=f.Group.prototype.addChild;f.Group.prototype.addWavefront=f.Group.prototype.addChild;f.Group.prototype.removeChild=function(e){for(var g=0;g<this.children.length;g++)if(this.children[g]==e){this.children.splice(g,1);this.scene&&this.scene["remove"+e.className]&&this.scene["remove"+e.className](e);break}};f.Group.prototype.getChildren=function(){return this.children};f.Group.prototype.GLInit=function(e){this.gl=e;for(var g=0;g<this.children.length;g++)this.children[g].GLInit&&
this.children[g].GLInit(e)};f.Group.prototype.GLRender=function(e,g){g==f.RENDER_DEFAULT&&this.animation&&this.animate();this.gl||this.GLInit(e);for(var l=0;l<this.children.length;l++)this.children[l].GLRender&&this.children[l].GLRender(e,g)};v();f.ActionChannel=function(e){f.Assets.registerAsset(this,e)};f.augment(f.QuickNotation,f.ActionChannel);f.augment(f.JSONLoader,f.ActionChannel);f.ActionChannel.prototype.setTarget=function(e){this.target=e};f.ActionChannel.prototype.setAnimation=function(e){this.animation=
e};f.ActionChannel.prototype.getTarget=function(){return this.target};f.ActionChannel.prototype.getAnimation=function(){return this.animation};f.Action=function(e){f.Assets.registerAsset(this,e);this.channels=[]};f.augment(f.QuickNotation,f.Action);f.augment(f.JSONLoader,f.Action);f.augment(f.Events,f.Action);f.Action.prototype.start=function(e,g,l){g||(g=false);e||(e=0);var o=this.channels,r=(new Date).getTime();this.animFinished=false;for(var s=0;s<o.length;s++){var w=o[s].getAnimation(),D=this,
L=o[s].getTarget();if(typeof L=="string")if(l&&l[L])L=l[L];var A={};A.finishEvent=function(){L.removeEventListener("animFinished",A.finishEvent);if(!D.animFinished&&L.animation==w){D.fireEvent("animFinished",{});D.animFinished=true}};L.addEventListener("animFinished",A.finishEvent);L.setAnimation(w,e,r);L.setLoop(g)}};f.Action.prototype.addActionChannel=function(e){this.channels.push(e);return this};f.Action.prototype.removeActionChannel=function(){for(var e=0;e<this.channels.length;e++)if(this.channels[e]==
channels){this.channels.splice(e,1);break}};f.Text=function(e){f.Assets.registerAsset(this,e);this.canvas=document.createElement("canvas");this.color={r:1,g:1,b:1}};f.augment(f.Placeable,f.Text);f.augment(f.Animatable,f.Text);f.augment(f.QuickNotation,f.Text);f.augment(f.JSONLoader,f.Text);f.Text.prototype.className="Text";f.Text.prototype.zTrans=true;f.Text.prototype.canvas=null;f.Text.prototype.aspect=1;f.Text.prototype.color=null;f.Text.prototype.text="";f.Text.prototype.font="Times";f.Text.prototype.size=
100;f.Text.prototype.pickType=f.TEXT_TEXTPICK;f.Text.prototype.getPickType=function(){return this.pickType};f.Text.prototype.setPickType=function(e){this.pickType=e;return this};f.Text.prototype.getFont=function(){return this.size};f.Text.prototype.setFont=function(e){this.font=e;this.gl&&this.updateCanvas(this.gl);return this};f.Text.prototype.getSize=function(){return this.size};f.Text.prototype.setSize=function(e){this.size=e;this.gl&&this.updateCanvas(this.gl);return this};f.Text.prototype.getText=
function(){return this.text};f.Text.prototype.setText=function(e){this.text=e;this.gl&&this.updateCanvas(this.gl);return this};f.Text.prototype.setColor=function(e){e=f.colorParse(e);this.color={r:e.r,g:e.g,b:e.b};return this};f.Text.prototype.setColorR=function(e){this.color.r=e;return this};f.Text.prototype.setColorG=function(e){this.color.g=e;return this};f.Text.prototype.setColorB=function(e){this.color.b=e;return this};f.Text.prototype.getColor=function(){return this.color};f.Text.prototype.setZtransparent=
function(e){this.zTrans=e;return this};f.Text.prototype.isZtransparent=function(){return this.zTrans};f.Text.prototype.GLGenerateShader=function(e){this.GLShaderProgram&&e.deleteProgram(this.GLShaderProgram);var g="";g+="attribute vec3 position;\n";g+="attribute vec2 uvcoord;\n";g+="varying vec2 texcoord;\n";g+="uniform mat4 Matrix;\n";g+="uniform mat4 PMatrix;\n";g+="varying vec4 pos;\n";g+="void main(void){\n";g+="texcoord=uvcoord;\n";g+="pos = Matrix * vec4(position,1.0);\n";g+="gl_Position = PMatrix * pos;\n";
g+="}\n";var l="#ifdef GL_ES\nprecision highp float;\n#endif\n";l+="uniform sampler2D TEXTURE;\n";l+="varying vec2 texcoord;\n";l+="varying vec4 pos;\n";l+="uniform float far;\n";l+="uniform int picktype;\n";l+="uniform vec3 pickcolor;\n";l+="uniform vec3 color;\n";l+="void main(void){\n";l+="float alpha=texture2D(TEXTURE,texcoord).a;\n";l=l+"if(picktype=="+f.TEXT_BOXPICK+"){gl_FragColor = vec4(pickcolor,1.0);}";l=l+"else if(picktype=="+f.TEXT_TEXTPICK+"){gl_FragColor = vec4(pickcolor,alpha);}";l+=
"else{gl_FragColor = vec4(color.rgb*alpha,alpha);};\n";l+="}\n";this.GLFragmentShader=e.createShader(e.FRAGMENT_SHADER);this.GLVertexShader=e.createShader(e.VERTEX_SHADER);e.shaderSource(this.GLFragmentShader,l);e.compileShader(this.GLFragmentShader);if(e.getShaderParameter(this.GLFragmentShader,e.COMPILE_STATUS)){e.shaderSource(this.GLVertexShader,g);e.compileShader(this.GLVertexShader);if(e.getShaderParameter(this.GLVertexShader,e.COMPILE_STATUS)){this.GLShaderProgram=e.createProgram();e.attachShader(this.GLShaderProgram,
this.GLVertexShader);e.attachShader(this.GLShaderProgram,this.GLFragmentShader);e.linkProgram(this.GLShaderProgram)}else f.error(e.getShaderInfoLog(this.GLVertexShader))}else f.error(e.getShaderInfoLog(this.GLFragmentShader))};f.Text.prototype.GLInit=function(e){this.gl=e;this.createPlane(e);this.GLGenerateShader(e);this.glTexture=e.createTexture();this.updateCanvas(e)};f.Text.prototype.updateCanvas=function(e){var g=this.canvas;g.width=1;g.height=this.size*1.2;var l=g.getContext("2d");l.font=this.size+
"px "+this.font;g.width=l.measureText(this.text).width;g.height=this.size*1.2;l=g.getContext("2d");l.textBaseline="top";l.font=this.size+"px "+this.font;this.aspect=g.width/g.height;l.fillText(this.text,0,0);e.bindTexture(e.TEXTURE_2D,this.glTexture);try{e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,g)}catch(o){e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,g,null)}e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,
e.LINEAR_MIPMAP_LINEAR);e.generateMipmap(e.TEXTURE_2D);e.bindTexture(e.TEXTURE_2D,null)};f.Text.prototype.GLRender=function(e,g,l){this.gl||this.GLInit(e);if(g==f.RENDER_DEFAULT||g==f.RENDER_PICK){this.lookAt&&this.Lookat(this.lookAt);e.useProgram(this.GLShaderProgram);var o;for(o=0;o<8;o++)e.disableVertexAttribArray(o);o=f.getAttribLocation(e,this.GLShaderProgram,"position");e.bindBuffer(e.ARRAY_BUFFER,this.posBuffer);e.enableVertexAttribArray(o);e.vertexAttribPointer(o,this.posBuffer.itemSize,e.FLOAT,
false,0,0);o=f.getAttribLocation(e,this.GLShaderProgram,"uvcoord");e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer);e.enableVertexAttribArray(o);e.vertexAttribPointer(o,this.uvBuffer.itemSize,e.FLOAT,false,0,0);e.activeTexture(e.TEXTURE0);e.bindTexture(e.TEXTURE_2D,this.glTexture);e.uniform1i(f.getUniformLocation(e,this.GLShaderProgram,"TEXTURE"),0);l||(l=0);o=l>>16&255;var r=l>>8&255;l=l&255;e.uniform3f(f.getUniformLocation(e,this.GLShaderProgram,"pickcolor"),l/255,r/255,o/255);g==f.RENDER_PICK?e.uniform1i(f.getUniformLocation(e,
this.GLShaderProgram,"picktype"),this.pickType):e.uniform1i(f.getUniformLocation(e,this.GLShaderProgram,"picktype"),0);if(!this.GLShaderProgram.glarrays)this.GLShaderProgram.glarrays={};g=this.size/100;g=f.mulMat4(e.scene.camera.getViewMatrix(),f.mulMat4(this.getModelMatrix(),f.scaleMatrix(this.aspect*g,g,g)));l=f.getUniformLocation(e,this.GLShaderProgram,"Matrix");if(this.GLShaderProgram.glarrays.mMatrix)f.mat4gl(g,this.GLShaderProgram.glarrays.mMatrix);else this.GLShaderProgram.glarrays.mMatrix=
new Float32Array(g);e.uniformMatrix4fv(l,true,this.GLShaderProgram.glarrays.mMatrix);l=f.getUniformLocation(e,this.GLShaderProgram,"PMatrix");if(this.GLShaderProgram.glarrays.pMatrix)f.mat4gl(e.scene.camera.getProjectionMatrix(),this.GLShaderProgram.glarrays.pMatrix);else this.GLShaderProgram.glarrays.pMatrix=new Float32Array(e.scene.camera.getProjectionMatrix());e.uniformMatrix4fv(l,true,this.GLShaderProgram.glarrays.pMatrix);g=f.getUniformLocation(e,this.GLShaderProgram,"far");e.uniform1f(g,e.scene.camera.getFar());
e.uniform3f(f.getUniformLocation(e,this.GLShaderProgram,"color"),this.color.r,this.color.g,this.color.b);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.GLfaces);e.drawElements(e.TRIANGLES,this.GLfaces.numItems,e.UNSIGNED_SHORT,0)}};f.Text.prototype.createPlane=function(e){if(!this.posBuffer)this.posBuffer=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this.posBuffer);e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,0,-1,1,0,-1,-1,0,1,-1,0]),e.STATIC_DRAW);this.posBuffer.itemSize=3;this.posBuffer.numItems=
4;if(!this.uvBuffer)this.uvBuffer=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer);e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,1,0,1,1,0,1]),e.STATIC_DRAW);this.uvBuffer.itemSize=2;this.uvBuffer.numItems=4;if(!this.GLfaces)this.GLfaces=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.GLfaces);e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,2,3,0]),e.STATIC_DRAW);this.GLfaces.itemSize=1;this.GLfaces.numItems=6};f.ObjectLod=function(e){f.Assets.registerAsset(this,
e)};f.augment(f.QuickNotation,f.ObjectLod);f.augment(f.JSONLoader,f.ObjectLod);f.ObjectLod.prototype.mesh=null;f.ObjectLod.prototype.className="ObjectLod";f.ObjectLod.prototype.material=null;f.ObjectLod.prototype.program=null;f.ObjectLod.prototype.GLShaderProgramPick=null;f.ObjectLod.prototype.GLShaderProgramShadow=null;f.ObjectLod.prototype.GLShaderProgram=null;f.ObjectLod.prototype.pixelSize=0;f.ObjectLod.prototype.setMesh=function(e){if(typeof e=="string")e=f.Assets.get(e);this.mesh&&this.mesh.removeEventListener("shaderupdate",
this.meshupdated);var g=this;this.meshupdated=function(){g.GLShaderProgram=null};e.addEventListener("shaderupdate",this.meshupdated);this.GLShaderProgram=null;this.mesh=e;return this};f.ObjectLod.prototype.getMesh=function(){return this.mesh};f.ObjectLod.prototype.setMaterial=function(e){if(typeof e=="string")e=f.Assets.get(e);this.material&&this.material.removeEventListener("shaderupdate",this.materialupdated);var g=this;this.materialupdated=function(){g.GLShaderProgram=null};e.addEventListener("shaderupdate",
this.materialupdated);this.GLShaderProgram=null;this.material=e;return this};f.ObjectLod.prototype.getMaterial=function(){return this.material};f.ObjectLod.prototype.getPixelSize=function(){return this.pixelSize};f.ObjectLod.prototype.setPixelSize=function(e){this.pixelSize=parseFloat(e)};f.MultiMaterial=function(e){f.Assets.registerAsset(this,e);this.lods=[new f.ObjectLod]};f.augment(f.QuickNotation,f.MultiMaterial);f.augment(f.JSONLoader,f.MultiMaterial);f.MultiMaterial.prototype.className="MultiMaterial";
f.MultiMaterial.prototype.setMesh=function(e){this.lods[0].setMesh(e);return this};f.MultiMaterial.prototype.getMesh=function(){return this.lods[0].getMesh()};f.MultiMaterial.prototype.setMaterial=function(e){this.lods[0].setMaterial(e);return this};f.MultiMaterial.prototype.getMaterial=function(){return this.lods[0].getMaterial()};f.MultiMaterial.prototype.getLOD=function(e){var g=0,l=this.lods[0];if(this.lods.length>1)for(var o=1;o<this.lods.length;o++){var r=this.lods[o].pixelSize;if(r>g&&r<e&&
this.lods[o].mesh&&this.lods[o].mesh.loaded){g=r;l=this.lods[o]}}return l};f.MultiMaterial.prototype.addObjectLod=function(e){this.lods.push(e);return this};f.MultiMaterial.prototype.removeObjectLod=function(e){(e=this.lods.indexOf(e))&&this.lods.splice(e,1);return this};f.ObjectInstance=function(e){f.Assets.registerAsset(this,e)};f.augment(f.Placeable,f.ObjectInstance);f.augment(f.Animatable,f.ObjectInstance);f.augment(f.QuickNotation,f.ObjectInstance);f.augment(f.JSONLoader,f.ObjectInstance);f.ObjectInstance.prototype.parentObject=
null;f.ObjectInstance.prototype.className="ObjectInstance";f.ObjectInstance.prototype.setObject=function(e){this.parentObject&&this.parentObject.removeInstance(this);this.parentObject=e;e.addInstance(this);return this};f.ObjectInstance.prototype.getObject=function(){return this.parentObject};f.Object=function(e){f.Assets.registerAsset(this,e);this.multimaterials=[];this.instances=[]};f.augment(f.Placeable,f.Object);f.augment(f.Animatable,f.Object);f.augment(f.QuickNotation,f.Object);f.augment(f.JSONLoader,
f.Object);f.Object.prototype.className="Object";f.Object.prototype.mesh=null;f.Object.prototype.skeleton=null;f.Object.prototype.scene=null;f.Object.prototype.transformMatrix=f.identMatrix();f.Object.prototype.material=null;f.Object.prototype.gl=null;f.Object.prototype.multimaterials=null;f.Object.prototype.instances=null;f.Object.prototype.zTrans=false;f.Object.prototype.id="";f.Object.prototype.pickable=true;f.Object.prototype.drawType=f.DRAW_TRIS;f.Object.prototype.pointSize=1;var h=[];h.push("#ifdef GL_ES\nprecision highp float;\n#endif\n");
h.push("void main(void)\n");h.push("{\n");h.push("vec4 rgba=fract((gl_FragCoord.z/gl_FragCoord.w)/10000.0 * vec4(16777216.0, 65536.0, 256.0, 1.0));\n");h.push("gl_FragColor=rgba-rgba.rrgb*vec4(0.0,0.00390625,0.00390625,0.00390625);\n");h.push("}\n");f.Object.prototype.shfragStr=h.join("");h=[];h.push("#ifdef GL_ES\nprecision highp float;\n#endif\n");h.push("varying vec3 n;\n");h.push("void main(void)\n");h.push("{\n");h.push("gl_FragColor=vec4(n,1.0);\n");h.push("}\n");f.Object.prototype.nfragStr=
h.join("");h=[];h.push("#ifdef GL_ES\nprecision highp float;\n#endif\n");h.push("uniform float far;\n");h.push("uniform vec3 pickcolor;\n");h.push("varying vec3 n;\n");h.push("varying vec4 UVCoord;\n");h.push("void main(void)\n");h.push("{\n");h.push("float Xcoord = gl_FragCoord.x+0.5;\n");h.push("if(Xcoord>0.0) gl_FragColor = vec4(pickcolor,1.0);\n");h.push("if(Xcoord>1.0) gl_FragColor = vec4(n,1.0);\n");h.push("if(Xcoord>2.0){");h.push("vec3 rgb=fract((gl_FragCoord.z/gl_FragCoord.w) * vec3(65536.0, 256.0, 1.0));\n");
h.push("gl_FragColor=vec4(rgb-rgb.rrg*vec3(0.0,0.00390625,0.00390625),1.0);\n");h.push("}");h.push("if(Xcoord>3.0){");h.push("vec3 rgb=fract(UVCoord.x * vec3(65536.0, 256.0, 1.0));\n");h.push("gl_FragColor=vec4(rgb-rgb.rrg*vec3(0.0,0.00390625,0.00390625),1.0);\n");h.push("}");h.push("if(Xcoord>4.0){");h.push("vec3 rgb=fract(UVCoord.y * vec3(65536.0, 256.0, 1.0));\n");h.push("gl_FragColor=vec4(rgb-rgb.rrg*vec3(0.0,0.00390625,0.00390625),1.0);\n");h.push("}");h.push("}\n");f.Object.prototype.pkfragStr=
h.join("");f.Object.prototype.getDrawType=function(){return this.drawType};f.Object.prototype.setDrawType=function(e){this.drawType=e;return this};f.Object.prototype.getPointSize=function(){return this.pointSize};f.Object.prototype.setPointSize=function(e){this.pointSize=parseFloat(e);return this};f.Object.prototype.getSkeleton=function(){return this.skeleton};f.Object.prototype.setSkeleton=function(e){this.skeleton=e;this.bones=e.getNames();return this};f.Object.prototype.getBoundingVolume=function(){var e=
this.multimaterials;this.boundingVolume=new f.BoundingVolume(0,0,0,0,0,0);for(var g=0;g<e.length;g++)this.boundingVolume.addBoundingVolume(e[g].lods[0].mesh.getBoundingVolume());this.boundingVolume.applyMatrixScale(this.getModelMatrix());return this.boundingVolume};f.Object.prototype.setZtransparent=function(e){this.zTrans=e;return this};f.Object.prototype.isZtransparent=function(){return this.zTrans};f.Object.prototype.addInstance=function(e){this.instances.push(e);return this};f.Object.prototype.removeInstance=
function(e){for(var g=0;g<this.instances;g++)this.instance==e&&this.instances.splice(g)};f.Object.prototype.setMaterial=function(e,g){if(typeof e=="string")e=f.Assets.get(e);g||(g=0);this.multimaterials[g]||(this.multimaterials[g]=new f.MultiMaterial);if(this.multimaterials[g].getMaterial()!=e){this.multimaterials[g].setMaterial(e);this.updateProgram()}return this};f.Object.prototype.getMaterial=function(e){e||(e=0);return this.multimaterials[e]?this.multimaterials[e].getMaterial():false};f.Object.prototype.setMesh=
function(e,g){if(typeof e=="string")e=f.Assets.get(e);g||(g=0);this.multimaterials[g]||this.multimaterials.push(new f.MultiMaterial);this.multimaterials[g].setMesh(e);return this};f.Object.prototype.getMesh=function(e){e||(e=0);if(this.multimaterials[e])this.multimaterials[e].getMesh();else return false};f.Object.prototype.GLInit=function(e){this.gl=e};f.Object.prototype.GLDestory=function(){};f.Object.prototype.updateProgram=function(){for(var e=0;e<this.multimaterials.length;e++)this.multimaterials[e].GLShaderProgram=
null};f.Object.prototype.addMultiMaterial=function(e){if(typeof e=="string")e=f.Assets.get(e);this.multimaterials.push(e)};f.Object.prototype.getMultiMaterials=function(){return this.multimaterials};f.Object.prototype.GLGenerateShader=function(e){var g=joints1=joints2=false,l=e.lights,o=[],r=false;this.mesh.normals||this.mesh.calcNormals();for(var s=0;s<this.mesh.buffers.length;s++){if(this.mesh.buffers[s].name=="tangent")r=true;this.mesh.buffers[s].size>1?o.push("attribute vec"+this.mesh.buffers[s].size+
" "+this.mesh.buffers[s].name+";\n"):o.push("attribute float "+this.mesh.buffers[s].name+";\n");if(this.mesh.buffers[s].name=="UV")g=true;if(this.mesh.buffers[s].name=="joints1")joints1=this.mesh.buffers[s];if(this.mesh.buffers[s].name=="joints2")joints2=this.mesh.buffers[s]}o.push("uniform mat4 worldView;\n");o.push("uniform mat4 projection;\n");o.push("uniform mat4 view;\n");o.push("uniform mat4 worldInverseTranspose;\n");o.push("uniform mat4 envMat;\n");for(s=0;s<l.length;s++){o.push("uniform vec3 lightpos"+
s+";\n");o.push("uniform vec3 lightdir"+s+";\n");o.push("uniform mat4 lightmat"+s+";\n");o.push("varying vec4 spotcoord"+s+";\n")}o.push("varying vec3 eyevec;\n");for(s=0;s<l.length;s++){o.push("varying vec3 lightvec"+s+";\n");o.push("varying vec3 tlightvec"+s+";\n");o.push("varying float lightdist"+s+";\n")}if(this.mesh.joints&&this.mesh.joints.length>0){o.push("uniform mat4 jointMat["+this.mesh.joints.length+"];\n");o.push("uniform mat4 jointNMat["+this.mesh.joints.length+"];\n")}this.material&&
o.push(this.material.getVertexVarying(o));o.push("varying vec3 n;\n");o.push("varying vec3 b;\n");o.push("varying vec3 t;\n");o.push("varying vec4 UVCoord;\n");o.push("varying vec3 OBJCoord;\n");o.push("varying vec3 tang;\n");o.push("varying vec3 teyevec;\n");o.push("void main(void)\n");o.push("{\n");g&&o.push("UVCoord=UV;\n");o.push("OBJCoord = position;\n");o.push("vec4 pos = vec4(0.0, 0.0, 0.0, 1.0);\n");o.push("vec4 norm = vec4(0.0, 0.0, 0.0, 1.0);\n");o.push("vec4 tang4 = vec4(0.0, 0.0, 0.0, 1.0);\n");
if(joints1){if(joints1.size==1){o.push("pos += jointMat[int(joints1)]*vec4(position,1.0)*weights1;\n");o.push("norm += jointNMat[int(joints1)]*vec4(normal,1.0)*weights1;\n");r&&o.push("tang4 +=  jointNMat[int(joints1)]*vec4(tangent,1.0)*weights1;\n")}else for(s=0;s<joints1.size;s++){o.push("pos += jointMat[int(joints1["+s+"])]*vec4(position,1.0)*weights1["+s+"];\n");o.push("norm += jointNMat[int(joints1["+s+"])]*vec4(normal,1.0)*weights1["+s+"];\n");r&&o.push("tang4 +=  jointNMat[int(joints1["+s+
"])]*vec4(tangent,1.0)*weights1["+s+"];\n")}if(joints2)if(joints2.size==1){o.push("pos += jointMat[int(joints2)]*vec4(position,1.0)*weights2;\n");o.push("norm += jointNMat[int(joints2)]*vec4(normal,1.0)*weights2;\n");r&&o.push("tang4 +=  jointNMat[int(joints2)]*vec4(tangent,1.0)*weights2;\n")}else for(s=0;s<joints2.size;s++){o.push("pos += jointMat[int(joints2["+s+"])]*vec4(position,1.0)*weights2["+s+"];\n");o.push("norm += jointNMat[int(joints2["+s+"])]*vec4(normal,1.0)*weights2["+s+"];\n");r&&o.push("tang4 +=  jointNMat[int(joints2["+
s+"])]*vec4(tangent,1.0)*weights2["+s+"];\n")}for(s=0;s<l.length;s++)o.push("spotcoord"+s+"=lightmat"+s+"*vec4(pos.xyz,1.0);\n");o.push("pos = worldView * vec4(pos.xyz, 1.0);\n");o.push("norm = worldInverseTranspose * vec4(norm.xyz, 1.0);\n");r&&o.push("tang = (worldInverseTranspose*vec4(tang4.xyz,1.0)).xyz;\n")}else{for(s=0;s<l.length;s++)o.push("spotcoord"+s+"=lightmat"+s+"*vec4(position,1.0);\n");o.push("pos = worldView * vec4(position, 1.0);\n");o.push("norm = worldInverseTranspose * vec4(normal, 1.0);\n");
r&&o.push("tang = (worldInverseTranspose*vec4(tangent,1.0)).xyz;\n")}o.push("gl_Position = projection * pos;\n");o.push("gl_PointSize="+this.pointSize.toFixed(5)+";\n");o.push("eyevec = -pos.xyz;\n");o.push("t = normalize(tang);");o.push("n = normalize(norm.rgb);");o.push("b = normalize(cross(n,t));");if(r){o.push("teyevec.x = dot(eyevec, t);");o.push("teyevec.y = dot(eyevec, b);");o.push("teyevec.z = dot(eyevec, n);")}else o.push("teyevec = eyevec;");for(s=0;s<l.length;s++){l[s].getType()==f.L_DIR?
o.push("vec3 tmplightvec"+s+" = -lightdir"+s+";\n"):o.push("vec3 tmplightvec"+s+" = -(lightpos"+s+"-pos.xyz);\n");if(r){o.push("tlightvec"+s+".x = dot(tmplightvec"+s+", t);");o.push("tlightvec"+s+".y = dot(tmplightvec"+s+", b);");o.push("tlightvec"+s+".z = dot(tmplightvec"+s+", n);")}else o.push("tlightvec"+s+" = tmplightvec"+s+";");o.push("lightvec"+s+" = tmplightvec"+s+";");o.push("lightdist"+s+" = length(lightpos"+s+".xyz-pos.xyz);\n")}this.material&&o.push(this.material.getLayerCoords(o));o.push("}\n");
o=o.join("");if(this.material)g=this.material.getFragmentShader(l);else{g=[];g.push("void main(void)\n");g.push("{\n");g.push("gl_FragColor = vec4(1.0,1.0,1.0,1.0);\n");g.push("}\n");g=g.join("")}this.GLFragmentShaderNormal=f.getGLShader(e,e.FRAGMENT_SHADER,this.nfragStr);this.GLFragmentShaderShadow=f.getGLShader(e,e.FRAGMENT_SHADER,this.shfragStr);this.GLFragmentShaderPick=f.getGLShader(e,e.FRAGMENT_SHADER,this.pkfragStr);this.GLFragmentShader=f.getGLShader(e,e.FRAGMENT_SHADER,g);this.GLVertexShader=
f.getGLShader(e,e.VERTEX_SHADER,o);this.GLShaderProgramPick=f.getGLProgram(e,this.GLVertexShader,this.GLFragmentShaderPick);this.GLShaderProgramShadow=f.getGLProgram(e,this.GLVertexShader,this.GLFragmentShaderShadow);this.GLShaderProgramNormal=f.getGLProgram(e,this.GLVertexShader,this.GLFragmentShaderNormal);this.GLShaderProgram=f.getGLProgram(e,this.GLVertexShader,this.GLFragmentShader)};f.Object.prototype.createShaders=function(e){if(this.gl){this.mesh=e.mesh;this.material=e.material;this.GLGenerateShader(this.gl);
e.GLShaderProgramPick=this.GLShaderProgramPick;e.GLShaderProgramShadow=this.GLShaderProgramShadow;e.GLShaderProgram=this.GLShaderProgram}};f.Object.prototype.GLUniforms=function(e,g,l){var o;switch(g){case f.RENDER_DEFAULT:o=this.GLShaderProgram;break;case f.RENDER_SHADOW:o=this.GLShaderProgramShadow;break;case f.RENDER_NORMAL:o=this.GLShaderProgramNormal;break;case f.RENDER_PICK:o=this.GLShaderProgramPick;var r=l>>16&255,s=l>>8&255;l=l&255;e.uniform3f(f.getUniformLocation(e,o,"pickcolor"),l/255,
s/255,r/255);break}if(!o.caches)o.caches={};if(!o.glarrays)o.glarrays={};if(o.caches.far!=e.scene.camera.far){e.uniform1f(f.getUniformLocation(e,o,"far"),e.scene.camera.far);o.caches.far=e.scene.camera.far}if(g==f.RENDER_DEFAULT){if(o.caches.ambientColor!=e.scene.ambientColor){e.uniform3f(f.getUniformLocation(e,o,"amb"),e.scene.ambientColor.r,e.scene.ambientColor.g,e.scene.ambientColor.b);o.caches.ambientColor=e.scene.ambientColor}if(o.caches.fogFar!=e.scene.fogFar){e.uniform1f(f.getUniformLocation(e,
o,"fogfar"),e.scene.fogFar);o.caches.fogFar=e.scene.fogFar}if(o.caches.fogNear!=e.scene.fogNear){e.uniform1f(f.getUniformLocation(e,o,"fognear"),e.scene.fogNear);o.caches.fogNear=e.scene.fogNear}if(o.caches.fogType!=e.scene.fogType){e.uniform1i(f.getUniformLocation(e,o,"fogtype"),e.scene.fogType);o.caches.fogType=e.scene.fogType}if(o.caches.fogType!=e.scene.fogcolor){e.uniform3f(f.getUniformLocation(e,o,"fogcolor"),e.scene.fogColor.r,e.scene.fogColor.g,e.scene.fogColor.b);o.caches.fogcolor=e.scene.fogcolor}}s=
e.scene.camera.getViewMatrix();r=this.getModelMatrix();if(!o.caches.mvMatrix)o.caches.mvMatrix={cameraMatrix:null,modelMatrix:null};l=o.caches.mvMatrix;if(l.camerMatrix!=s||l.modelMatrix!=r)try{if(!this.caches.mvMatrix)this.caches.mvMatrix=f.mulMat4(s,r);mvMatrix=this.caches.mvMatrix;var w=f.getUniformLocation(e,o,"worldView");if(o.glarrays.mvMatrix)f.mat4gl(mvMatrix,o.glarrays.mvMatrix);else o.glarrays.mvMatrix=new Float32Array(mvMatrix);e.uniformMatrix4fv(w,true,o.glarrays.mvMatrix);if(!this.caches.envMat){var D=
f.inverseMat4(mvMatrix);D[3]=0;D[7]=0;D[11]=0;this.caches.envMat=D}D=this.caches.envMat;var L=f.getUniformLocation(e,o,"envMat");if(o.glarrays.envMat)f.mat4gl(D,o.glarrays.envMat);else o.glarrays.envMat=new Float32Array(D);e.uniformMatrix4fv(L,true,o.glarrays.envMat);if(!this.caches.normalMatrix){var A=f.inverseMat4(mvMatrix);this.caches.normalMatrix=A}A=this.caches.normalMatrix;var K=f.getUniformLocation(e,o,"worldInverseTranspose");if(o.glarrays.normalMatrix)f.mat4gl(A,o.glarrays.normalMatrix);
else o.glarrays.normalMatrix=new Float32Array(A);e.uniformMatrix4fv(K,false,o.glarrays.normalMatrix);var Y=f.getUniformLocation(e,o,"view");if(o.glarrays.cameraMatrix)f.mat4gl(s,o.glarrays.cameraMatrix);else o.glarrays.cameraMatrix=new Float32Array(s);e.uniformMatrix4fv(Y,true,o.glarrays.cameraMatrix);l.camerMatrix=s}catch(aa){}try{var q=f.getUniformLocation(e,o,"projection");if(o.glarrays.pMatrix)f.mat4gl(e.scene.camera.getProjectionMatrix(),o.glarrays.pMatrix);else o.glarrays.pMatrix=new Float32Array(e.scene.camera.getProjectionMatrix());
e.uniformMatrix4fv(q,true,o.glarrays.pMatrix)}catch(P){}if(g==f.RENDER_DEFAULT){var fa=e.lights;if(!o.caches.lights)o.caches.lights=[];if(!o.glarrays.lights)o.glarrays.lights=[];if(!this.caches.lights)this.caches.lights=[];A=o.caches.lights;for(w=0;w<fa.length;w++){A[w]||(A[w]={modelMatrix:null,cameraMatrix:null});if(A[w].modelMatrix!=r||A[w].cameraMatrix!=s){this.caches.lights[w]||(this.caches.lights[w]={});if(!this.caches.lights[w].pos)this.caches.lights[w].pos=f.mulMat4Vec4(f.mulMat4(s,fa[w].getModelMatrix()),
[0,0,0,1]);D=this.caches.lights[w].pos;e.uniform3f(f.getUniformLocation(e,o,"lightpos"+w),D[0],D[1],D[2]);if(!this.caches.lights[w].lpos)this.caches.lights[w].lpos=f.mulMat4Vec4(f.mulMat4(s,fa[w].getModelMatrix()),[0,0,1,1]);L=this.caches.lights[w].lpos;e.uniform3f(f.getUniformLocation(e,o,"lightdir"+w),L[0]-D[0],L[1]-D[1],L[2]-D[2]);if(fa[w].s_cache)try{var S=f.mulMat4(fa[w].s_cache.smatrix,r);if(o.glarrays.lights[w])f.mat4gl(S,o.glarrays.lights[w]);else o.glarrays.lights[w]=new Float32Array(S);
e.uniformMatrix4fv(f.getUniformLocation(e,o,"lightmat"+w),true,o.glarrays.lights[w]);A[w].modelMatrix=r;A[w].cameraMatrix=s}catch(F){}else{A[w].modelMatrix=r;A[w].cameraMatrix=s}}}}if(this.mesh.joints){if(!o.caches.joints)o.caches.joints=[];if(!o.glarrays.joints)o.glarrays.joints=[];if(!o.glarrays.jointsinv)o.glarrays.jointsinv=[];S=o.caches.joints;f.identMatrix();for(w=0;w<this.mesh.joints.length;w++){S[w]||(S[w]={modelMatrix:null,invBind:null});if(typeof this.mesh.joints[w]=="string"){if(this.bones)r=
this.bones[this.mesh.joints[w]].getModelMatrix()}else r=this.mesh.joints[w].getModelMatrix();s=this.mesh.invBind[w];if(S[w].modelMatrix!=r||S[w].invBind!=s)try{var ja=f.mulMat4(r,s);if(o.glarrays.joints[w])f.mat4gl(ja,o.glarrays.joints[w]);else o.glarrays.joints[w]=new Float32Array(ja);if(o.glarrays.jointsinv[w])f.mat4gl(f.inverseMat4(ja),o.glarrays.jointsinv[w]);else o.glarrays.jointsinv[w]=new Float32Array(f.inverseMat4(ja));e.uniformMatrix4fv(f.getUniformLocation(e,o,"jointMat["+w+"]"),true,o.glarrays.joints[w]);
e.uniformMatrix4fv(f.getUniformLocation(e,o,"jointNMat["+w+"]"),false,o.glarrays.jointsinv[w]);S[w].modelMatrix=r;S[w].invBind=s}catch(xa){}}}this.material&&g==f.RENDER_DEFAULT&&this.material.textureUniforms(e,o,fa,this)};f.Object.prototype.GLRender=function(e,g,l){this.gl||this.GLInit(e);this.lookAt&&this.Lookat(this.lookAt);g==f.RENDER_DEFAULT&&this.animation&&this.animate();this.caches={};for(var o=0;o<this.instances.length;o++)this.instances[o].caches={};for(var r,s=0;s<this.multimaterials.length;s++){if(this.multimaterials[s].lods.length>
1&&!r){r=e.scene.camera.getPosition();o=this.getPosition();r=f.lengthVec3([r.x-o.x,r.y-o.y,r.z-o.z]);r=f.mulMat4Vec4(e.scene.camera.getProjectionMatrix(),[this.getBoundingVolume().getSphereRadius(),0,-r,1]);r=r[0]/r[3]*e.scene.renderer.canvas.width}o=this.multimaterials[s].getLOD(r);if(o.mesh&&o.mesh.loaded){if(g==f.RENDER_NULL){o.material&&o.material.registerPasses(e,this);break}if(this.multimaterials[s].GLShaderProgram){this.GLShaderProgramPick=o.GLShaderProgramPick;this.GLShaderProgramShadow=o.GLShaderProgramShadow;
this.GLShaderProgram=o.GLShaderProgram}else this.createShaders(o);this.mesh=o.mesh;this.material=o.material;var w;switch(this.drawType){case f.DRAW_LINES:w=e.LINES;break;case f.DRAW_POINTS:w=e.POINTS;break;case f.DRAW_LINELOOPS:w=e.LINE_LOOP;break;case f.DRAW_LINESTRIPS:w=e.LINE_STRIP;break;default:w=e.TRIANGLES;break}switch(g){case f.RENDER_DEFAULT:e.useProgram(this.GLShaderProgram);this.mesh.GLAttributes(e,this.GLShaderProgram);break;case f.RENDER_SHADOW:e.useProgram(this.GLShaderProgramShadow);
this.mesh.GLAttributes(e,this.GLShaderProgramShadow);break;case f.RENDER_NORMAL:e.useProgram(this.GLShaderProgramNormal);this.mesh.GLAttributes(e,this.GLShaderProgramNormal);break;case f.RENDER_PICK:e.useProgram(this.GLShaderProgramPick);this.mesh.GLAttributes(e,this.GLShaderProgramPick);w=e.TRIANGLES;break}this.GLUniforms(e,g,l);if(this.mesh.GLfaces){e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.mesh.GLfaces);e.drawElements(w,this.mesh.GLfaces.numItems,e.UNSIGNED_SHORT,0)}else e.drawArrays(w,0,this.mesh.positions.length/
3);var D=this.matrix,L=this.caches;for(o=0;o<this.instances.length;o++){this.matrix=this.instances[o].getModelMatrix();this.caches=this.instances[o].caches;this.GLUniforms(e,g,l);if(this.mesh.GLfaces){e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.mesh.GLfaces);e.drawElements(w,this.mesh.GLfaces.numItems,e.UNSIGNED_SHORT,0)}else e.drawArrays(w,0,this.mesh.positions.length/3)}this.matrix=D;this.caches=L}}};f.Mesh=function(e){f.Assets.registerAsset(this,e);this.GLbuffers=[];this.buffers=[];this.UV=[];this.boneWeights=
[];this.setBuffers=[];this.faces={}};f.augment(f.QuickNotation,f.Mesh);f.augment(f.JSONLoader,f.Mesh);f.augment(f.Events,f.Mesh);f.Mesh.prototype.gl=null;f.Mesh.prototype.className="Mesh";f.Mesh.prototype.GLbuffers=null;f.Mesh.prototype.buffers=null;f.Mesh.prototype.setBuffers=null;f.Mesh.prototype.GLfaces=null;f.Mesh.prototype.faces=null;f.Mesh.prototype.UV=null;f.Mesh.prototype.joints=null;f.Mesh.prototype.invBind=null;f.Mesh.prototype.loaded=false;f.Mesh.prototype.getBoundingVolume=function(){if(!this.boundingVolume){for(var e,
g,l,o,r,s,w=0;w<this.buffers.length;w++)if(this.buffers[w].name=="position")var D=this.buffers[w].data;for(w=0;w<D.length;w+=3)if(w==0){e=g=D[w];l=o=D[w+1];r=s=D[w+2]}else{e=Math.min(e,D[w]);g=Math.max(g,D[w]);l=Math.min(l,D[w+1]);o=Math.max(o,D[w+1]);r=Math.min(r,D[w+2]);s=Math.max(s,D[w+2])}this.boundingVolume=new f.BoundingVolume(e,g,l,o,r,s)}return this.boundingVolume};f.Mesh.prototype.setJoints=function(e){this.joints=e;this.fireEvent("shaderupdate",{});return this};f.Mesh.prototype.setInvBindMatrix=
function(e){this.invBind=e;this.fireEvent("shaderupdate",{});return this};f.Mesh.prototype.setVertexJoints=function(e,g){if(g<4)this.setBuffer("joints1",e,g);else{for(var l=[],o=[],r=0;r<e.length;r++)r%g<4?l.push(e[r]):o.push(e[r]);this.setBuffer("joints1",l,4);this.setBuffer("joints2",o,g%4)}this.fireEvent("shaderupdate",{});return this};f.Mesh.prototype.setVertexWeights=function(e,g){for(var l=0;l<e.length;l+=parseInt(g)){for(var o=0,r=0;r<g;r++)o+=parseFloat(e[l+r]);for(r=0;r<g;r++)e[l+r]/=o}if(g<
4)this.setBuffer("weights1",e,g);else{o=[];r=[];for(l=0;l<e.length;l++)l%g<4?o.push(e[l]):r.push(e[l]);this.setBuffer("weights1",o,4);this.setBuffer("weights2",r,g%4)}this.fireEvent("shaderupdate",{});return this};f.Mesh.prototype.setUV=function(e){for(var g=0,l=0;l<e.length;l+=2){this.UV[g]=e[l];this.UV[g+1]=e[l+1];this.UV[g+2]||(this.UV[g+2]=0);this.UV[g+3]||(this.UV[g+3]=0);g+=4}this.setBuffer("UV",this.UV,4);return this};f.Mesh.prototype.setUV2=function(e){for(var g=0,l=0;l<e.length;l+=2){this.UV[g]||
(this.UV[g]=0);this.UV[g+1]||(this.UV[g+1]=0);this.UV[g+2]=e[l];this.UV[g+3]=e[l+1];g+=4}this.setBuffer("UV",this.UV,4);return this};f.Mesh.prototype.setPositions=function(e){this.loaded=true;this.positions=e;this.setBuffer("position",e,3);return this};f.Mesh.prototype.setNormals=function(e){this.normals=e;this.setBuffer("normal",e,3);return this};f.Mesh.prototype.setBuffer=function(e,g,l){for(var o=0;o<g.length;o++)g[o]=parseFloat(g[o]);var r;for(o=0;o<this.buffers.length;o++)if(this.buffers[o].name==
e)r=o;if(r)this.buffers[r]={name:e,data:g,size:l,GL:false};else this.buffers.push({name:e,data:g,size:l,GL:false});return this};f.Mesh.prototype.setFaces=function(e){this.faces={data:e,GL:false};this.normals||this.calcNormals();for(e=0;e<this.buffers.length;e++){if(this.buffers[e].name=="position")var g=this.buffers[e].data;if(this.buffers[e].name=="UV")var l=this.buffers[e].data;if(this.buffers[e].name=="normal")var o=this.buffers[e].data}if(g&&l){var r=[],s={};for(e=0;e<this.faces.data.length;e+=
3){var w=[g[parseInt(this.faces.data[e])*3],g[parseInt(this.faces.data[e])*3+1],g[parseInt(this.faces.data[e])*3+2]],D=[g[parseInt(this.faces.data[e+1])*3],g[parseInt(this.faces.data[e+1])*3+1],g[parseInt(this.faces.data[e+1])*3+2]],L=[g[parseInt(this.faces.data[e+2])*3],g[parseInt(this.faces.data[e+2])*3+1],g[parseInt(this.faces.data[e+2])*3+2]],A=[o[parseInt(this.faces.data[e])*3],o[parseInt(this.faces.data[e])*3+1],o[parseInt(this.faces.data[e])*3+2]],K=[o[parseInt(this.faces.data[e+1])*3],o[parseInt(this.faces.data[e+
1])*3+1],o[parseInt(this.faces.data[e+1])*3+2]],Y=[o[parseInt(this.faces.data[e+2])*3],o[parseInt(this.faces.data[e+2])*3+1],o[parseInt(this.faces.data[e+2])*3+2]],aa=[D[0]-w[0],D[1]-w[1],D[2]-w[2]],q=[L[0]-w[0],L[1]-w[1],L[2]-w[2]],P=[l[parseInt(this.faces.data[e+1])*4]-l[parseInt(this.faces.data[e])*4],l[parseInt(this.faces.data[e+1])*4+1]-l[parseInt(this.faces.data[e])*4+1]],fa=[l[parseInt(this.faces.data[e+2])*4]-l[parseInt(this.faces.data[e])*4],l[parseInt(this.faces.data[e+2])*4+1]-l[parseInt(this.faces.data[e])*
4+1]];aa=f.toUnitVec3([aa[0]*fa[1]-q[0]*P[1],aa[1]*fa[1]-q[1]*P[1],aa[2]*fa[1]-q[2]*P[1]]);P=P[1]*fa[0]-P[0]*fa[1];if(P!=0)aa=f.toUnitVec3(f.scaleVec3(aa,1/P));if(s[[w[0],w[1],w[2],A[0],A[1],A[2]].join(",")]){tang=s[[w[0],w[1],w[2],A[0],A[1],A[2]].join(",")];tang.vec=f.scaleVec3(f.addVec3(f.scaleVec3(tang.vec,tang.weight),aa),1/tang.weight);tang.weight++}else s[[w[0],w[1],w[2],A[0],A[1],A[2]].join(",")]={vec:aa,weight:1};if(s[[D[0],D[1],D[2],K[0],K[1],K[2]].join(",")]){tang=s[[D[0],D[1],D[2],K[0],
K[1],K[2]].join(",")];tang.vec=f.scaleVec3(f.addVec3(f.scaleVec3(tang.vec,tang.weight),aa),1/(tang.weight+1));tang.weight++}else s[[D[0],D[1],D[2],K[0],K[1],K[2]].join(",")]={vec:aa,weight:1};if(s[[L[0],L[1],L[2],Y[0],Y[1],Y[2]].join(",")]){tang=s[[L[0],L[1],L[2],Y[0],Y[1],Y[2]].join(",")];tang.vec=f.scaleVec3(f.addVec3(f.scaleVec3(tang.vec,tang.weight),aa),1/(tang.weight+1));tang.weight++}else s[[L[0],L[1],L[2],Y[0],Y[1],Y[2]].join(",")]={vec:aa,weight:1}}for(e=0;e<g.length/3;e++){w=[g[e*3],g[e*
3+1],g[e*3+2]];A=[o[e*3],o[e*3+1],o[e*3+2]];if(t=s[[w[0],w[1],w[2],A[0],A[1],A[2]].join(",")].vec){r[e*3]=t[0];r[e*3+1]=t[1];r[e*3+2]=t[2]}}this.setBuffer("tangent",r,3)}return this};f.Mesh.prototype.GLSetFaceBuffer=function(e){if(!this.GLfaces)this.GLfaces=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.GLfaces);e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.faces.data),e.STATIC_DRAW);this.GLfaces.itemSize=1;this.GLfaces.numItems=this.faces.data.length};f.Mesh.prototype.GLSetBuffer=
function(e,g,l,o){this.GLbuffers[g]||(this.GLbuffers[g]=e.createBuffer());e.bindBuffer(e.ARRAY_BUFFER,this.GLbuffers[g]);e.bufferData(e.ARRAY_BUFFER,new Float32Array(l),e.STATIC_DRAW);this.GLbuffers[g].itemSize=o;this.GLbuffers[g].numItems=l.length/o};f.Mesh.prototype.calcNormals=function(){var e=[],g=this.positions,l=this.faces.data;if(!l){l=[];for(var o=0;o<g.length/3;o++)l[o]=o}for(o=0;o<l.length;o+=3){var r=[g[l[o]*3],g[l[o]*3+1],g[l[o]*3+2]],s=[g[l[o+2]*3],g[l[o+2]*3+1],g[l[o+2]*3+2]],w=f.subVec3([g[l[o+
1]*3],g[l[o+1]*3+1],g[l[o+1]*3+2]],r);r=f.subVec3(s,r);w=f.toUnitVec3(f.crossVec3(w,r));if(e[l[o]]==undefined)e[l[o]]=[];e[l[o]].push(w);if(e[l[o+1]]==undefined)e[l[o+1]]=[];e[l[o+1]].push(w);if(e[l[o+2]]==undefined)e[l[o+2]]=[];e[l[o+2]].push(w)}g=[];for(o=0;o<e.length;o++){r=w=l=0;if(e[o]!=undefined){for(s=0;s<e[o].length;s++){l+=e[o][s][0];w+=e[o][s][1];r+=e[o][s][2]}l/=e[o].length;w/=e[o].length;r/=e[o].length;g[o*3]=l;g[o*3+1]=w;g[o*3+2]=r}}this.setNormals(g)};f.Mesh.prototype.GLAttributes=function(e,
g){this.normals||this.calcNormals();for(var l=0;l<8;l++)e.disableVertexAttribArray(l);if(!this.faces.GL&&this.faces.data&&this.faces.data.length>0){this.GLSetFaceBuffer(e);this.faces.GL=true}for(l=0;l<this.buffers.length;l++){if(!this.buffers[l].GL){this.GLSetBuffer(e,this.buffers[l].name,this.buffers[l].data,this.buffers[l].size);this.buffers[l].GL=true}attribslot=f.getAttribLocation(e,g,this.buffers[l].name);if(attribslot>-1){e.bindBuffer(e.ARRAY_BUFFER,this.GLbuffers[this.buffers[l].name]);e.enableVertexAttribArray(attribslot);
e.vertexAttribPointer(attribslot,this.GLbuffers[this.buffers[l].name].itemSize,e.FLOAT,false,0,0)}}};f.Light=function(e){f.Assets.registerAsset(this,e);this.color={r:1,g:1,b:1}};f.augment(f.Placeable,f.Light);f.augment(f.Animatable,f.Light);f.augment(f.QuickNotation,f.Light);f.augment(f.JSONLoader,f.Light);f.Light.prototype.className="Light";f.L_POINT=1;f.L_DIR=2;f.L_SPOT=3;f.Light.prototype.constantAttenuation=1;f.Light.prototype.linearAttenuation=0.002;f.Light.prototype.quadraticAttenuation=8.0E-4;
f.Light.prototype.spotCosCutOff=0.95;f.Light.prototype.spotPMatrix=null;f.Light.prototype.spotExponent=10;f.Light.prototype.color=null;f.Light.prototype.diffuse=true;f.Light.prototype.specular=true;f.Light.prototype.samples=0;f.Light.prototype.softness=0.01;f.Light.prototype.type=f.L_POINT;f.Light.prototype.frameBuffer=null;f.Light.prototype.renderBuffer=null;f.Light.prototype.texture=null;f.Light.prototype.bufferHeight=256;f.Light.prototype.bufferWidth=256;f.Light.prototype.shadowBias=2;f.Light.prototype.castShadows=
false;f.Light.prototype.getPMatrix=function(){if(!this.spotPMatrix){var e;e=this.scene&&this.scene.camera?this.scene.camera.far:1E3;this.spotPMatrix=f.makePerspective(Math.acos(this.spotCosCutOff)/3.14159*360,1,0.1,e)}return this.spotPMatrix};f.Light.prototype.setCastShadows=function(e){this.castShadows=e;return this};f.Light.prototype.getCastShadows=function(){return this.castShadows};f.Light.prototype.setShadowBias=function(e){this.shadowBias=e;return this};f.Light.prototype.getShadowBias=function(){return this.shadowBias};
f.Light.prototype.setShadowSamples=function(e){this.samples=e;return this};f.Light.prototype.getShadowSamples=function(){return this.samples};f.Light.prototype.setShadowSoftness=function(e){this.softness=e;return this};f.Light.prototype.getShadowSamples=function(){return this.softness};f.Light.prototype.setBufferWidth=function(e){this.bufferWidth=e;return this};f.Light.prototype.getBufferHeight=function(){return this.bufferHeight};f.Light.prototype.setBufferHeight=function(e){this.bufferHeight=e;
return this};f.Light.prototype.getBufferWidth=function(){return this.bufferWidth};f.Light.prototype.setSpotCosCutOff=function(e){this.spotPMatrix=null;this.spotCosCutOff=e;return this};f.Light.prototype.getSpotCosCutOff=function(){return this.spotCosCutOff};f.Light.prototype.setSpotExponent=function(e){this.spotExponent=e;return this};f.Light.prototype.getSpotExponent=function(){return this.spotExponent};f.Light.prototype.getAttenuation=function(){var e={};e.constant=this.constantAttenuation;e.linear=
this.linearAttenuation;e.quadratic=this.quadraticAttenuation;return e};f.Light.prototype.setAttenuation=function(e,g,l){this.constantAttenuation=e;this.linearAttenuation=g;this.quadraticAttenuation=l;return this};f.Light.prototype.setAttenuationConstant=function(e){this.constantAttenuation=e;return this};f.Light.prototype.setAttenuationLinear=function(e){this.linearAttenuation=e;return this};f.Light.prototype.setAttenuationQuadratic=function(e){this.quadraticAttenuation=e;return this};f.Light.prototype.setColor=
function(e){e=f.colorParse(e);this.color={r:e.r,g:e.g,b:e.b};return this};f.Light.prototype.setColorR=function(e){this.color.r=e;return this};f.Light.prototype.setColorG=function(e){this.color.g=e;return this};f.Light.prototype.setColorB=function(e){this.color.b=e;return this};f.Light.prototype.getColor=function(){return this.color};f.Light.prototype.getType=function(){return this.type};f.Light.prototype.setType=function(e){this.type=e;return this};f.Light.prototype.GLInit=function(e){this.gl=e;this.type==
f.L_SPOT&&!this.texture&&this.createSpotBuffer(e)};f.Light.prototype.createSpotBuffer=function(e){this.frameBuffer=e.createFramebuffer();this.renderBuffer=e.createRenderbuffer();this.texture=e.createTexture();e.bindTexture(e.TEXTURE_2D,this.texture);try{e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.bufferWidth,this.bufferHeight,0,e.RGBA,e.UNSIGNED_BYTE,null)}catch(g){var l=new Uint8Array(this.bufferWidth*this.bufferHeight*4);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.bufferWidth,this.bufferHeight,0,e.RGBA,
e.UNSIGNED_BYTE,l)}e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer);e.bindRenderbuffer(e.RENDERBUFFER,this.renderBuffer);e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,this.bufferWidth,this.bufferHeight);e.bindRenderbuffer(e.RENDERBUFFER,null);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.renderBuffer);e.bindFramebuffer(e.FRAMEBUFFER,null)};f.C_PERSPECTIVE=1;f.C_ORTHO=
2;f.Camera=function(e){f.Assets.registerAsset(this,e)};f.augment(f.Placeable,f.Camera);f.augment(f.Animatable,f.Camera);f.augment(f.QuickNotation,f.Camera);f.augment(f.JSONLoader,f.Camera);f.Camera.prototype.className="Camera";f.Camera.prototype.fovy=35;f.Camera.prototype.aspect=1;f.Camera.prototype.near=0.1;f.Camera.prototype.far=1E3;f.Camera.prototype.orthoscale=5;f.Camera.prototype.type=f.C_PERSPECTIVE;f.Camera.prototype.pMatrix=null;f.Camera.prototype.getOrthoScale=function(){if(this.type==f.C_ORTHO)return this.orthoscale;
else{f.error("You may only get a scale for a orthographic camera");return 1}};f.Camera.prototype.setOrthoScale=function(e){if(this.type==f.C_ORTHO){this.orthoscale=e;this.pMatrix=null}else f.error("You may only set a scale for a orthographic camera");return this};f.Camera.prototype.getFar=function(){return this.far};f.Camera.prototype.setFar=function(e){this.far=e;return this};f.Camera.prototype.getNear=function(){return this.near};f.Camera.prototype.setNear=function(e){this.near=e;return this};f.Camera.prototype.getType=
function(){return this.type};f.Camera.prototype.setType=function(e){if(e==f.C_PERSPECTIVE||e==f.C_ORTHO){this.type=e;this.pMatrix=null}else f.error("unsuported camera type");return this};f.Camera.prototype.getFovY=function(){if(this.type==f.C_PERSPECTIVE)return this.fovy;else{f.error("You may only get a yfov for a perspective camera");return 1}};f.Camera.prototype.setFovY=function(e){if(this.type==f.C_PERSPECTIVE){this.fovy=e;this.pMatrix=this.ymax=null}else f.error("You may only set a yfov for a perspective camera");
return this};f.Camera.prototype.getAspect=function(){if(this.type==f.C_PERSPECTIVE||this.type==f.C_ORTHO)return this.aspect;else{f.error("You may only set a aspect for a perspective or orthographic camera");return 1}};f.Camera.prototype.setAspect=function(e){if(this.type==f.C_PERSPECTIVE||this.type==f.C_ORTHO){this.aspect=e;this.pMatrix=null}else f.error("You may only set a aspect for a perspective or orthographic camera");return this};f.Camera.prototype.getProjectionMatrix=function(){if(!this.pMatrix)switch(this.type){case f.C_PERSPECTIVE:this.pMatrix=
f.makePerspective(this.fovy,this.aspect,this.near,this.far);break;case f.C_ORTHO:this.pMatrix=f.makeOrtho(-this.orthoscale*this.aspect,this.orthoscale*this.aspect,-this.orthoscale,this.orthoscale,this.near,this.far);break}return this.pMatrix};f.Camera.prototype.setProjectionMatrix=function(e){this.pMatrix=e;return this};f.Camera.prototype.updateMatrix=function(){var e=this.getPosition();e=f.translateMatrix(e.x,e.y,e.z);e=f.mulMat4(e,this.getRotMatrix());if(this.parent)e=f.mulMat4(this.parent.getModelMatrix(),
e);this.matrix=f.inverseMat4(e)};f.Camera.prototype.getViewMatrix=function(){if(!this.matrix||!this.rotmatrix)this.updateMatrix();return this.matrix};f.FOG_NONE=1;f.FOG_LINEAR=2;f.FOG_QUADRATIC=3;f.Scene=function(e){f.Assets.registerAsset(this,e);this.children=[];this.camera=new f.Camera;this.backgroundColor={r:1,g:1,b:1,a:1};this.ambientColor={r:0,g:0,b:0};this.fogColor={r:0.5,g:0.5,b:0.5};this.passes=[]};f.augment(f.Group,f.Scene);f.augment(f.QuickNotation,f.Scene);f.augment(f.JSONLoader,f.Scene);
f.Scene.prototype.camera=null;f.Scene.prototype.className="Scene";f.Scene.prototype.renderer=null;f.Scene.prototype.backgroundColor=null;f.Scene.prototype.filter=null;f.Scene.prototype.fogColor=null;f.Scene.prototype.ambientColor=null;f.Scene.prototype.fogNear=10;f.Scene.prototype.fogFar=80;f.Scene.prototype.fogType=f.FOG_NONE;f.Scene.prototype.passes=null;f.Scene.prototype.getFogType=function(){return this.fogType};f.Scene.prototype.setFogType=function(e){this.fogType=e;return this};f.Scene.prototype.getFogFar=
function(){return this.fogFar};f.Scene.prototype.setFogFar=function(e){this.fogFar=e;return this};f.Scene.prototype.getFogNear=function(){return this.fogNear};f.Scene.prototype.setFogNear=function(e){this.fogNear=e;return this};f.Scene.prototype.getFogColor=function(){return this.fogColor};f.Scene.prototype.setFogColor=function(e){e=f.colorParse(e);this.fogColor={r:e.r,g:e.g,b:e.b};return this};f.Scene.prototype.getBackgroundColor=function(){return this.backgroundColor};f.Scene.prototype.setBackgroundColor=
function(e){e=f.colorParse(e);this.backgroundColor={r:e.r,g:e.g,b:e.b,a:e.a};return this};f.Scene.prototype.getAmbientColor=function(){return this.ambientColor};f.Scene.prototype.setAmbientColor=function(e){e=f.colorParse(e);this.ambientColor={r:e.r,g:e.g,b:e.b};this.renderer&&this.renderer.gl.clearColor(this.backgroundColor.r,this.backgroundColor.g,this.backgroundColor.b,1);return this};f.Scene.prototype.setAmbientColorR=function(e){this.ambientColor.r=e;return this};f.Scene.prototype.setAmbientColorG=
function(e){this.ambientColor.g=e;return this};f.Scene.prototype.setAmbientColorB=function(e){this.ambientColor.b=e;return this};f.Scene.prototype.setCamera=function(e){if(typeof e=="string")e=f.Assets.get(e);this.camera=e;return this};f.Scene.prototype.getCamera=function(){return this.camera};f.Scene.prototype.GLInit=function(e){this.gl=e;e.lights=this.getLights();this.camera.setAspect(this.renderer.canvas.width/this.renderer.canvas.height);this.renderer.gl.clearColor(this.backgroundColor.r,this.backgroundColor.g,
this.backgroundColor.b,1);for(var g=0;g<this.children;g++)this.children[g].GLInit&&children[g].GLInit(e)};f.Scene.prototype.GLDestroy=function(){};f.Scene.sortFunc=function(e,g){return e.zdepth-g.zdepth};f.Scene.prototype.zSort=function(e,g){e=e.scene.camera.getViewMatrix();for(var l,o=0;o<g.length;o++){l=f.mulMat4(e,g[o].getModelMatrix());g[o].zdepth=l[11]}g.sort(f.Scene.sortFunc);return g};f.Scene.prototype.setFilter2d=function(e){this.filter=e;return this};f.Scene.prototype.getFilter2d=function(){return this.filter};
f.Scene.prototype.getFrameBuffer=function(e){if(this.filter)return this.filter.getFrameBuffer(e);return null};f.Scene.prototype.cull=function(e){return e};f.Scene.prototype.render=function(e){this.camera.lookAt&&this.camera.Lookat(this.camera.lookAt);this.animate();var g=e.lights;e.scene=this;e.disable(e.BLEND);this.framebuffer=this.getFrameBuffer(e);for(var l=this.getObjects(),o=0;o<g.length;o++)if(g[o].castShadows){g[o].gl||g[o].GLInit(e);e.bindFramebuffer(e.FRAMEBUFFER,g[o].frameBuffer);e.viewport(0,
0,g[o].bufferWidth,g[o].bufferHeight);e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var r=this.camera.matrix,s=this.camera.getProjectionMatrix();if(!g[o].s_cache)g[o].s_cache={};if(g[o].s_cache.pmatrix!=g[o].getPMatrix()||g[o].s_cache.mvmatrix!=g[o].getModelMatrix()){g[o].s_cache.pmatrix=g[o].getPMatrix();g[o].s_cache.mvmatrix=g[o].getModelMatrix();g[o].s_cache.imvmatrix=f.inverseMat4(g[o].getModelMatrix());g[o].s_cache.smatrix=f.mulMat4(g[o].getPMatrix(),g[o].s_cache.imvmatrix)}this.camera.setProjectionMatrix(g[o].s_cache.pmatrix);
this.camera.matrix=g[o].s_cache.imvmatrix;for(var w=0;w<l.length;w++)l[w].GLRender(e,f.RENDER_SHADOW,w);e.flush();this.camera.matrix=r;this.camera.setProjectionMatrix(s);e.bindFramebuffer(e.FRAMEBUFFER,null)}this.camera.animation&&this.camera.animate();this.getPasses(e,l);r=this.camera.matrix;s=this.camera.getProjectionMatrix();for(this.allowPasses=false;this.passes.length>0;){g=this.passes.pop();e.bindFramebuffer(e.FRAMEBUFFER,g.frameBuffer);this.camera.matrix=g.cameraMatrix;this.camera.setProjectionMatrix(g.projectionMatrix);
this.renderPass(e,l,g.width,g.height)}this.camera.matrix=r;this.camera.setProjectionMatrix(s);e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer);this.renderPass(e,l,this.renderer.canvas.width,this.renderer.canvas.height);this.applyFilter(e,l,null);this.allowPasses=true};f.Scene.prototype.getPasses=function(e,g){for(var l=0;l<g.length;l++)g[l].GLRender(e,f.RENDER_NULL)};f.Scene.prototype.renderPass=function(e,g,l,o,r){if(!r)r=f.RENDER_DEFAULT;e.clearDepth(1);e.depthFunc(e.LEQUAL);e.viewport(0,0,l,o);
e.clearColor(this.backgroundColor.r,this.backgroundColor.g,this.backgroundColor.b,this.backgroundColor.a);e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT);l=[];e.disable(e.BLEND);for(o=0;o<g.length;o++)g[o].zTrans?l.push(g[o]):g[o].GLRender(e,r);e.enable(e.BLEND);l=this.zSort(e,l);for(o=0;o<l.length;o++)l[o].GLRender(e,r)};f.Scene.prototype.applyFilter=function(e,g,l){if(this.filter&&this.filter.renderDepth){e.clearDepth(1);e.depthFunc(e.LEQUAL);e.bindFramebuffer(e.FRAMEBUFFER,
this.filter.getDepthBuffer(e));this.renderPass(e,g,this.filter.getDepthBufferWidth(),this.filter.getDepthBufferHeight(),f.RENDER_SHADOW)}if(this.filter&&this.filter.renderNormal){e.clearDepth(1);e.depthFunc(e.LEQUAL);e.bindFramebuffer(e.FRAMEBUFFER,this.filter.getNormalBuffer(e));this.renderPass(e,g,this.filter.getNormalBufferWidth(),this.filter.getNormalBufferHeight(),f.RENDER_NORMAL)}this.filter&&this.filter.GLRender(e,l)};f.Scene.prototype.addRenderPass=function(e,g,l,o,r){this.allowPasses&&this.passes.push({frameBuffer:e,
cameraMatrix:g,projectionMatrix:l,height:r,width:o});return this};f.Scene.prototype.ray=function(e,g){var l=this.renderer.gl,o=this.camera.matrix,r=this.camera.pMatrix;this.camera.matrix=f.inverseMat4(f.Mat4([g[2],g[1],g[0],e[0],g[0],g[2],g[1],e[1],g[1],g[0],g[2],e[2],0,0,0,1]));if(!this.pickPMatrix)this.pickPMatrix=f.makeOrtho(-1.0E-4,1.0E-4,-1.0E-4,1.0E-4,this.camera.near,this.camera.far);this.camera.pMatrix=this.pickPMatrix;l.viewport(0,0,8,1);l.clear(l.DEPTH_BUFFER_BIT);l.disable(l.BLEND);l.scene=
this;for(var s=this.getObjects(),w=0;w<s.length;w++)s[w].pickable&&s[w].GLRender(l,f.RENDER_PICK,w+1);l.flush();w=new Uint8Array(32);l.readPixels(0,0,8,1,l.RGBA,l.UNSIGNED_BYTE,w);var D=[w[4]/255,w[5]/255,w[6]/255],L=Math.sqrt(D[0]*D[0]+D[1]*D[1]+D[2]*D[2])*0.5;D=[D[0]/L-1,D[1]/L-1,D[2]/L-1];s=s[w[0]+w[1]*256+w[2]*65536-1];L=(w[10]/255+0.00390625*w[9]/255+1.52587890625E-5*w[8]/255)*this.camera.far;var A=[];A[0]=w[14]/255+0.00390625*w[13]/255+1.52587890625E-5*w[12]/255;A[1]=w[18]/255+0.00390625*w[17]/
255+1.52587890625E-5*w[16]/255;l.bindFramebuffer(l.FRAMEBUFFER,null);l.viewport(0,0,this.renderer.canvas.width,this.renderer.canvas.height);this.camera.matrix=o;this.camera.pMatrix=r;return{object:s,distance:L,coord:[e[0]-g[0]*L,e[1]-g[1]*L,e[2]-g[2]*L],normal:D,texture:A}};f.Scene.prototype.pick=function(e,g){if(this.camera)if(this.camera.matrix&&this.camera.pMatrix){xcoord=-(2*e/this.renderer.canvas.width-1)/this.camera.pMatrix[0];ycoord=(2*g/this.renderer.canvas.height-1)/this.camera.pMatrix[5];
zcoord=1;e=[xcoord,ycoord,zcoord,0];e=f.mulMat4Vec4(f.inverseMat4(this.camera.matrix),e);g=this.camera.getPosition();return this.ray([g.x,g.y,g.z],e)}else return false;else{f.error("No camera set for picking");return false}};f.Renderer=function(e,g){this.canvas=e;try{this.gl=e.getContext("experimental-webgl",{alpha:true,depth:true,stencil:true,antialias:true,premultipliedAlpha:true})}catch(l){}if(!this.gl){if(g)g();else{e=document.createElement("div");e.setAttribute("style","position: absolute; top: 10px; left: 10px; font-family: sans-serif; font-size: 14px; padding: 10px;background-color: #fcffcb;color: #800; width: 200px; border:2px solid #f00");
e.innerHTML="Cannot detect webgl please download a compatible browser";document.getElementsByTagName("body")[0].appendChild(e)}throw"cannot create webgl context";}try{this.gl.canvas=e}catch(o){}if(!this.gl.getProgramParameter)this.gl.getProgramParameter=this.gl.getProgrami;if(!this.gl.getShaderParameter)this.gl.getShaderParameter=this.gl.getShaderi;this.gl.uniformMatrix4fvX=this.gl.uniformMatrix4fv;this.gl.uniformMatrix4fv=function(r,s,w){s&&f.mat4gl(f.transposeMat4(w),w);this.uniformMatrix4fvX(r,
false,w)};this.gl.clearDepth(1);this.gl.clearStencil(0);this.gl.enable(this.gl.DEPTH_TEST);this.gl.depthFunc(this.gl.LEQUAL);this.gl.blendFuncSeparate(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ZERO,this.gl.ONE)};f.Renderer.prototype.gl=null;f.Renderer.prototype.scene=null;f.Renderer.prototype.getScene=function(){return this.scene};f.Renderer.prototype.setScene=function(e){e.renderer=this;this.scene=e;e.GLInit(this.gl);return this};f.Renderer.prototype.render=function(){this.scene.render(this.gl);
if(!this.rendered){this.scene.render(this.gl);this.rendered=true}};f.Texture=function(e){f.Assets.registerAsset(this,e)};f.augment(f.QuickNotation,f.Texture);f.augment(f.JSONLoader,f.Texture);f.Texture.prototype.className="Texture";f.Texture.prototype.image=null;f.Texture.prototype.glTexture=null;f.Texture.prototype.url=null;f.Texture.prototype.getSrc=function(){return this.url};f.Texture.prototype.setSrc=function(e){this.url=e;this.state=0;this.image=new Image;var g=this;this.image.onload=function(){g.state=
1};this.image.src=e;if(this.glTexture&&this.gl){this.gl.deleteTexture(this.glTexture);this.glTexture=null}return this};f.Texture.prototype.doTexture=function(e){this.gl=e;if(!this.glTexture)this.glTexture=e.createTexture();if(this.state==1){e.bindTexture(e.TEXTURE_2D,this.glTexture);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.image);e.generateMipmap(e.TEXTURE_2D);e.bindTexture(e.TEXTURE_2D,null);this.state=2}e.bindTexture(e.TEXTURE_2D,this.glTexture);e.texParameteri(e.TEXTURE_2D,
e.TEXTURE_MAG_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT);return this.state==2?true:false};f.TextureCanvas=function(e){f.Assets.registerAsset(this,e);this.canvas=document.createElement("canvas")};f.augment(f.QuickNotation,f.TextureCanvas);f.augment(f.JSONLoader,f.TextureCanvas);f.TextureCanvas.prototype.className="TextureCanvas";f.TextureCanvas.prototype.glTexture=
null;f.TextureCanvas.prototype.getCanvas=function(){return this.canvas};f.TextureCanvas.prototype.setCanvas=function(e){this.canvas=e;return this};f.TextureCanvas.prototype.setHeight=function(e){this.canvas.height=e;return this};f.TextureCanvas.prototype.setWidth=function(e){this.canvas.width=e;return this};f.TextureCanvas.prototype.getHeight=function(){return this.canvas.height};f.TextureCanvas.prototype.getWidth=function(){return this.canvas.width};f.TextureCanvas.prototype.doTexture=function(e){this.gl=
e;if(!this.glTexture)this.glTexture=e.createTexture();e.bindTexture(e.TEXTURE_2D,this.glTexture);this.updateCanvas(e);return true};f.TextureCanvas.prototype.updateCanvas=function(e){var g=this.canvas;e.bindTexture(e.TEXTURE_2D,this.glTexture);try{e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,g)}catch(l){e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,g,null)}e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR);
e.generateMipmap(e.TEXTURE_2D)};f.TextureVideo=function(e){f.Assets.registerAsset(this,e);this.video=document.createElement("video");this.video.style.display="none";this.video.setAttribute("loop","loop");this.video.autoplay=true;this.video.addEventListener("ended",function(){this.play()},true);document.getElementsByTagName("body")[0].appendChild(this.video);this.canvas=document.createElement("canvas");this.ctx=this.canvas.getContext("2d")};f.augment(f.QuickNotation,f.TextureVideo);f.augment(f.JSONLoader,
f.TextureVideo);f.TextureVideo.prototype.className="TextureVideo";f.TextureVideo.prototype.glTexture=null;f.TextureVideo.prototype.getVideo=function(){return this.video};f.TextureVideo.prototype.setVideo=function(e){this.video=e;return this};f.TextureVideo.prototype.setSrc=function(e){this.video.src=e;return this};f.TextureVideo.prototype.getSrc=function(){return this.video.src};f.TextureVideo.prototype.doTexture=function(e){this.gl=e;if(!this.glTexture)this.glTexture=e.createTexture();e.bindTexture(e.TEXTURE_2D,
this.glTexture);this.updateTexture(e);return true};f.TextureVideo.prototype.updateTexture=function(e){var g=this.video;e.bindTexture(e.TEXTURE_2D,this.glTexture);if(g.readyState>0){if(g.height<=0){g.style.display="";g.height=g.offsetHeight;g.width=g.offsetWidth;g.style.display="none"}this.canvas.height=g.height;this.canvas.width=g.width;this.ctx.drawImage(g,0,0);try{e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.canvas)}catch(l){e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,
this.canvas,null)}e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR);e.generateMipmap(e.TEXTURE_2D)}};f.TextureCamera=function(e){f.Assets.registerAsset(this,e)};f.augment(f.QuickNotation,f.TextureCamera);f.augment(f.JSONLoader,f.TextureCamera);f.TextureCamera.prototype.className="Texture";f.TextureCamera.prototype.texture=null;f.TextureCamera.prototype.glTexture=null;f.TextureCamera.prototype.object=null;f.TextureCamera.prototype.camera=
null;f.TextureCamera.prototype.bufferHeight=0;f.TextureCamera.prototype.bufferWidth=0;f.TextureCamera.prototype.mirrorAxis=f.NONE;f.TextureCamera.prototype.clipAxis=f.NONE;f.TextureCamera.prototype.setBufferWidth=function(e){this.bufferWidth=e;this.update=true;return this};f.TextureCamera.prototype.getBufferWidth=function(){return this.bufferWidth};f.TextureCamera.prototype.setBufferHeight=function(e){this.bufferHeight=e;this.update=true;return this};f.TextureCamera.prototype.getBufferHeight=function(){return this.bufferHeight};
f.TextureCamera.prototype.setClipAxis=function(e){this.clipAxis=e;return this};f.TextureCamera.prototype.getClipAxis=function(){return this.clipAxis};f.TextureCamera.prototype.setMirrorAxis=function(e){this.mirrorAxis=e;return this};f.TextureCamera.prototype.getMirrorAxis=function(){return this.mirrorAxis};f.TextureCamera.prototype.setCamera=function(e){this.camera=e;return this};f.TextureCamera.prototype.getCamera=function(){return this.camera};f.TextureCamera.prototype.doTexture=function(e,g){if(this.camera){this.gl=
e;var l=g.getModelMatrix();g=e.scene.camera.getProjectionMatrix();var o=this.camera.getViewMatrix(),r;if(this.mirrorAxis)switch(this.mirrorAxis){case f.XAXIS:r=f.mulMat4(f.mulMat4(f.mulMat4(o,l),f.scaleMatrix(-1,1,1)),f.inverseMat4(l));break;case f.YAXIS:r=f.mulMat4(f.mulMat4(f.mulMat4(o,l),f.scaleMatrix(1,-1,1)),f.inverseMat4(l));break;case f.ZAXIS:r=f.mulMat4(f.mulMat4(f.mulMat4(o,l),f.scaleMatrix(1,1,-1)),f.inverseMat4(l));break}else r=o;if(this.clipAxis){var s;switch(this.clipAxis){case f.NEG_XAXIS:s=
f.toUnitVec3([-l[0],-l[4],-l[8]]);s=[s[0],s[1],s[2],-f.dotVec3([l[3],l[7],l[11]],s)];break;case f.POS_XAXIS:s=f.toUnitVec3([l[0],l[4],l[8]]);s=[s[0],s[1],s[2],-f.dotVec3([l[3],l[7],l[11]],s)];break;case f.NEG_YAXIS:s=f.toUnitVec3([-l[1],-l[5],-l[9]]);s=[s[0],s[1],s[2],-f.dotVec3([l[3],l[7],l[11]],s)];break;case f.POS_YAXIS:s=f.toUnitVec3([l[1],l[5],l[9]]);s=[s[0],s[1],s[2],-f.dotVec3([l[3],l[7],l[11]],s)];break;case f.NEG_ZAXIS:s=f.toUnitVec3([-l[2],-l[6],-l[10]]);s=[s[0],s[1],s[2],-f.dotVec3([l[3],
l[7],l[11]],s)+0.001];break;case f.POS_ZAXIS:s=f.toUnitVec3([l[2],l[6],l[10]]);s=[s[0],s[1],s[2],-f.dotVec3([l[3],l[7],l[11]],s)+0.001];break}l=f.transposeMat4(f.inverseMat4(f.mulMat4(g,r)));s=f.mulMat4Vec4(l,s);s=f.scaleVec4(s,g[10]);s[3]-=1;s[2]<0&&f.scaleVec4(s,-1);g=f.mulMat4([1,0,0,0,0,1,0,0,s[0],s[1],s[2],s[3],0,0,0,1],g)}s=!this.bufferHeight?e.scene.renderer.canvas.height:this.bufferHeight;l=!this.bufferWidth?e.scene.renderer.canvas.width:this.bufferWidth;if(!this.glTexture||this.update){this.createFrameBuffer(e);
e.scene.addRenderPass(this.frameBuffer,r,e.scene.camera.getProjectionMatrix(),l,s);e.bindTexture(e.TEXTURE_2D,this.glTexture);return this.update=false}else{e.bindTexture(e.TEXTURE_2D,this.glTexture);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.scene.addRenderPass(this.frameBuffer,r,g,l,s);return true}}else return false};
f.TextureCamera.prototype.registerPasses=f.TextureCamera.prototype.doTexture;f.TextureCamera.prototype.createFrameBuffer=function(e){var g=!this.bufferHeight?e.scene.renderer.canvas.height:this.bufferHeight,l=!this.bufferWidth?e.scene.renderer.canvas.width:this.bufferWidth;if(!this.frameBuffer)this.frameBuffer=e.createFramebuffer();if(!this.renderBuffer)this.renderBuffer=e.createRenderbuffer();if(!this.glTexture)this.glTexture=e.createTexture();e.bindTexture(e.TEXTURE_2D,this.glTexture);var o=new Uint8Array(l*
g*4);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,l,g,0,e.RGBA,e.UNSIGNED_BYTE,o);e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer);e.bindRenderbuffer(e.RENDERBUFFER,this.renderBuffer);e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,l,g);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.renderBuffer);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.glTexture,0);e.bindRenderbuffer(e.RENDERBUFFER,null);e.bindFramebuffer(e.FRAMEBUFFER,null);e.bindTexture(e.TEXTURE_2D,
null)};f.TextureCube=function(e){f.Assets.registerAsset(this,e)};f.augment(f.QuickNotation,f.TextureCube);f.augment(f.JSONLoader,f.TextureCube);f.TextureCube.prototype.className="TextureCube";f.TextureCube.prototype.posX=null;f.TextureCube.prototype.negX=null;f.TextureCube.prototype.posY=null;f.TextureCube.prototype.negY=null;f.TextureCube.prototype.posZ=null;f.TextureCube.prototype.negZ=null;f.TextureCube.prototype.texture=null;f.TextureCube.prototype.glTexture=null;f.TextureCube.prototype.loadState=
0;f.TextureCube.prototype.setSrc=function(e,g,l){this.url=e;this.state=0;this[g]=new Image;var o=this;this[g].onload=function(){o.loadState+=l};this[g].src=e;if(this.glTexture&&this.gl){this.gl.deleteTexture(this.glTexture);this.glTexture=null}return this};f.TextureCube.prototype.setSrcPosX=function(e){this.setSrc(e,"posX",1);return this};f.TextureCube.prototype.setSrcNegX=function(e){this.setSrc(e,"negX",2);return this};f.TextureCube.prototype.setSrcPosY=function(e){this.setSrc(e,"posY",4);return this};
f.TextureCube.prototype.setSrcNegY=function(e){this.setSrc(e,"negY",8);return this};f.TextureCube.prototype.setSrcPosZ=function(e){this.setSrc(e,"posZ",16);return this};f.TextureCube.prototype.setSrcNegZ=function(e){this.setSrc(e,"negZ",32);return this};f.TextureCube.prototype.doTexture=function(e){this.gl=e;if(!this.glTexture)this.glTexture=e.createTexture();e.bindTexture(e.TEXTURE_CUBE_MAP,this.glTexture);if(this.loadState==63&&this.state==0){e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X,0,e.RGBA,
e.RGBA,e.UNSIGNED_BYTE,this.posX);e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_X,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.negX);e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_Y,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.posY);e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.negY);e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_Z,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.posZ);e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.negZ);e.generateMipmap(e.TEXTURE_CUBE_MAP);
e.bindTexture(e.TEXTURE_CUBE_MAP,null);this.state=1}e.bindTexture(e.TEXTURE_CUBE_MAP,this.glTexture);return this.state==1?true:false};f.MaterialLayer=function(e){f.Assets.registerAsset(this,e);this.blendMode=f.BL_MIX};f.augment(f.Animatable,f.MaterialLayer);f.augment(f.QuickNotation,f.MaterialLayer);f.augment(f.JSONLoader,f.MaterialLayer);f.augment(f.Events,f.MaterialLayer);f.MaterialLayer.prototype.className="MaterialLayer";f.MaterialLayer.prototype.texture=null;f.MaterialLayer.prototype.blendMode=
null;f.MaterialLayer.prototype.mapto=f.M_COLOR;f.MaterialLayer.prototype.mapinput=f.UV1;f.MaterialLayer.prototype.scaleX=1;f.MaterialLayer.prototype.offsetX=0;f.MaterialLayer.prototype.rotX=0;f.MaterialLayer.prototype.scaleY=1;f.MaterialLayer.prototype.offsetY=0;f.MaterialLayer.prototype.rotY=0;f.MaterialLayer.prototype.scaleZ=1;f.MaterialLayer.prototype.offsetZ=0;f.MaterialLayer.prototype.rotZ=0;f.MaterialLayer.prototype.dScaleX=0;f.MaterialLayer.prototype.dOffsetX=0;f.MaterialLayer.prototype.dRotX=
0;f.MaterialLayer.prototype.dScaleY=0;f.MaterialLayer.prototype.dOffsetY=0;f.MaterialLayer.prototype.dRotY=0;f.MaterialLayer.prototype.dScaleZ=0;f.MaterialLayer.prototype.dOffsetZ=0;f.MaterialLayer.prototype.dRotZ=0;f.MaterialLayer.prototype.alpha=1;f.MaterialLayer.prototype.height=0.05;f.MaterialLayer.prototype.matrix=null;f.MaterialLayer.prototype.getMatrix=function(){if(!this.matrix){var e=this.getOffset(),g=this.getScale(),l=this.getRotation();this.matrix=f.mulMat4(f.mulMat4(f.translateMatrix(e.x,
e.y,e.z),f.scaleMatrix(g.x,g.y,g.z)),f.rotateMatrix(l.x,l.y,l.z))}return this.matrix};f.MaterialLayer.prototype.setHeight=function(e){this.height=e;return this};f.MaterialLayer.prototype.getHeight=function(){return this.height};f.MaterialLayer.prototype.setAlpha=function(e){this.alpha=e;return this};f.MaterialLayer.prototype.getAlpha=function(){return this.alpha};f.MaterialLayer.prototype.setTexture=function(e){if(typeof e=="string")e=f.Assets.get(e);this.texture=e;this.fireEvent("shaderupdate",{});
return this};f.MaterialLayer.prototype.getTexture=function(){return this.texture};f.MaterialLayer.prototype.setMapto=function(e){this.mapto=e;this.fireEvent("shaderupdate",{});return this};f.MaterialLayer.prototype.getMapto=function(){return this.mapto};f.MaterialLayer.prototype.setMapinput=function(e){this.mapinput=e;this.fireEvent("shaderupdate",{});return this};f.MaterialLayer.prototype.getMapinput=function(){return this.mapinput};f.MaterialLayer.prototype.getOffset=function(){var e={};e.x=parseFloat(this.getOffsetX())+
parseFloat(this.getDOffsetX());e.y=parseFloat(this.getOffsetY())+parseFloat(this.getDOffsetY());e.z=parseFloat(this.getOffsetZ())+parseFloat(this.getDOffsetZ());return e};f.MaterialLayer.prototype.getRotation=function(){var e={};e.x=parseFloat(this.getRotX())+parseFloat(this.getDRotX());e.y=parseFloat(this.getRotY())+parseFloat(this.getDRotY());e.z=parseFloat(this.getRotZ())+parseFloat(this.getDRotZ());return e};f.MaterialLayer.prototype.getScale=function(){var e={};e.x=parseFloat(this.getScaleX())+
parseFloat(this.getDScaleX());e.y=parseFloat(this.getScaleY())+parseFloat(this.getDScaleY());e.z=parseFloat(this.getScaleZ())+parseFloat(this.getDScaleZ());return e};f.MaterialLayer.prototype.setOffsetX=function(e){this.matrix=null;this.offsetX=e;return this};f.MaterialLayer.prototype.getOffsetX=function(){return this.offsetX};f.MaterialLayer.prototype.setOffsetY=function(e){this.matrix=null;this.offsetY=e;return this};f.MaterialLayer.prototype.getOffsetY=function(){return this.offsetY};f.MaterialLayer.prototype.setOffsetZ=
function(e){this.matrix=null;this.offsetZ=e;return this};f.MaterialLayer.prototype.getOffsetZ=function(){return this.offsetZ};f.MaterialLayer.prototype.setDOffsetX=function(e){this.matrix=null;this.dOffsetX=e;return this};f.MaterialLayer.prototype.getDOffsetX=function(){return this.dOffsetX};f.MaterialLayer.prototype.setDOffsetY=function(e){this.matrix=null;this.dOffsetY=e;return this};f.MaterialLayer.prototype.getDOffsetY=function(){return this.dOffsetY};f.MaterialLayer.prototype.setDOffsetZ=function(e){this.matrix=
null;this.dOffsetZ=e;return this};f.MaterialLayer.prototype.getDOffsetZ=function(){return this.dOffsetZ};f.MaterialLayer.prototype.setScaleX=function(e){this.matrix=null;this.scaleX=e;return this};f.MaterialLayer.prototype.getScaleX=function(){return this.scaleX};f.MaterialLayer.prototype.setScaleY=function(e){this.matrix=null;this.scaleY=e;return this};f.MaterialLayer.prototype.getScaleY=function(){return this.scaleY};f.MaterialLayer.prototype.setScaleZ=function(e){this.matrix=null;this.scaleZ=e;
return this};f.MaterialLayer.prototype.getScaleZ=function(){return this.scaleZ};f.MaterialLayer.prototype.setDScaleX=function(e){this.matrix=null;this.dScaleX=e;return this};f.MaterialLayer.prototype.getDScaleX=function(){return this.dScaleX};f.MaterialLayer.prototype.setDScaleY=function(e){this.matrix=null;this.dScaleY=e;return this};f.MaterialLayer.prototype.getDScaleY=function(){return this.dScaleY};f.MaterialLayer.prototype.setDScaleZ=function(e){this.matrix=null;this.dScaleZ=e;return this};f.MaterialLayer.prototype.getDScaleZ=
function(){return this.dScaleZ};f.MaterialLayer.prototype.setRotX=function(e){this.matrix=null;this.rotX=e;return this};f.MaterialLayer.prototype.getRotX=function(){return this.rotX};f.MaterialLayer.prototype.setRotY=function(e){this.matrix=null;this.rotY=e;return this};f.MaterialLayer.prototype.getRotY=function(){return this.rotY};f.MaterialLayer.prototype.setRotZ=function(e){this.matrix=null;this.rotZ=e;return this};f.MaterialLayer.prototype.getRotZ=function(){return this.rotZ};f.MaterialLayer.prototype.setDRotX=
function(e){this.matrix=null;this.dRotX=e;return this};f.MaterialLayer.prototype.getDRotX=function(){return this.dRotX};f.MaterialLayer.prototype.setDRotY=function(e){this.matrix=null;this.dRotY=e;return this};f.MaterialLayer.prototype.getDRotY=function(){return this.dRotY};f.MaterialLayer.prototype.setDRotZ=function(e){this.matrix=null;this.dRotZ=e;return this};f.MaterialLayer.prototype.getDRotZ=function(){return this.dRotZ};f.MaterialLayer.prototype.setBlendMode=function(e){this.blendMode=e;this.fireEvent("shaderupdate",
{});return this};f.MaterialLayer.prototype.getBlendMode=function(){return this.blendMode};f.Material=function(e){f.Assets.registerAsset(this,e);this.layers=[];this.layerlisteners=[];this.textures=[];this.lights=[];this.color={r:1,g:1,b:1,a:1};this.specColor={r:1,g:1,b:1};this.reflect=0.8;this.shine=10;this.specular=1;this.emit=0;this.alpha=1};f.augment(f.Animatable,f.Material);f.augment(f.QuickNotation,f.Material);f.augment(f.JSONLoader,f.Material);f.augment(f.Events,f.Material);f.M_COLOR=1;f.M_NOR=
2;f.M_ALPHA=4;f.M_SPECCOLOR=8;f.M_SPECULAR=16;f.M_SHINE=32;f.M_REFLECT=64;f.M_EMIT=128;f.M_ALPHA=256;f.M_MSKR=512;f.M_MSKG=1024;f.M_MSKB=2048;f.M_MSKA=4096;f.M_HEIGHT=8192;f.UV1=0;f.UV2=1;f.MAP_NORM=3;f.MAP_OBJ=4;f.MAP_REF=5;f.MAP_ENV=6;f.MAP_VIEW=7;f.BL_MIX=0;f.BL_MUL=1;f.Material.prototype.layers=null;f.Material.prototype.className="Material";f.Material.prototype.textures=null;f.Material.prototype.color=null;f.Material.prototype.specColor=null;f.Material.prototype.specular=null;f.Material.prototype.emit=
null;f.Material.prototype.shine=null;f.Material.prototype.reflect=null;f.Material.prototype.lights=null;f.Material.prototype.alpha=null;f.Material.prototype.shadow=true;f.Material.prototype.setShadow=function(e){this.shadow=e;this.fireEvent("shaderupdate",{});return this};f.Material.prototype.getShadow=function(){return this.shadow};f.Material.prototype.setColor=function(e){e.r||(e=f.colorParse(e));this.color={r:e.r,g:e.g,b:e.b};this.fireEvent("shaderupdate",{});return this};f.Material.prototype.setColorR=
function(e){this.color.r=e;this.fireEvent("shaderupdate",{});return this};f.Material.prototype.setColorG=function(e){this.color.g=e;this.fireEvent("shaderupdate",{});return this};f.Material.prototype.setColorB=function(e){this.color.b=e;this.fireEvent("shaderupdate",{});return this};f.Material.prototype.getColor=function(){return this.color};f.Material.prototype.setSpecularColor=function(e){e.r||(e=f.colorParse(e));this.specColor={r:e.r,g:e.g,b:e.b};this.fireEvent("shaderupdate",{});return this};
f.Material.prototype.getSpecularColor=function(){return this.specColor};f.Material.prototype.setAlpha=function(e){this.alpha=e;this.fireEvent("shaderupdate",{});return this};f.Material.prototype.getAlpha=function(){return this.alpha};f.Material.prototype.setSpecular=function(e){this.specular=e;this.fireEvent("shaderupdate",{});return this};f.Material.prototype.getSpecular=function(){return this.specular};f.Material.prototype.setShininess=function(e){this.shine=e;this.fireEvent("shaderupdate",{});
return this};f.Material.prototype.getShininess=function(){return this.shine};f.Material.prototype.setEmit=function(e){this.emit=e;this.fireEvent("shaderupdate",{});return this};f.Material.prototype.getEmit=function(){return this.emit};f.Material.prototype.setReflectivity=function(e){this.reflect=e;this.fireEvent("shaderupdate",{});return this};f.Material.prototype.getReflectivity=function(){return this.reflect};f.Material.prototype.addMaterialLayer=function(e){if(typeof e=="string")e=f.Assets.get(e);
this.layers.push(e);var g=this,l=function(){g.fireEvent("shaderupdate",{})};this.layerlisteners.push(l);e.addEventListener("shaderupdate",l);this.fireEvent("shaderupdate",{});return this};f.Material.prototype.removeMaterialLayer=function(e){var g=this.layers.indexOf(e);if(g>=0){this.layers.splice(g,1);e.removeEventListener("shaderupdate",this.layerlisteners[g]);this.layerlisteners.splice(g,1);this.fireEvent("shaderupdate",{})}return this};f.Material.prototype.getLayers=function(){return this.layers};
f.Material.prototype.getLayerCoords=function(){var e=[];e.push("vec4 texturePos;\n");for(i=0;i<this.layers.length;i++){e.push("textureCoords"+i+"=vec3(0.0,0.0,0.0);\n");if(this.layers[i].mapinput==f.UV1||this.layers[i].mapinput==f.UV2)e.push("texturePos=vec4(vec2(UVCoord["+this.layers[i].mapinput*2+"],(1.0-UVCoord["+(this.layers[i].mapinput*2+1)+"])),1.0,1.0);\n");this.layers[i].mapinput==f.MAP_NORM&&e.push("texturePos=vec4(normalize(n.xyz),1.0);\n");this.layers[i].mapinput==f.MAP_OBJ&&e.push("texturePos=vec4(normalize(OBJCoord.xyz),1.0);\n");
this.layers[i].mapinput==f.MAP_REF&&e.push("texturePos=vec4(reflect(normalize(eyevec.xyz),normalize(n.xyz)),1.0);\n");this.layers[i].mapinput==f.MAP_ENV&&e.push("texturePos=envMat * vec4(reflect(normalize(eyevec.xyz),normalize(n.xyz)),1.0);\n");e.push("textureCoords"+i+"=(layer"+i+"Matrix * texturePos).xyz;\n")}return e.join("")};f.Material.prototype.getVertexVarying=function(){var e=[];for(i=0;i<this.layers.length;i++){e.push("uniform mat4 layer"+i+"Matrix;\n");e.push("varying vec3 textureCoords"+
i+";\n")}return e.join("")};f.Material.prototype.registerPasses=function(e,g){for(var l=0;l<this.textures.length;l++)this.textures[l].registerPasses&&this.textures[l].registerPasses(e,g)};f.Material.prototype.getFragmentShader=function(e){for(var g="#ifdef GL_ES\nprecision mediump float;\n#endif\n",l=false,o=0;o<e.length;o++)if(e[o].type==f.L_POINT||e[o].type==f.L_SPOT||e[o].type==f.L_DIR){g=g+"varying vec3 lightvec"+o+";\n";g=g+"varying vec3 tlightvec"+o+";\n";g=g+"varying vec3 lightpos"+o+";\n";
g=g+"varying vec3 tlightdir"+o+";\n";g=g+"varying float lightdist"+o+";\n";g=g+"varying vec2 spotCoords"+o+";\n"}g+="varying vec3 n;\n";g+="varying vec3 b;\n";g+="varying vec3 t;\n";g+="varying vec4 UVCoord;\n";g+="varying vec3 eyevec;\n";g+="varying vec3 OBJCoord;\n";g+="varying vec3 teyevec;\n";for(o=0;o<this.textures.length;o++){if(this.textures[o].className=="Texture")g=g+"uniform sampler2D TEXTURE"+o+";\n";if(this.textures[o].className=="TextureCanvas")g=g+"uniform sampler2D TEXTURE"+o+";\n";
if(this.textures[o].className=="TextureVideo")g=g+"uniform sampler2D TEXTURE"+o+";\n";if(this.textures[o].className=="TextureCube")g=g+"uniform samplerCube TEXTURE"+o+";\n"}var r=0,s=[],w;for(o=0;o<e.length;o++){g=g+"uniform vec3 lightcolor"+o+";\n";g=g+"uniform vec3 lightAttenuation"+o+";\n";g=g+"uniform float spotCosCutOff"+o+";\n";g=g+"uniform float spotExp"+o+";\n";g=g+"uniform vec3 lightdir"+o+";\n";g=g+"uniform mat4 lightmat"+o+";\n";g=g+"uniform float shadowbias"+o+";\n";g=g+"uniform int shadowsamples"+
o+";\n";g=g+"uniform float shadowsoftness"+o+";\n";g=g+"uniform bool castshadows"+o+";\n";g=g+"varying vec4 spotcoord"+o+";\n";if(e[o].getCastShadows()&&this.shadow){w=this.textures.length+r++;g=g+"uniform sampler2D TEXTURE"+w+";\n";s[o]=w}}for(o=0;o<this.layers.length;o++){g=g+"varying vec3 textureCoords"+o+";\n";g=g+"uniform float layeralpha"+o+";\n";if((this.layers[o].mapto&f.M_HEIGHT)==f.M_HEIGHT)g=g+"uniform float layerheight"+o+";\n"}g+="uniform vec4 baseColor;\n";g+="uniform vec3 specColor;\n";
g+="uniform float shine;\n";g+="uniform float specular;\n";g+="uniform float reflective;\n";g+="uniform float emit;\n";g+="uniform float alpha;\n";g+="uniform vec3 amb;\n";g+="uniform float fognear;\n";g+="uniform float fogfar;\n";g+="uniform int fogtype;\n";g+="uniform vec3 fogcolor;\n";g+="uniform float far;\n";g+="uniform mat4 worldInverseTranspose;\n";g+="uniform mat4 projection;\n";g+="void main(void)\n";g+="{\n";g+="float att;\n";g+="int texture;\n";g+="float mask=1.0;\n";g+="float spec=specular;\n";
g+="vec3 specC=specColor;\n";g+="vec4 view;\n";g+="vec3 textureCoords=vec3(0.0,0.0,0.0);\n";g+="float ref=reflective;\n";g+="float sh=shine;\n";g+="float em=emit;\n";g+="float al=alpha;\n";g+="vec4 normalmap= vec4(n,0.0);\n";g+="vec4 color = baseColor;";g+="float pheight=0.0;\n";g+="vec3 textureHeight=vec3(0.0,0.0,0.0);\n";for(o=0;o<this.layers.length;o++){g=g+"textureCoords=textureCoords"+o+"+textureHeight;\n";g=g+"mask=layeralpha"+o+"*mask;\n";if(this.layers[o].mapinput==f.MAP_VIEW){g+="view=projection * vec4(-eyevec,1.0);\n";
g+="textureCoords=view.xyz/view.w*0.5+0.5;\n";g+="textureCoords=textureCoords+textureHeight;\n"}if(this.layers[o].getTexture().className=="Texture"||this.layers[o].getTexture().className=="TextureCanvas"||this.layers[o].getTexture().className=="TextureVideo"){r="xy";w="2D"}else{r="xyz";w="Cube"}if((this.layers[o].mapto&f.M_COLOR)==f.M_COLOR)g=this.layers[o].blendMode==f.BL_MUL?g+"color = color*(1.0-mask) + color*texture"+w+"(TEXTURE"+this.layers[o].texture.idx+", textureCoords."+r+")*mask;\n":g+"color = color*(1.0-mask) + texture"+
w+"(TEXTURE"+this.layers[o].texture.idx+", textureCoords."+r+")*mask;\n";if((this.layers[o].mapto&f.M_HEIGHT)==f.M_HEIGHT){g=g+"pheight = texture2D(TEXTURE"+this.layers[o].texture.idx+", textureCoords."+r+").x;\n";g=g+"textureHeight =vec3((layerheight"+o+"* (pheight-0.5)  * normalize(teyevec).xy*vec2(1.0,-1.0)),0.0);\n"}if((this.layers[o].mapto&f.M_SPECCOLOR)==f.M_SPECCOLOR)g=g+"specC = specC*(1.0-mask) + texture"+w+"(TEXTURE"+this.layers[o].texture.idx+", textureCoords."+r+").rgb*mask;\n";if((this.layers[o].mapto&
f.M_MSKR)==f.M_MSKR)g=g+"mask = texture"+w+"(TEXTURE"+this.layers[o].texture.idx+", textureCoords."+r+").r;\n";if((this.layers[o].mapto&f.M_MSKG)==f.M_MSKG)g=g+"mask = texture"+w+"(TEXTURE"+this.layers[o].texture.idx+", textureCoords."+r+").g;\n";if((this.layers[o].mapto&f.M_MSKB)==f.M_MSKB)g=g+"mask = texture"+w+"(TEXTURE"+this.layers[o].texture.idx+", textureCoords."+r+").b;\n";if((this.layers[o].mapto&f.M_MSKA)==f.M_MSKA)g=g+"mask = texture"+w+"(TEXTURE"+this.layers[o].texture.idx+", textureCoords."+
r+").a;\n";if((this.layers[o].mapto&f.M_SPECULAR)==f.M_SPECULAR)g=g+"spec = spec*(1.0-mask) + texture"+w+"(TEXTURE"+this.layers[o].texture.idx+", textureCoords."+r+").r*mask;\n";if((this.layers[o].mapto&f.M_REFLECT)==f.M_REFLECT)g=g+"ref = ref*(1.0-mask) + texture"+w+"(TEXTURE"+this.layers[o].texture.idx+", textureCoords."+r+").g*mask;\n";if((this.layers[o].mapto&f.M_SHINE)==f.M_SHINE)g=g+"sh = sh*(1.0-mask) + texture"+w+"(TEXTURE"+this.layers[o].texture.idx+", textureCoords."+r+").b*mask*255.0;\n";
if((this.layers[o].mapto&f.M_EMIT)==f.M_EMIT)g=g+"em = em*(1.0-mask) + texture"+w+"(TEXTURE"+this.layers[o].texture.idx+", textureCoords."+r+").r*mask;\n";if((this.layers[o].mapto&f.M_NOR)==f.M_NOR){g=g+"normalmap = normalmap*(1.0-mask) + texture"+w+"(TEXTURE"+this.layers[o].texture.idx+", textureCoords."+r+")*mask;\n";l=true}if((this.layers[o].mapto&f.M_ALPHA)==f.M_ALPHA)g=g+"al = al*(1.0-mask) + texture"+w+"(TEXTURE"+this.layers[o].texture.idx+", textureCoords."+r+").a*mask;\n"}g+=l?"vec3 normal = normalize(normalmap.rgb)*2.0-1.0;\n":
"vec3 normal = normalize(n);\n";g+="vec3 lightvalue=amb;\n";g+="vec3 specvalue=vec3(0.0,0.0,0.0);\n";g+="float dotN,spotEffect;";g+="vec3 lightvec=vec3(0.0,0.0,0.0);";g+="vec3 viewvec=vec3(0.0,0.0,0.0);";g+="float spotmul=0.0;";g+="float spotsampleX=0.0;";g+="float spotsampleY=0.0;";g+="float totalweight=0.0;";g+="int cnt=0;";g+="vec2 spotoffset=vec2(0.0,0.0);";for(o=0;o<e.length;o++){if(l){g=g+"lightvec=tlightvec"+o+"*vec3(-1.0,-1.0,1.0);\n";g+="normal.z=(normal.z+1.0)/2.0;\n";g+="viewvec=teyevec*vec3(-1.0,-1.0,1.0);\n"}else{g=
g+"lightvec=lightvec"+o+";\n";g+="viewvec=eyevec;\n"}if(e[o].type==f.L_POINT){g+="dotN=max(dot(normal,normalize(-lightvec)),0.0);\n";g+="if(dotN>0.0){\n";g=g+"att = 1.0 / (lightAttenuation"+o+"[0] + lightAttenuation"+o+"[1] * lightdist"+o+" + lightAttenuation"+o+"[2] * lightdist"+o+" * lightdist"+o+");\n";if(e[o].diffuse)g=g+"lightvalue += att * dotN * lightcolor"+o+";\n";if(e[o].specular)g=g+"specvalue += att * specC * lightcolor"+o+" * spec  * pow(max(dot(reflect(normalize(lightvec), normal),normalize(viewvec)),0.0), sh);\n";
g+="}\n"}g+="spotEffect = 0.0;\n";if(e[o].type==f.L_SPOT){g=g+"spotEffect = dot(normalize(lightdir"+o+"), normalize(-lightvec"+o+"));";g=g+"if (spotEffect > spotCosCutOff"+o+") {\n";g=g+"spotEffect = pow(spotEffect, spotExp"+o+");";if(e[o].getCastShadows()&&this.shadow){g=g+"if(castshadows"+o+"){\n";g=g+"vec4 dist=texture2D(TEXTURE"+s[o]+", (((spotcoord"+o+".xy)/spotcoord"+o+".w)+1.0)/2.0);\n";g+="float depth = dot(dist, vec4(0.000000059604644775390625,0.0000152587890625,0.00390625,1.0))*10000.0;\n";
g+="spotmul=0.0;\n";g+="totalweight=0.0;\n";g=g+"if((depth+shadowbias"+o+"-length(lightvec"+o+"))<0.0) {spotmul=1.0; totalweight=1.0;}\n";g=g+"if(shadowsamples"+o+">0){\n";g+="for(cnt=0; cnt<4; cnt++){;\n";g+="spotsampleX=-0.707106781;spotsampleY=-0.707106781;\n";g+="if(cnt==0 || cnt==3) spotsampleX=0.707106781;\n";g+="if(cnt==1 || cnt==3) spotsampleY=0.707106781;\n";g+="spotoffset=vec2(spotsampleX,spotsampleY)*0.5;\n";g=g+"dist=texture2D(TEXTURE"+s[o]+", (((spotcoord"+o+".xy)/spotcoord"+o+".w)+1.0)/2.0+spotoffset*shadowsoftness"+
o+");\n";g+="depth = dot(dist, vec4(0.000000059604644775390625,0.0000152587890625,0.00390625,1.0))*100.0;\n";g=g+"if((depth+shadowbias"+o+"-length(lightvec"+o+"))<0.0){\n";g+="spotmul+=length(spotoffset);\n";g+="}\n";g+="totalweight+=length(spotoffset);\n";g+="};\n";g+="};\n";g+="if(totalweight!=spotmul){\n";g+="spotmul=0.0;\n";g+="totalweight=0.0;\n";g=g+"for(cnt=0; cnt<shadowsamples"+o+"*2; cnt++){;\n";g=g+"spotsampleX=(fract(sin(dot(spotcoord"+o+".xy + vec2(float(cnt)),vec2(12.9898,78.233))) * 43758.5453)-0.5)*2.0;\n";
g=g+"spotsampleY=(fract(sin(dot(spotcoord"+o+".yz + vec2(float(cnt)),vec2(12.9898,78.233))) * 43758.5453)-0.5)*2.0;\n";g+="spotoffset=vec2(spotsampleX,spotsampleY);\n";g=g+"dist=texture2D(TEXTURE"+s[o]+", (((spotcoord"+o+".xy)/spotcoord"+o+".w)+1.0)/2.0+spotoffset*shadowsoftness"+o+");\n";g+="depth = dot(dist, vec4(0.000000059604644775390625,0.0000152587890625,0.00390625,1.0))*100.0;\n";g=g+"if((depth+shadowbias"+o+"-length(lightvec"+o+"))<0.0){\n";g+="spotmul+=length(spotoffset);\n";g+="}\n";g+=
"totalweight+=length(spotoffset);\n";g+="};\n";g+="}\n";g+="if(totalweight>0.0) spotEffect=spotEffect*pow(1.0-spotmul/totalweight,3.0);\n";g+="}"}g+="dotN=max(dot(normal,normalize(-lightvec)),0.0);\n";g+="if(dotN>0.0){\n";g=g+"att = spotEffect / (lightAttenuation"+o+"[0] + lightAttenuation"+o+"[1] * lightdist"+o+" + lightAttenuation"+o+"[2] * lightdist"+o+" * lightdist"+o+");\n";if(e[o].diffuse)g=g+"lightvalue += att * dotN * lightcolor"+o+";\n";if(e[o].specular)g=g+"specvalue += att * specC * lightcolor"+
o+" * spec  * pow(max(dot(reflect(normalize(lightvec), normal),normalize(viewvec)),0.0), sh);\n";g+="}\n}\n"}if(e[o].type==f.L_DIR){g+="dotN=max(dot(normal,-normalize(lightvec)),0.0);\n";g+="if(dotN>0.0){\n";if(e[o].diffuse)g=g+"lightvalue += dotN * lightcolor"+o+";\n";if(e[o].specular)g=g+"specvalue += specC * lightcolor"+o+" * spec  * pow(max(dot(reflect(normalize(lightvec), normal),normalize(viewvec)),0.0), sh);\n";g+="}\n"}}g+="float fogfact=1.0;";g=g+"if(fogtype=="+f.FOG_QUADRATIC+") fogfact=clamp(pow(max((fogfar - length(eyevec)) / (fogfar - fognear),0.0),2.0),0.0,1.0);\n";
g=g+"if(fogtype=="+f.FOG_LINEAR+") fogfact=clamp((fogfar - length(eyevec)) / (fogfar - fognear),0.0,1.0);\n";g+="lightvalue = (lightvalue)*ref;\n";g+="if(em>0.0){lightvalue=vec3(1.0,1.0,1.0);  fogfact=1.0;}\n";g+="gl_FragColor =vec4(specvalue.rgb+color.rgb*(em+1.0)*lightvalue.rgb,al)*fogfact+vec4(fogcolor,al)*(1.0-fogfact);\n";g+="}\n";return g};f.Material.prototype.textureUniforms=function(e,g,l,o){this.animation&&this.animate();if(g.caches.baseColor!=this.color){e.uniform4f(f.getUniformLocation(e,
g,"baseColor"),this.color.r,this.color.g,this.color.b,this.color.a);g.caches.baseColor=this.color}if(g.caches.specColor!=this.specColor){e.uniform3f(f.getUniformLocation(e,g,"specColor"),this.specColor.r,this.specColor.g,this.specColor.b);g.caches.specColor=this.specColor}if(g.caches.specular!=this.specular){e.uniform1f(f.getUniformLocation(e,g,"specular"),this.specular);g.caches.specular=this.specular}if(g.caches.shine!=this.shine){e.uniform1f(f.getUniformLocation(e,g,"shine"),this.shine);g.caches.shine=
this.shine}if(g.caches.reflect!=this.reflect){e.uniform1f(f.getUniformLocation(e,g,"reflective"),this.reflect);g.caches.reflect=this.reflect}if(g.caches.emit!=this.emit){e.uniform1f(f.getUniformLocation(e,g,"emit"),this.emit);g.caches.emit=this.emit}if(g.caches.alpha!=this.alpha){e.uniform1f(f.getUniformLocation(e,g,"alpha"),this.alpha);g.caches.alpha=this.alpha}for(var r=0,s=0,w=0;w<l.length;w++){e.uniform3f(f.getUniformLocation(e,g,"lightcolor"+w),l[w].color.r,l[w].color.g,l[w].color.b);e.uniform3f(f.getUniformLocation(e,
g,"lightAttenuation"+w),l[w].constantAttenuation,l[w].linearAttenuation,l[w].quadraticAttenuation);e.uniform1f(f.getUniformLocation(e,g,"spotCosCutOff"+w),l[w].spotCosCutOff);e.uniform1f(f.getUniformLocation(e,g,"spotExp"+w),l[w].spotExponent);e.uniform1f(f.getUniformLocation(e,g,"shadowbias"+w),l[w].shadowBias);e.uniform1i(f.getUniformLocation(e,g,"castshadows"+w),l[w].castShadows);e.uniform1i(f.getUniformLocation(e,g,"shadowsamples"+w),l[w].samples);e.uniform1f(f.getUniformLocation(e,g,"shadowsoftness"+
w),l[w].softness);if(l[w].getCastShadows()&&this.shadow&&this.emit==0){s=this.textures.length+r++;e.activeTexture(e["TEXTURE"+s]);e.bindTexture(e.TEXTURE_2D,l[w].texture);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR);e.generateMipmap(e.TEXTURE_2D);e.uniform1i(f.getUniformLocation(e,g,"TEXTURE"+s),s)}}if(!g.glarrays.layermat)g.glarrays.layermat=[];for(w=0;w<this.layers.length;w++){this.layers[w].animation&&this.layers[w].animate();
this.layers[w].getScale();this.layers[w].getOffset();if(g.glarrays.layermat[w])f.mat4gl(this.layers[w].getMatrix(),g.glarrays.layermat[w]);else g.glarrays.layermat[w]=new Float32Array(this.layers[w].getMatrix());try{e.uniformMatrix4fv(f.getUniformLocation(e,g,"layer"+w+"Matrix"),true,g.glarrays.layermat[w])}catch(D){}e.uniform1f(f.getUniformLocation(e,g,"layeralpha"+w),this.layers[w].getAlpha());e.uniform1f(f.getUniformLocation(e,g,"layerheight"+w),this.layers[w].getHeight())}for(w=0;w<this.textures.length;w++){e.activeTexture(e["TEXTURE"+
w]);this.textures[w].doTexture(e,o);e.uniform1i(f.getUniformLocation(e,g,"TEXTURE"+w),w)}};f.Material.prototype.addTexture=function(e){if(typeof e=="string")e=f.Assets.get(e);this.textures.push(e);e.idx=this.textures.length-1;this.fireEvent("shaderupdate",{});return this};f.Material.prototype.addTextureCube=f.Material.prototype.addTexture;f.Material.prototype.addTextureCamera=f.Material.prototype.addTexture;f.Material.prototype.addTextureCanvas=f.Material.prototype.addTexture;f.Material.prototype.addTextureVideo=
f.Material.prototype.addTexture;v()})(window.GLGE);define("glge/glge",function(){});if(!GLGE)var GLGE={};
(function(f){f.HeightMap=function(v,h,e,g,l,o,r,s,w){this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.canvas.width=h;this.canvas.height=e;this.minX=g;this.maxX=l;this.minY=o;this.maxY=r;this.minZ=s;this.maxZ=w;h=new Image;h.heightmap=this;h.onload=function(){this.heightmap.context.drawImage(this,0,0);this.heightmap.data=this.heightmap.context.getImageData(0,0,this.heightmap.canvas.width,this.heightmap.canvas.height).data};h.src=v};f.HeightMap.prototype.canvas=
null;f.HeightMap.prototype.context=null;f.HeightMap.prototype.minZ=null;f.HeightMap.prototype.maxZ=null;f.HeightMap.prototype.minY=null;f.HeightMap.prototype.maxY=null;f.HeightMap.prototype.minX=null;f.HeightMap.prototype.maxX=null;f.HeightMap.prototype.data=null;f.HeightMap.prototype.getPixelAt=function(v,h){return this.data?this.data[(this.canvas.width*h+v)*4]/255*(this.maxZ-this.minZ):0};f.HeightMap.prototype.getHeightAt=function(v,h){var e;if(this.lastx!=undefined&&v==this.lastx&&h==this.lasty)e=
this.lastValue;else{e=Math.round((v-this.minX)/(this.maxX-this.minX)*this.canvas.width);var g=Math.round((h-this.minY)/(this.maxY-this.minY)*this.canvas.height);this.lastValue=e=this.getPixelAt(e,g)}this.lastx=v;this.lasty=h;return e};f.KeyInput=function(){if(!document.keyStates)document.keyStates=[];document.addEventListener("keydown",this.onKeyDown,false);document.addEventListener("keyup",this.onKeyUp,false)};f.KeyInput.prototype.isKeyPressed=function(v){return document.keyStates[v]?true:false};
f.KeyInput.prototype.onKeyDown=function(v){document.keyStates[v.keyCode]=true};f.KeyInput.prototype.onKeyUp=function(v){document.keyStates[v.keyCode]=false};f.MouseInput=function(v){this.element=v;this.element.mouseX=0;this.element.mouseY=0;if(!this.element.buttonState)this.element.buttonState=[];v.addEventListener("mousemove",this.onMouseMove,false);v.addEventListener("mousedown",this.onMouseDown,false);v.addEventListener("mouseup",this.onMouseUp,false)};f.MouseInput.prototype.element=null;f.MouseInput.prototype.onMouseMove=
function(v){this.mouseX=v.clientX;this.mouseY=v.clientY};f.MouseInput.prototype.onMouseDown=function(v){this.buttonState[v.button]=true};f.MouseInput.prototype.onMouseUp=function(v){this.buttonState[v.button]=false};f.MouseInput.prototype.isButtonDown=function(v){return this.element.buttonState[v]?true:false};f.MouseInput.prototype.getMousePosition=function(){return{x:this.element.mouseX,y:this.element.mouseY}};f.MI_LEFT=0;f.MI_MIDDLE=1;f.MI_RIGHT=2;f.KI_BACKSPACE=8;f.KI_TAB=9;f.KI_ENTER=13;f.KI_SHIFT=
16;f.KI_CTRL=17;f.KI_ALT=18;f.KI_PAUSE_BREAK=19;f.KI_CAPS_LOCK=20;f.KI_ESCAPE=27;f.KI_PAGE_UP=33;f.KI_PAGE_DOWN=34;f.KI_END=35;f.KI_HOME=36;f.KI_LEFT_ARROW=37;f.KI_UP_ARROW=38;f.KI_RIGHT_ARROW=39;f.KI_DOWN_ARROW=40;f.KI_INSERT=45;f.KI_DELETE=46;f.KI_0=48;f.KI_1=49;f.KI_2=50;f.KI_3=51;f.KI_4=52;f.KI_5=53;f.KI_6=54;f.KI_7=55;f.KI_8=56;f.KI_9=57;f.KI_A=65;f.KI_B=66;f.KI_C=67;f.KI_D=68;f.KI_E=69;f.KI_F=70;f.KI_G=71;f.KI_H=72;f.KI_I=73;f.KI_J=74;f.KI_K=75;f.KI_L=76;f.KI_M=77;f.KI_N=78;f.KI_O=79;f.KI_P=
80;f.KI_Q=81;f.KI_R=82;f.KI_S=83;f.KI_T=84;f.KI_U=85;f.KI_V=86;f.KI_W=87;f.KI_X=88;f.KI_Y=89;f.KI_Z=90;f.KI_LEFT_WINDOW_KEY=91;f.KI_RIGHT_WINDOW_KEY=92;f.KI_SELECT_KEY=93;f.KI_NUMPAD_0=96;f.KI_NUMPAD_1=97;f.KI_NUMPAD_2=98;f.KI_NUMPAD_3=99;f.KI_NUMPAD_4=100;f.KI_NUMPAD_5=101;f.KI_NUMPAD_6=102;f.KI_NUMPAD_7=103;f.KI_NUMPAD_8=104;f.KI_NUMPAD_9=105;f.KI_MULTIPLY=106;f.KI_ADD=107;f.KI_SUBTRACT=109;f.KI_DECIMAL_POINT=110;f.KI_DIVIDE=111;f.KI_F1=112;f.KI_F2=113;f.KI_F3=114;f.KI_F4=115;f.KI_F5=116;f.KI_F6=
117;f.KI_F7=118;f.KI_F8=119;f.KI_F9=120;f.KI_F10=121;f.KI_F11=122;f.KI_F12=123;f.KI_NUM_LOCK=144;f.KI_SCROLL_LOCK=145;f.KI_SEMI_COLON=186;f.KI_EQUAL_SIGN=187;f.KI_COMMA=188;f.KI_DASH=189;f.KI_PERIOD=190;f.KI_FORWARD_SLASH=191;f.KI_GRAVE_ACCENT=192;f.KI_OPEN_BRACKET=219;f.KI_BACK_SLASH=220;f.KI_CLOSE_BRAKET=221;f.KI_SINGLE_QUOTE=222;f.KI_SPACE=32})(GLGE);define("glge/glge_input",function(){});GLGE||(GLGE={});
(function(f){f.ColladaDocuments=[];f.Collada=function(){this.children=[]};f.augment(f.Group,f.Collada);f.Collada.prototype.type=f.G_NODE;f.Collada.prototype.getAbsolutePath=function(v,h){if(v.substr(0,7)=="http://"||v.substr(0,7)=="file://"||v.substr(0,7)=="https://")return v;else{if(!h)h=window.location.href;var e=h.split("/");h=e[2];for(var g=e[0],l=[],o=3;o<e.length-1;o++)l.push(e[o]);if(v.substr(0,1)=="/")l=[];v=v.split("/");for(o=0;o<v.length;o++)if(v[o]=="..")l.pop();else v[o]!=""&&l.push(v[o]);
return g+"//"+h+"/"+l.join("/")}};f.Collada.prototype.getElementById=function(v){if(!this.idcache){var h=this.getElementsByTagName("*"),e;this.idcache={};for(var g=0;g<h.length;g++){e=h[g].getAttribute("id");if(e!="")this.idcache[e]=h[g]}}return this.idcache[v]};f.Collada.prototype.parseArray=function(v){v=v.firstChild;for(var h="",e=[],g,l;v;){g=(h+v.nodeValue).replace(/\s+/g," ").replace(/^\s+/g,"").split(" ");v=v.nextSibling;g[0]==""&&g.unshift();if(v)h=g.pop();for(l=0;l<g.length;l++)g[l]!=""&&
e.push(g[l])}return e};f.Collada.prototype.setDocument=function(v,h){this.url=v;if(v.indexOf("#")!=-1){this.rootId=v.substr(v.indexOf("#")+1);v=v.substr(0,v.indexOf("#"))}if(h)v=this.getAbsolutePath(v,h);this.docURL=v;if(f.ColladaDocuments[v])this.xml=f.ColladaDocuments[v];else if(h=new XMLHttpRequest){h.overrideMimeType("text/xml");var e=v,g=this;h.onreadystatechange=function(){if(this.readyState==4)if(this.status==200||this.status==0){this.responseXML.getElementById=g.getElementById;g.loaded(e,
this.responseXML)}else f.error("Error loading Document: "+e+" status "+this.status)};h.open("GET",v,true);h.send("")}};f.Collada.prototype.getSource=function(v){v=this.xml.getElementById(v);if(!v.jsArray){var h;if(v.tagName=="vertices"){h=[];for(var e=v.getElementsByTagName("input"),g=0;g<e.length;g++){h[g]=this.getSource(e[g].getAttribute("source").substr(1));h[g].block=e[g].getAttribute("semantic")}}else{g=v.getElementsByTagName("technique_common")[0].getElementsByTagName("accessor")[0];h=this.xml.getElementById(g.getAttribute("source").substr(1));
e=h.tagName;h=this.parseArray(h);stride=parseInt(g.getAttribute("stride"));(offset=parseInt(g.getAttribute("offset")))||(offset=0);stride||(stride=1);count=parseInt(g.getAttribute("count"));var l=g.getElementsByTagName("param"),o=[];for(g=0;g<l.length;g++)l[g].hasAttribute("name")?o.push({type:l[g].getAttribute("type"),name:l[g].getAttribute("name")}):o.push(false);h={array:h,stride:stride,offset:offset,count:count,pmask:o,type:e}}v.jsArray=h}return v.jsArray};f.Collada.prototype.getMeshes=function(v,
h){var e,g,l,o,r,s,w,D;o=this.xml.getElementById(v).getElementsByTagName("mesh")[0];var L=[];r=o.getElementsByTagName("polylist");for(v=0;v<r.length;v++){g=this.parseArray(r[v].getElementsByTagName("p")[0]);vcount=this.parseArray(r[v].getElementsByTagName("vcount")[0]);var A=r[v].getElementsByTagName("input"),K=0;for(e=0;e<A.length;e++)K=Math.max(K,A[e].getAttribute("offset"));s=[];for(e=A=0;e<vcount.length;e++){for(j=0;j<vcount[e]-2;j++){for(k=0;k<=K;k++)s.push(g[A+k]);for(k=0;k<=K;k++)s.push(g[A+
(K+1)*(j+1)+k]);for(k=0;k<=K;k++)s.push(g[A+(K+1)*(j+2)+k])}A+=(K+1)*vcount[e]}r[v].getElementsByTagName("p")[0].data=s}l=o.getElementsByTagName("polygons");for(v=0;v<l.length;v++){w=l[v].getElementsByTagName("p");s=[];for(D=0;D<w.length;D++){g=this.parseArray(w[D]);A=l[v].getElementsByTagName("input");for(e=K=0;e<A.length;e++)K=Math.max(K,A[e].getAttribute("offset"));for(j=A=0;j<g.length/(K+1)-2;j++){for(k=0;k<=K;k++)s.push(g[A+k]);for(k=0;k<=K;k++)s.push(g[A+(K+1)*(j+1)+k]);for(k=0;k<=K;k++)s.push(g[A+
(K+1)*(j+2)+k])}}if(w.length>0)l[v].getElementsByTagName("p")[0].data=s}K=[];s=o.getElementsByTagName("triangles");for(v=0;v<r.length;v++)K.push(r[v]);for(v=0;v<l.length;v++)l[v].getElementsByTagName("p").length>0&&K.push(l[v]);for(v=0;v<s.length;v++)K.push(s[v]);for(v=0;v<K.length;v++){g=K[v].getElementsByTagName("input");o=[];r=[];l=[];s={};for(e=0;e<g.length;e++){g[e].data=this.getSource(g[e].getAttribute("source").substr(1));w=g[e].getAttribute("semantic");if(w=="TEXCOORD"){(D=g[e].getAttribute("set"))||
(D=0);w+=D}if(w=="VERTEX")for(D=0;D<g[e].data.length;D++)s[g[e].data[D].block]=[];g[e].block=w;s[w]=[];l[g[e].getAttribute("offset")]=g[e]}g=K[v].getElementsByTagName("p")[0].data?K[v].getElementsByTagName("p")[0].data:this.parseArray(K[v].getElementsByTagName("p")[0]);for(e=0;e<l.length;e++)if(l[e].block!="VERTEX"){l[e].data=[l[e].data];l[e].data[0].block=l[e].block}for(j=0;j<g.length;j+=l.length)for(e=0;e<l.length;e++)for(D=0;D<l[e].data.length;D++){w=l[e].data[D].block;for(k=A=0;k<l[e].data[D].stride;k++)if(l[e].data[D].pmask[k]){s[w].push(l[e].data[D].array[g[j+
e]*l[e].data[D].stride+k+l[e].data[D].offset]);A++}if(h&&w=="POSITION")for(k=0;k<h.count;k++){o.push(h.vertexJoints[g[j+e]*h.count+k]);r.push(h.vertexWeight[g[j+e]*h.count+k])}w=="POSITION"&&A==1&&s[w].push(0);w=="POSITION"&&A==2&&s[w].push(0);w=="TEXCOORD0"&&A==3&&s[w].pop();w=="TEXCOORD1"&&A==3&&s[w].pop()}g=[];for(e=0;e<s.POSITION.length/3;e++)g.push(e);D=new f.Mesh;if(!s.NORMAL){s.NORMAL=[];for(e=0;e<s.POSITION.length;e+=9){l=f.subVec3([s.POSITION[e],s.POSITION[e+1],s.POSITION[e+2]],[s.POSITION[e+
3],s.POSITION[e+4],s.POSITION[e+5]]);w=f.subVec3([s.POSITION[e+6],s.POSITION[e+7],s.POSITION[e+8]],[s.POSITION[e],s.POSITION[e+1],s.POSITION[e+2]]);l=f.toUnitVec3(f.crossVec3(f.toUnitVec3(w),f.toUnitVec3(l)));s.NORMAL.push(l[0]);s.NORMAL.push(l[1]);s.NORMAL.push(l[2]);s.NORMAL.push(l[0]);s.NORMAL.push(l[1]);s.NORMAL.push(l[2]);s.NORMAL.push(l[0]);s.NORMAL.push(l[1]);s.NORMAL.push(l[2])}}D.setPositions(s.POSITION);D.setNormals(s.NORMAL);s.TEXCOORD0&&D.setUV(s.TEXCOORD0);s.TEXCOORD1&&D.setUV2(s.TEXCOORD1);
if(h){D.setJoints(h.joints);D.setInvBindMatrix(h.inverseBindMatrix);D.setVertexJoints(o,h.count);D.setVertexWeights(r,h.count)}D.setFaces(g);D.matName=K[v].getAttribute("material");L.push(D)}return L};f.Collada.prototype.getFloat4=function(v,h){v=v.getElementsByTagName("newparam");for(var e=0;e<v.length;e++)if(v[e].getAttribute("sid")==h)return v[e].getElementsByTagName("float4")[0].firstChild.nodeValue;return null};f.Collada.prototype.getFloat=function(v,h){v=v.getElementsByTagName("newparam");for(var e=
0;e<v.length;e++)if(v[e].getAttribute("sid")==h)return v[e].getElementsByTagName("float")[0].firstChild.nodeValue;return null};f.Collada.prototype.getSampler=function(v,h){v=v.getElementsByTagName("newparam");for(var e=0;e<v.length;e++)if(v[e].getAttribute("sid")==h)return v[e].getElementsByTagName("sampler2D")[0].getElementsByTagName("source")[0].firstChild.nodeValue;return null};f.Collada.prototype.getSurface=function(v,h){v=v.getElementsByTagName("newparam");for(var e=0;e<v.length;e++)if(v[e].getAttribute("sid")==
h)return v[e].getElementsByTagName("surface")[0].getElementsByTagName("init_from")[0].firstChild.nodeValue;return null};f.Collada.prototype.getImage=function(v){return this.getAbsolutePath(this.xml.getElementById(v).getElementsByTagName("init_from")[0].firstChild.nodeValue,this.docURL)};f.Collada.prototype.createMaterialLayer=function(v,h,e,g){var l;(e=this.getSurface(e,this.getSampler(e,v.getAttribute("texture"))))||(e=v.getAttribute("texture"));l=this.getImage(e);e=new f.Texture;e.setSrc(l);h.addTexture(e);
l=new f.MaterialLayer;l.setTexture(e);l.setMapto(g);l.setMapinput(f.UV1);if(v.getElementsByTagName("blend_mode")[0])var o=v.getElementsByTagName("blend_mode")[0].firstChild.nodeValue;o=="MULTIPLY"&&l.setBlendMode(f.BL_MUL);h.addMaterialLayer(l)};f.Collada.prototype.getMaterial=function(v){v=this.xml.getElementById(this.xml.getElementById(v).getElementsByTagName("instance_effect")[0].getAttribute("url").substr(1)).getElementsByTagName("profile_COMMON")[0];var h=v.getElementsByTagName("technique")[0],
e=new f.Material;e.setSpecular(0);var g,l;g=h.getElementsByTagName("diffuse");if(g.length>0){g=g[0].firstChild;do switch(g.tagName){case "color":l=g.firstChild.nodeValue.split(" ");e.setColor({r:l[0],g:l[1],b:l[2]});break;case "param":l=this.getFloat4(v,g.getAttribute("ref")).split(" ");e.setColor({r:l[0],g:l[1],b:l[2]});break;case "texture":this.createMaterialLayer(g,e,v,f.M_COLOR);break}while(g=g.nextSibling)}g=h.getElementsByTagName("bump");if(g.length>0){g=g[0].firstChild;do switch(g.tagName){case "texture":this.createMaterialLayer(g,
e,v,f.M_NOR);break}while(g=g.nextSibling)}if(h.getElementsByTagName("shininess").length>0){e.setSpecular(1);g=h.getElementsByTagName("shininess")[0].firstChild;do switch(g.tagName){case "float":parseFloat(g.firstChild.nodeValue)>1?e.setShininess(parseFloat(g.firstChild.nodeValue)):e.setShininess(parseFloat(g.firstChild.nodeValue)*128);break;case "param":l=parseFloat(this.getFloat(v,g.getAttribute("ref")));l>1?e.setShininess(l):e.setShininess(l*128);break;case "texture":this.createMaterialLayer(g,
e,v,f.M_SHINE);break}while(g=g.nextSibling)}g=h.getElementsByTagName("specular");if(g.length>0){e.setSpecular(1);g=g[0].firstChild;do switch(g.tagName){case "color":l=g.firstChild.nodeValue.split(" ");e.setSpecularColor({r:l[0],g:l[1],b:l[2]});break;case "param":l=this.getFloat4(v,g.getAttribute("ref")).split(" ");e.setSpecularColor({r:l[0],g:l[1],b:l[2]});break;case "texture":this.createMaterialLayer(g,e,v,f.M_SPECCOLOR);break}while(g=g.nextSibling)}g=h.getElementsByTagName("reflective");if(g.length>
0){g=g[0].firstChild;do switch(g.tagName){case "color":g.firstChild.nodeValue.split(" ");break;case "param":this.getFloat4(v,g.getAttribute("ref")).split(" ");break;case "texture":this.createMaterialLayer(g,e,v,f.M_REFLECT);break}while(g=g.nextSibling)}g=h.getElementsByTagName("transparency");if(g.length>0){g=g[0].firstChild;do switch(g.tagName){case "float":break;case "param":break}while(g=g.nextSibling)}g=h.getElementsByTagName("transparent");if(g.length>0){(h=g[0].getAttribute("opaque"))||(h="A_ONE");
g=g[0].firstChild;do switch(g.tagName){case "float":l=parseFloat(g.firstChild.nodeValue);if(l<1){e.setAlpha(parseFloat(g.firstChild.nodeValue));e.trans=true}break;case "color":l=g.firstChild.nodeValue.split(" ");l=this.getMaterialAlpha(l,h,1);if(l<1){e.setAlpha(l);e.trans=true}break;case "param":l=this.getFloat4(v,g.getAttribute("ref")).split(" ");l=this.getMaterialAlpha(l,h,1);if(l<1){e.setAlpha(l);e.trans=true}break;case "texture":this.createMaterialLayer(g,e,v,f.M_ALPHA);e.trans=true;break}while(g=
g.nextSibling)}return e};f.Collada.prototype.getMaterialAlpha=function(v,h,e){var g;switch(h){case "A_ONE":g=parseFloat(v[3])*e;break;case "A_ZERO":g=1-parseFloat(v[3])*e;break;case "RGB_ONE":v=parseFloat(v[0])*0.212671+parseFloat(v[1])*0.71516+parseFloat(v[2])*0.072169;g=v*e;break;case "RGB_ZERO":v=parseFloat(v[0])*0.212671+parseFloat(v[1])*0.71516+parseFloat(v[2])*0.072169;g=1-v*e;break}return g};f.Collada.prototype.getInstanceGeometry=function(v){if(v.GLGEObj){var h=new f.ObjectInstance;h.setObject(v.GLGEObj)}else{var e=
this.getMeshes(v.getAttribute("url").substr(1));h=v.getElementsByTagName("instance_material");for(var g={},l=0;l<h.length;l++){mat=this.getMaterial(h[l].getAttribute("target").substr(1));g[h[l].getAttribute("symbol")]=mat}h=new f.Object;for(l=0;l<e.length;l++){g[e[l].matName]&&g[e[l].matName].trans&&h.setZtransparent(true);var o=new f.MultiMaterial;o.setMesh(e[l]);if(!g[e[l].matName]){g[e[l].matName]=new f.Material;g[e[l].matName].setColor("lightgrey")}o.setMaterial(g[e[l].matName]);h.addMultiMaterial(o)}v.GLGEObj=
h}return h};f.Collada.prototype.getAnimationSampler=function(v){var h=this.xml.getElementById(v).getElementsByTagName("input");v={};for(var e=[],g,l,o=0;o<h.length;o++){g=this.getSource(h[o].getAttribute("source").substr(1));l=h[o].getAttribute("semantic");e.push({block:l,data:g})}for(n=0;n<e.length;n++){l=e[n].block;v[l]={};v[l].data=[];v[l].names=[];for(k=0;k<e[n].data.array.length;k+=e[n].data.stride)for(o=pcnt=0;o<e[n].data.pmask.length;o++)if(e[n].data.pmask[o]){v[l].names.push(e[n].data.pmask[o].name);
if(e[n].data.pmask[o].type=="float4x4"){v[l].stride=16;for(h=0;h<16;h++)v[l].data.push(e[n].data.array[h+k+e[n].data.offset+o])}else{pcnt++;v[l].stride=pcnt;v[l].data.push(e[n].data.array[k+e[n].data.offset+o])}}}l=[];for(o=0;o<v.OUTPUT.stride;o++)l.push(new f.AnimationCurve);for(o=0;o<v.INPUT.data.length;o++)for(h=0;h<v.OUTPUT.stride;h++){l[h].name=v.OUTPUT.names[h];if(v.INTERPOLATION.data[o]=="LINEAR"){e=new f.LinearPoint;e.setX(v.INPUT.data[o]*30);e.setY(v.OUTPUT.data[o*v.OUTPUT.stride+h]);l[h].addPoint(e)}if(v.INTERPOLATION.data[o]==
"BEZIER"){e=new f.BezTriple;e.setX1(v.IN_TANGENT.data[(o*v.OUTPUT.stride+h)*2]*30);e.setY1(v.IN_TANGENT.data[(o*v.OUTPUT.stride+h)*2+1]);e.setX2(Math.round(v.INPUT.data[o]*30));e.setY2(v.OUTPUT.data[o*v.OUTPUT.stride+h]);e.setX3(v.OUT_TANGENT.data[(o*v.OUTPUT.stride+h)*2]*30);e.setY3(v.OUT_TANGENT.data[(o*v.OUTPUT.stride+h)*2+1]);l[h].addPoint(e)}}return l};f.Collada.prototype.getAnimationVector=function(v){var h=0,e=this.xml.getElementById(v[0].target[0]),g=e.firstChild,l=[],o={};do{switch(g.tagName){case "matrix":case "translate":case "rotate":case "scale":def=
{type:g.tagName,data:this.parseArray(g),animations:[]};if(g.hasAttribute("sid"))o[g.getAttribute("sid")]=def;l.push(def);break}g=g.nextSibling}while(g);for(g=0;g<v.length;g++){var r=this.getAnimationSampler(v[g].source);for(w=0;w<r.length;w++)h=Math.max(h,r[w].keyFrames[r[w].keyFrames.length-1].x);var s=v[g].target;if(s[1].indexOf(".")!=-1){s=s[1].split(".");switch(s[1]){case "X":o[s[0]].animations[0]=r[0];break;case "Y":o[s[0]].animations[1]=r[0];break;case "Z":o[s[0]].animations[2]=r[0];break;case "ANGLE":o[s[0]].animations[3]=
r[0];break}}else if(s[1].indexOf("(")!=-1){s=s[1].split("(");sidtarget=s.shift();s=s.length>1?parseInt(s[0])+4*parseInt(s[1]):parseInt(s[0]);o[sidtarget].animations[s]=r[0]}else for(var w=0;w<r.length;w++)switch(r[w].name){case "X":o[s[1]].animations[0]=r[w];break;case "Y":o[s[1]].animations[1]=r[w];break;case "Z":o[s[1]].animations[2]=r[w];break;case "ANGLE":o[s[1]].animations[3]=r[w];break;default:o[s[1]].animations[w]=r[w];break}}v=new f.AnimationVector;v.setFrames(h);o=new f.AnimationCurve;o.setChannel("QuatX");
r=new f.AnimationCurve;r.setChannel("QuatY");s=new f.AnimationCurve;s.setChannel("QuatZ");w=new f.AnimationCurve;w.setChannel("QuatW");var D=new f.AnimationCurve;D.setChannel("LocX");var L=new f.AnimationCurve;L.setChannel("LocY");var A=new f.AnimationCurve;A.setChannel("LocZ");var K=new f.AnimationCurve;K.setChannel("ScaleX");var Y=new f.AnimationCurve;Y.setChannel("ScaleY");var aa=new f.AnimationCurve;aa.setChannel("ScaleZ");v.addAnimationCurve(o);v.addAnimationCurve(r);v.addAnimationCurve(s);v.addAnimationCurve(w);
v.addAnimationCurve(D);v.addAnimationCurve(L);v.addAnimationCurve(A);v.addAnimationCurve(K);v.addAnimationCurve(Y);v.addAnimationCurve(aa);for(var q=null,P=0;P<h;P++){var fa=f.identMatrix();for(g=0;g<l.length;g++)switch(l[g].type){case "matrix":var S=[l[g].animations[0]?l[g].animations[0].getValue(P):l[g].data[0],l[g].animations[1]?l[g].animations[1].getValue(P):l[g].data[1],l[g].animations[2]?l[g].animations[2].getValue(P):l[g].data[2],l[g].animations[3]?l[g].animations[3].getValue(P):l[g].data[3],
l[g].animations[4]?l[g].animations[4].getValue(P):l[g].data[4],l[g].animations[5]?l[g].animations[5].getValue(P):l[g].data[5],l[g].animations[6]?l[g].animations[6].getValue(P):l[g].data[6],l[g].animations[7]?l[g].animations[7].getValue(P):l[g].data[7],l[g].animations[8]?l[g].animations[8].getValue(P):l[g].data[8],l[g].animations[9]?l[g].animations[9].getValue(P):l[g].data[9],l[g].animations[10]?l[g].animations[10].getValue(P):l[g].data[10],l[g].animations[11]?l[g].animations[11].getValue(P):l[g].data[11],
l[g].animations[12]?l[g].animations[12].getValue(P):l[g].data[12],l[g].animations[13]?l[g].animations[13].getValue(P):l[g].data[13],l[g].animations[14]?l[g].animations[14].getValue(P):l[g].data[14],l[g].animations[15]?l[g].animations[15].getValue(P):l[g].data[15]];fa=f.mulMat4(fa,f.Mat4(S));break;case "rotate":S=[l[g].animations[0]?l[g].animations[0].getValue(P):l[g].data[0],l[g].animations[1]?l[g].animations[1].getValue(P):l[g].data[1],l[g].animations[2]?l[g].animations[2].getValue(P):l[g].data[2],
l[g].animations[3]?l[g].animations[3].getValue(P):l[g].data[3]];fa=f.mulMat4(fa,f.angleAxis(S[3]*0.017453278,[S[0],S[1],S[2]]));break;case "translate":S=[l[g].animations[0]?l[g].animations[0].getValue(P):l[g].data[0],l[g].animations[1]?l[g].animations[1].getValue(P):l[g].data[1],l[g].animations[2]?l[g].animations[2].getValue(P):l[g].data[2]];fa=f.mulMat4(fa,f.translateMatrix(S[0],S[1],S[2]));break;case "scale":S=[l[g].animations[0]?l[g].animations[0].getValue(P):l[g].data[0],l[g].animations[1]?l[g].animations[1].getValue(P):
l[g].data[1],l[g].animations[2]?l[g].animations[2].getValue(P):l[g].data[2]];fa=f.mulMat4(fa,f.scaleMatrix(S[0],S[1],S[2]));break}scale=f.matrix2Scale(fa);fa=f.mulMat4(fa,f.scaleMatrix(1/scale[0],1/scale[1],1/scale[2]));quat=f.rotationMatrix2Quat(fa);if(q)if(q[0]*quat[0]+q[1]*quat[1]+q[2]*quat[2]+q[3]*quat[3]<0){quat[0]*=-1;quat[1]*=-1;quat[2]*=-1;quat[3]*=-1}q=quat;point=new f.LinearPoint;point.setX(P);point.setY(quat[0]);o.addPoint(point);point=new f.LinearPoint;point.setX(P);point.setY(quat[1]);
r.addPoint(point);point=new f.LinearPoint;point.setX(P);point.setY(quat[2]);s.addPoint(point);point=new f.LinearPoint;point.setX(P);point.setY(quat[3]);w.addPoint(point);point=new f.LinearPoint;point.setX(P);point.setY(fa[3]);D.addPoint(point);point=new f.LinearPoint;point.setX(P);point.setY(fa[7]);L.addPoint(point);point=new f.LinearPoint;point.setX(P);point.setY(fa[11]);A.addPoint(point);point=new f.LinearPoint;point.setX(P);point.setY(scale[0]);K.addPoint(point);point=new f.LinearPoint;point.setX(P);
point.setY(scale[1]);Y.addPoint(point);point=new f.LinearPoint;point.setX(P);point.setY(scale[2]);aa.addPoint(point)}for(g=0;g<e.GLGEObjects.length;g++){e.GLGEObjects[g].setAnimation(v);e.GLGEObjects[g].animationStart=0;e.GLGEObjects[g].setFrameRate(30)}return v};f.Collada.prototype.getAnimations=function(){new f.Action;for(var v=this.xml.getElementsByTagName("animation"),h,e,g,l={},o=0;o<v.length;o++){h=v[o].getElementsByTagName("channel");for(var r=0;r<h.length;r++){e=h[r].getAttribute("target").split("/");
g=h[r].getAttribute("source").substr(1);l[e[0]]||(l[e[0]]=[]);l[e[0]].push({source:g,target:e})}}for(e in l)this.getAnimationVector(l[e])};f.Collada.prototype.getInstanceController=function(v){var h=new f.Object,e=this.xml.getElementById(v.getAttribute("url").substr(1)),g=v.getElementsByTagName("skeleton"),l=e.getElementsByTagName("joints")[0],o=l.getElementsByTagName("input"),r;r=e.getElementsByTagName("bind_shape_matrix").length>0?this.parseArray(e.getElementsByTagName("bind_shape_matrix")[0]):
f.identMatrix();var s=[r];l=[new f.Group];for(var w,D=0;D<o.length;D++){if(o[D].getAttribute("semantic")=="INV_BIND_MATRIX")for(var L=this.getSource(o[D].getAttribute("source").substr(1)),A=0;A<L.array.length;A+=L.stride){w=L.array.slice(A,A+16);s.push(f.mulMat4(f.Mat4(w),f.Mat4(r.slice(0,16))))}if(o[D].getAttribute("semantic")=="JOINT"){L=this.getSource(o[D].getAttribute("source").substr(1));if(L.type=="IDREF_array")for(A=0;A<L.array.length;A+=L.stride)l.push(this.getNode(this.xml.getElementById(L.array[A]),
true));else if(L.type=="Name_array"){var K={},Y;if(g.length==0){var aa=this.xml.getElementsByTagName("node");for(A=0;A<aa.length;A++)if(Y=aa[A].getAttribute("sid"))K[Y]=aa[A]}else for(w=0;w<g.length;w++){A=this.xml.getElementById(g[w].firstChild.nodeValue.substr(1));if(Y=A.getAttribute("sid"))K[Y]=A;aa=A.getElementsByTagName("*");for(A=0;A<aa.length;A++)if(Y=aa[A].getAttribute("sid"))K[Y]=aa[A]}for(A=0;A<L.array.length;A+=L.stride)L.array[A]!=""&&l.push(this.getNode(K[L.array[A]],true))}}}D=e.getElementsByTagName("vertex_weights")[0];
o=D.getElementsByTagName("input");inputArray=[];outputData={};for(w=0;w<o.length;w++){g=o[w].getAttribute("semantic");o[w].data=this.getSource(o[w].getAttribute("source").substr(1));o[w].block=g;outputData[g]=[];inputArray[o[w].getAttribute("offset")]=o[w]}o=this.parseArray(D.getElementsByTagName("vcount")[0]);r=this.parseArray(D.getElementsByTagName("v")[0]);for(D=L=0;D<o.length;D++)if(o[D])L=Math.max(L,parseInt(o[D]));for(D=vPointer=0;D<o.length;D++){for(K=0;K<o[D];K++)for(A=0;A<inputArray.length;A++){g=
inputArray[A].block;for(w=0;w<inputArray[A].data.stride;w++)if(inputArray[A].data.pmask[w]){g!="JOINT"?outputData[g].push(inputArray[A].data.array[parseInt(r[vPointer])+parseInt(inputArray[A].data.offset)]):outputData[g].push(parseInt(r[vPointer]));vPointer++}}for(K=K;K<L;K++)for(A=0;A<inputArray.length;A++){g=inputArray[A].block;outputData[g].push(0)}}for(D=0;D<outputData.JOINT.length;D++)outputData.JOINT[D]++;D={vertexJoints:outputData.JOINT,vertexWeight:outputData.WEIGHT,joints:l,inverseBindMatrix:s,
count:L};e=this.getMeshes(e.getElementsByTagName("skin")[0].getAttribute("source").substr(1),D);l=v.getElementsByTagName("instance_material");v={};for(D=0;D<l.length;D++){w=this.getMaterial(l[D].getAttribute("target").substr(1));v[l[D].getAttribute("symbol")]=w}for(D=0;D<e.length;D++){l=new f.MultiMaterial;l.setMesh(e[D]);if(v[e[D].matName]){v[e[D].matName].trans&&h.setZtransparent(true);l.setMaterial(v[e[D].matName])}else{s=new f.Material;l.setMaterial(s)}h.addMultiMaterial(l)}return h};f.Collada.prototype.getNode=
function(v,h){if(!h&&v.GLGEObject){e=v.GLGEObject;delete this.GLGEObject;return e}if(h&&v.GLGEObjects)return v.GLGEObjects[0];var e=new f.Group;if(!v.GLGEObjects)v.GLGEObjects=[];v.GLGEObjects.push(e);var g=v.firstChild,l=f.identMatrix(),o;do switch(g.tagName){case "node":e.addGroup(this.getNode(g));break;case "instance_node":e.addGroup(this.getNode(this.xml.getElementById(g.getAttribute("url").substr(1))));break;case "instance_visual_scene":e.addGroup(this.getNode(this.xml.getElementById(g.getAttribute("url").substr(1))));
break;case "instance_geometry":e.addObject(this.getInstanceGeometry(g));break;case "instance_controller":e.addObject(this.getInstanceController(g));break;case "matrix":l=this.parseArray(g);break;case "translate":o=this.parseArray(g);l=f.mulMat4(l,f.translateMatrix(o[0],o[1],o[2]));break;case "rotate":o=this.parseArray(g);l=f.mulMat4(l,f.angleAxis(o[3]*0.017453278,[o[0],o[1],o[2]]));break;case "scale":o=this.parseArray(g);l=f.mulMat4(l,f.scaleMatrix(o[0],o[1],o[2]));break}while(g=g.nextSibling);e.setLoc(l[3],
l[7],l[11]);g=f.Mat4([l[0],l[1],l[2],0,l[4],l[5],l[6],0,l[8],l[9],l[10],0,0,0,0,1]);e.setRotMatrix(g);if(h)v.GLGEObject=e;return e};f.Collada.prototype.initVisualScene=function(){if(this.rootId){var v=this.xml.getElementById(this.rootId);v?this.addGroup(this.getNode(v)):f.error("Asset "+this.rootId+" not found in document"+this.url)}else{v=this.xml.getElementsByTagName("scene");v.length>0?this.addGroup(this.getNode(v[0])):f.error("Please indicate the asset to render in Collada Document"+this.url)}};
f.Collada.prototype.loaded=function(v,h){this.xml=h;this.initVisualScene();this.getAnimations()};f.Scene.prototype.addCollada=f.Scene.prototype.addGroup;f.Group.prototype.addCollada=f.Group.prototype.addGroup;if(f.Document)f.Document.prototype.getCollada=function(v){if(!v.object){v.object=new (f[this.classString(v.tagName)]);v.object.setDocument(v.getAttribute("document"),this.getAbsolutePath(this.rootURL,null));v.removeAttribute("document");this.setProperties(v)}return v.object}})(GLGE);
define("glge/glge_collada",function(){});define("compiled/libs",function(){});
